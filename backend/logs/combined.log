{"action":"CREATE_MTR_SESSION","auditId":"68b043f15549c42e81eade01","complianceCategory":"clinical_documentation","level":"info","message":"MTR Audit Log Created","resourceId":"68b043f15549c42e81eade00","resourceType":"MedicationTherapyReview","riskLevel":"medium","service":"mtr-audit","timestamp":"2025-08-28 12:56:34","userId":"68b043f15549c42e81eaddfe","workplaceId":"68b043f15549c42e81eaddfd"}
{"action":"DELETE_MTR_SESSION","auditId":"68b043f25549c42e81eade08","complianceCategory":"clinical_documentation","level":"info","message":"MTR Audit Log Created","resourceId":"68b043f15549c42e81eade00","resourceType":"MedicationTherapyReview","riskLevel":"critical","service":"mtr-audit","timestamp":"2025-08-28 12:56:35","userId":"68b043f15549c42e81eaddfe","workplaceId":"68b043f15549c42e81eaddfd"}
{"action":"DELETE_MTR_SESSION","auditId":"68b043f25549c42e81eade08","level":"warn","message":"High-risk activity detected","riskLevel":"critical","service":"mtr-security","timestamp":"2025-08-28 12:56:35","userId":"68b043f15549c42e81eaddfe","workplaceId":"68b043f15549c42e81eaddfd"}
{"action":"ACCESS_PATIENT_VIEW","auditId":"68b043f35549c42e81eade0b","complianceCategory":"data_access","level":"info","message":"MTR Audit Log Created","resourceId":"68b043f15549c42e81eaddff","resourceType":"Patient","riskLevel":"medium","service":"mtr-audit","timestamp":"2025-08-28 12:56:35","userId":"68b043f15549c42e81eaddfe","workplaceId":"68b043f15549c42e81eaddfd"}
{"action":"LOGIN","auditId":"68b043f35549c42e81eade0e","complianceCategory":"system_security","level":"info","message":"MTR Audit Log Created","resourceId":"68b043f15549c42e81eaddfe","resourceType":"User","riskLevel":"low","service":"mtr-audit","timestamp":"2025-08-28 12:56:35","userId":"68b043f15549c42e81eaddfe","workplaceId":"68b043f15549c42e81eaddfd"}
{"action":"CREATE_MTR_SESSION","auditId":"68b0455216c2da6bc95f8518","complianceCategory":"clinical_documentation","level":"info","message":"MTR Audit Log Created","resourceId":"68b0455216c2da6bc95f8517","resourceType":"MedicationTherapyReview","riskLevel":"medium","service":"mtr-audit","timestamp":"2025-08-28 13:02:27","userId":"68b0455216c2da6bc95f8515","workplaceId":"68b0455216c2da6bc95f8514"}
{"action":"DELETE_MTR_SESSION","auditId":"68b0455316c2da6bc95f8520","complianceCategory":"clinical_documentation","level":"info","message":"MTR Audit Log Created","resourceId":"68b0455216c2da6bc95f8517","resourceType":"MedicationTherapyReview","riskLevel":"critical","service":"mtr-audit","timestamp":"2025-08-28 13:02:27","userId":"68b0455216c2da6bc95f8515","workplaceId":"68b0455216c2da6bc95f8514"}
{"action":"DELETE_MTR_SESSION","auditId":"68b0455316c2da6bc95f8520","level":"warn","message":"High-risk activity detected","riskLevel":"critical","service":"mtr-security","timestamp":"2025-08-28 13:02:27","userId":"68b0455216c2da6bc95f8515","workplaceId":"68b0455216c2da6bc95f8514"}
{"action":"ACCESS_PATIENT_VIEW","auditId":"68b0455316c2da6bc95f8523","complianceCategory":"data_access","level":"info","message":"MTR Audit Log Created","resourceId":"68b0455216c2da6bc95f8516","resourceType":"Patient","riskLevel":"medium","service":"mtr-audit","timestamp":"2025-08-28 13:02:28","userId":"68b0455216c2da6bc95f8515","workplaceId":"68b0455216c2da6bc95f8514"}
{"action":"LOGIN","auditId":"68b0455416c2da6bc95f8526","complianceCategory":"system_security","level":"info","message":"MTR Audit Log Created","resourceId":"68b0455216c2da6bc95f8515","resourceType":"User","riskLevel":"low","service":"mtr-audit","timestamp":"2025-08-28 13:02:28","userId":"68b0455216c2da6bc95f8515","workplaceId":"68b0455216c2da6bc95f8514"}
{"endpoint":"/api/mtr","level":"warn","licenseStatus":"approved","message":"MTR access attempt with inactive license","service":"pharma-care-api","timestamp":"2025-08-31 13:48:58","userId":"68ac07aa9c89eac4039ec4f1"}
{"endpoint":"/api/mtr","errorType":"MTRAuthorizationError","level":"warn","message":"MTR Error occurred Active pharmacist license required for MTR operations","method":"POST","service":"pharma-care-api","severity":"high","stack":"MTRAuthorizationError: Active pharmacist license required for MTR operations\n    at validateMTRAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/middlewares/mtrValidation.ts:357:19)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at auditTimer (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/middlewares/auditMiddleware.ts:32:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9","statusCode":403,"timestamp":"2025-08-31 13:48:58","userId":"68ac07aa9c89eac4039ec4f1"}
{"endpoint":"/api/mtr","level":"warn","licenseStatus":"approved","message":"MTR access attempt with inactive license","service":"pharma-care-api","timestamp":"2025-08-31 13:48:58","userId":"68ac07aa9c89eac4039ec4f1"}
{"endpoint":"/api/mtr","errorType":"MTRAuthorizationError","level":"warn","message":"MTR Error occurred Active pharmacist license required for MTR operations","method":"POST","service":"pharma-care-api","severity":"high","stack":"MTRAuthorizationError: Active pharmacist license required for MTR operations\n    at validateMTRAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/middlewares/mtrValidation.ts:357:19)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at auditTimer (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/middlewares/auditMiddleware.ts:32:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9","statusCode":403,"timestamp":"2025-08-31 13:48:58","userId":"68ac07aa9c89eac4039ec4f1"}
{"endpoint":"/api/mtr","level":"info","message":"MTR access granted","method":"POST","service":"pharma-care-api","timestamp":"2025-08-31 13:56:37","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 13:56:37","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":355,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T12:56:37.615Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T12:56:37.615Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 13:56:37"}
{"endpoint":"/api/mtr","level":"info","message":"MTR access granted","method":"POST","service":"pharma-care-api","timestamp":"2025-08-31 14:10:16","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:10:17","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":344,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:10:17.285Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:10:17.285Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:10:17"}
{"endpoint":"/api/mtr","level":"info","message":"MTR access granted","method":"POST","service":"pharma-care-api","timestamp":"2025-08-31 14:54:04","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"}
{"endpoint":"/api/mtr","level":"info","message":"MTR access granted","method":"POST","service":"pharma-care-api","timestamp":"2025-08-31 14:54:04","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:05","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":322,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:05.196Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:05.196Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:05"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:05","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":369,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:05.263Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:05.263Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:05"}
{"endpoint":"/api/mtr","level":"info","message":"MTR access granted","method":"POST","service":"pharma-care-api","timestamp":"2025-08-31 14:54:20","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:20","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":153,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:20.515Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:20.515Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:20"}
