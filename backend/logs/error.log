{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 13:56:37","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":355,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T12:56:37.615Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T12:56:37.615Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 13:56:37"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:10:17","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":344,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:10:17.285Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:10:17.285Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:10:17"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:05","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":322,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:05.196Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:05.196Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:05"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:05","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":369,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:05.263Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:05.263Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:05"}
{"endpoint":"/api/mtr","level":"error","message":"Non-MTR Error occurred Access denied: Resource belongs to different pharmacy","method":"POST","name":"PatientManagementError","service":"pharma-care-api","stack":"PatientManagementError: Access denied: Resource belongs to different pharmacy\n    at createTenantViolationError (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:151:3)\n    at checkTenantAccess (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/utils/responseHelpers.ts:279:37)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrController.ts:158:26\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","statusCode":403,"timestamp":"2025-08-31 14:54:20","userId":"68ac07aa9c89eac4039ec4f1"}
{"auditData":{"action":"CREATE_MTR_SESSION","complianceCategory":"clinical_documentation","details":{"queryParams":{},"requestBody":{"confidentialityAgreed":false,"patientConsent":false,"patientId":"68b0b5bdb26019cd8ea86b98","priority":"routine","reviewType":"initial"},"statusCode":403,"success":false},"duration":153,"errorMessage":{"message":"Access denied: Resource belongs to different pharmacy","timestamp":"2025-08-31T13:54:20.515Z","type":"InternalServerError"},"resourceId":"68ac07aa9c89eac4039ec4f1","resourceType":"MedicationTherapyReview"},"context":{"ipAddress":"::1","requestMethod":"POST","requestUrl":"/api/mtr","userAgent":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36","userId":"68ac07aa9c89eac4039ec4f1","userRole":"super_admin"},"error":"MTRAuditLog validation failed: errorMessage: Cast to string failed for value \"{\n  type: 'InternalServerError',\n  message: 'Access denied: Resource belongs to different pharmacy',\n  timestamp: '2025-08-31T13:54:20.515Z'\n}\" (type Object) at path \"errorMessage\", workplaceId: Path `workplaceId` is required.","level":"error","message":"Failed to create audit log","service":"mtr-audit","timestamp":"2025-08-31 14:54:20"}
{"code":11000,"index":0,"keyPattern":{"name":1},"keyValue":{"name":"Pro"},"level":"error","message":"Failed to upsert plan Pro: E11000 duplicate key error collection: PharmaCare.subscriptionplans index: name_1 dup key: { name: \"Pro\" }","service":"pharma-care-api","stack":"MongoServerError: E11000 duplicate key error collection: PharmaCare.subscriptionplans index: name_1 dup key: { name: \"Pro\" }\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongodb/src/operations/update.ts:154:44\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongodb/src/operations/command.ts:173:14\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-08-31 18:56:51"}
{"code":11000,"index":0,"keyPattern":{"name":1},"keyValue":{"name":"Pro"},"level":"error","message":"Failed to seed plans: E11000 duplicate key error collection: PharmaCare.subscriptionplans index: name_1 dup key: { name: \"Pro\" }","service":"pharma-care-api","stack":"MongoServerError: E11000 duplicate key error collection: PharmaCare.subscriptionplans index: name_1 dup key: { name: \"Pro\" }\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongodb/src/operations/update.ts:154:44\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongodb/src/operations/command.ts:173:14\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-08-31 18:58:38"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Pharmacist')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:154:28)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:166:28)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:197:28)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:245:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Technician')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Technician')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:259:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:276:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:276:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'Owner')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'Owner')\n    at PermissionService.checkWorkplaceRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:302:54)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:94:45)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:276:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:276:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error checking permission: Cannot read properties of undefined (reading 'pharmacist')","service":"pharma-care-api","stack":"TypeError: Cannot read properties of undefined (reading 'pharmacist')\n    at PermissionService.checkSystemRoles (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:266:44)\n    at PermissionService.checkPermission (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:88:42)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at PermissionService.resolveUserPermissions (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/services/PermissionService.ts:121:28)\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/services/PermissionService.test.ts:276:33)","timestamp":"2025-09-01 11:50:26"}
{"level":"error","message":"Error scheduling follow-up reminder: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:82:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 14:07:08"}
{"level":"error","message":"Error checking overdue follow-ups: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:156:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 14:07:08"}
{"level":"error","message":"Error getting notification preferences: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)","service":"pharma-care-api","stack":"MissingSchemaError: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)\n    at Mongoose.Object.<anonymous>.Mongoose.model (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongoose/lib/index.js:544:13)\n    at getNotificationPreferences (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrNotificationController.ts:132:31)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:42:13\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:397:39\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:404:13\n    at mockConstructor (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:148:19)\n    at auth (eval at _createMockFunction (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:50)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at router (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:47:12)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at jsonParser (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/body-parser/lib/types/json.js:113:7)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at expressInit (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/init.js:40:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at query (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/query.js:45:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/application.js:181:10)\n    at Server.app (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/express.js:39:9)\n    at Server.emit (node:events:518:28)\n    at parserOnIncoming (node:_http_server:1153:12)\n    at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)","timestamp":"2025-09-01 14:07:08"}
{"level":"error","message":"Error scheduling follow-up reminder: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:82:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 14:41:11"}
{"level":"error","message":"Error checking overdue follow-ups: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:156:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 14:41:11"}
{"level":"error","message":"Error getting notification preferences: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)","service":"pharma-care-api","stack":"MissingSchemaError: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)\n    at Mongoose.Object.<anonymous>.Mongoose.model (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongoose/lib/index.js:544:13)\n    at getNotificationPreferences (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrNotificationController.ts:132:31)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:42:13\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:397:39\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:404:13\n    at mockConstructor (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:148:19)\n    at auth (eval at _createMockFunction (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:50)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at router (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:47:12)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at jsonParser (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/body-parser/lib/types/json.js:113:7)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at expressInit (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/init.js:40:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at query (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/query.js:45:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/application.js:181:10)\n    at Server.app (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/express.js:39:9)\n    at Server.emit (node:events:518:28)\n    at parserOnIncoming (node:_http_server:1153:12)\n    at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)","timestamp":"2025-09-01 14:41:11"}
{"level":"error","message":"Error scheduling follow-up reminder: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:82:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 15:34:44"}
{"level":"error","message":"Error checking overdue follow-ups: Service error","service":"pharma-care-api","stack":"Error: Service error\n    at Object.<anonymous> (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:156:17)\n    at Promise.then.completed (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/runTest.js:444:34)\n    at Object.worker (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-runner/build/testWorker.js:106:12)","timestamp":"2025-09-01 15:34:44"}
{"level":"error","message":"Error getting notification preferences: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)","service":"pharma-care-api","stack":"MissingSchemaError: Schema hasn't been registered for model \"User\".\nUse mongoose.model(name, schema)\n    at Mongoose.Object.<anonymous>.Mongoose.model (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/mongoose/lib/index.js:544:13)\n    at getNotificationPreferences (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/controllers/mtrNotificationController.ts:132:31)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:284:15\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/src/__tests__/controllers/mtrNotificationController.test.ts:42:13\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:397:39\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:404:13\n    at mockConstructor (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:148:19)\n    at auth (eval at _createMockFunction (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/jest-mock/build/index.js:566:31), <anonymous>:3:50)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at router (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:47:12)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at jsonParser (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/body-parser/lib/types/json.js:113:7)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at expressInit (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/init.js:40:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at query (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/middleware/query.js:45:5)\n    at Layer.handle [as handle_request] (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/layer.js:95:5)\n    at trim_prefix (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:328:13)\n    at /home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:286:9\n    at Function.process_params (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:346:12)\n    at next (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:280:10)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/router/index.js:175:3)\n    at Function.handle (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/application.js:181:10)\n    at Server.app (/home/megagig/PROJECTS/MERN/pharma-care-saas/backend/node_modules/express/lib/express.js:39:9)\n    at Server.emit (node:events:518:28)\n    at parserOnIncoming (node:_http_server:1153:12)\n    at HTTPParser.parserOnHeadersComplete (node:_http_common:117:17)","timestamp":"2025-09-01 15:34:44"}
