import{c as Q,j as a,b3 as ee,g as ae,r as S,bf as te,B as l,T as u,I as re,C as z,b as H,bB as se,bC as ne,bD as ie,D as _,aa as D,bi as m,a5 as c,a7 as y,a8 as N,a9 as C,f as p,bj as A,l as oe,h as E}from"./index-B_pWc9hu.js";import{A as le}from"./ArrowBack-bh5q612l.js";import{S as me}from"./Save-DxF8g1QD.js";import{P as de}from"./Person-YzlArB5c.js";import{L as ce}from"./LocalHospital-BNb4THgq.js";import{d as he,c as ge,e as pe}from"./usePatients-TJUphVTL.js";import{L as ue}from"./LocalizationProvider-CB6kfikn.js";import{A as xe}from"./AdapterDateFns-RQ5vW8pD.js";import{D as je}from"./DatePicker-tSjwJs7r.js";import{A as be}from"./Autocomplete-HcpzFt3K.js";import"./addMonths-BkvcT9-f.js";import"./format-CQst3Dr_.js";import"./useMobilePicker-CrD-8_S2.js";import"./index-BydA3A-2.js";const ve=Q(a.jsx("path",{d:"M20 0H4v2h16zM4 24h16v-2H4zM20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m-8 2.75c1.24 0 2.25 1.01 2.25 2.25s-1.01 2.25-2.25 2.25S9.75 10.24 9.75 9 10.76 6.75 12 6.75M17 17H7v-1.5c0-1.67 3.33-2.5 5-2.5s5 .83 5 2.5z"})),fe=["Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta","Ebonyi","Edo","Ekiti","Enugu","FCT","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi","Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto","Taraba","Yobe","Zamfara"],Se=["A+","A-","B+","B-","AB+","AB-","O+","O-"],ye=["AA","AS","SS","AC","SC","CC"],Ne=["male","female","other"],Ce=["single","married","divorced","widowed"],v=[{label:"Demographics",icon:a.jsx(de,{})},{label:"Contact Info",icon:a.jsx(ve,{})},{label:"Medical Info",icon:a.jsx(ce,{})}],Fe=()=>{var q;const{patientId:b}=ee(),w=ae(),g=!!b,[h,B]=S.useState(0),[M,x]=S.useState(null),{data:f,isLoading:Y}=he(g&&b||""),$=ge(),V=pe(),n="patient"in(f||{})?f.patient:"data"in(f||{})?(q=f.data)==null?void 0:q.patient:void 0,{control:i,handleSubmit:L,watch:d,setValue:k,formState:{errors:r,isSubmitting:K},reset:F}=te({defaultValues:{firstName:"",lastName:"",otherNames:"",dob:null,age:"",gender:"",maritalStatus:"",phone:"",email:"",address:"",state:"",lga:"",bloodGroup:"",genotype:"",weightKg:""}}),J=d("state"),T=d("dob"),G=d("age");S.useEffect(()=>{g&&n&&F({firstName:n.firstName||"",lastName:n.lastName||"",otherNames:n.otherNames||"",dob:n.dob?new Date(n.dob):null,age:n.age||"",gender:n.gender||"",maritalStatus:n.maritalStatus||"",phone:n.phone||"",email:n.email||"",address:n.address||"",state:n.state||"",lga:n.lga||"",bloodGroup:n.bloodGroup||"",genotype:n.genotype||"",weightKg:n.weightKg||""})},[n,g,F]),S.useEffect(()=>{if(T&&(!G||G==="")){const e=new Date,t=new Date(T);let s=e.getFullYear()-t.getFullYear();const o=e.getMonth()-t.getMonth();(o<0||o===0&&e.getDate()<t.getDate())&&s--,s>=0&&s<=150&&k("age",s)}},[T,G,k]);const P=e=>/^\+234[789]\d{9}$/.test(e),I=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),O=async e=>{var t,s,o;try{if(x(null),!e.firstName||!e.firstName.trim()){x("First name is required");return}if(!e.lastName||!e.lastName.trim()){x("Last name is required");return}if(e.phone&&e.phone.trim()&&!P(e.phone)){x("Please enter a valid Nigerian phone number (+234XXXXXXXXX)");return}if(e.email&&e.email.trim()&&!I(e.email)){x("Please enter a valid email address");return}const j={firstName:e.firstName.trim(),lastName:e.lastName.trim(),otherNames:e.otherNames&&e.otherNames.trim()?e.otherNames.trim():void 0,dob:(t=e.dob)==null?void 0:t.toISOString(),age:typeof e.age=="number"?e.age:void 0,gender:e.gender&&e.gender!==""?e.gender:void 0,maritalStatus:e.maritalStatus&&e.maritalStatus!==""?e.maritalStatus:void 0,phone:e.phone&&e.phone.trim()!==""?e.phone.trim():void 0,email:e.email&&e.email.trim()!==""?e.email.trim():void 0,address:e.address&&e.address.trim()!==""?e.address.trim():void 0,state:e.state&&e.state!==""?e.state:void 0,lga:e.lga&&e.lga.trim()!==""?e.lga.trim():void 0,bloodGroup:e.bloodGroup&&e.bloodGroup!==""?e.bloodGroup:void 0,genotype:e.genotype&&e.genotype!==""?e.genotype:void 0,weightKg:typeof e.weightKg=="number"?e.weightKg:void 0};if(g&&b)await V.mutateAsync({patientId:b,patientData:j}),w(`/patients/${b}`);else{const X=await $.mutateAsync(j),U=(o=(s=X==null?void 0:X.data)==null?void 0:s.patient)==null?void 0:o._id;w(U?`/patients/${U}`:"/patients")}}catch(j){console.error("Form submission error:",j),x(j instanceof Error?j.message:"Failed to save patient. Please try again.")}},R=()=>{B(e=>Math.min(e+1,v.length-1))},Z=()=>{B(e=>Math.max(e-1,0))},W=()=>{switch(h){case 0:const e=d("firstName"),t=d("lastName");return!!(e&&e.trim()&&t&&t.trim());case 1:{const s=d("phone"),o=d("email");return!s||s===""||P(s)&&(!o||o===""||I(o))}case 2:return!0;default:return!0}};return g&&Y?a.jsx(l,{sx:{p:3},children:a.jsx(u,{children:"Loading patient data..."})}):a.jsx(ue,{dateAdapter:xe,children:a.jsxs(l,{sx:{p:3},children:[a.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:3},children:[a.jsx(re,{onClick:()=>w("/patients"),sx:{mr:2},children:a.jsx(le,{})}),a.jsxs(l,{sx:{flexGrow:1},children:[a.jsx(u,{variant:"h4",sx:{fontWeight:600,mb:.5},children:g?"Edit Patient":"Add New Patient"}),a.jsx(u,{variant:"body2",color:"text.secondary",children:g?"Update patient information and medical records":"Create a comprehensive patient profile with medical information"})]})]}),a.jsx(z,{sx:{mb:3},children:a.jsx(H,{children:a.jsx(se,{activeStep:h,alternativeLabel:!0,children:v.map(e=>a.jsx(ne,{children:a.jsx(ie,{icon:e.icon,children:e.label})},e.label))})})}),M&&a.jsx(_,{severity:"error",sx:{mb:3},children:M}),a.jsx(z,{children:a.jsx(H,{sx:{p:4},children:a.jsxs("form",{onSubmit:e=>{e.preventDefault(),h===v.length-1&&L(O)(e)},onKeyDown:e=>{e.key==="Enter"&&h!==v.length-1&&(e.preventDefault(),W()&&R())},children:[h===0&&a.jsxs(D,{spacing:3,children:[a.jsx(u,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Patient Demographics"}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[a.jsx(m,{name:"firstName",control:i,rules:{required:"First name is required"},render:({field:e})=>{var t;return a.jsx(c,{...e,label:"First Name",error:!!r.firstName,helperText:(t=r.firstName)==null?void 0:t.message,required:!0})}}),a.jsx(m,{name:"lastName",control:i,rules:{required:"Last name is required"},render:({field:e})=>{var t;return a.jsx(c,{...e,label:"Last Name",error:!!r.lastName,helperText:(t=r.lastName)==null?void 0:t.message,required:!0})}})]}),a.jsx(m,{name:"otherNames",control:i,render:({field:e})=>a.jsx(c,{...e,label:"Other Names",helperText:"Middle names or other names (optional)"})}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[a.jsx(m,{name:"dob",control:i,render:({field:e})=>{var t;return a.jsx(je,{label:"Date of Birth",value:e.value,onChange:s=>e.onChange(s),maxDate:new Date,slotProps:{textField:{error:!!r.dob,helperText:(t=r.dob)==null?void 0:t.message}}})}}),a.jsx(m,{name:"age",control:i,rules:{min:{value:0,message:"Age must be positive"},max:{value:150,message:"Age must be realistic"}},render:({field:e})=>{var t;return a.jsx(c,{...e,type:"number",label:"Age (years)",value:e.value||"",onChange:s=>{const o=s.target.value;e.onChange(o?Number(o):"")},error:!!r.age,helperText:((t=r.age)==null?void 0:t.message)||"Auto-calculated from DOB"})}})]}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[a.jsx(m,{name:"gender",control:i,render:({field:e})=>a.jsxs(y,{error:!!r.gender,children:[a.jsx(N,{children:"Gender"}),a.jsxs(C,{...e,label:"Gender",value:e.value||"",onChange:t=>e.onChange(t.target.value||""),children:[a.jsx(p,{value:"",children:a.jsx("em",{children:"Select Gender"})}),Ne.map(t=>a.jsx(p,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),r.gender&&a.jsx(A,{children:r.gender.message})]})}),a.jsx(m,{name:"maritalStatus",control:i,render:({field:e})=>a.jsxs(y,{error:!!r.maritalStatus,children:[a.jsx(N,{children:"Marital Status"}),a.jsxs(C,{...e,label:"Marital Status",value:e.value||"",onChange:t=>e.onChange(t.target.value||""),children:[a.jsx(p,{value:"",children:a.jsx("em",{children:"Select Marital Status"})}),Ce.map(t=>a.jsx(p,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]}),r.maritalStatus&&a.jsx(A,{children:r.maritalStatus.message})]})})]})]}),h===1&&a.jsxs(D,{spacing:3,children:[a.jsx(u,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Contact Information"}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[a.jsx(m,{name:"phone",control:i,rules:{validate:e=>!e||P(e)||"Enter valid Nigerian phone (+234XXXXXXXXX)"},render:({field:e})=>{var t;return a.jsx(c,{...e,label:"Phone Number",placeholder:"+234812345678",error:!!r.phone,helperText:((t=r.phone)==null?void 0:t.message)||"Nigerian format: +234XXXXXXXXX"})}}),a.jsx(m,{name:"email",control:i,rules:{validate:e=>!e||I(e)||"Enter a valid email address"},render:({field:e})=>{var t;return a.jsx(c,{...e,type:"email",label:"Email Address",error:!!r.email,helperText:(t=r.email)==null?void 0:t.message})}})]}),a.jsx(m,{name:"address",control:i,render:({field:e})=>a.jsx(c,{...e,label:"Address",multiline:!0,rows:2,helperText:"Street address or residential area"})}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:2},children:[a.jsx(m,{name:"state",control:i,render:({field:e})=>a.jsx(be,{options:fe,value:e.value||null,onChange:(t,s)=>e.onChange(s||""),renderInput:t=>{var s;return a.jsx(c,{...t,label:"State",error:!!r.state,helperText:(s=r.state)==null?void 0:s.message})}})}),a.jsx(m,{name:"lga",control:i,render:({field:e})=>a.jsx(c,{...e,label:"Local Government Area",helperText:"LGA within the selected state",disabled:!J})})]})]}),h===2&&a.jsxs(D,{spacing:3,children:[a.jsx(u,{variant:"h6",sx:{fontWeight:600,mb:2},children:"Medical Information"}),a.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:2},children:[a.jsx(m,{name:"bloodGroup",control:i,render:({field:e})=>a.jsxs(y,{error:!!r.bloodGroup,children:[a.jsx(N,{children:"Blood Group"}),a.jsxs(C,{...e,label:"Blood Group",value:e.value||"",onChange:t=>e.onChange(t.target.value||""),children:[a.jsx(p,{value:"",children:a.jsx("em",{children:"Select Blood Group"})}),Se.map(t=>a.jsx(p,{value:t,children:t},t))]}),r.bloodGroup&&a.jsx(A,{children:r.bloodGroup.message})]})}),a.jsx(m,{name:"genotype",control:i,render:({field:e})=>a.jsxs(y,{error:!!r.genotype,children:[a.jsx(N,{children:"Genotype"}),a.jsxs(C,{...e,label:"Genotype",value:e.value||"",onChange:t=>e.onChange(t.target.value||""),children:[a.jsx(p,{value:"",children:a.jsx("em",{children:"Select Genotype"})}),ye.map(t=>a.jsx(p,{value:t,children:a.jsxs(l,{sx:{display:"flex",alignItems:"center"},children:[t,t.includes("S")&&a.jsx(oe,{label:"Sickle Cell",size:"small",color:"warning",sx:{ml:1,fontSize:"0.7rem"}})]})},t))]}),r.genotype&&a.jsx(A,{children:r.genotype.message})]})}),a.jsx(m,{name:"weightKg",control:i,rules:{min:{value:.5,message:"Weight must be positive"},max:{value:500,message:"Weight must be realistic"}},render:({field:e})=>{var t;return a.jsx(c,{...e,type:"number",label:"Weight (kg)",value:e.value||"",onChange:s=>{const o=s.target.value;e.onChange(o?Number(o):"")},error:!!r.weightKg,helperText:(t=r.weightKg)==null?void 0:t.message,inputProps:{step:.1,min:.5,max:500}})}})]}),a.jsx(_,{severity:"info",children:a.jsxs(u,{variant:"body2",children:[a.jsx("strong",{children:"Medical Information:"})," Blood group and genotype are important for emergency situations and medication compatibility. Weight is used for dosage calculations.",d("genotype")&&typeof d("genotype")=="string"&&d("genotype").includes("S")&&a.jsx(l,{sx:{mt:1,fontWeight:600,color:"warning.main"},children:"⚠️ Sickle cell genotype detected - requires special medical attention"})]})})]}),a.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",mt:4,pt:3,borderTop:1,borderColor:"divider"},children:[a.jsx(l,{children:h>0&&a.jsx(E,{onClick:Z,sx:{mr:2},children:"Back"})}),a.jsx(l,{children:h<v.length-1?a.jsx(E,{variant:"contained",onClick:R,disabled:!W(),children:"Next"}):a.jsx(E,{variant:"contained",startIcon:a.jsx(me,{}),disabled:K,sx:{minWidth:120},onClick:L(O),children:K?"Saving...":g?"Update Patient":"Create Patient"})})]})]})})})]})})};export{Fe as default};
