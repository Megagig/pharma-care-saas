import{c as _e,j as e,B as n,T as s,d as E,l as b,x as He,w as ie,W as O,b5 as N,r as z,D as C,b4 as ee,a9 as L,Q as F,I as G,aU as H,ck as Ue,V as ke,aT as Be,h as D,bs as le,R as ce,q as me,L as J,n as M,aq as q,p as P,O as Q,aa as de,Y as xe,bo as K,bp as Y,bq as X,C as se,b as he,bC as Se,G as R,_ as ge,$ as Me,aP as Pe,aQ as Fe,aR as Ee,a4 as _,aS as Ne,bi as $e,c6 as fe,bE as ve,c7 as be,u as Ve,aW as Ge,g as Qe,b0 as Ke,cl as Ye,aX as Z,bj as Xe,bk as ae,y as Je}from"./index-louytu0d.js";import{E as pe}from"./Edit-B2er_J4R.js";import"./labStore-DWXuQil6.js";import{L as ne}from"./LocalHospital-BMwh71ta.js";import{E as Ze}from"./ExpandLess-BOUZH1RV.js";import{R as es}from"./Refresh-BWfz7OQR.js";import{P as qe}from"./Person-BO7Sszq-.js";import{C as ue}from"./Cancel-ngHfCh8l.js";import{E as ss}from"./ErrorBoundary-C2-bA3VX.js";import{d as re}from"./diagnosticApi-CpaUG7NC.js";import{D as is}from"./diagnosticFeatureGuard-BZJ2GOC_.js";import{A as ns}from"./ArrowBack-BItWCU58.js";import{P as rs}from"./Print-DJVTjYC_.js";import{D as ts}from"./Download-vzkMIyVG.js";import{S as as}from"./Share-aBoB7pKP.js";import{f as os}from"./format-CuO4PcXN.js";import"./Add-DinP5QbX.js";import"./Delete-CTgRaLP1.js";import"./Search-BDaMMIPP.js";import"./Autocomplete-DW-SeE61.js";import"./BugReport-Bln5s9ri.js";import"./Upgrade-BSH-OY3n.js";const ls=_e(e.jsx("path",{d:"M10.5 13H8v-3h2.5V7.5h3V10H16v3h-2.5v2.5h-3zM12 2 4 5v6.09c0 5.05 3.41 9.76 8 10.91 4.59-1.15 8-5.86 8-10.91V5z"})),cs=i=>i>=.8?{level:"high",label:"High Confidence",color:"success",icon:ie,description:"AI analysis shows high confidence in this assessment"}:i>=.6?{level:"medium",label:"Medium Confidence",color:"warning",icon:O,description:"AI analysis shows moderate confidence - consider additional evaluation"}:i>=.4?{level:"low",label:"Low Confidence",color:"error",icon:N,description:"AI analysis shows low confidence - manual review strongly recommended"}:{level:"very-low",label:"Very Low Confidence",color:"error",icon:N,description:"AI analysis shows very low confidence - manual assessment required"},ds=i=>{switch(i){case"small":return{height:4,fontSize:"0.75rem",iconSize:16,chipSize:"small"};case"large":return{height:8,fontSize:"1rem",iconSize:24,chipSize:"medium"};default:return{height:6,fontSize:"0.875rem",iconSize:20,chipSize:"small"}}},ye=({confidence:i,size:h="medium",showLabel:r=!0,showPercentage:m=!0,variant:j="linear"})=>{const c=cs(i),g=ds(h),x=Math.round(i*100),f=c.icon,A=e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",sx:{fontWeight:600,mb:.5},children:[c.label," (",x,"%)"]}),e.jsx(s,{variant:"caption",children:c.description})]});return j==="chip"?e.jsx(E,{title:A,arrow:!0,children:e.jsx(b,{icon:e.jsx(f,{sx:{fontSize:g.iconSize}}),label:m?`${x}%`:c.label,size:g.chipSize,color:c.color,variant:"outlined",sx:{"& .MuiChip-icon":{color:"inherit"}}})}):j==="circular"?e.jsx(E,{title:A,arrow:!0,children:e.jsxs(n,{sx:{display:"inline-flex",alignItems:"center",gap:1},children:[e.jsxs(n,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",width:h==="small"?32:h==="large"?48:40,height:h==="small"?32:h==="large"?48:40},children:[e.jsx(n,{sx:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",border:"2px solid",borderColor:"grey.300"}}),e.jsx(n,{sx:{position:"absolute",width:"100%",height:"100%",borderRadius:"50%",border:"2px solid",borderColor:`${c.color}.main`,borderTopColor:"transparent",borderRightColor:"transparent",transform:`rotate(${i*360-90}deg)`,transition:"transform 0.3s ease-in-out"}}),e.jsx(f,{sx:{fontSize:g.iconSize,color:`${c.color}.main`,zIndex:1}})]}),(r||m)&&e.jsxs(n,{children:[r&&e.jsx(s,{variant:"caption",sx:{fontSize:g.fontSize,fontWeight:600,display:"block",color:`${c.color}.main`},children:c.label}),m&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontSize:g.fontSize},children:[x,"%"]})]})]})}):e.jsx(E,{title:A,arrow:!0,children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:h==="small"?80:h==="large"?150:120},children:[e.jsx(f,{sx:{fontSize:g.iconSize,color:`${c.color}.main`}}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:.5},children:[r&&e.jsx(s,{variant:"caption",sx:{fontSize:g.fontSize,fontWeight:600,color:`${c.color}.main`},children:h==="small"?c.level.toUpperCase():c.label}),m&&e.jsxs(s,{variant:"caption",color:"text.secondary",sx:{fontSize:g.fontSize},children:[x,"%"]})]}),e.jsx(He,{variant:"determinate",value:x,color:c.color,sx:{height:g.height,borderRadius:g.height/2,backgroundColor:"grey.200","& .MuiLinearProgress-bar":{borderRadius:g.height/2}}})]})]})})},De={critical:{color:"error",icon:N,label:"Critical",bgColor:"error.light",textColor:"error.contrastText",description:"Immediate medical attention required"},high:{color:"error",icon:N,label:"High Risk",bgColor:"error.light",textColor:"error.contrastText",description:"Urgent medical evaluation needed"},medium:{color:"warning",icon:O,label:"Medium Risk",bgColor:"warning.light",textColor:"warning.contrastText",description:"Medical attention recommended"},low:{color:"info",icon:Q,label:"Low Risk",bgColor:"info.light",textColor:"info.contrastText",description:"Monitor and follow up as needed"}},Ae={"immediate referral":ne,"call physician":le,"schedule follow-up":me,"document findings":ce,"monitor closely":ke},Le=({redFlags:i,showActions:h=!0,onActionClick:r})=>{const[m,j]=z.useState(new Set),[c,g]=z.useState(new Set),x=o=>{const l=new Set(m);l.has(o)?l.delete(o):l.add(o),j(l)},f=o=>{const l=new Set(c);l.has(o)?l.delete(o):l.add(o),g(l)},A=o=>De[o]||De.medium,$=o=>{const l=o.toLowerCase(),u=Object.keys(Ae).find(y=>l.includes(y));return u?Ae[u]:ce},T=[...i].sort((o,l)=>{const u={critical:4,high:3,medium:2,low:1};return(u[l.severity]||0)-(u[o.severity]||0)}).filter((o,l)=>!c.has(l)),a=i.filter(o=>o.severity==="critical").length,d=i.filter(o=>o.severity==="high").length;return i.length===0?null:e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600,mb:1,display:"flex",alignItems:"center"},children:[e.jsx(N,{sx:{mr:1,color:"error.main"}}),"Clinical Red Flags (",i.length,")"]}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:2},children:[a>0&&e.jsx(b,{icon:e.jsx(N,{}),label:`${a} Critical`,color:"error",variant:"filled",size:"small"}),d>0&&e.jsx(b,{icon:e.jsx(N,{}),label:`${d} High Risk`,color:"error",variant:"outlined",size:"small"}),e.jsx(b,{label:`${i.length} Total Flags`,variant:"outlined",size:"small"})]}),(a>0||d>0)&&e.jsxs(C,{severity:"error",sx:{mb:2},children:[e.jsx(ee,{children:"Immediate Attention Required"}),e.jsxs(s,{variant:"body2",children:[a>0&&`${a} critical finding(s) detected. `,d>0&&`${d} high-risk condition(s) identified. `,"Review all red flags and take appropriate action immediately."]})]})]}),e.jsx(L,{spacing:2,children:T.map((o,l)=>{const u=A(o.severity),y=u.icon,p=$(o.action),S=m.has(l);return e.jsxs(F,{elevation:o.severity==="critical"?3:1,sx:{border:o.severity==="critical"?2:1,borderColor:`${u.color}.main`,borderRadius:2},children:[e.jsx(n,{sx:{p:2,bgcolor:u.bgColor,color:u.textColor,borderRadius:"8px 8px 0 0"},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(y,{sx:{fontSize:24}}),e.jsxs(n,{children:[e.jsx(s,{variant:"subtitle1",sx:{fontWeight:600},children:o.flag}),e.jsx(s,{variant:"caption",sx:{opacity:.9},children:u.description})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{label:u.label,size:"small",sx:{bgcolor:"rgba(255, 255, 255, 0.2)",color:"inherit",fontWeight:600}}),e.jsx(E,{title:S?"Collapse details":"Expand details",children:e.jsx(G,{size:"small",onClick:()=>x(l),sx:{color:"inherit"},children:S?e.jsx(Ze,{}):e.jsx(H,{})})}),e.jsx(E,{title:c.has(l)?"Show flag":"Hide flag",children:e.jsx(G,{size:"small",onClick:()=>f(l),sx:{color:"inherit"},children:c.has(l)?e.jsx(Ue,{}):e.jsx(ke,{})})})]})]})}),e.jsx(Be,{in:S,children:e.jsxs(n,{sx:{p:2},children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(s,{variant:"subtitle2",sx:{fontWeight:600,mb:1,display:"flex",alignItems:"center"},children:[e.jsx(p,{sx:{mr:1,fontSize:18}}),"Recommended Action"]}),e.jsx(C,{severity:u.color,variant:"outlined",children:e.jsx(s,{variant:"body2",children:o.action})})]}),h&&e.jsxs(n,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[o.severity==="critical"&&e.jsx(D,{variant:"contained",color:"error",size:"small",startIcon:e.jsx(ne,{}),onClick:()=>r==null?void 0:r(o,"emergency_referral"),children:"Emergency Referral"}),(o.severity==="critical"||o.severity==="high")&&e.jsx(D,{variant:"outlined",color:"error",size:"small",startIcon:e.jsx(le,{}),onClick:()=>r==null?void 0:r(o,"call_physician"),children:"Call Physician"}),e.jsx(D,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(ce,{}),onClick:()=>r==null?void 0:r(o,"document"),children:"Document"}),e.jsx(D,{variant:"outlined",color:"primary",size:"small",startIcon:e.jsx(me,{}),onClick:()=>r==null?void 0:r(o,"schedule_followup"),children:"Schedule Follow-up"})]})]})})]},l)})}),c.size>0&&e.jsx(n,{sx:{mt:2},children:e.jsxs(C,{severity:"info",variant:"outlined",children:[e.jsxs(s,{variant:"body2",children:[c.size," flag(s) hidden. Click the visibility icon to show them again."]}),e.jsx(D,{size:"small",onClick:()=>g(new Set),sx:{mt:1},children:"Show All Flags"})]})}),(a>0||d>0)&&e.jsx(n,{sx:{mt:3},children:e.jsxs(C,{severity:"error",children:[e.jsx(ee,{children:"Emergency Protocols"}),e.jsx(s,{variant:"body2",sx:{mb:1},children:"For critical findings, ensure immediate medical evaluation:"}),e.jsxs(J,{dense:!0,children:[e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(le,{color:"error"})}),e.jsx(P,{primary:"Emergency Services: 911",secondary:"For life-threatening conditions"})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(ne,{color:"error"})}),e.jsx(P,{primary:"Nearest Emergency Department",secondary:"For urgent medical evaluation"})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(le,{color:"warning"})}),e.jsx(P,{primary:"On-call Physician",secondary:"For immediate consultation"})]})]})]})})]})},We={major:{color:"error",icon:N,label:"Major",description:"Significant clinical interaction - avoid combination"},moderate:{color:"warning",icon:O,label:"Moderate",description:"Monitor closely and consider alternatives"},minor:{color:"info",icon:Q,label:"Minor",description:"Monitor for effects but generally safe"}},ze={severe:{color:"error",icon:N,label:"Severe Allergy",description:"Contraindicated - do not use"},moderate:{color:"warning",icon:O,label:"Moderate Allergy",description:"Use with extreme caution"},mild:{color:"info",icon:Q,label:"Mild Allergy",description:"Monitor for allergic reactions"}},Te={contraindicated:{color:"error",icon:N,label:"Contraindicated",description:"Do not use in this condition"},warning:{color:"warning",icon:O,label:"Use with Caution",description:"Monitor closely in this condition"}},Oe=({medications:i,patientAllergies:h=[],patientConditions:r=[],onCheckInteractions:m,loading:j=!1})=>{const[c,g]=z.useState([]),[x,f]=z.useState([]),[A,$]=z.useState([]),[k,T]=z.useState(!1),[a,d]=z.useState(null),[o,l]=z.useState(new Set(["interactions"])),u=t=>{const I=new Set(o);I.has(t)?I.delete(t):I.add(t),l(I)},y=async()=>{if(!(!m||i.length===0)){T(!0),d(null);try{const t=i.map(v=>v.drugName),I=await m(t);g(I.interactions||[]),f(I.allergies||[]),$(I.contraindications||[])}catch(t){d(t instanceof Error?t.message:"Failed to check interactions")}finally{T(!1)}}};z.useEffect(()=>{i.length>0&&y()},[i]);const p=(t,I)=>{switch(I){case"allergy":return ze[t]||ze.mild;case"contraindication":return Te[t]||Te.warning;default:return We[t]||We.minor}},S=c.length+x.length+A.length,w=[...c.filter(t=>t.severity==="major"),...x.filter(t=>t.severity==="severe"),...A.filter(t=>t.severity==="contraindicated")].length;return i.length===0?null:e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center"},children:[e.jsx(ls,{sx:{mr:1,color:"primary.main"}}),"Drug Safety Analysis"]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[(k||j)&&e.jsx(de,{size:20}),e.jsx(E,{title:"Refresh interaction check",children:e.jsx(G,{size:"small",onClick:y,disabled:k||j,children:e.jsx(es,{})})})]})]}),e.jsxs(n,{sx:{display:"flex",gap:1,mb:2},children:[e.jsx(b,{label:`${i.length} Medications`,variant:"outlined",size:"small",icon:e.jsx(xe,{})}),S>0&&e.jsx(b,{label:`${S} Alert(s)`,color:w>0?"error":"warning",variant:"filled",size:"small"}),w>0&&e.jsx(b,{label:`${w} Critical`,color:"error",variant:"filled",size:"small"})]}),a&&e.jsxs(C,{severity:"error",sx:{mb:2},children:[e.jsx(ee,{children:"Interaction Check Failed"}),e.jsx(s,{variant:"body2",children:a}),e.jsx(D,{size:"small",onClick:y,sx:{mt:1},children:"Retry"})]}),w>0&&e.jsxs(C,{severity:"error",sx:{mb:2},children:[e.jsx(ee,{children:"Critical Drug Safety Alerts"}),e.jsxs(s,{variant:"body2",children:[w," critical safety issue(s) detected. Review all alerts before prescribing."]})]})]}),c.length>0&&e.jsxs(K,{expanded:o.has("interactions"),onChange:()=>u("interactions"),children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(xe,{color:"warning"}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Drug-Drug Interactions (",c.length,")"]}),c.some(t=>t.severity==="major")&&e.jsx(b,{label:"Major Interactions",color:"error",size:"small",variant:"filled"})]})}),e.jsx(X,{children:e.jsx(L,{spacing:2,children:c.map((t,I)=>{const v=p(t.severity,"interaction"),B=v.icon;return e.jsx(F,{variant:"outlined",sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(B,{color:v.color}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsxs(s,{variant:"subtitle2",sx:{fontWeight:600},children:[t.drug1," + ",t.drug2]}),e.jsx(b,{label:v.label,color:v.color,size:"small",variant:"outlined"})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:v.description}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Clinical Effect:"})," ",t.clinicalEffect]}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Description:"})," ",t.description]}),t.mechanism&&e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Mechanism:"})," ",t.mechanism]}),t.management&&e.jsx(C,{severity:v.color,variant:"outlined",sx:{mt:1},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Management:"})," ",t.management]})})]})]})},I)})})})]}),x.length>0&&e.jsxs(K,{expanded:o.has("allergies"),onChange:()=>u("allergies"),sx:{mt:1},children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{color:"error"}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Allergy Alerts (",x.length,")"]}),x.some(t=>t.severity==="severe")&&e.jsx(b,{label:"Severe Allergies",color:"error",size:"small",variant:"filled"})]})}),e.jsx(X,{children:e.jsx(L,{spacing:2,children:x.map((t,I)=>{const v=p(t.severity,"allergy"),B=v.icon;return e.jsx(F,{variant:"outlined",sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(B,{color:v.color}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:600},children:t.drug}),e.jsx(b,{label:v.label,color:v.color,size:"small",variant:"filled"})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:v.description}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Known Allergy:"})," ",t.allergy]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Reaction:"})," ",t.reaction]})]})]})},I)})})})]}),A.length>0&&e.jsxs(K,{expanded:o.has("contraindications"),onChange:()=>u("contraindications"),sx:{mt:1},children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(N,{color:"error"}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Contraindications (",A.length,")"]}),A.some(t=>t.severity==="contraindicated")&&e.jsx(b,{label:"Absolute Contraindications",color:"error",size:"small",variant:"filled"})]})}),e.jsx(X,{children:e.jsx(L,{spacing:2,children:A.map((t,I)=>{const v=p(t.severity,"contraindication"),B=v.icon;return e.jsx(F,{variant:"outlined",sx:{p:2},children:e.jsxs(n,{sx:{display:"flex",alignItems:"flex-start",gap:2},children:[e.jsx(B,{color:v.color}),e.jsxs(n,{sx:{flex:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:600},children:t.drug}),e.jsx(b,{label:v.label,color:v.color,size:"small",variant:"filled"})]}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:1},children:v.description}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Condition:"})," ",t.condition]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Reason:"})," ",t.reason]})]})]})},I)})})})]}),!k&&!j&&S===0&&e.jsxs(C,{severity:"success",sx:{mt:2},children:[e.jsx(ee,{children:"No Safety Alerts"}),e.jsx(s,{variant:"body2",children:"No drug interactions, allergies, or contraindications detected for the suggested medications."})]}),e.jsx(C,{severity:"info",sx:{mt:2},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Safety Note:"})," This analysis is based on available drug interaction databases. Always consult current prescribing information and consider individual patient factors."]})})]})},xs={low:{color:"success",icon:ie,label:"Low Risk"},medium:{color:"warning",icon:O,label:"Medium Risk"},high:{color:"error",icon:N,label:"High Risk"}},hs={urgent:{color:"error",label:"Urgent",icon:N},routine:{color:"info",label:"Routine",icon:me},optional:{color:"default",label:"Optional",icon:Q}},ms={immediate:{color:"error",label:"Immediate",severity:"error"},within_24h:{color:"warning",label:"Within 24h",severity:"warning"},routine:{color:"info",label:"Routine",severity:"info"}},js=({result:i,onApprove:h,onModify:r,onReject:m,loading:j=!1,error:c})=>{var T;const[g,x]=z.useState(new Set(["diagnoses","redFlags"])),f=a=>{const d=new Set(g);d.has(a)?d.delete(a):d.add(a),x(d)},A=a=>{const d=xs[a];if(!d)return null;const o=d.icon;return e.jsx(b,{icon:e.jsx(o,{sx:{fontSize:16}}),label:d.label,size:"small",color:d.color,variant:"outlined"})},$=a=>{const d=hs[a];if(!d)return null;const o=d.icon;return e.jsx(b,{icon:e.jsx(o,{sx:{fontSize:16}}),label:d.label,size:"small",color:d.color,variant:"outlined"})},k=a=>{const d=ms[a];return d?e.jsx(C,{severity:d.severity,sx:{mb:2},children:e.jsxs(s,{variant:"body2",sx:{fontWeight:600},children:["Referral Urgency: ",d.label]})}):null};return e.jsx(se,{children:e.jsxs(he,{children:[e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center"},children:[e.jsx(Se,{sx:{mr:1,color:"primary.main"}}),"AI Diagnostic Analysis"]}),e.jsx(ye,{confidence:i.aiMetadata.confidenceScore,size:"large"})]}),e.jsxs(R,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(R,{item:!0,xs:6,md:3,children:e.jsxs(F,{sx:{p:1.5,textAlign:"center"},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Model"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:i.aiMetadata.modelId})]})}),e.jsx(R,{item:!0,xs:6,md:3,children:e.jsxs(F,{sx:{p:1.5,textAlign:"center"},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Processing Time"}),e.jsxs(s,{variant:"body2",sx:{fontWeight:600},children:[(i.aiMetadata.processingTime/1e3).toFixed(1),"s"]})]})}),e.jsx(R,{item:!0,xs:6,md:3,children:e.jsxs(F,{sx:{p:1.5,textAlign:"center"},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Tokens Used"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:i.aiMetadata.tokenUsage.totalTokens.toLocaleString()})]})}),e.jsx(R,{item:!0,xs:6,md:3,children:e.jsxs(F,{sx:{p:1.5,textAlign:"center"},children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Confidence"}),e.jsxs(s,{variant:"body2",sx:{fontWeight:600},children:[(i.aiMetadata.confidenceScore*100).toFixed(1),"%"]})]})})]}),c&&e.jsx(C,{severity:"error",sx:{mb:2},children:c})]}),i.redFlags.length>0&&e.jsx(n,{sx:{mb:3},children:e.jsx(Le,{redFlags:i.redFlags})}),((T=i.referralRecommendation)==null?void 0:T.recommended)&&e.jsxs(n,{sx:{mb:3},children:[k(i.referralRecommendation.urgency),e.jsxs(C,{severity:"warning",icon:e.jsx(ne,{}),children:[e.jsxs(s,{variant:"body2",sx:{fontWeight:600,mb:1},children:["Referral Recommended: ",i.referralRecommendation.specialty]}),e.jsx(s,{variant:"body2",children:i.referralRecommendation.reason})]})]}),e.jsxs(L,{spacing:2,children:[e.jsxs(K,{expanded:g.has("diagnoses"),onChange:()=>f("diagnoses"),children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(Se,{sx:{mr:1,color:"primary.main"}}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Differential Diagnoses (",i.diagnoses.length,")"]}),e.jsx(n,{sx:{ml:"auto",mr:2},children:e.jsx(b,{label:`Avg Confidence: ${(i.diagnoses.reduce((a,d)=>a+d.probability,0)/i.diagnoses.length*100).toFixed(1)}%`,size:"small",color:"primary",variant:"outlined"})})]})}),e.jsx(X,{children:e.jsx(J,{children:i.diagnoses.map((a,d)=>e.jsxs(M,{divider:d<i.diagnoses.length-1,children:[e.jsx(q,{children:e.jsx(n,{sx:{display:"flex",alignItems:"center",minWidth:80},children:e.jsx(ye,{confidence:a.probability,size:"small"})})}),e.jsx(P,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(s,{variant:"body1",sx:{fontWeight:600},children:a.condition}),A(a.severity),a.icdCode&&e.jsx(b,{label:`ICD: ${a.icdCode}`,size:"small",variant:"outlined"}),a.snomedCode&&e.jsx(b,{label:`SNOMED: ${a.snomedCode}`,size:"small",variant:"outlined"})]}),secondary:e.jsx(s,{variant:"body2",color:"text.secondary",children:a.reasoning})})]},d))})})]}),i.suggestedTests.length>0&&e.jsxs(K,{expanded:g.has("tests"),onChange:()=>f("tests"),children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ge,{sx:{mr:1,color:"secondary.main"}}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Suggested Laboratory Tests (",i.suggestedTests.length,")"]})]})}),e.jsx(X,{children:e.jsx(J,{children:i.suggestedTests.map((a,d)=>e.jsxs(M,{divider:d<i.suggestedTests.length-1,children:[e.jsx(q,{children:e.jsx(ge,{color:"secondary"})}),e.jsx(P,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(s,{variant:"body1",sx:{fontWeight:600},children:a.testName}),$(a.priority),a.loincCode&&e.jsx(b,{label:`LOINC: ${a.loincCode}`,size:"small",variant:"outlined"})]}),secondary:e.jsx(s,{variant:"body2",color:"text.secondary",children:a.reasoning})})]},d))})})]}),i.medicationSuggestions.length>0&&e.jsxs(K,{expanded:g.has("medications"),onChange:()=>f("medications"),children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(xe,{sx:{mr:1,color:"success.main"}}),e.jsxs(s,{variant:"subtitle1",sx:{fontWeight:600},children:["Medication Suggestions (",i.medicationSuggestions.length,")"]})]})}),e.jsx(X,{children:e.jsxs(L,{spacing:2,children:[i.medicationSuggestions.map((a,d)=>e.jsxs(F,{sx:{p:2},variant:"outlined",children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:600},children:a.drugName}),a.rxcui&&e.jsx(b,{label:`RxCUI: ${a.rxcui}`,size:"small",variant:"outlined"})]}),e.jsxs(R,{container:!0,spacing:2,sx:{mb:2},children:[e.jsxs(R,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Dosage"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:a.dosage})]}),e.jsxs(R,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Frequency"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:a.frequency})]}),e.jsxs(R,{item:!0,xs:6,md:3,children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Duration"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:a.duration})]})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:[e.jsx("strong",{children:"Reasoning:"})," ",a.reasoning]}),a.safetyNotes.length>0&&e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:1},children:"Safety Notes:"}),e.jsx(L,{spacing:.5,children:a.safetyNotes.map((o,l)=>e.jsx(C,{severity:"warning",sx:{py:.5},children:e.jsx(s,{variant:"body2",children:o})},l))})]})]},d)),e.jsx(Oe,{medications:i.medicationSuggestions})]})})]})]}),e.jsx(Me,{sx:{my:3}}),e.jsx(C,{severity:"info",sx:{mb:3},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"AI Disclaimer:"})," ",i.disclaimer]})}),i.pharmacistReview&&e.jsxs(n,{sx:{mb:2},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Pharmacist Review Status"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(b,{label:i.pharmacistReview.status.toUpperCase(),color:i.pharmacistReview.status==="approved"?"success":i.pharmacistReview.status==="modified"?"warning":"error",variant:"filled"}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Reviewed on"," ",new Date(i.pharmacistReview.reviewedAt).toLocaleDateString()]})]}),i.pharmacistReview.modifications&&e.jsx(C,{severity:"info",sx:{mt:2},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Modifications:"})," ",i.pharmacistReview.modifications]})}),i.pharmacistReview.rejectionReason&&e.jsx(C,{severity:"error",sx:{mt:2},children:e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Rejection Reason:"})," ",i.pharmacistReview.rejectionReason]})})]}),!i.pharmacistReview&&(h||r||m)&&e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[m&&e.jsx(D,{variant:"outlined",color:"error",onClick:m,disabled:j,children:"Reject"}),r&&e.jsx(D,{variant:"outlined",color:"warning",onClick:r,disabled:j,children:"Modify"}),h&&e.jsx(D,{variant:"contained",color:"success",onClick:h,disabled:j,children:j?"Processing...":"Approve"})]})]})})},gs=({result:i,onApprove:h,onModify:r,onReject:m,loading:j=!1,error:c,currentUser:g})=>{var p,S;const[x,f]=z.useState({open:!1,type:null,text:"",confirmationRequired:!1}),[A,$]=z.useState(new Set),k=w=>{const t=new Set(A);t.has(w)?t.delete(w):t.add(w),$(t)},T=w=>{var I;const t=w==="approve"&&(i.redFlags.some(v=>v.severity==="critical"||v.severity==="high")||((I=i.referralRecommendation)==null?void 0:I.recommended));f({open:!0,type:w,text:"",confirmationRequired:t})},a=()=>{f({open:!1,type:null,text:"",confirmationRequired:!1})},d=()=>{const{type:w,text:t}=x;switch(w){case"approve":h==null||h();break;case"modify":t.trim()&&(r==null||r(t.trim()));break;case"reject":t.trim()&&(m==null||m(t.trim()));break}a()},o=()=>{if(!i.pharmacistReview)return e.jsx(b,{label:"Pending Review",color:"warning",variant:"outlined",icon:e.jsx(me,{})});const{status:w}=i.pharmacistReview,I={approved:{color:"success",icon:ie,label:"Approved"},modified:{color:"warning",icon:pe,label:"Modified"},rejected:{color:"error",icon:ue,label:"Rejected"}}[w],v=I.icon;return e.jsx(b,{label:I.label,color:I.color,variant:"filled",icon:e.jsx(v,{})})},l=!!i.pharmacistReview,u=i.redFlags.some(w=>w.severity==="critical"||w.severity==="high"),y=(p=i.referralRecommendation)==null?void 0:p.recommended;return e.jsxs(se,{children:[e.jsxs(he,{children:[e.jsxs(n,{sx:{mb:3},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[e.jsxs(s,{variant:"h6",sx:{fontWeight:600,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1,color:"primary.main"}}),"Pharmacist Review"]}),o()]}),c&&e.jsx(C,{severity:"error",sx:{mb:2},children:c}),!l&&(u||y)&&e.jsxs(C,{severity:"warning",sx:{mb:2},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:600,mb:1},children:"Special Attention Required"}),e.jsxs(L,{spacing:.5,children:[u&&e.jsx(s,{variant:"body2",children:"• Critical or high-risk red flags detected"}),y&&e.jsxs(s,{variant:"body2",children:["• AI recommends referral to"," ",(S=i.referralRecommendation)==null?void 0:S.specialty]})]})]})]}),l&&e.jsx(n,{sx:{mb:3},children:e.jsxs(K,{expanded:A.has("history"),onChange:()=>k("history"),children:[e.jsx(Y,{expandIcon:e.jsx(H,{}),children:e.jsx(s,{variant:"subtitle1",sx:{fontWeight:600},children:"Review History"})}),e.jsx(X,{children:e.jsx(n,{sx:{p:2,bgcolor:"grey.50",borderRadius:1},children:e.jsxs(L,{spacing:2,children:[e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Reviewed By"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:i.pharmacistReview.reviewedBy})]}),e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Review Date"}),e.jsx(s,{variant:"body2",sx:{fontWeight:600},children:new Date(i.pharmacistReview.reviewedAt).toLocaleString()})]}),e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Decision"}),e.jsx(n,{sx:{mt:.5},children:o()})]}),i.pharmacistReview.modifications&&e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Modifications Made"}),e.jsx(C,{severity:"info",sx:{mt:1},children:e.jsx(s,{variant:"body2",children:i.pharmacistReview.modifications})})]}),i.pharmacistReview.rejectionReason&&e.jsxs(n,{children:[e.jsx(s,{variant:"caption",color:"text.secondary",children:"Rejection Reason"}),e.jsx(C,{severity:"error",sx:{mt:1},children:e.jsx(s,{variant:"body2",children:i.pharmacistReview.rejectionReason})})]})]})})})]})}),!l&&e.jsxs(n,{sx:{mb:3},children:[e.jsx(s,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Review Checklist"}),e.jsxs(J,{children:[e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(E,{title:"Verify diagnostic accuracy",children:e.jsx(Q,{color:"primary"})})}),e.jsx(P,{primary:"Diagnostic Assessment",secondary:"Review differential diagnoses for clinical accuracy and relevance"})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(E,{title:"Check medication safety",children:e.jsx(Q,{color:"primary"})})}),e.jsx(P,{primary:"Medication Safety",secondary:"Verify drug selections, dosages, and interaction checks"})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(E,{title:"Assess red flags",children:e.jsx(O,{color:"warning"})})}),e.jsx(P,{primary:"Red Flag Assessment",secondary:"Evaluate critical findings and recommended actions"})]}),e.jsxs(M,{children:[e.jsx(q,{children:e.jsx(E,{title:"Review referral needs",children:e.jsx(Q,{color:"primary"})})}),e.jsx(P,{primary:"Referral Appropriateness",secondary:"Assess need for physician referral and urgency level"})]})]})]}),!l&&(h||r||m)&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{sx:{mb:3}}),e.jsxs(n,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[m&&e.jsx(D,{variant:"outlined",color:"error",onClick:()=>T("reject"),disabled:j,startIcon:e.jsx(ue,{}),children:"Reject"}),r&&e.jsx(D,{variant:"outlined",color:"warning",onClick:()=>T("modify"),disabled:j,startIcon:e.jsx(pe,{}),children:"Modify"}),h&&e.jsx(D,{variant:"contained",color:"success",onClick:()=>T("approve"),disabled:j,startIcon:e.jsx(ie,{}),children:j?"Processing...":"Approve"})]})]}),g&&!l&&e.jsx(n,{sx:{mt:2,p:2,bgcolor:"grey.50",borderRadius:1},children:e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Reviewing as: ",g.name," (",g.role,")"]})})]}),e.jsxs(Pe,{open:x.open,onClose:a,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Fe,{children:[x.type==="approve"&&"Approve Diagnostic Result",x.type==="modify"&&"Modify Diagnostic Result",x.type==="reject"&&"Reject Diagnostic Result"]}),e.jsxs(Ee,{children:[x.confirmationRequired&&e.jsxs(C,{severity:"warning",sx:{mb:3},children:[e.jsx(s,{variant:"body2",sx:{fontWeight:600,mb:1},children:"High-Risk Case Detected"}),e.jsx(s,{variant:"body2",children:"This case contains critical findings or referral recommendations. Please confirm you have thoroughly reviewed all aspects before approving."})]}),x.type==="approve"&&e.jsxs(n,{children:[e.jsx(s,{variant:"body1",sx:{mb:2},children:"By approving this diagnostic result, you confirm that:"}),e.jsxs(J,{children:[e.jsx(M,{children:e.jsx(P,{primary:"• The diagnostic assessment is clinically appropriate"})}),e.jsx(M,{children:e.jsx(P,{primary:"• Medication recommendations are safe and appropriate"})}),e.jsx(M,{children:e.jsx(P,{primary:"• Red flags have been properly addressed"})}),e.jsx(M,{children:e.jsx(P,{primary:"• Referral recommendations are appropriate"})})]})]}),x.type==="modify"&&e.jsxs(n,{children:[e.jsx(s,{variant:"body1",sx:{mb:2},children:"Please describe the modifications you are making to the AI recommendations:"}),e.jsx(_,{fullWidth:!0,multiline:!0,rows:4,label:"Modifications",placeholder:"Describe your modifications to the diagnostic recommendations...",value:x.text,onChange:w=>f(t=>({...t,text:w.target.value})),required:!0,helperText:"Be specific about what changes you are making and why"})]}),x.type==="reject"&&e.jsxs(n,{children:[e.jsx(s,{variant:"body1",sx:{mb:2},children:"Please provide a reason for rejecting this diagnostic result:"}),e.jsx(_,{fullWidth:!0,multiline:!0,rows:4,label:"Rejection Reason",placeholder:"Explain why you are rejecting these recommendations...",value:x.text,onChange:w=>f(t=>({...t,text:w.target.value})),required:!0,helperText:"This will help improve future AI recommendations"})]})]}),e.jsxs(Ne,{children:[e.jsx(D,{onClick:a,disabled:j,children:"Cancel"}),e.jsx(D,{onClick:d,variant:"contained",disabled:j||(x.type==="modify"||x.type==="reject")&&!x.text.trim(),color:x.type==="approve"?"success":x.type==="modify"?"warning":"error",children:j?"Processing...":x.type==="approve"?"Approve":x.type==="modify"?"Submit Modifications":"Reject"})]})]})]})},U={all:["diagnostics"],requests:()=>["diagnostics","requests"],request:i=>["diagnostics","request",i],results:()=>["diagnostics","results"],result:i=>["diagnostics","result",i],history:i=>["diagnostics","history",i],analytics:i=>["diagnostics","analytics",i],status:i=>["diagnostics","status",i]},ps=i=>$e({queryKey:U.request(i),queryFn:()=>re.getRequest(i),enabled:!!i,staleTime:2*60*1e3,refetchOnWindowFocus:!1}),us=(i,h)=>{const{enablePolling:r=!1,pollingInterval:m=5e3}=h||{};return $e({queryKey:U.result(i),queryFn:()=>re.getResult(i),enabled:!!i,staleTime:30*1e3,refetchInterval:r?m:!1,refetchIntervalInBackground:r,refetchOnWindowFocus:!1,retry:(j,c)=>{var g;return((g=c==null?void 0:c.response)==null?void 0:g.status)===404?j<10:j<3},retryDelay:j=>Math.min(1e3*2**j,3e4)})},ys=()=>{const i=fe(),h=ve(r=>r.addNotification);return be({mutationFn:r=>re.approveResult(r),onSuccess:(r,m)=>{const j=r==null?void 0:r.data;j&&(i.setQueryData(U.result(j.requestId),r),i.invalidateQueries({queryKey:U.analytics()}),h({type:"success",title:"Diagnostic Approved",message:"Diagnostic result has been approved successfully.",duration:4e3}))},onError:r=>{h({type:"error",title:"Approval Failed",message:r.message||"Failed to approve diagnostic result. Please try again.",duration:5e3})}})},fs=()=>{const i=fe(),h=ve(r=>r.addNotification);return be({mutationFn:({resultId:r,modifications:m})=>re.modifyResult(r,m),onSuccess:(r,{resultId:m})=>{const j=r==null?void 0:r.data;j&&(i.setQueryData(U.result(j.requestId),r),i.invalidateQueries({queryKey:U.analytics()}),h({type:"success",title:"Diagnostic Modified",message:"Diagnostic result has been modified successfully.",duration:4e3}))},onError:r=>{h({type:"error",title:"Modification Failed",message:r.message||"Failed to modify diagnostic result. Please try again.",duration:5e3})}})},vs=()=>{const i=fe(),h=ve(r=>r.addNotification);return be({mutationFn:({resultId:r,rejectionReason:m})=>re.rejectResult(r,m),onSuccess:(r,{resultId:m})=>{const j=r==null?void 0:r.data;j&&(i.setQueryData(U.result(j.requestId),r),i.invalidateQueries({queryKey:U.analytics()}),h({type:"success",title:"Diagnostic Rejected",message:"Diagnostic result has been rejected.",duration:4e3}))},onError:r=>{h({type:"error",title:"Rejection Failed",message:r.message||"Failed to reject diagnostic result. Please try again.",duration:5e3})}})},oe=({children:i,value:h,index:r,...m})=>e.jsx("div",{role:"tabpanel",hidden:h!==r,id:`results-tabpanel-${r}`,"aria-labelledby":`results-tab-${r}`,...m,children:h===r&&e.jsx(n,{sx:{py:3},children:i})}),bs=({open:i,type:h,onClose:r,onConfirm:m,loading:j=!1})=>{const[c,g]=z.useState(""),[x,f]=z.useState({specialty:"",urgency:"routine",reason:"",notes:""}),A=()=>{switch(h){case"modify":m(c);break;case"reject":m(c);break;case"referral":m(x);break;default:m()}g(""),f({specialty:"",urgency:"routine",reason:"",notes:""})},$=()=>{switch(h){case"approve":return{title:"Approve Diagnostic Result",content:e.jsx(s,{children:"Are you sure you want to approve this diagnostic result? This will mark it as reviewed and approved for clinical use."}),confirmText:"Approve",confirmColor:"success"};case"modify":return{title:"Modify Diagnostic Result",content:e.jsxs(n,{children:[e.jsx(s,{sx:{mb:2},children:"Please provide your modifications to the diagnostic result:"}),e.jsx(_,{fullWidth:!0,multiline:!0,rows:4,label:"Modifications",value:c,onChange:l=>g(l.target.value),placeholder:"Describe your modifications to the AI recommendations..."})]}),confirmText:"Save Modifications",confirmColor:"primary"};case"reject":return{title:"Reject Diagnostic Result",content:e.jsxs(n,{children:[e.jsx(s,{sx:{mb:2},children:"Please provide a reason for rejecting this diagnostic result:"}),e.jsx(_,{fullWidth:!0,multiline:!0,rows:4,label:"Rejection Reason",value:c,onChange:l=>g(l.target.value),placeholder:"Explain why this result is being rejected...",required:!0})]}),confirmText:"Reject Result",confirmColor:"error"};case"export":return{title:"Export Diagnostic Report",content:e.jsx(s,{children:"This will generate a comprehensive diagnostic report including all analysis, recommendations, and pharmacist review notes."}),confirmText:"Export PDF",confirmColor:"primary"};case"referral":return{title:"Create Referral",content:e.jsxs(n,{children:[e.jsx(s,{sx:{mb:2},children:"Create a referral based on this diagnostic analysis:"}),e.jsxs(R,{container:!0,spacing:2,children:[e.jsx(R,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Specialty",value:x.specialty,onChange:l=>f(u=>({...u,specialty:l.target.value})),placeholder:"e.g., Cardiology, Endocrinology"})}),e.jsx(R,{item:!0,xs:12,sm:6,children:e.jsxs(_,{fullWidth:!0,select:!0,label:"Urgency",value:x.urgency,onChange:l=>f(u=>({...u,urgency:l.target.value})),SelectProps:{native:!0},children:[e.jsx("option",{value:"routine",children:"Routine"}),e.jsx("option",{value:"within_24h",children:"Within 24 Hours"}),e.jsx("option",{value:"immediate",children:"Immediate"})]})}),e.jsx(R,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,label:"Reason for Referral",value:x.reason,onChange:l=>f(u=>({...u,reason:l.target.value})),placeholder:"Primary reason for specialist consultation"})}),e.jsx(R,{item:!0,xs:12,children:e.jsx(_,{fullWidth:!0,multiline:!0,rows:3,label:"Additional Notes",value:x.notes,onChange:l=>f(u=>({...u,notes:l.target.value})),placeholder:"Additional clinical notes for the specialist"})})]})]}),confirmText:"Create Referral",confirmColor:"primary"};default:return{title:"Confirm Action",content:e.jsx(s,{children:"Are you sure you want to proceed?"}),confirmText:"Confirm",confirmColor:"primary"}}},{title:k,content:T,confirmText:a,confirmColor:d}=$(),o=h==="reject"?c.trim().length>0:!0;return e.jsxs(Pe,{open:i,onClose:r,maxWidth:"md",fullWidth:!0,children:[e.jsx(Fe,{children:k}),e.jsx(Ee,{children:T}),e.jsxs(Ne,{children:[e.jsx(D,{onClick:r,disabled:j,children:"Cancel"}),e.jsx(D,{variant:"contained",color:d,onClick:A,disabled:!o||j,startIcon:j?e.jsx(de,{size:16}):void 0,children:a})]})]})},ws=()=>{var we,Ie,Ce,Re;const i=Ve();Ge(i.breakpoints.down("md"));const h=Qe(),{requestId:r}=Ke(),[m,j]=z.useState(0),[c,g]=z.useState({open:!1,type:"approve"}),{patients:x}=Ye(),{data:f,isLoading:A,error:$}=ps(r),{data:k,isLoading:T,error:a,refetch:d}=us(r,{enablePolling:((we=f==null?void 0:f.data)==null?void 0:we.status)==="processing",pollingInterval:5e3}),o=ys(),l=fs(),u=vs(),y=f==null?void 0:f.data,p=k==null?void 0:k.data,S=x.find(W=>W._id===(y==null?void 0:y.patientId)),w=(W,V)=>{j(V)},t=W=>{g({open:!0,type:W})},I=async W=>{if(p)try{switch(c.type){case"approve":await o.mutateAsync(p._id);break;case"modify":await l.mutateAsync({resultId:p._id,modifications:W});break;case"reject":await u.mutateAsync({resultId:p._id,rejectionReason:W});break;case"export":console.log("Exporting report...");break;case"referral":console.log("Creating referral...",W);break}g({open:!1,type:"approve"}),d()}catch(V){console.error("Action failed:",V)}},v=()=>{h("/pharmacy/diagnostics")},B=()=>{p&&h(`/clinical-interventions/create?diagnosticResultId=${p._id}`)};if(A||T)return e.jsx(Z,{maxWidth:"xl",sx:{py:4},children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(de,{size:48})})});if($||a||!y)return e.jsxs(Z,{maxWidth:"xl",sx:{py:4},children:[e.jsx(C,{severity:"error",sx:{mb:2},children:"Failed to load diagnostic data. Please try again."}),e.jsx(D,{variant:"contained",onClick:v,children:"Back to Dashboard"})]});if(y.status==="processing")return e.jsx(Z,{maxWidth:"xl",sx:{py:4},children:e.jsx(se,{children:e.jsxs(he,{sx:{textAlign:"center",py:8},children:[e.jsx(de,{size:64,sx:{mb:3}}),e.jsx(s,{variant:"h5",sx:{mb:2},children:"AI Analysis in Progress"}),e.jsx(s,{variant:"body1",color:"text.secondary",sx:{mb:3},children:"Your diagnostic case is being analyzed. This typically takes 10-30 seconds."}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Patient:"," ",S?`${S.firstName} ${S.lastName}`:"Unknown"]})]})})});if(!p)return e.jsxs(Z,{maxWidth:"xl",sx:{py:4},children:[e.jsx(C,{severity:"info",sx:{mb:2},children:"Diagnostic analysis is not yet available for this case."}),e.jsx(D,{variant:"contained",onClick:v,children:"Back to Dashboard"})]});const je=((Ie=p.pharmacistReview)==null?void 0:Ie.status)!==void 0,te=(Ce=p.pharmacistReview)==null?void 0:Ce.status;return e.jsx(ss,{children:e.jsxs(Z,{maxWidth:"xl",sx:{py:4},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(G,{onClick:v,sx:{mr:1},children:e.jsx(ns,{})}),e.jsxs(n,{sx:{flexGrow:1},children:[e.jsx(s,{variant:"h4",sx:{fontWeight:600},children:"Diagnostic Results Review"}),e.jsxs(s,{variant:"body1",color:"text.secondary",children:[S?`${S.firstName} ${S.lastName}`:"Unknown Patient"," ","- Case ID: ",y._id.slice(-8)]})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(E,{title:"Print Report",children:e.jsx(G,{onClick:()=>t("export"),children:e.jsx(rs,{})})}),e.jsx(E,{title:"Export PDF",children:e.jsx(G,{onClick:()=>t("export"),children:e.jsx(ts,{})})}),e.jsx(E,{title:"Share",children:e.jsx(G,{children:e.jsx(as,{})})})]})]}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:2},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(b,{label:`Case ${y.status}`,color:y.status==="completed"?"success":"default",sx:{textTransform:"capitalize"}}),je&&e.jsx(b,{label:`Review ${te}`,color:te==="approved"?"success":te==="modified"?"warning":"error",sx:{textTransform:"capitalize"}}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Analyzed"," ",os(new Date(p.createdAt),"MMM dd, yyyy HH:mm")]})]}),!je&&e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(D,{variant:"outlined",color:"error",startIcon:e.jsx(ue,{}),onClick:()=>t("reject"),disabled:u.isPending,children:"Reject"}),e.jsx(D,{variant:"outlined",startIcon:e.jsx(pe,{}),onClick:()=>t("modify"),disabled:l.isPending,children:"Modify"}),e.jsx(D,{variant:"contained",color:"success",startIcon:e.jsx(ie,{}),onClick:()=>t("approve"),disabled:o.isPending,children:"Approve"})]}),je&&te==="approved"&&e.jsxs(n,{sx:{display:"flex",gap:1},children:[e.jsx(D,{variant:"outlined",startIcon:e.jsx(ne,{}),onClick:()=>t("referral"),children:"Create Referral"}),e.jsx(D,{variant:"contained",startIcon:e.jsx(ce,{}),onClick:B,children:"Create Intervention"})]})]})]}),p.redFlags&&p.redFlags.length>0&&e.jsxs(C,{severity:"error",sx:{mb:3},children:[e.jsx(s,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:"Critical Red Flags Detected"}),e.jsx(Le,{redFlags:p.redFlags})]}),((Re=p.referralRecommendation)==null?void 0:Re.recommended)&&e.jsxs(C,{severity:p.referralRecommendation.urgency==="immediate"?"error":"warning",sx:{mb:3},children:[e.jsxs(s,{variant:"subtitle2",sx:{fontWeight:600,mb:1},children:["Referral Recommended -"," ",p.referralRecommendation.urgency.replace("_"," ")]}),e.jsxs(s,{variant:"body2",children:[p.referralRecommendation.specialty,":"," ",p.referralRecommendation.reason]})]}),e.jsxs(se,{sx:{mb:3},children:[e.jsx(n,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Xe,{value:m,onChange:w,"aria-label":"diagnostic results tabs",children:[e.jsx(ae,{label:"Analysis Results"}),e.jsx(ae,{label:"Case Details"}),e.jsx(ae,{label:"Interactions"}),e.jsx(ae,{label:"Review History"})]})}),e.jsx(oe,{value:m,index:0,children:e.jsx(js,{result:p,onApprove:()=>t("approve"),onModify:W=>t("modify"),onReject:W=>t("reject"),loading:o.isPending||l.isPending||u.isPending})}),e.jsx(oe,{value:m,index:1,children:e.jsxs(R,{container:!0,spacing:3,children:[e.jsx(R,{item:!0,xs:12,md:6,children:e.jsxs(F,{sx:{p:3},children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(qe,{sx:{mr:1}}),"Patient Information"]}),S&&e.jsxs(n,{children:[e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Name:"})," ",S.firstName," ",S.lastName]}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"DOB:"})," ",S.dateOfBirth]}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Gender:"})," ",S.gender]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Phone:"})," ",S.phoneNumber]})]})]})}),e.jsx(R,{item:!0,xs:12,md:6,children:e.jsxs(F,{sx:{p:3},children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(ge,{sx:{mr:1}}),"Case Input Summary"]}),e.jsxs(n,{children:[e.jsx(s,{variant:"body2",sx:{mb:1},children:e.jsx("strong",{children:"Primary Symptoms:"})}),e.jsx(s,{variant:"body2",sx:{mb:2},children:y.inputSnapshot.symptoms.subjective.join(", ")}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Duration:"})," ",y.inputSnapshot.symptoms.duration]}),e.jsxs(s,{variant:"body2",sx:{mb:1},children:[e.jsx("strong",{children:"Severity:"})," ",y.inputSnapshot.symptoms.severity]}),e.jsxs(s,{variant:"body2",children:[e.jsx("strong",{children:"Onset:"})," ",y.inputSnapshot.symptoms.onset]})]})]})}),y.inputSnapshot.currentMedications&&y.inputSnapshot.currentMedications.length>0&&e.jsx(R,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:3},children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(xe,{sx:{mr:1}}),"Current Medications"]}),e.jsx(J,{dense:!0,children:y.inputSnapshot.currentMedications.map((W,V)=>e.jsx(M,{children:e.jsx(P,{primary:W.name,secondary:`${W.dosage} - ${W.frequency}`})},V))})]})}),y.inputSnapshot.allergies&&y.inputSnapshot.allergies.length>0&&e.jsx(R,{item:!0,xs:12,children:e.jsxs(F,{sx:{p:3},children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(O,{sx:{mr:1}}),"Known Allergies"]}),e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:y.inputSnapshot.allergies.map((W,V)=>e.jsx(b,{label:W,color:"warning",size:"small"},V))})]})})]})}),e.jsx(oe,{value:m,index:2,children:e.jsx(Oe,{medications:p.medicationSuggestions.map(W=>W.drugName),allergies:y.inputSnapshot.allergies||[]})}),e.jsx(oe,{value:m,index:3,children:e.jsx(gs,{result:p,onApprove:()=>t("approve"),onModify:W=>t("modify"),onReject:W=>t("reject"),loading:o.isPending||l.isPending||u.isPending})})]}),e.jsx(se,{children:e.jsxs(he,{children:[e.jsxs(s,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:[e.jsx(Je,{sx:{mr:1}}),"AI Analysis Metadata"]}),e.jsxs(R,{container:!0,spacing:2,children:[e.jsxs(R,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Model:"}),e.jsxs(s,{variant:"body2",children:[p.aiMetadata.modelId," v",p.aiMetadata.modelVersion]})]}),e.jsxs(R,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Confidence Score:"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(ye,{score:p.aiMetadata.confidenceScore}),e.jsxs(s,{variant:"body2",sx:{ml:1},children:[Math.round(p.aiMetadata.confidenceScore*100),"%"]})]})]}),e.jsxs(R,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Processing Time:"}),e.jsxs(s,{variant:"body2",children:[p.aiMetadata.processingTime,"ms"]})]}),e.jsxs(R,{item:!0,xs:12,sm:6,md:3,children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Tokens Used:"}),e.jsx(s,{variant:"body2",children:p.aiMetadata.tokenUsage.totalTokens})]})]})]})}),e.jsx(bs,{open:c.open,type:c.type,onClose:()=>g({open:!1,type:"approve"}),onConfirm:I,loading:o.isPending||l.isPending||u.isPending})]})})},Bs=()=>e.jsx(is,{children:e.jsx(ws,{})});export{Bs as default};
