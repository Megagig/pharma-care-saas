import{c6 as P,c7 as S,bi as j,r as T,j as e,B as y,aa as w,D as R,T as k,Q as F,G as o,ah as u,bf as f,a6 as L,a7 as z,a8 as I,f as b,a4 as g,h as q}from"./index-louytu0d.js";import{m as c}from"./medicationManagementService-CyHUiaEu.js";import{S as h}from"./Switch-Cd_KxpXf.js";const a={all:["medications"],lists:()=>[...a.all,"list"],list:t=>[...a.lists(),t],details:()=>[...a.all,"detail"],detail:t=>[...a.details(),t],adherence:()=>[...a.all,"adherence"],adherenceList:t=>[...a.adherence(),t],interactions:()=>[...a.all,"interactions"],analytics:()=>[...a.all,"analytics"],adherenceAnalytics:(t,s)=>[...a.analytics(),"adherence",t,s],prescriptionPatternAnalytics:t=>[...a.analytics(),"prescriptionPatterns",t],interactionAnalytics:t=>[...a.analytics(),"interactions",t],medicationSummary:t=>[...a.analytics(),"summary",t],settings:()=>[...a.all,"settings"],patientSettings:t=>[...a.settings(),t]},ee=()=>{const t=P();return S({mutationFn:s=>c.createMedication(s),onSuccess:(s,l)=>{t.invalidateQueries({queryKey:a.list({patientId:l.patientId})})}})},ne=(t,s="active")=>j({queryKey:a.list({patientId:t,status:s}),queryFn:()=>c.getMedicationsByPatient(t,s),enabled:!!t}),te=()=>{const t=P();return S({mutationFn:({id:s,data:l})=>c.updateMedication(s,l),onSuccess:s=>{t.invalidateQueries({queryKey:a.detail(s._id)}),t.invalidateQueries({queryKey:a.list({patientId:s.patientId})})}})},ie=()=>{const t=P();return S({mutationFn:({id:s,reason:l})=>c.archiveMedication(s,l),onSuccess:s=>{t.invalidateQueries({queryKey:a.detail(s._id)}),t.invalidateQueries({queryKey:a.list({patientId:s.patientId})})}})},se=()=>{const t=P();return S({mutationFn:s=>c.logAdherence(s),onSuccess:(s,l)=>{t.invalidateQueries({queryKey:a.adherenceList({patientId:l.patientId})})}})},ae=(t,s,l)=>j({queryKey:a.adherenceList({patientId:t,startDate:s==null?void 0:s.toString(),endDate:l==null?void 0:l.toString()}),queryFn:()=>c.getAdherenceLogs(t,s,l),enabled:!!t}),D=t=>j({queryKey:a.patientSettings(t),queryFn:()=>c.getPatientMedicationSettings(t),enabled:!!t}),J=()=>{const t=P();return S({mutationFn:({patientId:s,settings:l})=>c.updatePatientMedicationSettings(s,l),onSuccess:(s,l)=>{t.invalidateQueries({queryKey:a.patientSettings(l.patientId)})}})},V=()=>S({mutationFn:({patientId:t,type:s,contact:l})=>c.testNotification(t,s,l)}),re=(t,s="6months")=>j({queryKey:a.adherenceAnalytics(t,s),queryFn:()=>c.getAdherenceAnalytics(t,s),enabled:!!t,staleTime:5*60*1e3}),le=t=>j({queryKey:a.prescriptionPatternAnalytics(t),queryFn:()=>c.getPrescriptionPatternAnalytics(t),enabled:!!t,staleTime:5*60*1e3}),oe=t=>j({queryKey:a.interactionAnalytics(t),queryFn:()=>c.getMedicationInteractionAnalytics(t),enabled:!!t,staleTime:5*60*1e3}),de=t=>j({queryKey:a.medicationSummary(t),queryFn:()=>c.getPatientMedicationSummary(t),enabled:!!t,staleTime:5*60*1e3}),ce=({patientId:t})=>{var E,K;const[s,l]=T.useState(""),[M,W]=T.useState("email"),{data:x,isLoading:B,error:N}=D(t),v=J(),C=V(),[i,d]=T.useState({enabled:!1,defaultReminderTimes:["09:00","13:00","19:00"],reminderMethod:"email",defaultNotificationLeadTime:15,customMessage:"Time to take your medication!",repeatReminders:!1,repeatInterval:30,smartReminders:!1,allowSnooze:!0,snoozeOptions:[5,10,15,30],notifyCaregiver:!1,caregiverContact:""}),[r,m]=T.useState({adherenceMonitoring:!1,refillReminders:!1,interactionChecking:!0,refillThreshold:20,missedDoseThreshold:2,adherenceReporting:!1,reportFrequency:"weekly",alertOnLowAdherence:!1,lowAdherenceThreshold:70,stockoutPrediction:!1});T.useEffect(()=>{x&&(d(n=>({...n,enabled:x.reminderSettings.enabled,defaultReminderTimes:x.reminderSettings.defaultReminderTimes,reminderMethod:x.reminderSettings.reminderMethod,defaultNotificationLeadTime:x.reminderSettings.defaultNotificationLeadTime})),m(n=>({...n,adherenceMonitoring:x.monitoringSettings.adherenceMonitoring,refillReminders:x.monitoringSettings.refillReminders,interactionChecking:x.monitoringSettings.interactionChecking})))},[x]);const Q=async()=>{try{await v.mutateAsync({patientId:t,settings:{reminderSettings:i,monitoringSettings:r}})}catch(n){console.error("Failed to update settings:",n)}},O=(n,p)=>{const A=[...i.defaultReminderTimes];A[n]=p,d({...i,defaultReminderTimes:A})},U=()=>{d({...i,defaultReminderTimes:[...i.defaultReminderTimes,"12:00"]})},_=n=>{const p=[...i.defaultReminderTimes];p.splice(n,1),d({...i,defaultReminderTimes:p})},[G,$]=T.useState(i.customMessage||"Time to take your medication!"),H=async()=>{if(!s){alert("Please enter a valid email or phone number.");return}try{const n=await C.mutateAsync({patientId:t,type:M,contact:s});n.success?alert(`${n.message}

${n.details||""}`):alert(`Failed to send test notification: ${n.message}`)}catch(n){console.error("Failed to send test notification:",n),alert("Failed to send test notification. Please try again.")}};return B?e.jsx(y,{sx:{display:"flex",justifyContent:"center",p:4},children:e.jsx(w,{})}):N?e.jsxs(R,{severity:"error",sx:{m:2},children:["Error loading medication settings:"," ",N.message||"Unknown error"]}):e.jsxs(y,{sx:{p:3},children:[e.jsx(k,{variant:"h6",component:"h2",gutterBottom:!0,children:"Medication Reminder Settings"}),e.jsx(F,{sx:{p:3,mb:4},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{sx:{gridColumn:"span 12"},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:i.enabled,onChange:n=>d({...i,enabled:n.target.checked}),name:"enabled"}),label:"Enable Medication Reminders"}),e.jsx(f,{children:"When enabled, reminders will be sent based on the schedule below"})]}),e.jsx(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:e.jsxs(L,{fullWidth:!0,children:[e.jsx(z,{id:"reminder-method-label",children:"Reminder Method"}),e.jsxs(I,{labelId:"reminder-method-label",id:"reminder-method",value:i.reminderMethod,label:"Reminder Method",onChange:n=>d({...i,reminderMethod:n.target.value}),disabled:!i.enabled,children:[e.jsx(b,{value:"email",children:"Email"}),e.jsx(b,{value:"sms",children:"SMS"}),e.jsx(b,{value:"both",children:"Both Email and SMS"})]}),e.jsx(f,{children:"Choose how you want to receive medication reminders"})]})}),e.jsx(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:e.jsx(g,{fullWidth:!0,type:"number",label:"Default Notification Lead Time (minutes)",value:i.defaultNotificationLeadTime,onChange:n=>d({...i,defaultNotificationLeadTime:parseInt(n.target.value)||0}),disabled:!i.enabled,InputProps:{inputProps:{min:0,max:120}},helperText:"How many minutes before the scheduled time to send reminders"})}),e.jsx(o,{sx:{gridColumn:{xs:"span 12"}},component:"div",children:e.jsx(g,{fullWidth:!0,label:"Custom Reminder Message",value:i.customMessage,onChange:n=>d({...i,customMessage:n.target.value}),disabled:!i.enabled,helperText:"Custom message to include in medication reminders"})}),e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:i.repeatReminders,onChange:n=>d({...i,repeatReminders:n.target.checked}),disabled:!i.enabled}),label:"Repeat Reminders"}),i.repeatReminders&&e.jsx(g,{type:"number",label:"Repeat Interval (minutes)",value:i.repeatInterval,onChange:n=>d({...i,repeatInterval:parseInt(n.target.value)||0}),disabled:!i.enabled,InputProps:{inputProps:{min:5,max:120}},size:"small",sx:{ml:3,mt:1}})]}),e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:i.smartReminders,onChange:n=>d({...i,smartReminders:n.target.checked}),disabled:!i.enabled}),label:"Smart Reminders"}),e.jsx(f,{children:"Adaptive reminders based on patient behavior patterns"})]}),e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:i.allowSnooze,onChange:n=>d({...i,allowSnooze:n.target.checked}),disabled:!i.enabled}),label:"Allow Snooze"}),e.jsx(f,{children:"Enable snooze functionality for medication reminders"})]}),e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:i.notifyCaregiver,onChange:n=>d({...i,notifyCaregiver:n.target.checked}),disabled:!i.enabled}),label:"Notify Caregiver"}),i.notifyCaregiver&&e.jsx(g,{fullWidth:!0,label:"Caregiver Contact",value:i.caregiverContact,onChange:n=>d({...i,caregiverContact:n.target.value}),placeholder:"Email or phone number",disabled:!i.enabled,size:"small",sx:{mt:1}})]}),e.jsxs(o,{sx:{gridColumn:"span 12"},component:"div",children:[e.jsx(k,{variant:"subtitle1",gutterBottom:!0,children:"Default Reminder Times"}),e.jsx(y,{sx:{mb:2},children:e.jsx(k,{variant:"body2",color:"text.secondary",children:"These times will be used as defaults when setting up medication schedules"})}),i.defaultReminderTimes.map((n,p)=>e.jsxs(y,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(g,{type:"time",value:n,onChange:A=>O(p,A.target.value),disabled:!i.enabled,sx:{mr:2}}),e.jsx(q,{variant:"outlined",color:"error",size:"small",onClick:()=>_(p),disabled:!i.enabled||i.defaultReminderTimes.length<=1,children:"Remove"})]},p)),e.jsx(q,{variant:"outlined",onClick:U,disabled:!i.enabled,sx:{mt:1},children:"Add Reminder Time"})]})]})}),e.jsx(k,{variant:"h6",component:"h2",gutterBottom:!0,children:"Monitoring Settings"}),e.jsx(F,{sx:{p:3,mb:4},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:r.adherenceMonitoring,onChange:n=>m({...r,adherenceMonitoring:n.target.checked})}),label:"Enable Adherence Monitoring"}),e.jsx(f,{children:"Track and analyze medication adherence patterns"}),r.adherenceMonitoring&&e.jsxs(y,{sx:{mt:2,ml:3},children:[e.jsx(u,{control:e.jsx(h,{checked:r.adherenceReporting,onChange:n=>m({...r,adherenceReporting:n.target.checked}),size:"small"}),label:"Generate Adherence Reports"}),r.adherenceReporting&&e.jsxs(L,{fullWidth:!0,size:"small",sx:{mt:1,maxWidth:200},children:[e.jsx(z,{id:"report-frequency-label",children:"Report Frequency"}),e.jsxs(I,{labelId:"report-frequency-label",value:r.reportFrequency,label:"Report Frequency",onChange:n=>m({...r,reportFrequency:n.target.value}),children:[e.jsx(b,{value:"daily",children:"Daily"}),e.jsx(b,{value:"weekly",children:"Weekly"}),e.jsx(b,{value:"monthly",children:"Monthly"})]})]}),e.jsx(u,{control:e.jsx(h,{checked:r.alertOnLowAdherence,onChange:n=>m({...r,alertOnLowAdherence:n.target.checked}),size:"small"}),label:"Alert on Low Adherence",sx:{mt:1,display:"block"}}),r.alertOnLowAdherence&&e.jsx(g,{type:"number",label:"Low Adherence Threshold %",value:r.lowAdherenceThreshold,onChange:n=>m({...r,lowAdherenceThreshold:parseInt(n.target.value)||0}),InputProps:{inputProps:{min:0,max:100}},size:"small",sx:{mt:1,maxWidth:200}})]})]}),e.jsxs(o,{sx:{gridColumn:{xs:"span 12",sm:"span 6"}},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:r.refillReminders,onChange:n=>m({...r,refillReminders:n.target.checked})}),label:"Enable Refill Reminders"}),e.jsx(f,{children:"Send reminders when medications need to be refilled"}),r.refillReminders&&e.jsxs(y,{sx:{mt:2,ml:3},children:[e.jsx(g,{type:"number",label:"Refill Threshold %",value:r.refillThreshold,onChange:n=>m({...r,refillThreshold:parseInt(n.target.value)||0}),helperText:"Percentage remaining to trigger refill reminder",InputProps:{inputProps:{min:0,max:50}},size:"small",sx:{maxWidth:200}}),e.jsx(u,{control:e.jsx(h,{checked:r.stockoutPrediction,onChange:n=>m({...r,stockoutPrediction:n.target.checked}),size:"small"}),label:"Predict Medication Stockouts",sx:{mt:1,display:"block"}})]})]}),e.jsxs(o,{sx:{gridColumn:"span 12"},component:"div",children:[e.jsx(u,{control:e.jsx(h,{checked:r.interactionChecking,onChange:n=>m({...r,interactionChecking:n.target.checked})}),label:"Enable Medication Interaction Checking"}),e.jsx(f,{children:"Check for potential interactions between medications"}),r.interactionChecking&&e.jsx(y,{sx:{mt:2,ml:3},children:e.jsx(g,{type:"number",label:"Missed Dose Threshold",value:r.missedDoseThreshold,onChange:n=>m({...r,missedDoseThreshold:parseInt(n.target.value)||0}),helperText:"Consecutive missed doses to trigger an alert",InputProps:{inputProps:{min:1,max:10}},size:"small",sx:{maxWidth:200}})})]})]})}),e.jsx(k,{variant:"h6",component:"h2",gutterBottom:!0,children:"Test Notifications"}),e.jsx(F,{sx:{p:3,mb:4},children:e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{sx:{gridColumn:{xs:"span 12",sm:"span 4"}},component:"div",children:e.jsxs(L,{fullWidth:!0,children:[e.jsx(z,{id:"test-notification-type-label",children:"Notification Type"}),e.jsxs(I,{labelId:"test-notification-type-label",id:"test-notification-type",value:M,label:"Notification Type",onChange:n=>W(n.target.value),children:[e.jsx(b,{value:"email",children:"Email"}),e.jsx(b,{value:"sms",children:"SMS"})]})]})}),e.jsx(o,{sx:{gridColumn:{xs:"span 12",sm:"span 8"}},component:"div",children:e.jsx(g,{fullWidth:!0,label:M==="email"?"Email Address":"Phone Number",value:s,placeholder:M==="email"?"example@email.com":"+1 (555) 123-4567",onChange:n=>l(n.target.value)})}),e.jsx(o,{sx:{gridColumn:"span 12"},component:"div",children:e.jsx(g,{fullWidth:!0,multiline:!0,rows:2,label:"Test Message",value:G,onChange:n=>$(n.target.value),helperText:"Message to include in the test notification",placeholder:M==="email"?"patient@example.com":"+1234567890"})}),e.jsxs(o,{sx:{gridColumn:"span 12"},component:"div",children:[e.jsxs(q,{variant:"contained",onClick:H,disabled:!s||C.isPending,children:["Send Test Notification",C.isPending&&e.jsx(w,{size:20,sx:{ml:1}})]}),C.isSuccess&&e.jsx(R,{severity:"success",sx:{mt:2},children:"Test notification sent successfully!"}),C.isError&&e.jsxs(R,{severity:"error",sx:{mt:2},children:["Failed to send test notification:"," ",((E=C.error)==null?void 0:E.message)||"Unknown error"]})]})]})}),e.jsx(y,{sx:{display:"flex",justifyContent:"flex-end",mt:4},children:e.jsxs(q,{variant:"contained",color:"primary",onClick:Q,disabled:v.isPending,children:["Save Settings",v.isPending&&e.jsx(w,{size:20,sx:{ml:1}})]})}),v.isSuccess&&e.jsx(R,{severity:"success",sx:{mt:2},children:"Settings saved successfully!"}),v.isError&&e.jsxs(R,{severity:"error",sx:{mt:2},children:["Failed to save settings:"," ",((K=v.error)==null?void 0:K.message)||"Unknown error"]})]})};export{ce as M,ae as a,ee as b,te as c,ie as d,se as e,re as f,le as g,oe as h,de as i,ne as u};
