const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B_pWc9hu.js","assets/index-S70ZUQXG.css"])))=>i.map(i=>d[i]);
import{az as ni,aA as ri,af as Tn,bQ as gr,bR as _v,r as p,bc as si,bS as Wn,A as gt,j as n,ap as Un,aC as ii,aK as oi,u as ai,bT as wv,aD as Sv,ao as Cv,bU as Av,bV as Tv,bW as kv,bX as Iv,d as Ee,c as Ve,bY as Rv,k as Ft,bZ as Ev,T as S,B as x,l as Ne,b1 as Lv,b5 as Ur,F as Ks,t as qn,s as Hn,I as ve,aX as Gs,ab as ur,D as xn,Q as st,be as oa,aW as lr,aQ as hr,a0 as pn,M as tn,f as ee,G as rt,h as We,aR as li,aS as ci,aT as ui,a5 as _t,aU as hi,q as Hr,b9 as pt,w as Kt,bP as Mv,Y as hu,b_ as Dr,L as dr,n as mr,o as di,p as fi,bl as du,bA as aa,b$ as Pv,R as pi,O as xi,by as Dv,v as Yo,bB as Ov,bC as Nv,bD as Bv,a7 as Jt,a8 as Xt,a9 as Zt,Z as Qc,a6 as Vs,S as fu,m as Jo,N as Fr,bK as zv,U as Wr,W as la,a1 as Fv,ai as Ps,K as Wv,bN as Uv,bO as $v,bL as Yc,bb as Hv,bz as qv,C as zn,b as Fn,V as pu,a2 as Kv,ak as Gv,x as xu,bF as Vv,c0 as Qv,y as Yv,bn as gu,bo as Br,_ as Jv,aY as Xv,a_ as Zv,e as ey}from"./index-B_pWc9hu.js";import{u as ca,a as gi,b as ty,c as ny}from"./useResponsive-LdFh52p2.js";import{M as Kn}from"./MoreVert-DZVFVdEw.js";import{E as mu}from"./Edit-DD3Q49Z-.js";import{D as Qs}from"./Delete-BIyg2wQJ.js";import{D as ua}from"./Download-DRMVM3Bm.js";import{I as ry}from"./Image-B2lXq2kK.js";import{P as xt}from"./Person-YzlArB5c.js";import{L as Ys}from"./LocalPharmacy-BpoHyUxJ.js";import{E as Js}from"./ExpandLess-CfW7CJI2.js";import{f as cr,s as sy}from"./format-CQst3Dr_.js";import{A as vu}from"./AttachFile-CLMBR5Se.js";import{I as iy}from"./PersonAdd-BOMx32z9.js";import{A as Xo}from"./Autocomplete-HcpzFt3K.js";import{O as Jc}from"./WifiOff-DA694lDl.js";import{S as Xc}from"./Sync-C9idAwzJ.js";import{u as oy}from"./useDebounce-BtuGOYBb.js";import{Q as yu}from"./QuestionAnswer-DdC2zH-9.js";import{u as ay}from"./usePatients-TJUphVTL.js";import{L as Zc}from"./LocalHospital-BNb4THgq.js";import{R as ly}from"./Remove-CMoL-_ZM.js";import{A as fr}from"./Add-D5-B7xRD.js";import{F as mi}from"./FilterList-BjHMpklN.js";import{S as pr}from"./Search-C2mZoRVv.js";import{F as ha}from"./Fab-_YJw2jg9.js";import{C as cy}from"./Clear-BB7JsfoZ.js";import{S as Ds}from"./Switch-DtQ0auD3.js";import{A as uy}from"./ArrowBack-bh5q612l.js";import{S as hy,A as dy}from"./AccessTime-DjyPxGRb.js";import{Z as fy}from"./Zoom-VLTAQnN7.js";import{L as ju}from"./LocalizationProvider-CB6kfikn.js";import{A as bu}from"./AdapterDateFns-RQ5vW8pD.js";import{D as Xs}from"./DatePicker-tSjwJs7r.js";import{T as py,a as xy,b as gy,c as $o,d as my}from"./TableRow-BGzfcKex.js";import{T as ft}from"./TableCell-DCrr5aWG.js";import{T as vy}from"./TablePagination-DuttMPh4.js";import{p as eu}from"./parseISO-CGAyFpjm.js";import{C as yy}from"./CardActions-DtPJ3__D.js";import{s as jy}from"./subDays-GbJIKp5j.js";import"./addMonths-BkvcT9-f.js";import"./useMobilePicker-CrD-8_S2.js";import"./index-BydA3A-2.js";import"./LastPage-CY6t_Uvn.js";function by(o){return ri("MuiAvatarGroup",o)}const _y=ni("MuiAvatarGroup",["root","avatar"]),Ho={small:-16,medium:-8},wy=o=>{const{classes:i}=o;return ii({root:["root"],avatar:["avatar"]},by,i)},Sy=Tn("div",{name:"MuiAvatarGroup",slot:"Root",overridesResolver:(o,i)=>[{[`& .${_y.avatar}`]:i.avatar},i.root]})(gr(({theme:o})=>({display:"flex",flexDirection:"row-reverse",[`& .${_v.root}`]:{border:`2px solid ${(o.vars||o).palette.background.default}`,boxSizing:"content-box",marginLeft:"var(--AvatarGroup-spacing, -8px)","&:last-child":{marginLeft:0}}}))),_u=p.forwardRef(function(i,s){const l=si({props:i,name:"MuiAvatarGroup"}),{children:d,className:m,component:b="div",componentsProps:j,max:C=5,renderSurplus:V,slotProps:I={},slots:O={},spacing:q="medium",total:X,variant:Q="circular",...U}=l;let W=C<2?2:C;const _={...l,max:C,spacing:q,component:b,variant:Q},Y=wy(_),H=p.Children.toArray(d).filter(K=>p.isValidElement(K)),M=X||H.length;M===W&&(W+=1),W=Math.min(M+1,W);const T=Math.min(H.length,W-1),J=Math.max(M-W,M-T,0),re=V?V(J):`+${J}`;let te;_.spacing&&Ho[_.spacing]!==void 0?te=Ho[_.spacing]:_.spacing===0?te=0:te=-_.spacing||Ho.medium;const G={slots:O,slotProps:{surplus:I.additionalAvatar??(j==null?void 0:j.additionalAvatar),...j,...I}},[Z,k]=Wn("surplus",{elementType:gt,externalForwardedProps:G,className:Y.avatar,ownerState:_,additionalProps:{variant:Q}});return n.jsxs(Sy,{as:b,ownerState:_,className:Un(Y.root,m),ref:s,...U,style:{"--AvatarGroup-spacing":`${te}px`,...U.style},children:[J?n.jsx(Z,{...k,children:re}):null,H.slice(0,T).reverse().map(K=>p.cloneElement(K,{className:Un(K.props.className,Y.avatar),variant:K.props.variant||Q}))]})});function Cy(o){return ri("MuiSpeedDial",o)}const Os=ni("MuiSpeedDial",["root","fab","directionUp","directionDown","directionLeft","directionRight","actions","actionsClosed"]),Ay=o=>{const{classes:i,open:s,direction:l}=o,d={root:["root",`direction${oi(l)}`],fab:["fab"],actions:["actions",!s&&"actionsClosed"]};return ii(d,Cy,i)};function Or(o){if(o==="up"||o==="down")return"vertical";if(o==="right"||o==="left")return"horizontal"}const Cn=32,Ns=16,Ty=Tn("div",{name:"MuiSpeedDial",slot:"Root",overridesResolver:(o,i)=>{const{ownerState:s}=o;return[i.root,i[`direction${oi(s.direction)}`]]}})(gr(({theme:o})=>({zIndex:(o.vars||o).zIndex.speedDial,display:"flex",alignItems:"center",pointerEvents:"none",variants:[{props:{direction:"up"},style:{flexDirection:"column-reverse",[`& .${Os.actions}`]:{flexDirection:"column-reverse",marginBottom:-Cn,paddingBottom:Ns+Cn}}},{props:{direction:"down"},style:{flexDirection:"column",[`& .${Os.actions}`]:{flexDirection:"column",marginTop:-Cn,paddingTop:Ns+Cn}}},{props:{direction:"left"},style:{flexDirection:"row-reverse",[`& .${Os.actions}`]:{flexDirection:"row-reverse",marginRight:-Cn,paddingRight:Ns+Cn}}},{props:{direction:"right"},style:{flexDirection:"row",[`& .${Os.actions}`]:{flexDirection:"row",marginLeft:-Cn,paddingLeft:Ns+Cn}}}]}))),ky=Tn(ha,{name:"MuiSpeedDial",slot:"Fab"})({pointerEvents:"auto"}),Iy=Tn("div",{name:"MuiSpeedDial",slot:"Actions",overridesResolver:(o,i)=>{const{ownerState:s}=o;return[i.actions,!s.open&&i.actionsClosed]}})({display:"flex",pointerEvents:"auto",variants:[{props:({ownerState:o})=>!o.open,style:{transition:"top 0s linear 0.2s",pointerEvents:"none"}}]}),Ry=p.forwardRef(function(i,s){const l=si({props:i,name:"MuiSpeedDial"}),d=ai(),m={enter:d.transitions.duration.enteringScreen,exit:d.transitions.duration.leavingScreen},{ariaLabel:b,FabProps:{ref:j,...C}={},children:V,className:I,direction:O="up",hidden:q=!1,icon:X,onBlur:Q,onClose:U,onFocus:W,onKeyDown:_,onMouseEnter:Y,onMouseLeave:H,onOpen:M,open:T,openIcon:J,slots:re={},slotProps:te={},TransitionComponent:G,TransitionProps:Z,transitionDuration:k=m,...K}=l,[le,ge]=wv({controlled:T,default:!1,name:"SpeedDial",state:"open"}),ye={...l,open:le,direction:O},B=Ay(ye),z=Sv(),se=p.useRef(0),F=p.useRef(),L=p.useRef([]);L.current=[L.current[0]];const P=p.useCallback(ue=>{L.current[0]=ue},[]),ie=Cv(j,P),be=(ue,Re,Le)=>fe=>{L.current[ue+1]=fe,Re&&Re(fe),Le&&Le(fe)},ze=ue=>{_&&_(ue);const Re=ue.key.replace("Arrow","").toLowerCase(),{current:Le=Re}=F;if(ue.key==="Escape"){ge(!1),L.current[0].focus(),U&&U(ue,"escapeKeyDown");return}if(Or(Re)===Or(Le)&&Or(Re)!==void 0){ue.preventDefault();const fe=Re===Le?1:-1,Pe=Tv(se.current+fe,0,L.current.length-1);L.current[Pe].focus(),se.current=Pe,F.current=Le}};p.useEffect(()=>{le||(se.current=0,F.current=void 0)},[le]);const he=ue=>{ue.type==="mouseleave"&&H&&H(ue),ue.type==="blur"&&Q&&Q(ue),z.clear(),ue.type==="blur"?z.start(0,()=>{ge(!1),U&&U(ue,"blur")}):(ge(!1),U&&U(ue,"mouseLeave"))},w=ue=>{C.onClick&&C.onClick(ue),z.clear(),le?(ge(!1),U&&U(ue,"toggle")):(ge(!0),M&&M(ue,"toggle"))},R=ue=>{ue.type==="mouseenter"&&Y&&Y(ue),ue.type==="focus"&&W&&W(ue),z.clear(),le||z.start(0,()=>{ge(!0),M&&M(ue,{focus:"focus",mouseenter:"mouseEnter"}[ue.type])})},ne=b.replace(/^[^a-z]+|[^\w:.-]+/gi,""),Ae=p.Children.toArray(V).filter(ue=>p.isValidElement(ue)),at=Ae.map((ue,Re)=>{const{FabProps:{ref:Le}={},slotProps:fe={},tooltipPlacement:Pe}=ue.props,{fab:{ref:Rt,...qr}={},...In}=fe,ji=Pe||(Or(O)==="vertical"?"left":"top");return p.cloneElement(ue,{slotProps:{fab:{...qr,ref:be(Re,Le,Rt)},...In},delay:30*(le?Re:Ae.length-Re),open:le,tooltipPlacement:ji,id:`${ne}-action-${Re}`})}),mt={transition:G,...re},lt={transition:Z,...te},rn={slots:mt,slotProps:lt},[Ye,wt]=Wn("root",{elementType:Ty,externalForwardedProps:{...rn,...K},ownerState:ye,ref:s,className:Un(B.root,I),additionalProps:{role:"presentation"},getSlotProps:ue=>({...ue,onKeyDown:Re=>{var Le;(Le=ue.onKeyDown)==null||Le.call(ue,Re),ze(Re)},onBlur:Re=>{var Le;(Le=ue.onBlur)==null||Le.call(ue,Re),he(Re)},onFocus:Re=>{var Le;(Le=ue.onFocus)==null||Le.call(ue,Re),R(Re)},onMouseEnter:Re=>{var Le;(Le=ue.onMouseEnter)==null||Le.call(ue,Re),R(Re)},onMouseLeave:Re=>{var Le;(Le=ue.onMouseLeave)==null||Le.call(ue,Re),he(Re)}})}),[kn,ct]=Wn("transition",{elementType:fy,externalForwardedProps:rn,ownerState:ye});return n.jsxs(Ye,{...wt,children:[n.jsx(kn,{in:!q,timeout:k,unmountOnExit:!0,...ct,children:n.jsx(ky,{color:"primary","aria-label":b,"aria-haspopup":"true","aria-expanded":le,"aria-controls":`${ne}-actions`,...C,onClick:w,className:Un(B.fab,C.className),ref:ie,ownerState:ye,children:p.isValidElement(X)&&Av(X,["SpeedDialIcon"])?p.cloneElement(X,{open:le}):X})}),n.jsx(Iy,{id:`${ne}-actions`,role:"menu","aria-orientation":Or(O),className:Un(B.actions,!le&&B.actionsClosed),ownerState:ye,children:at})]})});function Ey(o){return ri("MuiSpeedDialAction",o)}const Bs=ni("MuiSpeedDialAction",["fab","fabClosed","staticTooltip","staticTooltipClosed","staticTooltipLabel","tooltipPlacementLeft","tooltipPlacementRight"]),Ly=o=>{const{open:i,tooltipPlacement:s,classes:l}=o,d={fab:["fab",!i&&"fabClosed"],staticTooltip:["staticTooltip",`tooltipPlacement${oi(s)}`,!i&&"staticTooltipClosed"],staticTooltipLabel:["staticTooltipLabel"]};return ii(d,Ey,l)},My=Tn(ha,{name:"MuiSpeedDialAction",slot:"Fab",skipVariantsResolver:!1,overridesResolver:(o,i)=>{const{ownerState:s}=o;return[i.fab,!s.open&&i.fabClosed]}})(gr(({theme:o})=>({margin:8,color:(o.vars||o).palette.text.secondary,backgroundColor:(o.vars||o).palette.background.paper,"&:hover":{backgroundColor:o.vars?o.vars.palette.SpeedDialAction.fabHoverBg:kv(o.palette.background.paper,.15)},transition:`${o.transitions.create("transform",{duration:o.transitions.duration.shorter})}, opacity 0.8s`,opacity:1,variants:[{props:({ownerState:i})=>!i.open,style:{opacity:0,transform:"scale(0)"}}]}))),Py=Tn("span",{name:"MuiSpeedDialAction",slot:"StaticTooltip",overridesResolver:(o,i)=>{const{ownerState:s}=o;return[i.staticTooltip,!s.open&&i.staticTooltipClosed,i[`tooltipPlacement${oi(s.tooltipPlacement)}`]]}})(gr(({theme:o})=>({position:"relative",display:"flex",alignItems:"center",[`& .${Bs.staticTooltipLabel}`]:{transition:o.transitions.create(["transform","opacity"],{duration:o.transitions.duration.shorter}),opacity:1},variants:[{props:({ownerState:i})=>!i.open,style:{[`& .${Bs.staticTooltipLabel}`]:{opacity:0,transform:"scale(0.5)"}}},{props:{tooltipPlacement:"left"},style:{[`& .${Bs.staticTooltipLabel}`]:{transformOrigin:"100% 50%",right:"100%",marginRight:8}}},{props:{tooltipPlacement:"right"},style:{[`& .${Bs.staticTooltipLabel}`]:{transformOrigin:"0% 50%",left:"100%",marginLeft:8}}}]}))),Dy=Tn("span",{name:"MuiSpeedDialAction",slot:"StaticTooltipLabel"})(gr(({theme:o})=>({position:"absolute",...o.typography.body1,backgroundColor:(o.vars||o).palette.background.paper,borderRadius:(o.vars||o).shape.borderRadius,boxShadow:(o.vars||o).shadows[1],color:(o.vars||o).palette.text.secondary,padding:"4px 16px",wordBreak:"keep-all"}))),Oy=p.forwardRef(function(i,s){var se;const l=si({props:i,name:"MuiSpeedDialAction"}),{className:d,delay:m=0,FabProps:b={},icon:j,id:C,open:V,TooltipClasses:I,tooltipOpen:O=!1,tooltipPlacement:q="left",tooltipTitle:X,slots:Q={},slotProps:U={},...W}=l,_={...l,tooltipPlacement:q},Y=Ly(_),H={slots:Q,slotProps:{fab:b,...U,tooltip:Iv(typeof U.tooltip=="function"?U.tooltip(_):U.tooltip,{title:X,open:O,placement:q,classes:I})}},[M,T]=p.useState((se=H.slotProps.tooltip)==null?void 0:se.open),J=()=>{T(!1)},re=()=>{T(!0)},te={transitionDelay:`${m}ms`},[G,Z]=Wn("fab",{elementType:My,externalForwardedProps:H,ownerState:_,shouldForwardComponentProp:!0,className:Un(Y.fab,d),additionalProps:{style:te,tabIndex:-1,role:"menuitem",size:"small"}}),[k,K]=Wn("tooltip",{elementType:Ee,externalForwardedProps:H,shouldForwardComponentProp:!0,ref:s,additionalProps:{id:C},ownerState:_,getSlotProps:F=>({...F,onClose:L=>{var P;(P=F.onClose)==null||P.call(F,L),J()},onOpen:L=>{var P;(P=F.onOpen)==null||P.call(F,L),re()}})}),[le,ge]=Wn("staticTooltip",{elementType:Py,externalForwardedProps:H,ownerState:_,ref:s,className:Y.staticTooltip,additionalProps:{id:C}}),[ye,B]=Wn("staticTooltipLabel",{elementType:Dy,externalForwardedProps:H,ownerState:_,className:Y.staticTooltipLabel,additionalProps:{style:te,id:`${C}-label`}}),z=n.jsx(G,{...Z,children:j});return K.open?n.jsxs(le,{...ge,...W,children:[n.jsx(ye,{...B,children:K.title}),p.cloneElement(z,{"aria-labelledby":`${C}-label`})]}):(!V&&M&&T(!1),n.jsx(k,{...K,title:K.title,open:V&&M,placement:K.placement,classes:K.classes,...W,children:z}))}),Ny=Ve(n.jsx("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}));function By(o){return ri("MuiSpeedDialIcon",o)}const Yt=ni("MuiSpeedDialIcon",["root","icon","iconOpen","iconWithOpenIconOpen","openIcon","openIconOpen"]),zy=o=>{const{classes:i,open:s,openIcon:l}=o;return ii({root:["root"],icon:["icon",s&&"iconOpen",l&&s&&"iconWithOpenIconOpen"],openIcon:["openIcon",s&&"openIconOpen"]},By,i)},Fy=Tn("span",{name:"MuiSpeedDialIcon",slot:"Root",overridesResolver:(o,i)=>{const{ownerState:s}=o;return[{[`& .${Yt.icon}`]:i.icon},{[`& .${Yt.icon}`]:s.open&&i.iconOpen},{[`& .${Yt.icon}`]:s.open&&s.openIcon&&i.iconWithOpenIconOpen},{[`& .${Yt.openIcon}`]:i.openIcon},{[`& .${Yt.openIcon}`]:s.open&&i.openIconOpen},i.root]}})(gr(({theme:o})=>({height:24,[`& .${Yt.icon}`]:{transition:o.transitions.create(["transform","opacity"],{duration:o.transitions.duration.short})},[`& .${Yt.openIcon}`]:{position:"absolute",transition:o.transitions.create(["transform","opacity"],{duration:o.transitions.duration.short}),opacity:0,transform:"rotate(-45deg)"},variants:[{props:({ownerState:i})=>i.open,style:{[`& .${Yt.icon}`]:{transform:"rotate(45deg)"}}},{props:({ownerState:i})=>i.open&&i.openIcon,style:{[`& .${Yt.icon}`]:{opacity:0}}},{props:({ownerState:i})=>i.open,style:{[`& .${Yt.openIcon}`]:{transform:"rotate(0deg)",opacity:1}}}]}))),wu=p.forwardRef(function(i,s){const l=si({props:i,name:"MuiSpeedDialIcon"}),{className:d,icon:m,open:b,openIcon:j,...C}=l,V=l,I=zy(V);function O(q,X){return p.isValidElement(q)?p.cloneElement(q,{className:X}):q}return n.jsxs(Fy,{className:Un(I.root,d),ref:s,ownerState:V,...C,children:[j?O(j,I.openIcon):null,m?O(m,I.icon):n.jsx(Ny,{className:I.icon})]})});wu.muiName="SpeedDialIcon";function Wy(o,i){const{disableHysteresis:s=!1,threshold:l=100,target:d}=i,m=o.current;return d&&(o.current=d.pageYOffset!==void 0?d.pageYOffset:d.scrollTop),!s&&m!==void 0&&o.current<m?!1:o.current>l}const Uy=typeof window<"u"?window:null;function $y(o={}){const{getTrigger:i=Wy,target:s=Uy,...l}=o,d=p.useRef(),[m,b]=p.useState(()=>i(d,l));return p.useEffect(()=>{if(s===null)return b(!1);const j=()=>{b(i(d,{target:s,...l}))};return j(),s.addEventListener("scroll",j,{passive:!0}),()=>{s.removeEventListener("scroll",j,{passive:!0})}},[s,i,JSON.stringify(l)]),m}const Hy=Ve(n.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10h5v-2h-5c-4.34 0-8-3.66-8-8s3.66-8 8-8 8 3.66 8 8v1.43c0 .79-.71 1.57-1.5 1.57s-1.5-.78-1.5-1.57V12c0-2.76-2.24-5-5-5s-5 2.24-5 5 2.24 5 5 5c1.38 0 2.64-.56 3.54-1.47.65.89 1.77 1.47 2.96 1.47 1.97 0 3.5-1.6 3.5-3.57V12c0-5.52-4.48-10-10-10m0 13c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3"})),$n=Ve(n.jsx("path",{d:"m20.54 5.23-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.16.55L3.46 5.23C3.17 5.57 3 6.02 3 6.5V19c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.48-.17-.93-.46-1.27M12 17.5 6.5 12H10v-2h4v2h3.5zM5.12 5l.81-1h12l.94 1z"})),qy=Ve([n.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),n.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")]),Ky=Ve(n.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"})),da=Ve(n.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"})),Gy=Ve(n.jsx("path",{d:"M12 8V4l8 8-8 8v-4H4V8z"})),Vy=Ve(n.jsx("path",{d:"M22 9V7h-2v2h-2v2h2v2h2v-2h2V9zM8 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 1c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4m4.51-8.95C13.43 5.11 14 6.49 14 8s-.57 2.89-1.49 3.95C14.47 11.7 16 10.04 16 8s-1.53-3.7-3.49-3.95m4.02 9.78C17.42 14.66 18 15.7 18 17v3h2v-3c0-1.45-1.59-2.51-3.47-3.17"})),Qy=Ve(n.jsx("path",{d:"M12 19c0-3.87 3.13-7 7-7 1.08 0 2.09.25 3 .68V6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h8.08c-.05-.33-.08-.66-.08-1M4 6l8 5 8-5v2l-8 5-8-5zm13.34 16-3.54-3.54 1.41-1.41 2.12 2.12 4.24-4.24L23 16.34z"})),Yy=Ve(n.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"})),tu=Ve(n.jsx("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"})),Jy=Ve(n.jsx("path",{d:"M14 8c0-2.21-1.79-4-4-4S6 5.79 6 8s1.79 4 4 4 4-1.79 4-4m3 2v2h6v-2zM2 18v2h16v-2c0-2.66-5.33-4-8-4s-8 1.34-8 4"})),Xy=Ve(n.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"})),$r=Ve([n.jsx("circle",{cx:"12",cy:"19",r:"2"},"0"),n.jsx("path",{d:"M10 3h4v12h-4z"},"1")]),nu=Ve(n.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"})),xr=Ve(n.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"})),Zy=Ve(n.jsx("path",{d:"M3 18h6v-2H3zM3 6v2h18V6zm0 7h12v-2H3z"})),e0=Ve(n.jsx("path",{d:"m20.55 5.22-1.39-1.68C18.88 3.21 18.47 3 18 3H6c-.47 0-.88.21-1.15.55L3.46 5.22C3.17 5.57 3 6.01 3 6.5V19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6.5c0-.49-.17-.93-.45-1.28M12 9.5l5.5 5.5H14v2h-4v-2H6.5zM5.12 5l.82-1h12l.93 1z"})),t0=Ve(n.jsx("path",{d:"M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63m2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71M4.27 3 3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9zM12 4 9.91 6.09 12 8.18z"})),n0=Ve(n.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"})),r0=Ve(n.jsx("path",{d:"m1 9 2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9m8 8 3 3 3-3c-1.65-1.66-4.34-1.66-6 0m-4-4 2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13"})),nn=Object.create(null);nn.open="0";nn.close="1";nn.ping="2";nn.pong="3";nn.message="4";nn.upgrade="5";nn.noop="6";const Us=Object.create(null);Object.keys(nn).forEach(o=>{Us[nn[o]]=o});const Zo={type:"error",data:"parser error"},Su=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Cu=typeof ArrayBuffer=="function",Au=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o&&o.buffer instanceof ArrayBuffer,fa=({type:o,data:i},s,l)=>Su&&i instanceof Blob?s?l(i):ru(i,l):Cu&&(i instanceof ArrayBuffer||Au(i))?s?l(i):ru(new Blob([i]),l):l(nn[o]+(i||"")),ru=(o,i)=>{const s=new FileReader;return s.onload=function(){const l=s.result.split(",")[1];i("b"+(l||""))},s.readAsDataURL(o)};function su(o){return o instanceof Uint8Array?o:o instanceof ArrayBuffer?new Uint8Array(o):new Uint8Array(o.buffer,o.byteOffset,o.byteLength)}let qo;function s0(o,i){if(Su&&o.data instanceof Blob)return o.data.arrayBuffer().then(su).then(i);if(Cu&&(o.data instanceof ArrayBuffer||Au(o.data)))return i(su(o.data));fa(o,!1,s=>{qo||(qo=new TextEncoder),i(qo.encode(s))})}const iu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",zr=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let o=0;o<iu.length;o++)zr[iu.charCodeAt(o)]=o;const i0=o=>{let i=o.length*.75,s=o.length,l,d=0,m,b,j,C;o[o.length-1]==="="&&(i--,o[o.length-2]==="="&&i--);const V=new ArrayBuffer(i),I=new Uint8Array(V);for(l=0;l<s;l+=4)m=zr[o.charCodeAt(l)],b=zr[o.charCodeAt(l+1)],j=zr[o.charCodeAt(l+2)],C=zr[o.charCodeAt(l+3)],I[d++]=m<<2|b>>4,I[d++]=(b&15)<<4|j>>2,I[d++]=(j&3)<<6|C&63;return V},o0=typeof ArrayBuffer=="function",pa=(o,i)=>{if(typeof o!="string")return{type:"message",data:Tu(o,i)};const s=o.charAt(0);return s==="b"?{type:"message",data:a0(o.substring(1),i)}:Us[s]?o.length>1?{type:Us[s],data:o.substring(1)}:{type:Us[s]}:Zo},a0=(o,i)=>{if(o0){const s=i0(o);return Tu(s,i)}else return{base64:!0,data:o}},Tu=(o,i)=>{switch(i){case"blob":return o instanceof Blob?o:new Blob([o]);case"arraybuffer":default:return o instanceof ArrayBuffer?o:o.buffer}},ku="",l0=(o,i)=>{const s=o.length,l=new Array(s);let d=0;o.forEach((m,b)=>{fa(m,!1,j=>{l[b]=j,++d===s&&i(l.join(ku))})})},c0=(o,i)=>{const s=o.split(ku),l=[];for(let d=0;d<s.length;d++){const m=pa(s[d],i);if(l.push(m),m.type==="error")break}return l};function u0(){return new TransformStream({transform(o,i){s0(o,s=>{const l=s.length;let d;if(l<126)d=new Uint8Array(1),new DataView(d.buffer).setUint8(0,l);else if(l<65536){d=new Uint8Array(3);const m=new DataView(d.buffer);m.setUint8(0,126),m.setUint16(1,l)}else{d=new Uint8Array(9);const m=new DataView(d.buffer);m.setUint8(0,127),m.setBigUint64(1,BigInt(l))}o.data&&typeof o.data!="string"&&(d[0]|=128),i.enqueue(d),i.enqueue(s)})}})}let Ko;function zs(o){return o.reduce((i,s)=>i+s.length,0)}function Fs(o,i){if(o[0].length===i)return o.shift();const s=new Uint8Array(i);let l=0;for(let d=0;d<i;d++)s[d]=o[0][l++],l===o[0].length&&(o.shift(),l=0);return o.length&&l<o[0].length&&(o[0]=o[0].slice(l)),s}function h0(o,i){Ko||(Ko=new TextDecoder);const s=[];let l=0,d=-1,m=!1;return new TransformStream({transform(b,j){for(s.push(b);;){if(l===0){if(zs(s)<1)break;const C=Fs(s,1);m=(C[0]&128)===128,d=C[0]&127,d<126?l=3:d===126?l=1:l=2}else if(l===1){if(zs(s)<2)break;const C=Fs(s,2);d=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),l=3}else if(l===2){if(zs(s)<8)break;const C=Fs(s,8),V=new DataView(C.buffer,C.byteOffset,C.length),I=V.getUint32(0);if(I>Math.pow(2,21)-1){j.enqueue(Zo);break}d=I*Math.pow(2,32)+V.getUint32(4),l=3}else{if(zs(s)<d)break;const C=Fs(s,d);j.enqueue(pa(m?C:Ko.decode(C),i)),l=0}if(d===0||d>o){j.enqueue(Zo);break}}}})}const Iu=4;function Qe(o){if(o)return d0(o)}function d0(o){for(var i in Qe.prototype)o[i]=Qe.prototype[i];return o}Qe.prototype.on=Qe.prototype.addEventListener=function(o,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+o]=this._callbacks["$"+o]||[]).push(i),this};Qe.prototype.once=function(o,i){function s(){this.off(o,s),i.apply(this,arguments)}return s.fn=i,this.on(o,s),this};Qe.prototype.off=Qe.prototype.removeListener=Qe.prototype.removeAllListeners=Qe.prototype.removeEventListener=function(o,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+o];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+o],this;for(var l,d=0;d<s.length;d++)if(l=s[d],l===i||l.fn===i){s.splice(d,1);break}return s.length===0&&delete this._callbacks["$"+o],this};Qe.prototype.emit=function(o){this._callbacks=this._callbacks||{};for(var i=new Array(arguments.length-1),s=this._callbacks["$"+o],l=1;l<arguments.length;l++)i[l-1]=arguments[l];if(s){s=s.slice(0);for(var l=0,d=s.length;l<d;++l)s[l].apply(this,i)}return this};Qe.prototype.emitReserved=Qe.prototype.emit;Qe.prototype.listeners=function(o){return this._callbacks=this._callbacks||{},this._callbacks["$"+o]||[]};Qe.prototype.hasListeners=function(o){return!!this.listeners(o).length};const vi=typeof Promise=="function"&&typeof Promise.resolve=="function"?i=>Promise.resolve().then(i):(i,s)=>s(i,0),zt=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),f0="arraybuffer";function Ru(o,...i){return i.reduce((s,l)=>(o.hasOwnProperty(l)&&(s[l]=o[l]),s),{})}const p0=zt.setTimeout,x0=zt.clearTimeout;function yi(o,i){i.useNativeTimers?(o.setTimeoutFn=p0.bind(zt),o.clearTimeoutFn=x0.bind(zt)):(o.setTimeoutFn=zt.setTimeout.bind(zt),o.clearTimeoutFn=zt.clearTimeout.bind(zt))}const g0=1.33;function m0(o){return typeof o=="string"?v0(o):Math.ceil((o.byteLength||o.size)*g0)}function v0(o){let i=0,s=0;for(let l=0,d=o.length;l<d;l++)i=o.charCodeAt(l),i<128?s+=1:i<2048?s+=2:i<55296||i>=57344?s+=3:(l++,s+=4);return s}function Eu(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function y0(o){let i="";for(let s in o)o.hasOwnProperty(s)&&(i.length&&(i+="&"),i+=encodeURIComponent(s)+"="+encodeURIComponent(o[s]));return i}function j0(o){let i={},s=o.split("&");for(let l=0,d=s.length;l<d;l++){let m=s[l].split("=");i[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return i}class b0 extends Error{constructor(i,s,l){super(i),this.description=s,this.context=l,this.type="TransportError"}}class xa extends Qe{constructor(i){super(),this.writable=!1,yi(this,i),this.opts=i,this.query=i.query,this.socket=i.socket,this.supportsBinary=!i.forceBase64}onError(i,s,l){return super.emitReserved("error",new b0(i,s,l)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(i){this.readyState==="open"&&this.write(i)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(i){const s=pa(i,this.socket.binaryType);this.onPacket(s)}onPacket(i){super.emitReserved("packet",i)}onClose(i){this.readyState="closed",super.emitReserved("close",i)}pause(i){}createUri(i,s={}){return i+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const i=this.opts.hostname;return i.indexOf(":")===-1?i:"["+i+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(i){const s=y0(i);return s.length?"?"+s:""}}class _0 extends xa{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(i){this.readyState="pausing";const s=()=>{this.readyState="paused",i()};if(this._polling||!this.writable){let l=0;this._polling&&(l++,this.once("pollComplete",function(){--l||s()})),this.writable||(l++,this.once("drain",function(){--l||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(i){const s=l=>{if(this.readyState==="opening"&&l.type==="open"&&this.onOpen(),l.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(l)};c0(i,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const i=()=>{this.write([{type:"close"}])};this.readyState==="open"?i():this.once("open",i)}write(i){this.writable=!1,l0(i,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const i=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=Eu()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(i,s)}}let Lu=!1;try{Lu=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const w0=Lu;function S0(){}class C0 extends _0{constructor(i){if(super(i),typeof location<"u"){const s=location.protocol==="https:";let l=location.port;l||(l=s?"443":"80"),this.xd=typeof location<"u"&&i.hostname!==location.hostname||l!==i.port}}doWrite(i,s){const l=this.request({method:"POST",data:i});l.on("success",s),l.on("error",(d,m)=>{this.onError("xhr post error",d,m)})}doPoll(){const i=this.request();i.on("data",this.onData.bind(this)),i.on("error",(s,l)=>{this.onError("xhr poll error",s,l)}),this.pollXhr=i}}class en extends Qe{constructor(i,s,l){super(),this.createRequest=i,yi(this,l),this._opts=l,this._method=l.method||"GET",this._uri=s,this._data=l.data!==void 0?l.data:null,this._create()}_create(){var i;const s=Ru(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const l=this._xhr=this.createRequest(s);try{l.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){l.setDisableHeaderCheck&&l.setDisableHeaderCheck(!0);for(let d in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(d)&&l.setRequestHeader(d,this._opts.extraHeaders[d])}}catch{}if(this._method==="POST")try{l.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{l.setRequestHeader("Accept","*/*")}catch{}(i=this._opts.cookieJar)===null||i===void 0||i.addCookies(l),"withCredentials"in l&&(l.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(l.timeout=this._opts.requestTimeout),l.onreadystatechange=()=>{var d;l.readyState===3&&((d=this._opts.cookieJar)===null||d===void 0||d.parseCookies(l.getResponseHeader("set-cookie"))),l.readyState===4&&(l.status===200||l.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof l.status=="number"?l.status:0)},0))},l.send(this._data)}catch(d){this.setTimeoutFn(()=>{this._onError(d)},0);return}typeof document<"u"&&(this._index=en.requestsCount++,en.requests[this._index]=this)}_onError(i){this.emitReserved("error",i,this._xhr),this._cleanup(!0)}_cleanup(i){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=S0,i)try{this._xhr.abort()}catch{}typeof document<"u"&&delete en.requests[this._index],this._xhr=null}}_onLoad(){const i=this._xhr.responseText;i!==null&&(this.emitReserved("data",i),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}en.requestsCount=0;en.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ou);else if(typeof addEventListener=="function"){const o="onpagehide"in zt?"pagehide":"unload";addEventListener(o,ou,!1)}}function ou(){for(let o in en.requests)en.requests.hasOwnProperty(o)&&en.requests[o].abort()}const A0=function(){const o=Mu({xdomain:!1});return o&&o.responseType!==null}();class T0 extends C0{constructor(i){super(i);const s=i&&i.forceBase64;this.supportsBinary=A0&&!s}request(i={}){return Object.assign(i,{xd:this.xd},this.opts),new en(Mu,this.uri(),i)}}function Mu(o){const i=o.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!i||w0))return new XMLHttpRequest}catch{}if(!i)try{return new zt[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Pu=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class k0 extends xa{get name(){return"websocket"}doOpen(){const i=this.uri(),s=this.opts.protocols,l=Pu?{}:Ru(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(l.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(i,s,l)}catch(d){return this.emitReserved("error",d)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=i=>this.onClose({description:"websocket connection closed",context:i}),this.ws.onmessage=i=>this.onData(i.data),this.ws.onerror=i=>this.onError("websocket error",i)}write(i){this.writable=!1;for(let s=0;s<i.length;s++){const l=i[s],d=s===i.length-1;fa(l,this.supportsBinary,m=>{try{this.doWrite(l,m)}catch{}d&&vi(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const i=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=Eu()),this.supportsBinary||(s.b64=1),this.createUri(i,s)}}const Go=zt.WebSocket||zt.MozWebSocket;class I0 extends k0{createSocket(i,s,l){return Pu?new Go(i,s,l):s?new Go(i,s):new Go(i)}doWrite(i,s){this.ws.send(s)}}class R0 extends xa{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(i){return this.emitReserved("error",i)}this._transport.closed.then(()=>{this.onClose()}).catch(i=>{this.onError("webtransport error",i)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(i=>{const s=h0(Number.MAX_SAFE_INTEGER,this.socket.binaryType),l=i.readable.pipeThrough(s).getReader(),d=u0();d.readable.pipeTo(i.writable),this._writer=d.writable.getWriter();const m=()=>{l.read().then(({done:j,value:C})=>{j||(this.onPacket(C),m())}).catch(j=>{})};m();const b={type:"open"};this.query.sid&&(b.data=`{"sid":"${this.query.sid}"}`),this._writer.write(b).then(()=>this.onOpen())})})}write(i){this.writable=!1;for(let s=0;s<i.length;s++){const l=i[s],d=s===i.length-1;this._writer.write(l).then(()=>{d&&vi(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var i;(i=this._transport)===null||i===void 0||i.close()}}const E0={websocket:I0,webtransport:R0,polling:T0},L0=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,M0=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ea(o){if(o.length>8e3)throw"URI too long";const i=o,s=o.indexOf("["),l=o.indexOf("]");s!=-1&&l!=-1&&(o=o.substring(0,s)+o.substring(s,l).replace(/:/g,";")+o.substring(l,o.length));let d=L0.exec(o||""),m={},b=14;for(;b--;)m[M0[b]]=d[b]||"";return s!=-1&&l!=-1&&(m.source=i,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=!0),m.pathNames=P0(m,m.path),m.queryKey=D0(m,m.query),m}function P0(o,i){const s=/\/{2,9}/g,l=i.replace(s,"/").split("/");return(i.slice(0,1)=="/"||i.length===0)&&l.splice(0,1),i.slice(-1)=="/"&&l.splice(l.length-1,1),l}function D0(o,i){const s={};return i.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(l,d,m){d&&(s[d]=m)}),s}const ta=typeof addEventListener=="function"&&typeof removeEventListener=="function",$s=[];ta&&addEventListener("offline",()=>{$s.forEach(o=>o())},!1);class An extends Qe{constructor(i,s){if(super(),this.binaryType=f0,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,i&&typeof i=="object"&&(s=i,i=null),i){const l=ea(i);s.hostname=l.host,s.secure=l.protocol==="https"||l.protocol==="wss",s.port=l.port,l.query&&(s.query=l.query)}else s.host&&(s.hostname=ea(s.host).host);yi(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(l=>{const d=l.prototype.name;this.transports.push(d),this._transportsByName[d]=l}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=j0(this.opts.query)),ta&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},$s.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(i){const s=Object.assign({},this.opts.query);s.EIO=Iu,s.transport=i,this.id&&(s.sid=this.id);const l=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[i]);return new this._transportsByName[i](l)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const i=this.opts.rememberUpgrade&&An.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(i);s.open(),this.setTransport(s)}setTransport(i){this.transport&&this.transport.removeAllListeners(),this.transport=i,i.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",An.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(i){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",i),this.emitReserved("heartbeat"),i.type){case"open":this.onHandshake(JSON.parse(i.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=i.data,this._onError(s);break;case"message":this.emitReserved("data",i.data),this.emitReserved("message",i.data);break}}onHandshake(i){this.emitReserved("handshake",i),this.id=i.sid,this.transport.query.sid=i.sid,this._pingInterval=i.pingInterval,this._pingTimeout=i.pingTimeout,this._maxPayload=i.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const i=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+i,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},i),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const i=this._getWritablePackets();this.transport.send(i),this._prevBufferLen=i.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let l=0;l<this.writeBuffer.length;l++){const d=this.writeBuffer[l].data;if(d&&(s+=m0(d)),l>0&&s>this._maxPayload)return this.writeBuffer.slice(0,l);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const i=Date.now()>this._pingTimeoutTime;return i&&(this._pingTimeoutTime=0,vi(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),i}write(i,s,l){return this._sendPacket("message",i,s,l),this}send(i,s,l){return this._sendPacket("message",i,s,l),this}_sendPacket(i,s,l,d){if(typeof s=="function"&&(d=s,s=void 0),typeof l=="function"&&(d=l,l=null),this.readyState==="closing"||this.readyState==="closed")return;l=l||{},l.compress=l.compress!==!1;const m={type:i,data:s,options:l};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),d&&this.once("flush",d),this.flush()}close(){const i=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),i()},l=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?l():i()}):this.upgrading?l():i()),this}_onError(i){if(An.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",i),this._onClose("transport error",i)}_onClose(i,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ta&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const l=$s.indexOf(this._offlineEventListener);l!==-1&&$s.splice(l,1)}this.readyState="closed",this.id=null,this.emitReserved("close",i,s),this.writeBuffer=[],this._prevBufferLen=0}}}An.protocol=Iu;class O0 extends An{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let i=0;i<this._upgrades.length;i++)this._probe(this._upgrades[i])}_probe(i){let s=this.createTransport(i),l=!1;An.priorWebsocketSuccess=!1;const d=()=>{l||(s.send([{type:"ping",data:"probe"}]),s.once("packet",O=>{if(!l)if(O.type==="pong"&&O.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;An.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{l||this.readyState!=="closed"&&(I(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const q=new Error("probe error");q.transport=s.name,this.emitReserved("upgradeError",q)}}))};function m(){l||(l=!0,I(),s.close(),s=null)}const b=O=>{const q=new Error("probe error: "+O);q.transport=s.name,m(),this.emitReserved("upgradeError",q)};function j(){b("transport closed")}function C(){b("socket closed")}function V(O){s&&O.name!==s.name&&m()}const I=()=>{s.removeListener("open",d),s.removeListener("error",b),s.removeListener("close",j),this.off("close",C),this.off("upgrading",V)};s.once("open",d),s.once("error",b),s.once("close",j),this.once("close",C),this.once("upgrading",V),this._upgrades.indexOf("webtransport")!==-1&&i!=="webtransport"?this.setTimeoutFn(()=>{l||s.open()},200):s.open()}onHandshake(i){this._upgrades=this._filterUpgrades(i.upgrades),super.onHandshake(i)}_filterUpgrades(i){const s=[];for(let l=0;l<i.length;l++)~this.transports.indexOf(i[l])&&s.push(i[l]);return s}}let N0=class extends O0{constructor(i,s={}){const l=typeof i=="object"?i:s;(!l.transports||l.transports&&typeof l.transports[0]=="string")&&(l.transports=(l.transports||["polling","websocket","webtransport"]).map(d=>E0[d]).filter(d=>!!d)),super(i,l)}};function B0(o,i="",s){let l=o;s=s||typeof location<"u"&&location,o==null&&(o=s.protocol+"//"+s.host),typeof o=="string"&&(o.charAt(0)==="/"&&(o.charAt(1)==="/"?o=s.protocol+o:o=s.host+o),/^(https?|wss?):\/\//.test(o)||(typeof s<"u"?o=s.protocol+"//"+o:o="https://"+o),l=ea(o)),l.port||(/^(http|ws)$/.test(l.protocol)?l.port="80":/^(http|ws)s$/.test(l.protocol)&&(l.port="443")),l.path=l.path||"/";const m=l.host.indexOf(":")!==-1?"["+l.host+"]":l.host;return l.id=l.protocol+"://"+m+":"+l.port+i,l.href=l.protocol+"://"+m+(s&&s.port===l.port?"":":"+l.port),l}const z0=typeof ArrayBuffer=="function",F0=o=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(o):o.buffer instanceof ArrayBuffer,Du=Object.prototype.toString,W0=typeof Blob=="function"||typeof Blob<"u"&&Du.call(Blob)==="[object BlobConstructor]",U0=typeof File=="function"||typeof File<"u"&&Du.call(File)==="[object FileConstructor]";function ga(o){return z0&&(o instanceof ArrayBuffer||F0(o))||W0&&o instanceof Blob||U0&&o instanceof File}function Hs(o,i){if(!o||typeof o!="object")return!1;if(Array.isArray(o)){for(let s=0,l=o.length;s<l;s++)if(Hs(o[s]))return!0;return!1}if(ga(o))return!0;if(o.toJSON&&typeof o.toJSON=="function"&&arguments.length===1)return Hs(o.toJSON(),!0);for(const s in o)if(Object.prototype.hasOwnProperty.call(o,s)&&Hs(o[s]))return!0;return!1}function $0(o){const i=[],s=o.data,l=o;return l.data=na(s,i),l.attachments=i.length,{packet:l,buffers:i}}function na(o,i){if(!o)return o;if(ga(o)){const s={_placeholder:!0,num:i.length};return i.push(o),s}else if(Array.isArray(o)){const s=new Array(o.length);for(let l=0;l<o.length;l++)s[l]=na(o[l],i);return s}else if(typeof o=="object"&&!(o instanceof Date)){const s={};for(const l in o)Object.prototype.hasOwnProperty.call(o,l)&&(s[l]=na(o[l],i));return s}return o}function H0(o,i){return o.data=ra(o.data,i),delete o.attachments,o}function ra(o,i){if(!o)return o;if(o&&o._placeholder===!0){if(typeof o.num=="number"&&o.num>=0&&o.num<i.length)return i[o.num];throw new Error("illegal attachments")}else if(Array.isArray(o))for(let s=0;s<o.length;s++)o[s]=ra(o[s],i);else if(typeof o=="object")for(const s in o)Object.prototype.hasOwnProperty.call(o,s)&&(o[s]=ra(o[s],i));return o}const q0=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],K0=5;var Ie;(function(o){o[o.CONNECT=0]="CONNECT",o[o.DISCONNECT=1]="DISCONNECT",o[o.EVENT=2]="EVENT",o[o.ACK=3]="ACK",o[o.CONNECT_ERROR=4]="CONNECT_ERROR",o[o.BINARY_EVENT=5]="BINARY_EVENT",o[o.BINARY_ACK=6]="BINARY_ACK"})(Ie||(Ie={}));class G0{constructor(i){this.replacer=i}encode(i){return(i.type===Ie.EVENT||i.type===Ie.ACK)&&Hs(i)?this.encodeAsBinary({type:i.type===Ie.EVENT?Ie.BINARY_EVENT:Ie.BINARY_ACK,nsp:i.nsp,data:i.data,id:i.id}):[this.encodeAsString(i)]}encodeAsString(i){let s=""+i.type;return(i.type===Ie.BINARY_EVENT||i.type===Ie.BINARY_ACK)&&(s+=i.attachments+"-"),i.nsp&&i.nsp!=="/"&&(s+=i.nsp+","),i.id!=null&&(s+=i.id),i.data!=null&&(s+=JSON.stringify(i.data,this.replacer)),s}encodeAsBinary(i){const s=$0(i),l=this.encodeAsString(s.packet),d=s.buffers;return d.unshift(l),d}}function au(o){return Object.prototype.toString.call(o)==="[object Object]"}class ma extends Qe{constructor(i){super(),this.reviver=i}add(i){let s;if(typeof i=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(i);const l=s.type===Ie.BINARY_EVENT;l||s.type===Ie.BINARY_ACK?(s.type=l?Ie.EVENT:Ie.ACK,this.reconstructor=new V0(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(ga(i)||i.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(i),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+i)}decodeString(i){let s=0;const l={type:Number(i.charAt(0))};if(Ie[l.type]===void 0)throw new Error("unknown packet type "+l.type);if(l.type===Ie.BINARY_EVENT||l.type===Ie.BINARY_ACK){const m=s+1;for(;i.charAt(++s)!=="-"&&s!=i.length;);const b=i.substring(m,s);if(b!=Number(b)||i.charAt(s)!=="-")throw new Error("Illegal attachments");l.attachments=Number(b)}if(i.charAt(s+1)==="/"){const m=s+1;for(;++s&&!(i.charAt(s)===","||s===i.length););l.nsp=i.substring(m,s)}else l.nsp="/";const d=i.charAt(s+1);if(d!==""&&Number(d)==d){const m=s+1;for(;++s;){const b=i.charAt(s);if(b==null||Number(b)!=b){--s;break}if(s===i.length)break}l.id=Number(i.substring(m,s+1))}if(i.charAt(++s)){const m=this.tryParse(i.substr(s));if(ma.isPayloadValid(l.type,m))l.data=m;else throw new Error("invalid payload")}return l}tryParse(i){try{return JSON.parse(i,this.reviver)}catch{return!1}}static isPayloadValid(i,s){switch(i){case Ie.CONNECT:return au(s);case Ie.DISCONNECT:return s===void 0;case Ie.CONNECT_ERROR:return typeof s=="string"||au(s);case Ie.EVENT:case Ie.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&q0.indexOf(s[0])===-1);case Ie.ACK:case Ie.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class V0{constructor(i){this.packet=i,this.buffers=[],this.reconPack=i}takeBinaryData(i){if(this.buffers.push(i),this.buffers.length===this.reconPack.attachments){const s=H0(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Q0=Object.freeze(Object.defineProperty({__proto__:null,Decoder:ma,Encoder:G0,get PacketType(){return Ie},protocol:K0},Symbol.toStringTag,{value:"Module"}));function qt(o,i,s){return o.on(i,s),function(){o.off(i,s)}}const Y0=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ou extends Qe{constructor(i,s,l){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=i,this.nsp=s,l&&l.auth&&(this.auth=l.auth),this._opts=Object.assign({},l),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const i=this.io;this.subs=[qt(i,"open",this.onopen.bind(this)),qt(i,"packet",this.onpacket.bind(this)),qt(i,"error",this.onerror.bind(this)),qt(i,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...i){return i.unshift("message"),this.emit.apply(this,i),this}emit(i,...s){var l,d,m;if(Y0.hasOwnProperty(i))throw new Error('"'+i.toString()+'" is a reserved event name');if(s.unshift(i),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const b={type:Ie.EVENT,data:s};if(b.options={},b.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const I=this.ids++,O=s.pop();this._registerAckCallback(I,O),b.id=I}const j=(d=(l=this.io.engine)===null||l===void 0?void 0:l.transport)===null||d===void 0?void 0:d.writable,C=this.connected&&!(!((m=this.io.engine)===null||m===void 0)&&m._hasPingExpired());return this.flags.volatile&&!j||(C?(this.notifyOutgoingListeners(b),this.packet(b)):this.sendBuffer.push(b)),this.flags={},this}_registerAckCallback(i,s){var l;const d=(l=this.flags.timeout)!==null&&l!==void 0?l:this._opts.ackTimeout;if(d===void 0){this.acks[i]=s;return}const m=this.io.setTimeoutFn(()=>{delete this.acks[i];for(let j=0;j<this.sendBuffer.length;j++)this.sendBuffer[j].id===i&&this.sendBuffer.splice(j,1);s.call(this,new Error("operation has timed out"))},d),b=(...j)=>{this.io.clearTimeoutFn(m),s.apply(this,j)};b.withError=!0,this.acks[i]=b}emitWithAck(i,...s){return new Promise((l,d)=>{const m=(b,j)=>b?d(b):l(j);m.withError=!0,s.push(m),this.emit(i,...s)})}_addToQueue(i){let s;typeof i[i.length-1]=="function"&&(s=i.pop());const l={id:this._queueSeq++,tryCount:0,pending:!1,args:i,flags:Object.assign({fromQueue:!0},this.flags)};i.push((d,...m)=>l!==this._queue[0]?void 0:(d!==null?l.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(d)):(this._queue.shift(),s&&s(null,...m)),l.pending=!1,this._drainQueue())),this._queue.push(l),this._drainQueue()}_drainQueue(i=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!i||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(i){i.nsp=this.nsp,this.io._packet(i)}onopen(){typeof this.auth=="function"?this.auth(i=>{this._sendConnectPacket(i)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(i){this.packet({type:Ie.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},i):i})}onerror(i){this.connected||this.emitReserved("connect_error",i)}onclose(i,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",i,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(i=>{if(!this.sendBuffer.some(l=>String(l.id)===i)){const l=this.acks[i];delete this.acks[i],l.withError&&l.call(this,new Error("socket has been disconnected"))}})}onpacket(i){if(i.nsp===this.nsp)switch(i.type){case Ie.CONNECT:i.data&&i.data.sid?this.onconnect(i.data.sid,i.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Ie.EVENT:case Ie.BINARY_EVENT:this.onevent(i);break;case Ie.ACK:case Ie.BINARY_ACK:this.onack(i);break;case Ie.DISCONNECT:this.ondisconnect();break;case Ie.CONNECT_ERROR:this.destroy();const l=new Error(i.data.message);l.data=i.data.data,this.emitReserved("connect_error",l);break}}onevent(i){const s=i.data||[];i.id!=null&&s.push(this.ack(i.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(i){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const l of s)l.apply(this,i)}super.emit.apply(this,i),this._pid&&i.length&&typeof i[i.length-1]=="string"&&(this._lastOffset=i[i.length-1])}ack(i){const s=this;let l=!1;return function(...d){l||(l=!0,s.packet({type:Ie.ACK,id:i,data:d}))}}onack(i){const s=this.acks[i.id];typeof s=="function"&&(delete this.acks[i.id],s.withError&&i.data.unshift(null),s.apply(this,i.data))}onconnect(i,s){this.id=i,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(i=>this.emitEvent(i)),this.receiveBuffer=[],this.sendBuffer.forEach(i=>{this.notifyOutgoingListeners(i),this.packet(i)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(i=>i()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Ie.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(i){return this.flags.compress=i,this}get volatile(){return this.flags.volatile=!0,this}timeout(i){return this.flags.timeout=i,this}onAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(i),this}prependAny(i){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(i),this}offAny(i){if(!this._anyListeners)return this;if(i){const s=this._anyListeners;for(let l=0;l<s.length;l++)if(i===s[l])return s.splice(l,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(i),this}prependAnyOutgoing(i){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(i),this}offAnyOutgoing(i){if(!this._anyOutgoingListeners)return this;if(i){const s=this._anyOutgoingListeners;for(let l=0;l<s.length;l++)if(i===s[l])return s.splice(l,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(i){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const l of s)l.apply(this,i.data)}}}function vr(o){o=o||{},this.ms=o.min||100,this.max=o.max||1e4,this.factor=o.factor||2,this.jitter=o.jitter>0&&o.jitter<=1?o.jitter:0,this.attempts=0}vr.prototype.duration=function(){var o=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var i=Math.random(),s=Math.floor(i*this.jitter*o);o=Math.floor(i*10)&1?o+s:o-s}return Math.min(o,this.max)|0};vr.prototype.reset=function(){this.attempts=0};vr.prototype.setMin=function(o){this.ms=o};vr.prototype.setMax=function(o){this.max=o};vr.prototype.setJitter=function(o){this.jitter=o};class sa extends Qe{constructor(i,s){var l;super(),this.nsps={},this.subs=[],i&&typeof i=="object"&&(s=i,i=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,yi(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((l=s.randomizationFactor)!==null&&l!==void 0?l:.5),this.backoff=new vr({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=i;const d=s.parser||Q0;this.encoder=new d.Encoder,this.decoder=new d.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(i){return arguments.length?(this._reconnection=!!i,i||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(i){return i===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=i,this)}reconnectionDelay(i){var s;return i===void 0?this._reconnectionDelay:(this._reconnectionDelay=i,(s=this.backoff)===null||s===void 0||s.setMin(i),this)}randomizationFactor(i){var s;return i===void 0?this._randomizationFactor:(this._randomizationFactor=i,(s=this.backoff)===null||s===void 0||s.setJitter(i),this)}reconnectionDelayMax(i){var s;return i===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=i,(s=this.backoff)===null||s===void 0||s.setMax(i),this)}timeout(i){return arguments.length?(this._timeout=i,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(i){if(~this._readyState.indexOf("open"))return this;this.engine=new N0(this.uri,this.opts);const s=this.engine,l=this;this._readyState="opening",this.skipReconnect=!1;const d=qt(s,"open",function(){l.onopen(),i&&i()}),m=j=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",j),i?i(j):this.maybeReconnectOnOpen()},b=qt(s,"error",m);if(this._timeout!==!1){const j=this._timeout,C=this.setTimeoutFn(()=>{d(),m(new Error("timeout")),s.close()},j);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(d),this.subs.push(b),this}connect(i){return this.open(i)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const i=this.engine;this.subs.push(qt(i,"ping",this.onping.bind(this)),qt(i,"data",this.ondata.bind(this)),qt(i,"error",this.onerror.bind(this)),qt(i,"close",this.onclose.bind(this)),qt(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(i){try{this.decoder.add(i)}catch(s){this.onclose("parse error",s)}}ondecoded(i){vi(()=>{this.emitReserved("packet",i)},this.setTimeoutFn)}onerror(i){this.emitReserved("error",i)}socket(i,s){let l=this.nsps[i];return l?this._autoConnect&&!l.active&&l.connect():(l=new Ou(this,i,s),this.nsps[i]=l),l}_destroy(i){const s=Object.keys(this.nsps);for(const l of s)if(this.nsps[l].active)return;this._close()}_packet(i){const s=this.encoder.encode(i);for(let l=0;l<s.length;l++)this.engine.write(s[l],i.options)}cleanup(){this.subs.forEach(i=>i()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(i,s){var l;this.cleanup(),(l=this.engine)===null||l===void 0||l.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",i,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const i=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const l=this.setTimeoutFn(()=>{i.skipReconnect||(this.emitReserved("reconnect_attempt",i.backoff.attempts),!i.skipReconnect&&i.open(d=>{d?(i._reconnecting=!1,i.reconnect(),this.emitReserved("reconnect_error",d)):i.onreconnect()}))},s);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}}onreconnect(){const i=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",i)}}const Nr={};function qs(o,i){typeof o=="object"&&(i=o,o=void 0),i=i||{};const s=B0(o,i.path||"/socket.io"),l=s.source,d=s.id,m=s.path,b=Nr[d]&&m in Nr[d].nsps,j=i.forceNew||i["force new connection"]||i.multiplex===!1||b;let C;return j?C=new sa(l,i):(Nr[d]||(Nr[d]=new sa(l,i)),C=Nr[d]),s.query&&!i.query&&(i.query=s.queryKey),C.socket(s.path,i)}Object.assign(qs,{Manager:sa,Socket:Ou,io:qs,connect:qs});var J0={};class X0{constructor(i={}){this.config=i,this.socket=null,this.connectionStatus="disconnected",this.eventHandlers={},this.joinedConversations=new Set,this.typingTimeouts=new Map,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.isManualDisconnect=!1,this.missedMessagesQueue=[],this.maxReconnectAttempts=i.reconnectionAttempts||5,this.reconnectDelay=i.reconnectionDelay||1e3}connect(){return new Promise((i,s)=>{try{const l=this.config.url||J0.VITE_SOCKET_URL||"http://localhost:3001";this.socket=qs(l,{withCredentials:!0,autoConnect:this.config.autoConnect!==!1,reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:this.reconnectDelay,timeout:this.config.timeout||2e4,transports:["websocket","polling"]}),this.setupEventListeners(),this.isManualDisconnect=!1,this.socket.on("connect",()=>{this.setConnectionStatus("connected"),this.reconnectAttempts=0,this.rejoinConversations(),this.processMissedMessages(),i()}),this.socket.on("connect_error",d=>{var m,b;this.setConnectionStatus("error"),(b=(m=this.eventHandlers).onError)==null||b.call(m,d.message),s(d)}),this.config.autoConnect!==!1&&(this.setConnectionStatus("connecting"),this.socket.connect())}catch(l){this.setConnectionStatus("error"),s(l)}})}disconnect(){this.isManualDisconnect=!0,this.clearTypingTimeouts(),this.joinedConversations.clear(),this.socket&&(this.socket.disconnect(),this.socket=null),this.setConnectionStatus("disconnected")}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{this.setConnectionStatus("connected"),this.reconnectAttempts=0}),this.socket.on("disconnect",i=>{this.setConnectionStatus("disconnected"),!this.isManualDisconnect&&i==="io server disconnect"&&this.attemptReconnection()}),this.socket.on("reconnect",i=>{this.setConnectionStatus("connected"),this.reconnectAttempts=0,this.rejoinConversations(),this.processMissedMessages()}),this.socket.on("reconnect_error",i=>{var s,l;this.setConnectionStatus("error"),(l=(s=this.eventHandlers).onError)==null||l.call(s,i.message)}),this.socket.on("message_received",i=>{var s,l;(l=(s=this.eventHandlers).onMessageReceived)==null||l.call(s,i)}),this.socket.on("message_updated",i=>{var s,l;(l=(s=this.eventHandlers).onMessageUpdated)==null||l.call(s,i)}),this.socket.on("user_typing",({userId:i,conversationId:s})=>{var l,d;(d=(l=this.eventHandlers).onUserTyping)==null||d.call(l,s,i)}),this.socket.on("user_stopped_typing",({userId:i,conversationId:s})=>{var l,d;(d=(l=this.eventHandlers).onUserStoppedTyping)==null||d.call(l,s,i)}),this.socket.on("notification_received",i=>{var s,l;(l=(s=this.eventHandlers).onNotificationReceived)==null||l.call(s,i)}),this.socket.on("conversation_updated",i=>{var s,l;(l=(s=this.eventHandlers).onConversationUpdated)==null||l.call(s,i)}),this.socket.on("participant_joined",({userId:i,conversationId:s})=>{var l,d;(d=(l=this.eventHandlers).onParticipantJoined)==null||d.call(l,s,i)}),this.socket.on("participant_left",({userId:i,conversationId:s})=>{var l,d;(d=(l=this.eventHandlers).onParticipantLeft)==null||d.call(l,s,i)}),this.socket.on("error_notification",({type:i,message:s,retry:l})=>{var d,m;(m=(d=this.eventHandlers).onError)==null||m.call(d,s),l&&i==="connection_error"&&this.attemptReconnection()}))}setEventHandlers(i){this.eventHandlers={...this.eventHandlers,...i}}joinConversation(i){if(!this.socket||!this.isConnected()){console.warn("Socket not connected, queuing conversation join"),this.joinedConversations.add(i);return}this.socket.emit("join_conversation",i),this.joinedConversations.add(i)}leaveConversation(i){if(!this.socket||!this.isConnected()){this.joinedConversations.delete(i);return}this.socket.emit("leave_conversation",i),this.joinedConversations.delete(i)}sendMessage(i){var s,l;if(!this.socket||!this.isConnected()){(l=(s=this.eventHandlers).onError)==null||l.call(s,"Cannot send message: Socket not connected");return}this.socket.emit("send_message",i)}startTyping(i){if(!this.socket||!this.isConnected())return;this.socket.emit("typing_start",i);const s=this.typingTimeouts.get(i);s&&clearTimeout(s);const l=setTimeout(()=>{this.stopTyping(i)},3e3);this.typingTimeouts.set(i,l)}stopTyping(i){if(!this.socket||!this.isConnected())return;this.socket.emit("typing_stop",i);const s=this.typingTimeouts.get(i);s&&(clearTimeout(s),this.typingTimeouts.delete(i))}markMessageAsRead(i){!this.socket||!this.isConnected()||this.socket.emit("mark_read",i)}getConnectionStatus(){return this.connectionStatus}isConnected(){var i;return((i=this.socket)==null?void 0:i.connected)===!0}getSocket(){return this.socket}setConnectionStatus(i){var s,l;this.connectionStatus!==i&&(this.connectionStatus=i,(l=(s=this.eventHandlers).onConnectionStatusChange)==null||l.call(s,i))}async checkAuthentication(){try{const{authService:i}=await Rv(async()=>{const{authService:l}=await import("./index-B_pWc9hu.js").then(d=>d.dz);return{authService:l}},__vite__mapDeps([0,1])),s=await i.getCurrentUser();return s.success&&!!s.user}catch(i){return console.error("Authentication check failed:",i),!1}}attemptReconnection(){this.isManualDisconnect||this.reconnectAttempts>=this.maxReconnectAttempts||(this.reconnectAttempts++,this.setConnectionStatus("reconnecting"),setTimeout(()=>{this.socket&&!this.socket.connected&&this.socket.connect()},this.reconnectDelay*this.reconnectAttempts))}rejoinConversations(){this.joinedConversations.forEach(i=>{this.socket&&this.isConnected()&&this.socket.emit("join_conversation",i)})}processMissedMessages(){this.missedMessagesQueue.length>0&&(this.missedMessagesQueue.forEach(i=>{var s,l;(l=(s=this.eventHandlers).onMessageReceived)==null||l.call(s,i)}),this.missedMessagesQueue=[])}clearTypingTimeouts(){this.typingTimeouts.forEach(i=>clearTimeout(i)),this.typingTimeouts.clear()}getConnectionInfo(){var i;return{status:this.connectionStatus,reconnectAttempts:this.reconnectAttempts,joinedConversations:Array.from(this.joinedConversations),socketId:(i=this.socket)==null?void 0:i.id}}forceReconnect(){this.socket&&(this.socket.disconnect(),this.socket.connect())}async refreshAuthentication(){const i=await this.checkAuthentication();!i&&this.isConnected()?this.disconnect():i&&!this.isConnected()&&await this.connect()}}const et=new X0,Z0=(o={})=>{const{autoConnect:i=!0,onConnectionChange:s,onError:l}=o,{handleSocketMessage:d,handleSocketConversationUpdate:m,handleSocketUserTyping:b,handleSocketUserStoppedTyping:j,addNotification:C,updateMessage:V}=Ft(),[I,O]=p.useState(!1),[q,X]=p.useState(!1),Q=p.useRef("disconnected"),U=p.useRef(!1),W=p.useCallback(async()=>{try{const k=await Ev.getCurrentUser(),K=k.success&&!!k.user;return O(K),K}catch(k){return console.error("Auth check failed:",k),O(!1),!1}finally{X(!0)}},[]),_=p.useCallback(()=>{const k={onMessageReceived:K=>{d(K)},onMessageUpdated:K=>{V(K._id,K)},onUserTyping:(K,le)=>{b(K,le)},onUserStoppedTyping:(K,le)=>{j(K,le)},onNotificationReceived:K=>{C(K)},onConversationUpdated:K=>{m(K)},onParticipantJoined:(K,le)=>{console.log(`User ${le} joined conversation ${K}`)},onParticipantLeft:(K,le)=>{console.log(`User ${le} left conversation ${K}`)},onConnectionStatusChange:K=>{Q.current=K,U.current=K==="connected",s==null||s(K)},onError:K=>{console.error("Socket error:",K),l==null||l(K)}};et.setEventHandlers(k)},[d,m,b,j,C,V,s,l]),Y=p.useCallback(async()=>{if(!await W())throw new Error("Authentication required for socket connection");try{await et.connect()}catch(K){throw console.error("Failed to connect to socket server:",K),K}},[W]),H=p.useCallback(()=>{et.disconnect()},[]),M=p.useCallback(k=>{et.joinConversation(k)},[]),T=p.useCallback(k=>{et.leaveConversation(k)},[]),J=p.useCallback(k=>{et.sendMessage(k)},[]),re=p.useCallback(k=>{et.startTyping(k)},[]),te=p.useCallback(k=>{et.stopTyping(k)},[]),G=p.useCallback(k=>{et.markMessageAsRead(k)},[]),Z=p.useCallback(()=>{et.forceReconnect()},[]);return p.useEffect(()=>{W();const k=setInterval(W,5*60*1e3);return()=>clearInterval(k)},[W]),p.useEffect(()=>(_(),i&&I&&q&&Y().catch(k=>{console.error("Auto-connect failed:",k)}),()=>{H()}),[_,i,I,q,Y,H]),p.useEffect(()=>{q&&!I&&H()},[I,q,H]),p.useEffect(()=>{I&&et.isConnected()&&et.refreshAuthentication().catch(k=>{console.error("Failed to refresh socket authentication:",k)})},[I]),{connectionStatus:Q.current,isConnected:U.current,isAuthenticated:I,connect:Y,disconnect:H,joinConversation:M,leaveConversation:T,sendMessage:J,startTyping:re,stopTyping:te,markMessageAsRead:G,forceReconnect:Z}},va=()=>{const o=et.getConnectionStatus(),i=et.isConnected(),s=et.getConnectionInfo();return{connectionStatus:o,isConnected:i,connectionInfo:s}},e1=o=>{const{typingUsers:i}=Ft(),{startTyping:s,stopTyping:l}=Z0({autoConnect:!1}),d=i[o]||[],m=p.useCallback(()=>{s(o)},[o,s]),b=p.useCallback(()=>{l(o)},[o,l]);return{typingUsers:d,startTyping:m,stopTyping:b}},Nu=(o,i={})=>{const{swipeThreshold:s=50,longPressDelay:l=500,doubleTapDelay:d=300,pinchThreshold:m=10}=i,b=p.useRef(null),j=p.useRef(null),C=p.useRef(null),V=p.useRef(0),I=p.useRef(0),O=p.useRef(!1),q=p.useCallback(_=>{var M;const Y=_.touches[0],H=Date.now();if(b.current={x:Y.clientX,y:Y.clientY,time:H},_.touches.length===2){const T=_.touches[0],J=_.touches[1],re=Math.sqrt(Math.pow(J.clientX-T.clientX,2)+Math.pow(J.clientY-T.clientY,2));I.current=re,O.current=!0,(M=o.onPinchStart)==null||M.call(o)}else O.current=!1,o.onLongPress&&(C.current=setTimeout(()=>{var T;(T=o.onLongPress)==null||T.call(o)},l))},[o,l]),X=p.useCallback(_=>{if(C.current&&(clearTimeout(C.current),C.current=null),_.touches.length===2&&O.current){const Y=_.touches[0],H=_.touches[1],M=Math.sqrt(Math.pow(H.clientX-Y.clientX,2)+Math.pow(H.clientY-Y.clientY,2));Math.abs(M-I.current)}},[m]),Q=p.useCallback(_=>{var G,Z,k,K,le;if(C.current&&(clearTimeout(C.current),C.current=null),O.current){O.current=!1,(G=o.onPinchEnd)==null||G.call(o);return}const Y=_.changedTouches[0],H=Date.now();if(j.current={x:Y.clientX,y:Y.clientY,time:H},!b.current||!j.current)return;const M=j.current.x-b.current.x,T=j.current.y-b.current.y,J=j.current.time-b.current.time;if(o.onDoubleTap&&J<d&&H-V.current<d){o.onDoubleTap(),V.current=0;return}V.current=H;const re=Math.abs(M),te=Math.abs(T);(re>s||te>s)&&(re>te?M>0?(Z=o.onSwipeRight)==null||Z.call(o):(k=o.onSwipeLeft)==null||k.call(o):T>0?(K=o.onSwipeDown)==null||K.call(o):(le=o.onSwipeUp)==null||le.call(o))},[o,s,d]),U=p.useRef(null),W=p.useCallback(_=>{U.current&&(U.current.removeEventListener("touchstart",q),U.current.removeEventListener("touchmove",X),U.current.removeEventListener("touchend",Q)),U.current=_,_&&(_.addEventListener("touchstart",q,{passive:!1}),_.addEventListener("touchmove",X,{passive:!1}),_.addEventListener("touchend",Q,{passive:!1}))},[q,X,Q]);return p.useEffect(()=>()=>{C.current&&clearTimeout(C.current),U.current&&(U.current.removeEventListener("touchstart",q),U.current.removeEventListener("touchmove",X),U.current.removeEventListener("touchend",Q))},[q,X,Q]),{attachGestures:W}},t1=({text:o,mentions:i=[],users:s=[],onMentionClick:l,variant:d="body2",color:m,sx:b})=>{const j=s.reduce((Q,U)=>(Q[U._id]=U,Q),{}),C=Q=>{switch(Q){case"doctor":return"primary.main";case"pharmacist":return"secondary.main";case"patient":return"info.main";default:return"text.primary"}},V=Q=>{switch(Q){case"doctor":return n.jsx(Ur,{sx:{fontSize:14}});case"pharmacist":return n.jsx(Ys,{sx:{fontSize:14}});case"patient":return n.jsx(xt,{sx:{fontSize:14}});default:return n.jsx(xt,{sx:{fontSize:14}})}},I=()=>{if(!o)return null;const Q=/@\[([^\]]+)\]\(([^)]+)\)/g,U=[];let W=0,_;for(;(_=Q.exec(o))!==null;){const[Y,H,M]=_,T=j[M];_.index>W&&U.push(n.jsx("span",{children:o.substring(W,_.index)},`text-${W}`)),T?U.push(n.jsx(Ee,{title:n.jsxs(x,{children:[n.jsxs(S,{variant:"caption",fontWeight:"bold",children:[T.firstName," ",T.lastName]}),n.jsx("br",{}),n.jsxs(S,{variant:"caption",children:[T.role,"  ",T.email]})]}),arrow:!0,children:n.jsx(Ne,{label:H,size:"small",icon:V(T.role),onClick:l?()=>l(M):void 0,sx:{mx:.25,height:20,fontSize:"0.75rem",bgcolor:C(T.role),color:"white",cursor:l?"pointer":"default","& .MuiChip-icon":{color:"white"},"&:hover":l?{opacity:.8}:{}}})},`mention-${_.index}`)):U.push(n.jsx(Ne,{label:H,size:"small",variant:"outlined",sx:{mx:.25,height:20,fontSize:"0.75rem",color:"text.secondary"}},`mention-unknown-${_.index}`)),W=_.index+Y.length}return W<o.length&&U.push(n.jsx("span",{children:o.substring(W)},`text-${W}`)),U.length>0?U:o},O=Q=>{if(typeof Q=="string"){const U=/(https?:\/\/[^\s]+)/g;return Q.split(U).map((_,Y)=>U.test(_)?n.jsx(Lv,{href:_,target:"_blank",rel:"noopener noreferrer",sx:{wordBreak:"break-all"},children:_},Y):_)}return Q},q=I(),X=Array.isArray(q)?q.map((Q,U)=>n.jsx("span",{children:O(Q)},U)):O(q);return n.jsx(S,{variant:d,color:m,sx:{wordBreak:"break-word",whiteSpace:"pre-wrap",...b},children:X})},n1=({threadId:o,replyCount:i,participants:s,lastReplyAt:l,unreadCount:d=0,expanded:m=!1,onToggle:b,onViewThread:j,variant:C="compact"})=>{if(i===0)return null;const V=O=>{O.stopPropagation(),j&&j()},I=O=>{O.stopPropagation(),b&&b()};return C==="compact"?n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:1,p:1,bgcolor:"primary.50",borderRadius:1,border:"1px solid",borderColor:"primary.light",cursor:"pointer","&:hover":{bgcolor:"primary.100"}},onClick:V,children:[n.jsx(Ks,{color:"primary",fontSize:"small"}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsxs(S,{variant:"caption",color:"primary",fontWeight:"bold",children:[i," ",i===1?"reply":"replies"]}),d>0&&n.jsx(qn,{badgeContent:d,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.6rem",minWidth:"16px",height:"16px"}}})]}),l&&n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Last reply"," ",Hn(new Date(l),{addSuffix:!0})]})]}),b&&n.jsx(Ee,{title:m?"Collapse thread":"Expand thread",children:n.jsx(ve,{size:"small",onClick:I,children:m?n.jsx(Js,{}):n.jsx(Gs,{})})})]}):n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mt:1,p:2,bgcolor:"background.paper",borderRadius:2,border:"1px solid",borderColor:"divider",cursor:j?"pointer":"default","&:hover":j?{bgcolor:"action.hover"}:{}},onClick:j?V:void 0,children:[n.jsx(Ks,{color:"primary"}),n.jsxs(x,{sx:{flex:1},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:.5},children:[n.jsx(S,{variant:"subtitle2",color:"primary",fontWeight:"bold",children:"Thread Discussion"}),d>0&&n.jsx(Ne,{label:`${d} new`,size:"small",color:"error",variant:"filled",sx:{height:20,fontSize:"0.75rem"}})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:3},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(xr,{fontSize:"small",color:"action"}),n.jsxs(S,{variant:"body2",color:"text.secondary",children:[i," ",i===1?"reply":"replies"]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(xt,{fontSize:"small",color:"action"}),n.jsxs(S,{variant:"body2",color:"text.secondary",children:[s.length," participant",s.length!==1?"s":""]})]}),l&&n.jsxs(S,{variant:"body2",color:"text.secondary",children:["Last reply"," ",Hn(new Date(l),{addSuffix:!0})]})]})]}),b&&n.jsx(Ee,{title:m?"Collapse thread":"Expand thread",children:n.jsx(ve,{onClick:I,children:m?n.jsx(Js,{}):n.jsx(Gs,{})})})]})},r1=({threadId:o,conversationId:i,onClose:s,compact:l=!1,showReplyInput:d=!0,maxHeight:m="600px"})=>{var M,T;const[b,j]=p.useState(!l),[C,V]=p.useState(null),[I,O]=p.useState(null),[q,X]=p.useState(!1),[Q,U]=p.useState(null);Ft();const W=async()=>{try{X(!0),U(null);const J=await fetch(`/api/communication/threads/${o}/summary`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!J.ok)throw new Error("Failed to fetch thread summary");const re=await J.json();V(re.data)}catch(J){U(J instanceof Error?J.message:"Failed to load thread")}finally{X(!1)}},_=async()=>{try{X(!0),U(null);const J=await fetch(`/api/communication/threads/${o}/messages`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!J.ok)throw new Error("Failed to fetch thread messages");const re=await J.json();O(re.data)}catch(J){U(J instanceof Error?J.message:"Failed to load thread messages")}finally{X(!1)}};p.useEffect(()=>{W(),b&&_()},[o,b]);const Y=()=>{j(!b),!b&&!I&&_()},H=async(J,re,te)=>{try{if(!(await fetch(`/api/communication/threads/${o}/reply`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({content:{text:J,type:"text"},mentions:te})})).ok)throw new Error("Failed to send reply");await _(),await W()}catch(G){throw console.error("Failed to reply to thread:",G),G}};return q&&!C?n.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:2},children:n.jsx(ur,{size:24})}):Q&&!C?n.jsx(xn,{severity:"error",sx:{m:1},children:Q}):C?n.jsxs(st,{variant:"outlined",sx:{mb:1,overflow:"hidden",border:"1px solid",borderColor:"primary.light",borderRadius:2},children:[n.jsx(x,{sx:{p:2,bgcolor:"primary.50",borderBottom:b?1:0,borderColor:"divider",cursor:l?"pointer":"default"},onClick:l?Y:void 0,children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Ks,{color:"primary",fontSize:"small"}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[n.jsx(S,{variant:"subtitle2",fontWeight:"bold",noWrap:!0,children:"Thread"}),C.unreadCount>0&&n.jsx(qn,{badgeContent:C.unreadCount,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.75rem"}}}),C.lastReplyAt&&n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Last reply"," ",Hn(new Date(C.lastReplyAt),{addSuffix:!0})]})]}),n.jsxs(S,{variant:"body2",color:"text.secondary",noWrap:!0,sx:{maxWidth:"100%"},children:[(M=C.rootMessage.content.text)==null?void 0:M.substring(0,100),(((T=C.rootMessage.content.text)==null?void 0:T.length)||0)>100?"...":""]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(xr,{fontSize:"small",color:"action"}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:[C.replyCount," ",C.replyCount===1?"reply":"replies"]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(xt,{fontSize:"small",color:"action"}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:[C.participants.length," participant",C.participants.length!==1?"s":""]})]})]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[l&&n.jsx(Ee,{title:b?"Collapse thread":"Expand thread",children:n.jsx(ve,{size:"small",onClick:Y,children:b?n.jsx(Js,{}):n.jsx(Gs,{})})}),s&&n.jsx(Ee,{title:"Close thread",children:n.jsx(ve,{size:"small",onClick:s,children:n.jsx(oa,{})})})]})]})}),n.jsx(lr,{in:b,children:n.jsxs(x,{sx:{maxHeight:m,overflow:"hidden",display:"flex",flexDirection:"column"},children:[n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsx(S,{variant:"caption",color:"primary",sx:{mb:1,display:"block"},children:"Thread starter"}),n.jsx(ia,{message:C.rootMessage,showAvatar:!0,showTimestamp:!0,compact:!1,onReply:()=>{}})]}),I&&n.jsx(x,{sx:{flex:1,overflow:"hidden"},children:I.replies.length>0?n.jsxs(x,{sx:{p:1},children:[n.jsxs(S,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block",px:1},children:["Replies (",I.replies.length,")"]}),n.jsx(x,{sx:{pl:2,borderLeft:2,borderColor:"primary.light"},children:I.replies.map((J,re)=>{const te=re>0?I.replies[re-1]:null,G=te&&new Date(J.createdAt).toDateString()!==new Date(te.createdAt).toDateString();return n.jsxs(hr.Fragment,{children:[G&&n.jsx(x,{sx:{my:2},children:n.jsx(pn,{children:n.jsx(S,{variant:"caption",color:"text.secondary",children:new Date(J.createdAt).toLocaleDateString()})})}),n.jsx(ia,{message:J,showAvatar:!te||te.senderId!==J.senderId,showTimestamp:!0,compact:!0})]},J._id)})})]}):n.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",p:4},children:n.jsx(S,{variant:"body2",color:"text.secondary",children:"No replies yet. Be the first to reply!"})})}),d&&b&&n.jsx(x,{sx:{borderTop:1,borderColor:"divider"},children:n.jsx(ya,{conversationId:i,messages:[],onSendMessage:H,threadId:o,parentMessage:C.rootMessage,maxHeight:"200px"})})]})})]}):null},ia=({message:o,showAvatar:i=!0,showTimestamp:s=!0,isOwn:l=!1,onReply:d,onEdit:m,onDelete:b,onReaction:j,onCreateThread:C,onViewThread:V,compact:I=!1,showThreading:O=!0,conversationId:q,mobile:X=!1,touchOptimized:Q=!1})=>{var Le;ai();const{isMobile:U,isSmallMobile:W}=ca();gi();const _=X||U,Y=I||W,[H,M]=p.useState(null),[T,J]=p.useState(!1),[re,te]=p.useState(o.content.text||""),[G,Z]=p.useState(!1),[k,K]=p.useState(null),[le,ge]=p.useState(!1),[ye,B]=p.useState(!1),[z,se]=p.useState(0),[F,L]=p.useState(!1),P=!!H,ie=hr.useRef(null),{attachGestures:be}=Nu({onSwipeRight:()=>{_&&!l&&ne()},onSwipeLeft:()=>{_&&l&&Ae()},onLongPress:()=>{_&&w({currentTarget:ie.current})},onDoubleTap:()=>{_&&wt("")}});hr.useEffect(()=>{Q&&ie.current&&be(ie.current)},[Q,be]),p.useEffect(()=>{(async()=>{if(!(!o.threadId||!O))try{B(!0);const Pe=await fetch(`/api/communication/threads/${o.threadId}/summary`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(Pe.ok){const Rt=await Pe.json();K({replyCount:Rt.data.replyCount,participants:Rt.data.participants,lastReplyAt:Rt.data.lastReplyAt,unreadCount:Rt.data.unreadCount})}}catch(Pe){console.error("Failed to fetch thread summary:",Pe)}finally{B(!1)}})()},[o.threadId,O]);const ze=o.threadId===o._id,he=k&&k.replyCount>0,w=fe=>{M(fe.currentTarget)},R=()=>{M(null)},ne=()=>{d==null||d(o),R()},Ae=()=>{J(!0),R()},at=()=>{b==null||b(o._id),R()},mt=()=>{C==null||C(o._id),R()},lt=()=>{o.threadId&&(V==null||V(o.threadId))},rn=()=>{re.trim()!==o.content.text&&(m==null||m(o._id,re.trim())),J(!1)},Ye=()=>{te(o.content.text||""),J(!1)},wt=fe=>{j==null||j(o._id,fe),Z(!1)},kn=()=>{switch(o.status){case"sent":return n.jsx(Mv,{fontSize:"small",color:"disabled"});case"delivered":return n.jsx(Kt,{fontSize:"small",color:"disabled"});case"read":return n.jsx(Kt,{fontSize:"small",color:"primary"});case"failed":return n.jsx(pt,{fontSize:"small",color:"error"});default:return n.jsx(Hr,{fontSize:"small",color:"disabled"})}},ct=fe=>fe.startsWith("image/")?n.jsx(ry,{}):n.jsx(hu,{}),ue=fe=>{const Pe=new Date(fe);return(new Date().getTime()-Pe.getTime())/(1e3*60*60)<24?Hn(Pe,{addSuffix:!0}):cr(Pe,"MMM d, yyyy h:mm a")},Re=o.reactions.reduce((fe,Pe)=>(fe[Pe.emoji]||(fe[Pe.emoji]=[]),fe[Pe.emoji].push(Pe),fe),{});return o.isDeleted?n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,py:1,px:2,opacity:.6},children:[i&&n.jsx(gt,{sx:{width:32,height:32,bgcolor:"grey.300"},children:n.jsx(Qs,{fontSize:"small"})}),n.jsx(S,{variant:"body2",color:"text.secondary",fontStyle:"italic",children:"This message was deleted"}),s&&n.jsx(S,{variant:"caption",color:"text.secondary",children:ue(o.deletedAt||o.createdAt)})]}):n.jsxs(x,{ref:ie,sx:{display:"flex",gap:_?.5:1,py:Y?.5:1,px:_?.5:1,"&:hover":_?{}:{bgcolor:"action.hover"},alignItems:"flex-start",position:"relative",transform:`translateX(${z}px)`,transition:F?"none":"transform 0.2s ease",..._&&{minHeight:48,"&:active":{bgcolor:"action.selected"}}},children:[i?n.jsx(gt,{sx:{width:_?28:32,height:_?28:32,fontSize:_?"0.75rem":"1rem"},children:"U"}):n.jsx(x,{sx:{width:_?28:32}}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[i&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:_?.5:1,mb:.5,flexWrap:_?"wrap":"nowrap"},children:[n.jsx(S,{variant:_?"body2":"subtitle2",fontWeight:"bold",sx:{fontSize:_?"0.875rem":void 0},children:"User Name"}),o.priority==="urgent"&&n.jsx(Ne,{label:"Urgent",size:"small",color:"error",variant:"outlined",sx:{height:20,fontSize:"0.75rem"}}),s&&n.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:_?"0.75rem":void 0,flexShrink:0},children:ue(o.createdAt)}),o.editHistory.length>0&&n.jsx(S,{variant:"caption",color:"text.secondary",children:"(edited)"})]}),n.jsxs(x,{children:[o.content.text&&n.jsx(t1,{text:o.content.text,mentions:o.mentions,variant:"body2",onMentionClick:fe=>{console.log("Mention clicked:",fe)},sx:{mb:(Le=o.content.attachments)!=null&&Le.length?1:0}}),o.content.attachments&&o.content.attachments.length>0&&n.jsx(x,{sx:{mt:1},children:o.content.attachments.map((fe,Pe)=>n.jsxs(st,{variant:"outlined",sx:{p:_?.75:1,mb:1,display:"flex",alignItems:"center",gap:_?.5:1,maxWidth:_?"100%":300,cursor:_?"pointer":"default","&:active":_?{bgcolor:"action.selected"}:{}},children:[ct(fe.mimeType),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsx(S,{variant:"body2",noWrap:!0,children:fe.fileName}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:[(fe.fileSize/1024).toFixed(1)," KB"]})]}),n.jsx(Ee,{title:"Download",children:n.jsx(ve,{size:"small",onClick:()=>window.open(fe.secureUrl,"_blank"),children:n.jsx(ua,{fontSize:"small"})})})]},Pe))}),Object.keys(Re).length>0&&n.jsx(x,{sx:{display:"flex",gap:.5,mt:1,flexWrap:"wrap"},children:Object.entries(Re).map(([fe,Pe])=>n.jsx(Ne,{label:`${fe} ${Pe.length}`,size:"small",variant:"outlined",onClick:()=>wt(fe),sx:{height:_?28:24,fontSize:_?"0.8rem":"0.75rem",cursor:"pointer",minWidth:_?44:"auto","&:hover":_?{}:{bgcolor:"action.hover"},"&:active":_?{bgcolor:"action.selected"}:{}}},fe))}),O&&he&&ze&&n.jsx(n1,{threadId:o.threadId,replyCount:k.replyCount,participants:k.participants,lastReplyAt:k.lastReplyAt,unreadCount:k.unreadCount,expanded:le,onToggle:()=>ge(!le),onViewThread:lt,variant:"compact"})]}),O&&he&&ze&&le&&q&&n.jsx(x,{sx:{mt:2},children:n.jsx(r1,{threadId:o.threadId,conversationId:q,compact:!0,showReplyInput:!0,maxHeight:"400px"})})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[l&&n.jsx(Ee,{title:`Message ${o.status}`,children:n.jsx(x,{sx:{display:"flex",alignItems:"center"},children:kn()})}),n.jsxs(x,{sx:{display:"flex",opacity:_?1:0,transition:"opacity 0.2s",".MuiBox-root:hover &":_?{}:{opacity:1}},children:[!_&&n.jsxs(n.Fragment,{children:[n.jsx(Ee,{title:"Reply",children:n.jsx(ve,{size:"small",onClick:ne,children:n.jsx(xr,{fontSize:"small"})})}),n.jsx(Ee,{title:"Add reaction",children:n.jsx(ve,{size:"small",onClick:()=>Z(!G),children:n.jsx(da,{fontSize:"small"})})})]}),n.jsx(ve,{size:_?"medium":"small",onClick:w,sx:{..._&&{minWidth:44,minHeight:44}},children:n.jsx(Kn,{fontSize:_?"medium":"small"})})]})]}),n.jsxs(tn,{anchorEl:H,open:P,onClose:R,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[n.jsxs(ee,{onClick:ne,children:[n.jsx(xr,{fontSize:"small",sx:{mr:1}}),"Reply"]}),O&&!o.threadId&&C&&n.jsxs(ee,{onClick:mt,children:[n.jsx(Ks,{fontSize:"small",sx:{mr:1}}),"Start Thread"]}),l&&n.jsxs(ee,{onClick:Ae,children:[n.jsx(mu,{fontSize:"small",sx:{mr:1}}),"Edit"]}),l&&n.jsxs(ee,{onClick:at,sx:{color:"error.main"},children:[n.jsx(Qs,{fontSize:"small",sx:{mr:1}}),"Delete"]})]}),G&&n.jsxs(st,{sx:{position:"absolute",zIndex:1e3,p:2,mt:4,ml:-2,borderRadius:2,boxShadow:3},children:[n.jsx(S,{variant:"caption",color:"text.secondary",sx:{mb:1,display:"block"},children:"Healthcare Reactions"}),n.jsx(rt,{container:!0,spacing:.5,sx:{maxWidth:200},children:[{emoji:"",label:"Approve"},{emoji:"",label:"Disapprove"},{emoji:"",label:"Care"},{emoji:"",label:"Happy"},{emoji:"",label:"Concern"},{emoji:"",label:"Surprised"},{emoji:"",label:"Thinking"},{emoji:"",label:"Confirmed"},{emoji:"",label:"Declined"},{emoji:"",label:"Warning"},{emoji:"",label:"Urgent"},{emoji:"",label:"Note"},{emoji:"",label:"Medication"},{emoji:"",label:"Medical"},{emoji:"",label:"Data"}].map(({emoji:fe,label:Pe})=>n.jsx(rt,{item:!0,children:n.jsx(Ee,{title:Pe,children:n.jsx(We,{size:"small",onClick:()=>wt(fe),sx:{minWidth:"auto",p:.5,fontSize:"1.2rem","&:hover":{bgcolor:"action.hover",transform:"scale(1.1)"}},children:fe})})},fe))})]}),n.jsxs(li,{open:T,onClose:Ye,maxWidth:"sm",fullWidth:!0,children:[n.jsx(ci,{children:"Edit Message"}),n.jsx(ui,{children:n.jsx(_t,{fullWidth:!0,multiline:!0,rows:4,value:re,onChange:fe=>te(fe.target.value),placeholder:"Edit your message...",variant:"outlined",sx:{mt:1}})}),n.jsxs(hi,{children:[n.jsx(We,{onClick:Ye,children:"Cancel"}),n.jsx(We,{onClick:rn,variant:"contained",disabled:!re.trim(),children:"Save"})]})]})]})};var Zs={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Zs.exports;(function(o,i){(function(){var s,l="4.17.21",d=200,m="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",b="Expected a function",j="Invalid `variable` option passed into `_.template`",C="__lodash_hash_undefined__",V=500,I="__lodash_placeholder__",O=1,q=2,X=4,Q=1,U=2,W=1,_=2,Y=4,H=8,M=16,T=32,J=64,re=128,te=256,G=512,Z=30,k="...",K=800,le=16,ge=1,ye=2,B=3,z=1/0,se=9007199254740991,F=17976931348623157e292,L=NaN,P=4294967295,ie=P-1,be=P>>>1,ze=[["ary",re],["bind",W],["bindKey",_],["curry",H],["curryRight",M],["flip",G],["partial",T],["partialRight",J],["rearg",te]],he="[object Arguments]",w="[object Array]",R="[object AsyncFunction]",ne="[object Boolean]",Ae="[object Date]",at="[object DOMException]",mt="[object Error]",lt="[object Function]",rn="[object GeneratorFunction]",Ye="[object Map]",wt="[object Number]",kn="[object Null]",ct="[object Object]",ue="[object Promise]",Re="[object Proxy]",Le="[object RegExp]",fe="[object Set]",Pe="[object String]",Rt="[object Symbol]",qr="[object Undefined]",In="[object WeakMap]",ji="[object WeakSet]",yr="[object ArrayBuffer]",Gn="[object DataView]",bi="[object Float32Array]",_i="[object Float64Array]",wi="[object Int8Array]",Si="[object Int16Array]",Ci="[object Int32Array]",Ai="[object Uint8Array]",Ti="[object Uint8ClampedArray]",ki="[object Uint16Array]",Ii="[object Uint32Array]",Uu=/\b__p \+= '';/g,$u=/\b(__p \+=) '' \+/g,Hu=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ja=/&(?:amp|lt|gt|quot|#39);/g,ba=/[&<>"']/g,qu=RegExp(ja.source),Ku=RegExp(ba.source),Gu=/<%-([\s\S]+?)%>/g,Vu=/<%([\s\S]+?)%>/g,_a=/<%=([\s\S]+?)%>/g,Qu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yu=/^\w*$/,Ju=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Ri=/[\\^$.*+?()[\]{}|]/g,Xu=RegExp(Ri.source),Ei=/^\s+/,Zu=/\s/,eh=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,th=/\{\n\/\* \[wrapped with (.+)\] \*/,nh=/,? & /,rh=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sh=/[()=,{}\[\]\/\s]/,ih=/\\(\\)?/g,oh=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wa=/\w*$/,ah=/^[-+]0x[0-9a-f]+$/i,lh=/^0b[01]+$/i,ch=/^\[object .+?Constructor\]$/,uh=/^0o[0-7]+$/i,hh=/^(?:0|[1-9]\d*)$/,dh=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Kr=/($^)/,fh=/['\n\r\u2028\u2029\\]/g,Gr="\\ud800-\\udfff",ph="\\u0300-\\u036f",xh="\\ufe20-\\ufe2f",gh="\\u20d0-\\u20ff",Sa=ph+xh+gh,Ca="\\u2700-\\u27bf",Aa="a-z\\xdf-\\xf6\\xf8-\\xff",mh="\\xac\\xb1\\xd7\\xf7",vh="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",yh="\\u2000-\\u206f",jh=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ta="A-Z\\xc0-\\xd6\\xd8-\\xde",ka="\\ufe0e\\ufe0f",Ia=mh+vh+yh+jh,Li="[']",bh="["+Gr+"]",Ra="["+Ia+"]",Vr="["+Sa+"]",Ea="\\d+",_h="["+Ca+"]",La="["+Aa+"]",Ma="[^"+Gr+Ia+Ea+Ca+Aa+Ta+"]",Mi="\\ud83c[\\udffb-\\udfff]",wh="(?:"+Vr+"|"+Mi+")",Pa="[^"+Gr+"]",Pi="(?:\\ud83c[\\udde6-\\uddff]){2}",Di="[\\ud800-\\udbff][\\udc00-\\udfff]",Vn="["+Ta+"]",Da="\\u200d",Oa="(?:"+La+"|"+Ma+")",Sh="(?:"+Vn+"|"+Ma+")",Na="(?:"+Li+"(?:d|ll|m|re|s|t|ve))?",Ba="(?:"+Li+"(?:D|LL|M|RE|S|T|VE))?",za=wh+"?",Fa="["+ka+"]?",Ch="(?:"+Da+"(?:"+[Pa,Pi,Di].join("|")+")"+Fa+za+")*",Ah="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Th="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Wa=Fa+za+Ch,kh="(?:"+[_h,Pi,Di].join("|")+")"+Wa,Ih="(?:"+[Pa+Vr+"?",Vr,Pi,Di,bh].join("|")+")",Rh=RegExp(Li,"g"),Eh=RegExp(Vr,"g"),Oi=RegExp(Mi+"(?="+Mi+")|"+Ih+Wa,"g"),Lh=RegExp([Vn+"?"+La+"+"+Na+"(?="+[Ra,Vn,"$"].join("|")+")",Sh+"+"+Ba+"(?="+[Ra,Vn+Oa,"$"].join("|")+")",Vn+"?"+Oa+"+"+Na,Vn+"+"+Ba,Th,Ah,Ea,kh].join("|"),"g"),Mh=RegExp("["+Da+Gr+Sa+ka+"]"),Ph=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Dh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Oh=-1,Ue={};Ue[bi]=Ue[_i]=Ue[wi]=Ue[Si]=Ue[Ci]=Ue[Ai]=Ue[Ti]=Ue[ki]=Ue[Ii]=!0,Ue[he]=Ue[w]=Ue[yr]=Ue[ne]=Ue[Gn]=Ue[Ae]=Ue[mt]=Ue[lt]=Ue[Ye]=Ue[wt]=Ue[ct]=Ue[Le]=Ue[fe]=Ue[Pe]=Ue[In]=!1;var Fe={};Fe[he]=Fe[w]=Fe[yr]=Fe[Gn]=Fe[ne]=Fe[Ae]=Fe[bi]=Fe[_i]=Fe[wi]=Fe[Si]=Fe[Ci]=Fe[Ye]=Fe[wt]=Fe[ct]=Fe[Le]=Fe[fe]=Fe[Pe]=Fe[Rt]=Fe[Ai]=Fe[Ti]=Fe[ki]=Fe[Ii]=!0,Fe[mt]=Fe[lt]=Fe[In]=!1;var Nh={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Bh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zh={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Fh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Wh=parseFloat,Uh=parseInt,Ua=typeof Dr=="object"&&Dr&&Dr.Object===Object&&Dr,$h=typeof self=="object"&&self&&self.Object===Object&&self,tt=Ua||$h||Function("return this")(),Ni=i&&!i.nodeType&&i,Rn=Ni&&!0&&o&&!o.nodeType&&o,$a=Rn&&Rn.exports===Ni,Bi=$a&&Ua.process,Et=function(){try{var v=Rn&&Rn.require&&Rn.require("util").types;return v||Bi&&Bi.binding&&Bi.binding("util")}catch{}}(),Ha=Et&&Et.isArrayBuffer,qa=Et&&Et.isDate,Ka=Et&&Et.isMap,Ga=Et&&Et.isRegExp,Va=Et&&Et.isSet,Qa=Et&&Et.isTypedArray;function St(v,E,A){switch(A.length){case 0:return v.call(E);case 1:return v.call(E,A[0]);case 2:return v.call(E,A[0],A[1]);case 3:return v.call(E,A[0],A[1],A[2])}return v.apply(E,A)}function Hh(v,E,A,ae){for(var me=-1,Me=v==null?0:v.length;++me<Me;){var Je=v[me];E(ae,Je,A(Je),v)}return ae}function Lt(v,E){for(var A=-1,ae=v==null?0:v.length;++A<ae&&E(v[A],A,v)!==!1;);return v}function qh(v,E){for(var A=v==null?0:v.length;A--&&E(v[A],A,v)!==!1;);return v}function Ya(v,E){for(var A=-1,ae=v==null?0:v.length;++A<ae;)if(!E(v[A],A,v))return!1;return!0}function gn(v,E){for(var A=-1,ae=v==null?0:v.length,me=0,Me=[];++A<ae;){var Je=v[A];E(Je,A,v)&&(Me[me++]=Je)}return Me}function Qr(v,E){var A=v==null?0:v.length;return!!A&&Qn(v,E,0)>-1}function zi(v,E,A){for(var ae=-1,me=v==null?0:v.length;++ae<me;)if(A(E,v[ae]))return!0;return!1}function $e(v,E){for(var A=-1,ae=v==null?0:v.length,me=Array(ae);++A<ae;)me[A]=E(v[A],A,v);return me}function mn(v,E){for(var A=-1,ae=E.length,me=v.length;++A<ae;)v[me+A]=E[A];return v}function Fi(v,E,A,ae){var me=-1,Me=v==null?0:v.length;for(ae&&Me&&(A=v[++me]);++me<Me;)A=E(A,v[me],me,v);return A}function Kh(v,E,A,ae){var me=v==null?0:v.length;for(ae&&me&&(A=v[--me]);me--;)A=E(A,v[me],me,v);return A}function Wi(v,E){for(var A=-1,ae=v==null?0:v.length;++A<ae;)if(E(v[A],A,v))return!0;return!1}var Gh=Ui("length");function Vh(v){return v.split("")}function Qh(v){return v.match(rh)||[]}function Ja(v,E,A){var ae;return A(v,function(me,Me,Je){if(E(me,Me,Je))return ae=Me,!1}),ae}function Yr(v,E,A,ae){for(var me=v.length,Me=A+(ae?1:-1);ae?Me--:++Me<me;)if(E(v[Me],Me,v))return Me;return-1}function Qn(v,E,A){return E===E?ad(v,E,A):Yr(v,Xa,A)}function Yh(v,E,A,ae){for(var me=A-1,Me=v.length;++me<Me;)if(ae(v[me],E))return me;return-1}function Xa(v){return v!==v}function Za(v,E){var A=v==null?0:v.length;return A?Hi(v,E)/A:L}function Ui(v){return function(E){return E==null?s:E[v]}}function $i(v){return function(E){return v==null?s:v[E]}}function el(v,E,A,ae,me){return me(v,function(Me,Je,Be){A=ae?(ae=!1,Me):E(A,Me,Je,Be)}),A}function Jh(v,E){var A=v.length;for(v.sort(E);A--;)v[A]=v[A].value;return v}function Hi(v,E){for(var A,ae=-1,me=v.length;++ae<me;){var Me=E(v[ae]);Me!==s&&(A=A===s?Me:A+Me)}return A}function qi(v,E){for(var A=-1,ae=Array(v);++A<v;)ae[A]=E(A);return ae}function Xh(v,E){return $e(E,function(A){return[A,v[A]]})}function tl(v){return v&&v.slice(0,il(v)+1).replace(Ei,"")}function Ct(v){return function(E){return v(E)}}function Ki(v,E){return $e(E,function(A){return v[A]})}function jr(v,E){return v.has(E)}function nl(v,E){for(var A=-1,ae=v.length;++A<ae&&Qn(E,v[A],0)>-1;);return A}function rl(v,E){for(var A=v.length;A--&&Qn(E,v[A],0)>-1;);return A}function Zh(v,E){for(var A=v.length,ae=0;A--;)v[A]===E&&++ae;return ae}var ed=$i(Nh),td=$i(Bh);function nd(v){return"\\"+Fh[v]}function rd(v,E){return v==null?s:v[E]}function Yn(v){return Mh.test(v)}function sd(v){return Ph.test(v)}function id(v){for(var E,A=[];!(E=v.next()).done;)A.push(E.value);return A}function Gi(v){var E=-1,A=Array(v.size);return v.forEach(function(ae,me){A[++E]=[me,ae]}),A}function sl(v,E){return function(A){return v(E(A))}}function vn(v,E){for(var A=-1,ae=v.length,me=0,Me=[];++A<ae;){var Je=v[A];(Je===E||Je===I)&&(v[A]=I,Me[me++]=A)}return Me}function Jr(v){var E=-1,A=Array(v.size);return v.forEach(function(ae){A[++E]=ae}),A}function od(v){var E=-1,A=Array(v.size);return v.forEach(function(ae){A[++E]=[ae,ae]}),A}function ad(v,E,A){for(var ae=A-1,me=v.length;++ae<me;)if(v[ae]===E)return ae;return-1}function ld(v,E,A){for(var ae=A+1;ae--;)if(v[ae]===E)return ae;return ae}function Jn(v){return Yn(v)?ud(v):Gh(v)}function Wt(v){return Yn(v)?hd(v):Vh(v)}function il(v){for(var E=v.length;E--&&Zu.test(v.charAt(E)););return E}var cd=$i(zh);function ud(v){for(var E=Oi.lastIndex=0;Oi.test(v);)++E;return E}function hd(v){return v.match(Oi)||[]}function dd(v){return v.match(Lh)||[]}var fd=function v(E){E=E==null?tt:Xn.defaults(tt.Object(),E,Xn.pick(tt,Dh));var A=E.Array,ae=E.Date,me=E.Error,Me=E.Function,Je=E.Math,Be=E.Object,Vi=E.RegExp,pd=E.String,Mt=E.TypeError,Xr=A.prototype,xd=Me.prototype,Zn=Be.prototype,Zr=E["__core-js_shared__"],es=xd.toString,Oe=Zn.hasOwnProperty,gd=0,ol=function(){var e=/[^.]+$/.exec(Zr&&Zr.keys&&Zr.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ts=Zn.toString,md=es.call(Be),vd=tt._,yd=Vi("^"+es.call(Oe).replace(Ri,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ns=$a?E.Buffer:s,yn=E.Symbol,rs=E.Uint8Array,al=ns?ns.allocUnsafe:s,ss=sl(Be.getPrototypeOf,Be),ll=Be.create,cl=Zn.propertyIsEnumerable,is=Xr.splice,ul=yn?yn.isConcatSpreadable:s,br=yn?yn.iterator:s,En=yn?yn.toStringTag:s,os=function(){try{var e=On(Be,"defineProperty");return e({},"",{}),e}catch{}}(),jd=E.clearTimeout!==tt.clearTimeout&&E.clearTimeout,bd=ae&&ae.now!==tt.Date.now&&ae.now,_d=E.setTimeout!==tt.setTimeout&&E.setTimeout,as=Je.ceil,ls=Je.floor,Qi=Be.getOwnPropertySymbols,wd=ns?ns.isBuffer:s,hl=E.isFinite,Sd=Xr.join,Cd=sl(Be.keys,Be),Xe=Je.max,it=Je.min,Ad=ae.now,Td=E.parseInt,dl=Je.random,kd=Xr.reverse,Yi=On(E,"DataView"),_r=On(E,"Map"),Ji=On(E,"Promise"),er=On(E,"Set"),wr=On(E,"WeakMap"),Sr=On(Be,"create"),cs=wr&&new wr,tr={},Id=Nn(Yi),Rd=Nn(_r),Ed=Nn(Ji),Ld=Nn(er),Md=Nn(wr),us=yn?yn.prototype:s,Cr=us?us.valueOf:s,fl=us?us.toString:s;function u(e){if(qe(e)&&!je(e)&&!(e instanceof Te)){if(e instanceof Pt)return e;if(Oe.call(e,"__wrapped__"))return pc(e)}return new Pt(e)}var nr=function(){function e(){}return function(t){if(!He(t))return{};if(ll)return ll(t);e.prototype=t;var r=new e;return e.prototype=s,r}}();function hs(){}function Pt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=s}u.templateSettings={escape:Gu,evaluate:Vu,interpolate:_a,variable:"",imports:{_:u}},u.prototype=hs.prototype,u.prototype.constructor=u,Pt.prototype=nr(hs.prototype),Pt.prototype.constructor=Pt;function Te(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=P,this.__views__=[]}function Pd(){var e=new Te(this.__wrapped__);return e.__actions__=vt(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=vt(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=vt(this.__views__),e}function Dd(){if(this.__filtered__){var e=new Te(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function Od(){var e=this.__wrapped__.value(),t=this.__dir__,r=je(e),a=t<0,c=r?e.length:0,h=Qf(0,c,this.__views__),f=h.start,g=h.end,y=g-f,D=a?g:f-1,N=this.__iteratees__,$=N.length,oe=0,ce=it(y,this.__takeCount__);if(!r||!a&&c==y&&ce==y)return Nl(e,this.__actions__);var pe=[];e:for(;y--&&oe<ce;){D+=t;for(var we=-1,xe=e[D];++we<$;){var Ce=N[we],ke=Ce.iteratee,kt=Ce.type,dt=ke(xe);if(kt==ye)xe=dt;else if(!dt){if(kt==ge)continue e;break e}}pe[oe++]=xe}return pe}Te.prototype=nr(hs.prototype),Te.prototype.constructor=Te;function Ln(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function Nd(){this.__data__=Sr?Sr(null):{},this.size=0}function Bd(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function zd(e){var t=this.__data__;if(Sr){var r=t[e];return r===C?s:r}return Oe.call(t,e)?t[e]:s}function Fd(e){var t=this.__data__;return Sr?t[e]!==s:Oe.call(t,e)}function Wd(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Sr&&t===s?C:t,this}Ln.prototype.clear=Nd,Ln.prototype.delete=Bd,Ln.prototype.get=zd,Ln.prototype.has=Fd,Ln.prototype.set=Wd;function sn(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function Ud(){this.__data__=[],this.size=0}function $d(e){var t=this.__data__,r=ds(t,e);if(r<0)return!1;var a=t.length-1;return r==a?t.pop():is.call(t,r,1),--this.size,!0}function Hd(e){var t=this.__data__,r=ds(t,e);return r<0?s:t[r][1]}function qd(e){return ds(this.__data__,e)>-1}function Kd(e,t){var r=this.__data__,a=ds(r,e);return a<0?(++this.size,r.push([e,t])):r[a][1]=t,this}sn.prototype.clear=Ud,sn.prototype.delete=$d,sn.prototype.get=Hd,sn.prototype.has=qd,sn.prototype.set=Kd;function on(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var a=e[t];this.set(a[0],a[1])}}function Gd(){this.size=0,this.__data__={hash:new Ln,map:new(_r||sn),string:new Ln}}function Vd(e){var t=Ss(this,e).delete(e);return this.size-=t?1:0,t}function Qd(e){return Ss(this,e).get(e)}function Yd(e){return Ss(this,e).has(e)}function Jd(e,t){var r=Ss(this,e),a=r.size;return r.set(e,t),this.size+=r.size==a?0:1,this}on.prototype.clear=Gd,on.prototype.delete=Vd,on.prototype.get=Qd,on.prototype.has=Yd,on.prototype.set=Jd;function Mn(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new on;++t<r;)this.add(e[t])}function Xd(e){return this.__data__.set(e,C),this}function Zd(e){return this.__data__.has(e)}Mn.prototype.add=Mn.prototype.push=Xd,Mn.prototype.has=Zd;function Ut(e){var t=this.__data__=new sn(e);this.size=t.size}function ef(){this.__data__=new sn,this.size=0}function tf(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function nf(e){return this.__data__.get(e)}function rf(e){return this.__data__.has(e)}function sf(e,t){var r=this.__data__;if(r instanceof sn){var a=r.__data__;if(!_r||a.length<d-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new on(a)}return r.set(e,t),this.size=r.size,this}Ut.prototype.clear=ef,Ut.prototype.delete=tf,Ut.prototype.get=nf,Ut.prototype.has=rf,Ut.prototype.set=sf;function pl(e,t){var r=je(e),a=!r&&Bn(e),c=!r&&!a&&Sn(e),h=!r&&!a&&!c&&or(e),f=r||a||c||h,g=f?qi(e.length,pd):[],y=g.length;for(var D in e)(t||Oe.call(e,D))&&!(f&&(D=="length"||c&&(D=="offset"||D=="parent")||h&&(D=="buffer"||D=="byteLength"||D=="byteOffset")||un(D,y)))&&g.push(D);return g}function xl(e){var t=e.length;return t?e[lo(0,t-1)]:s}function of(e,t){return Cs(vt(e),Pn(t,0,e.length))}function af(e){return Cs(vt(e))}function Xi(e,t,r){(r!==s&&!$t(e[t],r)||r===s&&!(t in e))&&an(e,t,r)}function Ar(e,t,r){var a=e[t];(!(Oe.call(e,t)&&$t(a,r))||r===s&&!(t in e))&&an(e,t,r)}function ds(e,t){for(var r=e.length;r--;)if($t(e[r][0],t))return r;return-1}function lf(e,t,r,a){return jn(e,function(c,h,f){t(a,c,r(c),f)}),a}function gl(e,t){return e&&Vt(t,Ze(t),e)}function cf(e,t){return e&&Vt(t,jt(t),e)}function an(e,t,r){t=="__proto__"&&os?os(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function Zi(e,t){for(var r=-1,a=t.length,c=A(a),h=e==null;++r<a;)c[r]=h?s:Po(e,t[r]);return c}function Pn(e,t,r){return e===e&&(r!==s&&(e=e<=r?e:r),t!==s&&(e=e>=t?e:t)),e}function Dt(e,t,r,a,c,h){var f,g=t&O,y=t&q,D=t&X;if(r&&(f=c?r(e,a,c,h):r(e)),f!==s)return f;if(!He(e))return e;var N=je(e);if(N){if(f=Jf(e),!g)return vt(e,f)}else{var $=ot(e),oe=$==lt||$==rn;if(Sn(e))return Fl(e,g);if($==ct||$==he||oe&&!c){if(f=y||oe?{}:ic(e),!g)return y?Ff(e,cf(f,e)):zf(e,gl(f,e))}else{if(!Fe[$])return c?e:{};f=Xf(e,$,g)}}h||(h=new Ut);var ce=h.get(e);if(ce)return ce;h.set(e,f),Pc(e)?e.forEach(function(xe){f.add(Dt(xe,t,r,xe,e,h))}):Lc(e)&&e.forEach(function(xe,Ce){f.set(Ce,Dt(xe,t,r,Ce,e,h))});var pe=D?y?jo:yo:y?jt:Ze,we=N?s:pe(e);return Lt(we||e,function(xe,Ce){we&&(Ce=xe,xe=e[Ce]),Ar(f,Ce,Dt(xe,t,r,Ce,e,h))}),f}function uf(e){var t=Ze(e);return function(r){return ml(r,e,t)}}function ml(e,t,r){var a=r.length;if(e==null)return!a;for(e=Be(e);a--;){var c=r[a],h=t[c],f=e[c];if(f===s&&!(c in e)||!h(f))return!1}return!0}function vl(e,t,r){if(typeof e!="function")throw new Mt(b);return Mr(function(){e.apply(s,r)},t)}function Tr(e,t,r,a){var c=-1,h=Qr,f=!0,g=e.length,y=[],D=t.length;if(!g)return y;r&&(t=$e(t,Ct(r))),a?(h=zi,f=!1):t.length>=d&&(h=jr,f=!1,t=new Mn(t));e:for(;++c<g;){var N=e[c],$=r==null?N:r(N);if(N=a||N!==0?N:0,f&&$===$){for(var oe=D;oe--;)if(t[oe]===$)continue e;y.push(N)}else h(t,$,a)||y.push(N)}return y}var jn=ql(Gt),yl=ql(to,!0);function hf(e,t){var r=!0;return jn(e,function(a,c,h){return r=!!t(a,c,h),r}),r}function fs(e,t,r){for(var a=-1,c=e.length;++a<c;){var h=e[a],f=t(h);if(f!=null&&(g===s?f===f&&!Tt(f):r(f,g)))var g=f,y=h}return y}function df(e,t,r,a){var c=e.length;for(r=_e(r),r<0&&(r=-r>c?0:c+r),a=a===s||a>c?c:_e(a),a<0&&(a+=c),a=r>a?0:Oc(a);r<a;)e[r++]=t;return e}function jl(e,t){var r=[];return jn(e,function(a,c,h){t(a,c,h)&&r.push(a)}),r}function nt(e,t,r,a,c){var h=-1,f=e.length;for(r||(r=ep),c||(c=[]);++h<f;){var g=e[h];t>0&&r(g)?t>1?nt(g,t-1,r,a,c):mn(c,g):a||(c[c.length]=g)}return c}var eo=Kl(),bl=Kl(!0);function Gt(e,t){return e&&eo(e,t,Ze)}function to(e,t){return e&&bl(e,t,Ze)}function ps(e,t){return gn(t,function(r){return hn(e[r])})}function Dn(e,t){t=_n(t,e);for(var r=0,a=t.length;e!=null&&r<a;)e=e[Qt(t[r++])];return r&&r==a?e:s}function _l(e,t,r){var a=t(e);return je(e)?a:mn(a,r(e))}function ut(e){return e==null?e===s?qr:kn:En&&En in Be(e)?Vf(e):ap(e)}function no(e,t){return e>t}function ff(e,t){return e!=null&&Oe.call(e,t)}function pf(e,t){return e!=null&&t in Be(e)}function xf(e,t,r){return e>=it(t,r)&&e<Xe(t,r)}function ro(e,t,r){for(var a=r?zi:Qr,c=e[0].length,h=e.length,f=h,g=A(h),y=1/0,D=[];f--;){var N=e[f];f&&t&&(N=$e(N,Ct(t))),y=it(N.length,y),g[f]=!r&&(t||c>=120&&N.length>=120)?new Mn(f&&N):s}N=e[0];var $=-1,oe=g[0];e:for(;++$<c&&D.length<y;){var ce=N[$],pe=t?t(ce):ce;if(ce=r||ce!==0?ce:0,!(oe?jr(oe,pe):a(D,pe,r))){for(f=h;--f;){var we=g[f];if(!(we?jr(we,pe):a(e[f],pe,r)))continue e}oe&&oe.push(pe),D.push(ce)}}return D}function gf(e,t,r,a){return Gt(e,function(c,h,f){t(a,r(c),h,f)}),a}function kr(e,t,r){t=_n(t,e),e=cc(e,t);var a=e==null?e:e[Qt(Nt(t))];return a==null?s:St(a,e,r)}function wl(e){return qe(e)&&ut(e)==he}function mf(e){return qe(e)&&ut(e)==yr}function vf(e){return qe(e)&&ut(e)==Ae}function Ir(e,t,r,a,c){return e===t?!0:e==null||t==null||!qe(e)&&!qe(t)?e!==e&&t!==t:yf(e,t,r,a,Ir,c)}function yf(e,t,r,a,c,h){var f=je(e),g=je(t),y=f?w:ot(e),D=g?w:ot(t);y=y==he?ct:y,D=D==he?ct:D;var N=y==ct,$=D==ct,oe=y==D;if(oe&&Sn(e)){if(!Sn(t))return!1;f=!0,N=!1}if(oe&&!N)return h||(h=new Ut),f||or(e)?nc(e,t,r,a,c,h):Kf(e,t,y,r,a,c,h);if(!(r&Q)){var ce=N&&Oe.call(e,"__wrapped__"),pe=$&&Oe.call(t,"__wrapped__");if(ce||pe){var we=ce?e.value():e,xe=pe?t.value():t;return h||(h=new Ut),c(we,xe,r,a,h)}}return oe?(h||(h=new Ut),Gf(e,t,r,a,c,h)):!1}function jf(e){return qe(e)&&ot(e)==Ye}function so(e,t,r,a){var c=r.length,h=c,f=!a;if(e==null)return!h;for(e=Be(e);c--;){var g=r[c];if(f&&g[2]?g[1]!==e[g[0]]:!(g[0]in e))return!1}for(;++c<h;){g=r[c];var y=g[0],D=e[y],N=g[1];if(f&&g[2]){if(D===s&&!(y in e))return!1}else{var $=new Ut;if(a)var oe=a(D,N,y,e,t,$);if(!(oe===s?Ir(N,D,Q|U,a,$):oe))return!1}}return!0}function Sl(e){if(!He(e)||np(e))return!1;var t=hn(e)?yd:ch;return t.test(Nn(e))}function bf(e){return qe(e)&&ut(e)==Le}function _f(e){return qe(e)&&ot(e)==fe}function wf(e){return qe(e)&&Es(e.length)&&!!Ue[ut(e)]}function Cl(e){return typeof e=="function"?e:e==null?bt:typeof e=="object"?je(e)?kl(e[0],e[1]):Tl(e):Gc(e)}function io(e){if(!Lr(e))return Cd(e);var t=[];for(var r in Be(e))Oe.call(e,r)&&r!="constructor"&&t.push(r);return t}function Sf(e){if(!He(e))return op(e);var t=Lr(e),r=[];for(var a in e)a=="constructor"&&(t||!Oe.call(e,a))||r.push(a);return r}function oo(e,t){return e<t}function Al(e,t){var r=-1,a=yt(e)?A(e.length):[];return jn(e,function(c,h,f){a[++r]=t(c,h,f)}),a}function Tl(e){var t=_o(e);return t.length==1&&t[0][2]?ac(t[0][0],t[0][1]):function(r){return r===e||so(r,e,t)}}function kl(e,t){return So(e)&&oc(t)?ac(Qt(e),t):function(r){var a=Po(r,e);return a===s&&a===t?Do(r,e):Ir(t,a,Q|U)}}function xs(e,t,r,a,c){e!==t&&eo(t,function(h,f){if(c||(c=new Ut),He(h))Cf(e,t,f,r,xs,a,c);else{var g=a?a(Ao(e,f),h,f+"",e,t,c):s;g===s&&(g=h),Xi(e,f,g)}},jt)}function Cf(e,t,r,a,c,h,f){var g=Ao(e,r),y=Ao(t,r),D=f.get(y);if(D){Xi(e,r,D);return}var N=h?h(g,y,r+"",e,t,f):s,$=N===s;if($){var oe=je(y),ce=!oe&&Sn(y),pe=!oe&&!ce&&or(y);N=y,oe||ce||pe?je(g)?N=g:Ke(g)?N=vt(g):ce?($=!1,N=Fl(y,!0)):pe?($=!1,N=Wl(y,!0)):N=[]:Pr(y)||Bn(y)?(N=g,Bn(g)?N=Nc(g):(!He(g)||hn(g))&&(N=ic(y))):$=!1}$&&(f.set(y,N),c(N,y,a,h,f),f.delete(y)),Xi(e,r,N)}function Il(e,t){var r=e.length;if(r)return t+=t<0?r:0,un(t,r)?e[t]:s}function Rl(e,t,r){t.length?t=$e(t,function(h){return je(h)?function(f){return Dn(f,h.length===1?h[0]:h)}:h}):t=[bt];var a=-1;t=$e(t,Ct(de()));var c=Al(e,function(h,f,g){var y=$e(t,function(D){return D(h)});return{criteria:y,index:++a,value:h}});return Jh(c,function(h,f){return Bf(h,f,r)})}function Af(e,t){return El(e,t,function(r,a){return Do(e,a)})}function El(e,t,r){for(var a=-1,c=t.length,h={};++a<c;){var f=t[a],g=Dn(e,f);r(g,f)&&Rr(h,_n(f,e),g)}return h}function Tf(e){return function(t){return Dn(t,e)}}function ao(e,t,r,a){var c=a?Yh:Qn,h=-1,f=t.length,g=e;for(e===t&&(t=vt(t)),r&&(g=$e(e,Ct(r)));++h<f;)for(var y=0,D=t[h],N=r?r(D):D;(y=c(g,N,y,a))>-1;)g!==e&&is.call(g,y,1),is.call(e,y,1);return e}function Ll(e,t){for(var r=e?t.length:0,a=r-1;r--;){var c=t[r];if(r==a||c!==h){var h=c;un(c)?is.call(e,c,1):ho(e,c)}}return e}function lo(e,t){return e+ls(dl()*(t-e+1))}function kf(e,t,r,a){for(var c=-1,h=Xe(as((t-e)/(r||1)),0),f=A(h);h--;)f[a?h:++c]=e,e+=r;return f}function co(e,t){var r="";if(!e||t<1||t>se)return r;do t%2&&(r+=e),t=ls(t/2),t&&(e+=e);while(t);return r}function Se(e,t){return To(lc(e,t,bt),e+"")}function If(e){return xl(ar(e))}function Rf(e,t){var r=ar(e);return Cs(r,Pn(t,0,r.length))}function Rr(e,t,r,a){if(!He(e))return e;t=_n(t,e);for(var c=-1,h=t.length,f=h-1,g=e;g!=null&&++c<h;){var y=Qt(t[c]),D=r;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(c!=f){var N=g[y];D=a?a(N,y,g):s,D===s&&(D=He(N)?N:un(t[c+1])?[]:{})}Ar(g,y,D),g=g[y]}return e}var Ml=cs?function(e,t){return cs.set(e,t),e}:bt,Ef=os?function(e,t){return os(e,"toString",{configurable:!0,enumerable:!1,value:No(t),writable:!0})}:bt;function Lf(e){return Cs(ar(e))}function Ot(e,t,r){var a=-1,c=e.length;t<0&&(t=-t>c?0:c+t),r=r>c?c:r,r<0&&(r+=c),c=t>r?0:r-t>>>0,t>>>=0;for(var h=A(c);++a<c;)h[a]=e[a+t];return h}function Mf(e,t){var r;return jn(e,function(a,c,h){return r=t(a,c,h),!r}),!!r}function gs(e,t,r){var a=0,c=e==null?a:e.length;if(typeof t=="number"&&t===t&&c<=be){for(;a<c;){var h=a+c>>>1,f=e[h];f!==null&&!Tt(f)&&(r?f<=t:f<t)?a=h+1:c=h}return c}return uo(e,t,bt,r)}function uo(e,t,r,a){var c=0,h=e==null?0:e.length;if(h===0)return 0;t=r(t);for(var f=t!==t,g=t===null,y=Tt(t),D=t===s;c<h;){var N=ls((c+h)/2),$=r(e[N]),oe=$!==s,ce=$===null,pe=$===$,we=Tt($);if(f)var xe=a||pe;else D?xe=pe&&(a||oe):g?xe=pe&&oe&&(a||!ce):y?xe=pe&&oe&&!ce&&(a||!we):ce||we?xe=!1:xe=a?$<=t:$<t;xe?c=N+1:h=N}return it(h,ie)}function Pl(e,t){for(var r=-1,a=e.length,c=0,h=[];++r<a;){var f=e[r],g=t?t(f):f;if(!r||!$t(g,y)){var y=g;h[c++]=f===0?0:f}}return h}function Dl(e){return typeof e=="number"?e:Tt(e)?L:+e}function At(e){if(typeof e=="string")return e;if(je(e))return $e(e,At)+"";if(Tt(e))return fl?fl.call(e):"";var t=e+"";return t=="0"&&1/e==-z?"-0":t}function bn(e,t,r){var a=-1,c=Qr,h=e.length,f=!0,g=[],y=g;if(r)f=!1,c=zi;else if(h>=d){var D=t?null:Hf(e);if(D)return Jr(D);f=!1,c=jr,y=new Mn}else y=t?[]:g;e:for(;++a<h;){var N=e[a],$=t?t(N):N;if(N=r||N!==0?N:0,f&&$===$){for(var oe=y.length;oe--;)if(y[oe]===$)continue e;t&&y.push($),g.push(N)}else c(y,$,r)||(y!==g&&y.push($),g.push(N))}return g}function ho(e,t){return t=_n(t,e),e=cc(e,t),e==null||delete e[Qt(Nt(t))]}function Ol(e,t,r,a){return Rr(e,t,r(Dn(e,t)),a)}function ms(e,t,r,a){for(var c=e.length,h=a?c:-1;(a?h--:++h<c)&&t(e[h],h,e););return r?Ot(e,a?0:h,a?h+1:c):Ot(e,a?h+1:0,a?c:h)}function Nl(e,t){var r=e;return r instanceof Te&&(r=r.value()),Fi(t,function(a,c){return c.func.apply(c.thisArg,mn([a],c.args))},r)}function fo(e,t,r){var a=e.length;if(a<2)return a?bn(e[0]):[];for(var c=-1,h=A(a);++c<a;)for(var f=e[c],g=-1;++g<a;)g!=c&&(h[c]=Tr(h[c]||f,e[g],t,r));return bn(nt(h,1),t,r)}function Bl(e,t,r){for(var a=-1,c=e.length,h=t.length,f={};++a<c;){var g=a<h?t[a]:s;r(f,e[a],g)}return f}function po(e){return Ke(e)?e:[]}function xo(e){return typeof e=="function"?e:bt}function _n(e,t){return je(e)?e:So(e,t)?[e]:fc(De(e))}var Pf=Se;function wn(e,t,r){var a=e.length;return r=r===s?a:r,!t&&r>=a?e:Ot(e,t,r)}var zl=jd||function(e){return tt.clearTimeout(e)};function Fl(e,t){if(t)return e.slice();var r=e.length,a=al?al(r):new e.constructor(r);return e.copy(a),a}function go(e){var t=new e.constructor(e.byteLength);return new rs(t).set(new rs(e)),t}function Df(e,t){var r=t?go(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}function Of(e){var t=new e.constructor(e.source,wa.exec(e));return t.lastIndex=e.lastIndex,t}function Nf(e){return Cr?Be(Cr.call(e)):{}}function Wl(e,t){var r=t?go(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}function Ul(e,t){if(e!==t){var r=e!==s,a=e===null,c=e===e,h=Tt(e),f=t!==s,g=t===null,y=t===t,D=Tt(t);if(!g&&!D&&!h&&e>t||h&&f&&y&&!g&&!D||a&&f&&y||!r&&y||!c)return 1;if(!a&&!h&&!D&&e<t||D&&r&&c&&!a&&!h||g&&r&&c||!f&&c||!y)return-1}return 0}function Bf(e,t,r){for(var a=-1,c=e.criteria,h=t.criteria,f=c.length,g=r.length;++a<f;){var y=Ul(c[a],h[a]);if(y){if(a>=g)return y;var D=r[a];return y*(D=="desc"?-1:1)}}return e.index-t.index}function $l(e,t,r,a){for(var c=-1,h=e.length,f=r.length,g=-1,y=t.length,D=Xe(h-f,0),N=A(y+D),$=!a;++g<y;)N[g]=t[g];for(;++c<f;)($||c<h)&&(N[r[c]]=e[c]);for(;D--;)N[g++]=e[c++];return N}function Hl(e,t,r,a){for(var c=-1,h=e.length,f=-1,g=r.length,y=-1,D=t.length,N=Xe(h-g,0),$=A(N+D),oe=!a;++c<N;)$[c]=e[c];for(var ce=c;++y<D;)$[ce+y]=t[y];for(;++f<g;)(oe||c<h)&&($[ce+r[f]]=e[c++]);return $}function vt(e,t){var r=-1,a=e.length;for(t||(t=A(a));++r<a;)t[r]=e[r];return t}function Vt(e,t,r,a){var c=!r;r||(r={});for(var h=-1,f=t.length;++h<f;){var g=t[h],y=a?a(r[g],e[g],g,r,e):s;y===s&&(y=e[g]),c?an(r,g,y):Ar(r,g,y)}return r}function zf(e,t){return Vt(e,wo(e),t)}function Ff(e,t){return Vt(e,rc(e),t)}function vs(e,t){return function(r,a){var c=je(r)?Hh:lf,h=t?t():{};return c(r,e,de(a,2),h)}}function rr(e){return Se(function(t,r){var a=-1,c=r.length,h=c>1?r[c-1]:s,f=c>2?r[2]:s;for(h=e.length>3&&typeof h=="function"?(c--,h):s,f&&ht(r[0],r[1],f)&&(h=c<3?s:h,c=1),t=Be(t);++a<c;){var g=r[a];g&&e(t,g,a,h)}return t})}function ql(e,t){return function(r,a){if(r==null)return r;if(!yt(r))return e(r,a);for(var c=r.length,h=t?c:-1,f=Be(r);(t?h--:++h<c)&&a(f[h],h,f)!==!1;);return r}}function Kl(e){return function(t,r,a){for(var c=-1,h=Be(t),f=a(t),g=f.length;g--;){var y=f[e?g:++c];if(r(h[y],y,h)===!1)break}return t}}function Wf(e,t,r){var a=t&W,c=Er(e);function h(){var f=this&&this!==tt&&this instanceof h?c:e;return f.apply(a?r:this,arguments)}return h}function Gl(e){return function(t){t=De(t);var r=Yn(t)?Wt(t):s,a=r?r[0]:t.charAt(0),c=r?wn(r,1).join(""):t.slice(1);return a[e]()+c}}function sr(e){return function(t){return Fi(qc(Hc(t).replace(Rh,"")),e,"")}}function Er(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var r=nr(e.prototype),a=e.apply(r,t);return He(a)?a:r}}function Uf(e,t,r){var a=Er(e);function c(){for(var h=arguments.length,f=A(h),g=h,y=ir(c);g--;)f[g]=arguments[g];var D=h<3&&f[0]!==y&&f[h-1]!==y?[]:vn(f,y);if(h-=D.length,h<r)return Xl(e,t,ys,c.placeholder,s,f,D,s,s,r-h);var N=this&&this!==tt&&this instanceof c?a:e;return St(N,this,f)}return c}function Vl(e){return function(t,r,a){var c=Be(t);if(!yt(t)){var h=de(r,3);t=Ze(t),r=function(g){return h(c[g],g,c)}}var f=e(t,r,a);return f>-1?c[h?t[f]:f]:s}}function Ql(e){return cn(function(t){var r=t.length,a=r,c=Pt.prototype.thru;for(e&&t.reverse();a--;){var h=t[a];if(typeof h!="function")throw new Mt(b);if(c&&!f&&ws(h)=="wrapper")var f=new Pt([],!0)}for(a=f?a:r;++a<r;){h=t[a];var g=ws(h),y=g=="wrapper"?bo(h):s;y&&Co(y[0])&&y[1]==(re|H|T|te)&&!y[4].length&&y[9]==1?f=f[ws(y[0])].apply(f,y[3]):f=h.length==1&&Co(h)?f[g]():f.thru(h)}return function(){var D=arguments,N=D[0];if(f&&D.length==1&&je(N))return f.plant(N).value();for(var $=0,oe=r?t[$].apply(this,D):N;++$<r;)oe=t[$].call(this,oe);return oe}})}function ys(e,t,r,a,c,h,f,g,y,D){var N=t&re,$=t&W,oe=t&_,ce=t&(H|M),pe=t&G,we=oe?s:Er(e);function xe(){for(var Ce=arguments.length,ke=A(Ce),kt=Ce;kt--;)ke[kt]=arguments[kt];if(ce)var dt=ir(xe),It=Zh(ke,dt);if(a&&(ke=$l(ke,a,c,ce)),h&&(ke=Hl(ke,h,f,ce)),Ce-=It,ce&&Ce<D){var Ge=vn(ke,dt);return Xl(e,t,ys,xe.placeholder,r,ke,Ge,g,y,D-Ce)}var Ht=$?r:this,fn=oe?Ht[e]:e;return Ce=ke.length,g?ke=lp(ke,g):pe&&Ce>1&&ke.reverse(),N&&y<Ce&&(ke.length=y),this&&this!==tt&&this instanceof xe&&(fn=we||Er(fn)),fn.apply(Ht,ke)}return xe}function Yl(e,t){return function(r,a){return gf(r,e,t(a),{})}}function js(e,t){return function(r,a){var c;if(r===s&&a===s)return t;if(r!==s&&(c=r),a!==s){if(c===s)return a;typeof r=="string"||typeof a=="string"?(r=At(r),a=At(a)):(r=Dl(r),a=Dl(a)),c=e(r,a)}return c}}function mo(e){return cn(function(t){return t=$e(t,Ct(de())),Se(function(r){var a=this;return e(t,function(c){return St(c,a,r)})})})}function bs(e,t){t=t===s?" ":At(t);var r=t.length;if(r<2)return r?co(t,e):t;var a=co(t,as(e/Jn(t)));return Yn(t)?wn(Wt(a),0,e).join(""):a.slice(0,e)}function $f(e,t,r,a){var c=t&W,h=Er(e);function f(){for(var g=-1,y=arguments.length,D=-1,N=a.length,$=A(N+y),oe=this&&this!==tt&&this instanceof f?h:e;++D<N;)$[D]=a[D];for(;y--;)$[D++]=arguments[++g];return St(oe,c?r:this,$)}return f}function Jl(e){return function(t,r,a){return a&&typeof a!="number"&&ht(t,r,a)&&(r=a=s),t=dn(t),r===s?(r=t,t=0):r=dn(r),a=a===s?t<r?1:-1:dn(a),kf(t,r,a,e)}}function _s(e){return function(t,r){return typeof t=="string"&&typeof r=="string"||(t=Bt(t),r=Bt(r)),e(t,r)}}function Xl(e,t,r,a,c,h,f,g,y,D){var N=t&H,$=N?f:s,oe=N?s:f,ce=N?h:s,pe=N?s:h;t|=N?T:J,t&=~(N?J:T),t&Y||(t&=~(W|_));var we=[e,t,c,ce,$,pe,oe,g,y,D],xe=r.apply(s,we);return Co(e)&&uc(xe,we),xe.placeholder=a,hc(xe,e,t)}function vo(e){var t=Je[e];return function(r,a){if(r=Bt(r),a=a==null?0:it(_e(a),292),a&&hl(r)){var c=(De(r)+"e").split("e"),h=t(c[0]+"e"+(+c[1]+a));return c=(De(h)+"e").split("e"),+(c[0]+"e"+(+c[1]-a))}return t(r)}}var Hf=er&&1/Jr(new er([,-0]))[1]==z?function(e){return new er(e)}:Fo;function Zl(e){return function(t){var r=ot(t);return r==Ye?Gi(t):r==fe?od(t):Xh(t,e(t))}}function ln(e,t,r,a,c,h,f,g){var y=t&_;if(!y&&typeof e!="function")throw new Mt(b);var D=a?a.length:0;if(D||(t&=~(T|J),a=c=s),f=f===s?f:Xe(_e(f),0),g=g===s?g:_e(g),D-=c?c.length:0,t&J){var N=a,$=c;a=c=s}var oe=y?s:bo(e),ce=[e,t,r,a,c,N,$,h,f,g];if(oe&&ip(ce,oe),e=ce[0],t=ce[1],r=ce[2],a=ce[3],c=ce[4],g=ce[9]=ce[9]===s?y?0:e.length:Xe(ce[9]-D,0),!g&&t&(H|M)&&(t&=~(H|M)),!t||t==W)var pe=Wf(e,t,r);else t==H||t==M?pe=Uf(e,t,g):(t==T||t==(W|T))&&!c.length?pe=$f(e,t,r,a):pe=ys.apply(s,ce);var we=oe?Ml:uc;return hc(we(pe,ce),e,t)}function ec(e,t,r,a){return e===s||$t(e,Zn[r])&&!Oe.call(a,r)?t:e}function tc(e,t,r,a,c,h){return He(e)&&He(t)&&(h.set(t,e),xs(e,t,s,tc,h),h.delete(t)),e}function qf(e){return Pr(e)?s:e}function nc(e,t,r,a,c,h){var f=r&Q,g=e.length,y=t.length;if(g!=y&&!(f&&y>g))return!1;var D=h.get(e),N=h.get(t);if(D&&N)return D==t&&N==e;var $=-1,oe=!0,ce=r&U?new Mn:s;for(h.set(e,t),h.set(t,e);++$<g;){var pe=e[$],we=t[$];if(a)var xe=f?a(we,pe,$,t,e,h):a(pe,we,$,e,t,h);if(xe!==s){if(xe)continue;oe=!1;break}if(ce){if(!Wi(t,function(Ce,ke){if(!jr(ce,ke)&&(pe===Ce||c(pe,Ce,r,a,h)))return ce.push(ke)})){oe=!1;break}}else if(!(pe===we||c(pe,we,r,a,h))){oe=!1;break}}return h.delete(e),h.delete(t),oe}function Kf(e,t,r,a,c,h,f){switch(r){case Gn:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case yr:return!(e.byteLength!=t.byteLength||!h(new rs(e),new rs(t)));case ne:case Ae:case wt:return $t(+e,+t);case mt:return e.name==t.name&&e.message==t.message;case Le:case Pe:return e==t+"";case Ye:var g=Gi;case fe:var y=a&Q;if(g||(g=Jr),e.size!=t.size&&!y)return!1;var D=f.get(e);if(D)return D==t;a|=U,f.set(e,t);var N=nc(g(e),g(t),a,c,h,f);return f.delete(e),N;case Rt:if(Cr)return Cr.call(e)==Cr.call(t)}return!1}function Gf(e,t,r,a,c,h){var f=r&Q,g=yo(e),y=g.length,D=yo(t),N=D.length;if(y!=N&&!f)return!1;for(var $=y;$--;){var oe=g[$];if(!(f?oe in t:Oe.call(t,oe)))return!1}var ce=h.get(e),pe=h.get(t);if(ce&&pe)return ce==t&&pe==e;var we=!0;h.set(e,t),h.set(t,e);for(var xe=f;++$<y;){oe=g[$];var Ce=e[oe],ke=t[oe];if(a)var kt=f?a(ke,Ce,oe,t,e,h):a(Ce,ke,oe,e,t,h);if(!(kt===s?Ce===ke||c(Ce,ke,r,a,h):kt)){we=!1;break}xe||(xe=oe=="constructor")}if(we&&!xe){var dt=e.constructor,It=t.constructor;dt!=It&&"constructor"in e&&"constructor"in t&&!(typeof dt=="function"&&dt instanceof dt&&typeof It=="function"&&It instanceof It)&&(we=!1)}return h.delete(e),h.delete(t),we}function cn(e){return To(lc(e,s,mc),e+"")}function yo(e){return _l(e,Ze,wo)}function jo(e){return _l(e,jt,rc)}var bo=cs?function(e){return cs.get(e)}:Fo;function ws(e){for(var t=e.name+"",r=tr[t],a=Oe.call(tr,t)?r.length:0;a--;){var c=r[a],h=c.func;if(h==null||h==e)return c.name}return t}function ir(e){var t=Oe.call(u,"placeholder")?u:e;return t.placeholder}function de(){var e=u.iteratee||Bo;return e=e===Bo?Cl:e,arguments.length?e(arguments[0],arguments[1]):e}function Ss(e,t){var r=e.__data__;return tp(t)?r[typeof t=="string"?"string":"hash"]:r.map}function _o(e){for(var t=Ze(e),r=t.length;r--;){var a=t[r],c=e[a];t[r]=[a,c,oc(c)]}return t}function On(e,t){var r=rd(e,t);return Sl(r)?r:s}function Vf(e){var t=Oe.call(e,En),r=e[En];try{e[En]=s;var a=!0}catch{}var c=ts.call(e);return a&&(t?e[En]=r:delete e[En]),c}var wo=Qi?function(e){return e==null?[]:(e=Be(e),gn(Qi(e),function(t){return cl.call(e,t)}))}:Wo,rc=Qi?function(e){for(var t=[];e;)mn(t,wo(e)),e=ss(e);return t}:Wo,ot=ut;(Yi&&ot(new Yi(new ArrayBuffer(1)))!=Gn||_r&&ot(new _r)!=Ye||Ji&&ot(Ji.resolve())!=ue||er&&ot(new er)!=fe||wr&&ot(new wr)!=In)&&(ot=function(e){var t=ut(e),r=t==ct?e.constructor:s,a=r?Nn(r):"";if(a)switch(a){case Id:return Gn;case Rd:return Ye;case Ed:return ue;case Ld:return fe;case Md:return In}return t});function Qf(e,t,r){for(var a=-1,c=r.length;++a<c;){var h=r[a],f=h.size;switch(h.type){case"drop":e+=f;break;case"dropRight":t-=f;break;case"take":t=it(t,e+f);break;case"takeRight":e=Xe(e,t-f);break}}return{start:e,end:t}}function Yf(e){var t=e.match(th);return t?t[1].split(nh):[]}function sc(e,t,r){t=_n(t,e);for(var a=-1,c=t.length,h=!1;++a<c;){var f=Qt(t[a]);if(!(h=e!=null&&r(e,f)))break;e=e[f]}return h||++a!=c?h:(c=e==null?0:e.length,!!c&&Es(c)&&un(f,c)&&(je(e)||Bn(e)))}function Jf(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&Oe.call(e,"index")&&(r.index=e.index,r.input=e.input),r}function ic(e){return typeof e.constructor=="function"&&!Lr(e)?nr(ss(e)):{}}function Xf(e,t,r){var a=e.constructor;switch(t){case yr:return go(e);case ne:case Ae:return new a(+e);case Gn:return Df(e,r);case bi:case _i:case wi:case Si:case Ci:case Ai:case Ti:case ki:case Ii:return Wl(e,r);case Ye:return new a;case wt:case Pe:return new a(e);case Le:return Of(e);case fe:return new a;case Rt:return Nf(e)}}function Zf(e,t){var r=t.length;if(!r)return e;var a=r-1;return t[a]=(r>1?"& ":"")+t[a],t=t.join(r>2?", ":" "),e.replace(eh,`{
/* [wrapped with `+t+`] */
`)}function ep(e){return je(e)||Bn(e)||!!(ul&&e&&e[ul])}function un(e,t){var r=typeof e;return t=t??se,!!t&&(r=="number"||r!="symbol"&&hh.test(e))&&e>-1&&e%1==0&&e<t}function ht(e,t,r){if(!He(r))return!1;var a=typeof t;return(a=="number"?yt(r)&&un(t,r.length):a=="string"&&t in r)?$t(r[t],e):!1}function So(e,t){if(je(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Tt(e)?!0:Yu.test(e)||!Qu.test(e)||t!=null&&e in Be(t)}function tp(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function Co(e){var t=ws(e),r=u[t];if(typeof r!="function"||!(t in Te.prototype))return!1;if(e===r)return!0;var a=bo(r);return!!a&&e===a[0]}function np(e){return!!ol&&ol in e}var rp=Zr?hn:Uo;function Lr(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||Zn;return e===r}function oc(e){return e===e&&!He(e)}function ac(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==s||e in Be(r))}}function sp(e){var t=Is(e,function(a){return r.size===V&&r.clear(),a}),r=t.cache;return t}function ip(e,t){var r=e[1],a=t[1],c=r|a,h=c<(W|_|re),f=a==re&&r==H||a==re&&r==te&&e[7].length<=t[8]||a==(re|te)&&t[7].length<=t[8]&&r==H;if(!(h||f))return e;a&W&&(e[2]=t[2],c|=r&W?0:Y);var g=t[3];if(g){var y=e[3];e[3]=y?$l(y,g,t[4]):g,e[4]=y?vn(e[3],I):t[4]}return g=t[5],g&&(y=e[5],e[5]=y?Hl(y,g,t[6]):g,e[6]=y?vn(e[5],I):t[6]),g=t[7],g&&(e[7]=g),a&re&&(e[8]=e[8]==null?t[8]:it(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=c,e}function op(e){var t=[];if(e!=null)for(var r in Be(e))t.push(r);return t}function ap(e){return ts.call(e)}function lc(e,t,r){return t=Xe(t===s?e.length-1:t,0),function(){for(var a=arguments,c=-1,h=Xe(a.length-t,0),f=A(h);++c<h;)f[c]=a[t+c];c=-1;for(var g=A(t+1);++c<t;)g[c]=a[c];return g[t]=r(f),St(e,this,g)}}function cc(e,t){return t.length<2?e:Dn(e,Ot(t,0,-1))}function lp(e,t){for(var r=e.length,a=it(t.length,r),c=vt(e);a--;){var h=t[a];e[a]=un(h,r)?c[h]:s}return e}function Ao(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var uc=dc(Ml),Mr=_d||function(e,t){return tt.setTimeout(e,t)},To=dc(Ef);function hc(e,t,r){var a=t+"";return To(e,Zf(a,cp(Yf(a),r)))}function dc(e){var t=0,r=0;return function(){var a=Ad(),c=le-(a-r);if(r=a,c>0){if(++t>=K)return arguments[0]}else t=0;return e.apply(s,arguments)}}function Cs(e,t){var r=-1,a=e.length,c=a-1;for(t=t===s?a:t;++r<t;){var h=lo(r,c),f=e[h];e[h]=e[r],e[r]=f}return e.length=t,e}var fc=sp(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Ju,function(r,a,c,h){t.push(c?h.replace(ih,"$1"):a||r)}),t});function Qt(e){if(typeof e=="string"||Tt(e))return e;var t=e+"";return t=="0"&&1/e==-z?"-0":t}function Nn(e){if(e!=null){try{return es.call(e)}catch{}try{return e+""}catch{}}return""}function cp(e,t){return Lt(ze,function(r){var a="_."+r[0];t&r[1]&&!Qr(e,a)&&e.push(a)}),e.sort()}function pc(e){if(e instanceof Te)return e.clone();var t=new Pt(e.__wrapped__,e.__chain__);return t.__actions__=vt(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function up(e,t,r){(r?ht(e,t,r):t===s)?t=1:t=Xe(_e(t),0);var a=e==null?0:e.length;if(!a||t<1)return[];for(var c=0,h=0,f=A(as(a/t));c<a;)f[h++]=Ot(e,c,c+=t);return f}function hp(e){for(var t=-1,r=e==null?0:e.length,a=0,c=[];++t<r;){var h=e[t];h&&(c[a++]=h)}return c}function dp(){var e=arguments.length;if(!e)return[];for(var t=A(e-1),r=arguments[0],a=e;a--;)t[a-1]=arguments[a];return mn(je(r)?vt(r):[r],nt(t,1))}var fp=Se(function(e,t){return Ke(e)?Tr(e,nt(t,1,Ke,!0)):[]}),pp=Se(function(e,t){var r=Nt(t);return Ke(r)&&(r=s),Ke(e)?Tr(e,nt(t,1,Ke,!0),de(r,2)):[]}),xp=Se(function(e,t){var r=Nt(t);return Ke(r)&&(r=s),Ke(e)?Tr(e,nt(t,1,Ke,!0),s,r):[]});function gp(e,t,r){var a=e==null?0:e.length;return a?(t=r||t===s?1:_e(t),Ot(e,t<0?0:t,a)):[]}function mp(e,t,r){var a=e==null?0:e.length;return a?(t=r||t===s?1:_e(t),t=a-t,Ot(e,0,t<0?0:t)):[]}function vp(e,t){return e&&e.length?ms(e,de(t,3),!0,!0):[]}function yp(e,t){return e&&e.length?ms(e,de(t,3),!0):[]}function jp(e,t,r,a){var c=e==null?0:e.length;return c?(r&&typeof r!="number"&&ht(e,t,r)&&(r=0,a=c),df(e,t,r,a)):[]}function xc(e,t,r){var a=e==null?0:e.length;if(!a)return-1;var c=r==null?0:_e(r);return c<0&&(c=Xe(a+c,0)),Yr(e,de(t,3),c)}function gc(e,t,r){var a=e==null?0:e.length;if(!a)return-1;var c=a-1;return r!==s&&(c=_e(r),c=r<0?Xe(a+c,0):it(c,a-1)),Yr(e,de(t,3),c,!0)}function mc(e){var t=e==null?0:e.length;return t?nt(e,1):[]}function bp(e){var t=e==null?0:e.length;return t?nt(e,z):[]}function _p(e,t){var r=e==null?0:e.length;return r?(t=t===s?1:_e(t),nt(e,t)):[]}function wp(e){for(var t=-1,r=e==null?0:e.length,a={};++t<r;){var c=e[t];a[c[0]]=c[1]}return a}function vc(e){return e&&e.length?e[0]:s}function Sp(e,t,r){var a=e==null?0:e.length;if(!a)return-1;var c=r==null?0:_e(r);return c<0&&(c=Xe(a+c,0)),Qn(e,t,c)}function Cp(e){var t=e==null?0:e.length;return t?Ot(e,0,-1):[]}var Ap=Se(function(e){var t=$e(e,po);return t.length&&t[0]===e[0]?ro(t):[]}),Tp=Se(function(e){var t=Nt(e),r=$e(e,po);return t===Nt(r)?t=s:r.pop(),r.length&&r[0]===e[0]?ro(r,de(t,2)):[]}),kp=Se(function(e){var t=Nt(e),r=$e(e,po);return t=typeof t=="function"?t:s,t&&r.pop(),r.length&&r[0]===e[0]?ro(r,s,t):[]});function Ip(e,t){return e==null?"":Sd.call(e,t)}function Nt(e){var t=e==null?0:e.length;return t?e[t-1]:s}function Rp(e,t,r){var a=e==null?0:e.length;if(!a)return-1;var c=a;return r!==s&&(c=_e(r),c=c<0?Xe(a+c,0):it(c,a-1)),t===t?ld(e,t,c):Yr(e,Xa,c,!0)}function Ep(e,t){return e&&e.length?Il(e,_e(t)):s}var Lp=Se(yc);function yc(e,t){return e&&e.length&&t&&t.length?ao(e,t):e}function Mp(e,t,r){return e&&e.length&&t&&t.length?ao(e,t,de(r,2)):e}function Pp(e,t,r){return e&&e.length&&t&&t.length?ao(e,t,s,r):e}var Dp=cn(function(e,t){var r=e==null?0:e.length,a=Zi(e,t);return Ll(e,$e(t,function(c){return un(c,r)?+c:c}).sort(Ul)),a});function Op(e,t){var r=[];if(!(e&&e.length))return r;var a=-1,c=[],h=e.length;for(t=de(t,3);++a<h;){var f=e[a];t(f,a,e)&&(r.push(f),c.push(a))}return Ll(e,c),r}function ko(e){return e==null?e:kd.call(e)}function Np(e,t,r){var a=e==null?0:e.length;return a?(r&&typeof r!="number"&&ht(e,t,r)?(t=0,r=a):(t=t==null?0:_e(t),r=r===s?a:_e(r)),Ot(e,t,r)):[]}function Bp(e,t){return gs(e,t)}function zp(e,t,r){return uo(e,t,de(r,2))}function Fp(e,t){var r=e==null?0:e.length;if(r){var a=gs(e,t);if(a<r&&$t(e[a],t))return a}return-1}function Wp(e,t){return gs(e,t,!0)}function Up(e,t,r){return uo(e,t,de(r,2),!0)}function $p(e,t){var r=e==null?0:e.length;if(r){var a=gs(e,t,!0)-1;if($t(e[a],t))return a}return-1}function Hp(e){return e&&e.length?Pl(e):[]}function qp(e,t){return e&&e.length?Pl(e,de(t,2)):[]}function Kp(e){var t=e==null?0:e.length;return t?Ot(e,1,t):[]}function Gp(e,t,r){return e&&e.length?(t=r||t===s?1:_e(t),Ot(e,0,t<0?0:t)):[]}function Vp(e,t,r){var a=e==null?0:e.length;return a?(t=r||t===s?1:_e(t),t=a-t,Ot(e,t<0?0:t,a)):[]}function Qp(e,t){return e&&e.length?ms(e,de(t,3),!1,!0):[]}function Yp(e,t){return e&&e.length?ms(e,de(t,3)):[]}var Jp=Se(function(e){return bn(nt(e,1,Ke,!0))}),Xp=Se(function(e){var t=Nt(e);return Ke(t)&&(t=s),bn(nt(e,1,Ke,!0),de(t,2))}),Zp=Se(function(e){var t=Nt(e);return t=typeof t=="function"?t:s,bn(nt(e,1,Ke,!0),s,t)});function ex(e){return e&&e.length?bn(e):[]}function tx(e,t){return e&&e.length?bn(e,de(t,2)):[]}function nx(e,t){return t=typeof t=="function"?t:s,e&&e.length?bn(e,s,t):[]}function Io(e){if(!(e&&e.length))return[];var t=0;return e=gn(e,function(r){if(Ke(r))return t=Xe(r.length,t),!0}),qi(t,function(r){return $e(e,Ui(r))})}function jc(e,t){if(!(e&&e.length))return[];var r=Io(e);return t==null?r:$e(r,function(a){return St(t,s,a)})}var rx=Se(function(e,t){return Ke(e)?Tr(e,t):[]}),sx=Se(function(e){return fo(gn(e,Ke))}),ix=Se(function(e){var t=Nt(e);return Ke(t)&&(t=s),fo(gn(e,Ke),de(t,2))}),ox=Se(function(e){var t=Nt(e);return t=typeof t=="function"?t:s,fo(gn(e,Ke),s,t)}),ax=Se(Io);function lx(e,t){return Bl(e||[],t||[],Ar)}function cx(e,t){return Bl(e||[],t||[],Rr)}var ux=Se(function(e){var t=e.length,r=t>1?e[t-1]:s;return r=typeof r=="function"?(e.pop(),r):s,jc(e,r)});function bc(e){var t=u(e);return t.__chain__=!0,t}function hx(e,t){return t(e),e}function As(e,t){return t(e)}var dx=cn(function(e){var t=e.length,r=t?e[0]:0,a=this.__wrapped__,c=function(h){return Zi(h,e)};return t>1||this.__actions__.length||!(a instanceof Te)||!un(r)?this.thru(c):(a=a.slice(r,+r+(t?1:0)),a.__actions__.push({func:As,args:[c],thisArg:s}),new Pt(a,this.__chain__).thru(function(h){return t&&!h.length&&h.push(s),h}))});function fx(){return bc(this)}function px(){return new Pt(this.value(),this.__chain__)}function xx(){this.__values__===s&&(this.__values__=Dc(this.value()));var e=this.__index__>=this.__values__.length,t=e?s:this.__values__[this.__index__++];return{done:e,value:t}}function gx(){return this}function mx(e){for(var t,r=this;r instanceof hs;){var a=pc(r);a.__index__=0,a.__values__=s,t?c.__wrapped__=a:t=a;var c=a;r=r.__wrapped__}return c.__wrapped__=e,t}function vx(){var e=this.__wrapped__;if(e instanceof Te){var t=e;return this.__actions__.length&&(t=new Te(this)),t=t.reverse(),t.__actions__.push({func:As,args:[ko],thisArg:s}),new Pt(t,this.__chain__)}return this.thru(ko)}function yx(){return Nl(this.__wrapped__,this.__actions__)}var jx=vs(function(e,t,r){Oe.call(e,r)?++e[r]:an(e,r,1)});function bx(e,t,r){var a=je(e)?Ya:hf;return r&&ht(e,t,r)&&(t=s),a(e,de(t,3))}function _x(e,t){var r=je(e)?gn:jl;return r(e,de(t,3))}var wx=Vl(xc),Sx=Vl(gc);function Cx(e,t){return nt(Ts(e,t),1)}function Ax(e,t){return nt(Ts(e,t),z)}function Tx(e,t,r){return r=r===s?1:_e(r),nt(Ts(e,t),r)}function _c(e,t){var r=je(e)?Lt:jn;return r(e,de(t,3))}function wc(e,t){var r=je(e)?qh:yl;return r(e,de(t,3))}var kx=vs(function(e,t,r){Oe.call(e,r)?e[r].push(t):an(e,r,[t])});function Ix(e,t,r,a){e=yt(e)?e:ar(e),r=r&&!a?_e(r):0;var c=e.length;return r<0&&(r=Xe(c+r,0)),Ls(e)?r<=c&&e.indexOf(t,r)>-1:!!c&&Qn(e,t,r)>-1}var Rx=Se(function(e,t,r){var a=-1,c=typeof t=="function",h=yt(e)?A(e.length):[];return jn(e,function(f){h[++a]=c?St(t,f,r):kr(f,t,r)}),h}),Ex=vs(function(e,t,r){an(e,r,t)});function Ts(e,t){var r=je(e)?$e:Al;return r(e,de(t,3))}function Lx(e,t,r,a){return e==null?[]:(je(t)||(t=t==null?[]:[t]),r=a?s:r,je(r)||(r=r==null?[]:[r]),Rl(e,t,r))}var Mx=vs(function(e,t,r){e[r?0:1].push(t)},function(){return[[],[]]});function Px(e,t,r){var a=je(e)?Fi:el,c=arguments.length<3;return a(e,de(t,4),r,c,jn)}function Dx(e,t,r){var a=je(e)?Kh:el,c=arguments.length<3;return a(e,de(t,4),r,c,yl)}function Ox(e,t){var r=je(e)?gn:jl;return r(e,Rs(de(t,3)))}function Nx(e){var t=je(e)?xl:If;return t(e)}function Bx(e,t,r){(r?ht(e,t,r):t===s)?t=1:t=_e(t);var a=je(e)?of:Rf;return a(e,t)}function zx(e){var t=je(e)?af:Lf;return t(e)}function Fx(e){if(e==null)return 0;if(yt(e))return Ls(e)?Jn(e):e.length;var t=ot(e);return t==Ye||t==fe?e.size:io(e).length}function Wx(e,t,r){var a=je(e)?Wi:Mf;return r&&ht(e,t,r)&&(t=s),a(e,de(t,3))}var Ux=Se(function(e,t){if(e==null)return[];var r=t.length;return r>1&&ht(e,t[0],t[1])?t=[]:r>2&&ht(t[0],t[1],t[2])&&(t=[t[0]]),Rl(e,nt(t,1),[])}),ks=bd||function(){return tt.Date.now()};function $x(e,t){if(typeof t!="function")throw new Mt(b);return e=_e(e),function(){if(--e<1)return t.apply(this,arguments)}}function Sc(e,t,r){return t=r?s:t,t=e&&t==null?e.length:t,ln(e,re,s,s,s,s,t)}function Cc(e,t){var r;if(typeof t!="function")throw new Mt(b);return e=_e(e),function(){return--e>0&&(r=t.apply(this,arguments)),e<=1&&(t=s),r}}var Ro=Se(function(e,t,r){var a=W;if(r.length){var c=vn(r,ir(Ro));a|=T}return ln(e,a,t,r,c)}),Ac=Se(function(e,t,r){var a=W|_;if(r.length){var c=vn(r,ir(Ac));a|=T}return ln(t,a,e,r,c)});function Tc(e,t,r){t=r?s:t;var a=ln(e,H,s,s,s,s,s,t);return a.placeholder=Tc.placeholder,a}function kc(e,t,r){t=r?s:t;var a=ln(e,M,s,s,s,s,s,t);return a.placeholder=kc.placeholder,a}function Ic(e,t,r){var a,c,h,f,g,y,D=0,N=!1,$=!1,oe=!0;if(typeof e!="function")throw new Mt(b);t=Bt(t)||0,He(r)&&(N=!!r.leading,$="maxWait"in r,h=$?Xe(Bt(r.maxWait)||0,t):h,oe="trailing"in r?!!r.trailing:oe);function ce(Ge){var Ht=a,fn=c;return a=c=s,D=Ge,f=e.apply(fn,Ht),f}function pe(Ge){return D=Ge,g=Mr(Ce,t),N?ce(Ge):f}function we(Ge){var Ht=Ge-y,fn=Ge-D,Vc=t-Ht;return $?it(Vc,h-fn):Vc}function xe(Ge){var Ht=Ge-y,fn=Ge-D;return y===s||Ht>=t||Ht<0||$&&fn>=h}function Ce(){var Ge=ks();if(xe(Ge))return ke(Ge);g=Mr(Ce,we(Ge))}function ke(Ge){return g=s,oe&&a?ce(Ge):(a=c=s,f)}function kt(){g!==s&&zl(g),D=0,a=y=c=g=s}function dt(){return g===s?f:ke(ks())}function It(){var Ge=ks(),Ht=xe(Ge);if(a=arguments,c=this,y=Ge,Ht){if(g===s)return pe(y);if($)return zl(g),g=Mr(Ce,t),ce(y)}return g===s&&(g=Mr(Ce,t)),f}return It.cancel=kt,It.flush=dt,It}var Hx=Se(function(e,t){return vl(e,1,t)}),qx=Se(function(e,t,r){return vl(e,Bt(t)||0,r)});function Kx(e){return ln(e,G)}function Is(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Mt(b);var r=function(){var a=arguments,c=t?t.apply(this,a):a[0],h=r.cache;if(h.has(c))return h.get(c);var f=e.apply(this,a);return r.cache=h.set(c,f)||h,f};return r.cache=new(Is.Cache||on),r}Is.Cache=on;function Rs(e){if(typeof e!="function")throw new Mt(b);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Gx(e){return Cc(2,e)}var Vx=Pf(function(e,t){t=t.length==1&&je(t[0])?$e(t[0],Ct(de())):$e(nt(t,1),Ct(de()));var r=t.length;return Se(function(a){for(var c=-1,h=it(a.length,r);++c<h;)a[c]=t[c].call(this,a[c]);return St(e,this,a)})}),Eo=Se(function(e,t){var r=vn(t,ir(Eo));return ln(e,T,s,t,r)}),Rc=Se(function(e,t){var r=vn(t,ir(Rc));return ln(e,J,s,t,r)}),Qx=cn(function(e,t){return ln(e,te,s,s,s,t)});function Yx(e,t){if(typeof e!="function")throw new Mt(b);return t=t===s?t:_e(t),Se(e,t)}function Jx(e,t){if(typeof e!="function")throw new Mt(b);return t=t==null?0:Xe(_e(t),0),Se(function(r){var a=r[t],c=wn(r,0,t);return a&&mn(c,a),St(e,this,c)})}function Xx(e,t,r){var a=!0,c=!0;if(typeof e!="function")throw new Mt(b);return He(r)&&(a="leading"in r?!!r.leading:a,c="trailing"in r?!!r.trailing:c),Ic(e,t,{leading:a,maxWait:t,trailing:c})}function Zx(e){return Sc(e,1)}function eg(e,t){return Eo(xo(t),e)}function tg(){if(!arguments.length)return[];var e=arguments[0];return je(e)?e:[e]}function ng(e){return Dt(e,X)}function rg(e,t){return t=typeof t=="function"?t:s,Dt(e,X,t)}function sg(e){return Dt(e,O|X)}function ig(e,t){return t=typeof t=="function"?t:s,Dt(e,O|X,t)}function og(e,t){return t==null||ml(e,t,Ze(t))}function $t(e,t){return e===t||e!==e&&t!==t}var ag=_s(no),lg=_s(function(e,t){return e>=t}),Bn=wl(function(){return arguments}())?wl:function(e){return qe(e)&&Oe.call(e,"callee")&&!cl.call(e,"callee")},je=A.isArray,cg=Ha?Ct(Ha):mf;function yt(e){return e!=null&&Es(e.length)&&!hn(e)}function Ke(e){return qe(e)&&yt(e)}function ug(e){return e===!0||e===!1||qe(e)&&ut(e)==ne}var Sn=wd||Uo,hg=qa?Ct(qa):vf;function dg(e){return qe(e)&&e.nodeType===1&&!Pr(e)}function fg(e){if(e==null)return!0;if(yt(e)&&(je(e)||typeof e=="string"||typeof e.splice=="function"||Sn(e)||or(e)||Bn(e)))return!e.length;var t=ot(e);if(t==Ye||t==fe)return!e.size;if(Lr(e))return!io(e).length;for(var r in e)if(Oe.call(e,r))return!1;return!0}function pg(e,t){return Ir(e,t)}function xg(e,t,r){r=typeof r=="function"?r:s;var a=r?r(e,t):s;return a===s?Ir(e,t,s,r):!!a}function Lo(e){if(!qe(e))return!1;var t=ut(e);return t==mt||t==at||typeof e.message=="string"&&typeof e.name=="string"&&!Pr(e)}function gg(e){return typeof e=="number"&&hl(e)}function hn(e){if(!He(e))return!1;var t=ut(e);return t==lt||t==rn||t==R||t==Re}function Ec(e){return typeof e=="number"&&e==_e(e)}function Es(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=se}function He(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function qe(e){return e!=null&&typeof e=="object"}var Lc=Ka?Ct(Ka):jf;function mg(e,t){return e===t||so(e,t,_o(t))}function vg(e,t,r){return r=typeof r=="function"?r:s,so(e,t,_o(t),r)}function yg(e){return Mc(e)&&e!=+e}function jg(e){if(rp(e))throw new me(m);return Sl(e)}function bg(e){return e===null}function _g(e){return e==null}function Mc(e){return typeof e=="number"||qe(e)&&ut(e)==wt}function Pr(e){if(!qe(e)||ut(e)!=ct)return!1;var t=ss(e);if(t===null)return!0;var r=Oe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&es.call(r)==md}var Mo=Ga?Ct(Ga):bf;function wg(e){return Ec(e)&&e>=-se&&e<=se}var Pc=Va?Ct(Va):_f;function Ls(e){return typeof e=="string"||!je(e)&&qe(e)&&ut(e)==Pe}function Tt(e){return typeof e=="symbol"||qe(e)&&ut(e)==Rt}var or=Qa?Ct(Qa):wf;function Sg(e){return e===s}function Cg(e){return qe(e)&&ot(e)==In}function Ag(e){return qe(e)&&ut(e)==ji}var Tg=_s(oo),kg=_s(function(e,t){return e<=t});function Dc(e){if(!e)return[];if(yt(e))return Ls(e)?Wt(e):vt(e);if(br&&e[br])return id(e[br]());var t=ot(e),r=t==Ye?Gi:t==fe?Jr:ar;return r(e)}function dn(e){if(!e)return e===0?e:0;if(e=Bt(e),e===z||e===-z){var t=e<0?-1:1;return t*F}return e===e?e:0}function _e(e){var t=dn(e),r=t%1;return t===t?r?t-r:t:0}function Oc(e){return e?Pn(_e(e),0,P):0}function Bt(e){if(typeof e=="number")return e;if(Tt(e))return L;if(He(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=He(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=tl(e);var r=lh.test(e);return r||uh.test(e)?Uh(e.slice(2),r?2:8):ah.test(e)?L:+e}function Nc(e){return Vt(e,jt(e))}function Ig(e){return e?Pn(_e(e),-se,se):e===0?e:0}function De(e){return e==null?"":At(e)}var Rg=rr(function(e,t){if(Lr(t)||yt(t)){Vt(t,Ze(t),e);return}for(var r in t)Oe.call(t,r)&&Ar(e,r,t[r])}),Bc=rr(function(e,t){Vt(t,jt(t),e)}),Ms=rr(function(e,t,r,a){Vt(t,jt(t),e,a)}),Eg=rr(function(e,t,r,a){Vt(t,Ze(t),e,a)}),Lg=cn(Zi);function Mg(e,t){var r=nr(e);return t==null?r:gl(r,t)}var Pg=Se(function(e,t){e=Be(e);var r=-1,a=t.length,c=a>2?t[2]:s;for(c&&ht(t[0],t[1],c)&&(a=1);++r<a;)for(var h=t[r],f=jt(h),g=-1,y=f.length;++g<y;){var D=f[g],N=e[D];(N===s||$t(N,Zn[D])&&!Oe.call(e,D))&&(e[D]=h[D])}return e}),Dg=Se(function(e){return e.push(s,tc),St(zc,s,e)});function Og(e,t){return Ja(e,de(t,3),Gt)}function Ng(e,t){return Ja(e,de(t,3),to)}function Bg(e,t){return e==null?e:eo(e,de(t,3),jt)}function zg(e,t){return e==null?e:bl(e,de(t,3),jt)}function Fg(e,t){return e&&Gt(e,de(t,3))}function Wg(e,t){return e&&to(e,de(t,3))}function Ug(e){return e==null?[]:ps(e,Ze(e))}function $g(e){return e==null?[]:ps(e,jt(e))}function Po(e,t,r){var a=e==null?s:Dn(e,t);return a===s?r:a}function Hg(e,t){return e!=null&&sc(e,t,ff)}function Do(e,t){return e!=null&&sc(e,t,pf)}var qg=Yl(function(e,t,r){t!=null&&typeof t.toString!="function"&&(t=ts.call(t)),e[t]=r},No(bt)),Kg=Yl(function(e,t,r){t!=null&&typeof t.toString!="function"&&(t=ts.call(t)),Oe.call(e,t)?e[t].push(r):e[t]=[r]},de),Gg=Se(kr);function Ze(e){return yt(e)?pl(e):io(e)}function jt(e){return yt(e)?pl(e,!0):Sf(e)}function Vg(e,t){var r={};return t=de(t,3),Gt(e,function(a,c,h){an(r,t(a,c,h),a)}),r}function Qg(e,t){var r={};return t=de(t,3),Gt(e,function(a,c,h){an(r,c,t(a,c,h))}),r}var Yg=rr(function(e,t,r){xs(e,t,r)}),zc=rr(function(e,t,r,a){xs(e,t,r,a)}),Jg=cn(function(e,t){var r={};if(e==null)return r;var a=!1;t=$e(t,function(h){return h=_n(h,e),a||(a=h.length>1),h}),Vt(e,jo(e),r),a&&(r=Dt(r,O|q|X,qf));for(var c=t.length;c--;)ho(r,t[c]);return r});function Xg(e,t){return Fc(e,Rs(de(t)))}var Zg=cn(function(e,t){return e==null?{}:Af(e,t)});function Fc(e,t){if(e==null)return{};var r=$e(jo(e),function(a){return[a]});return t=de(t),El(e,r,function(a,c){return t(a,c[0])})}function em(e,t,r){t=_n(t,e);var a=-1,c=t.length;for(c||(c=1,e=s);++a<c;){var h=e==null?s:e[Qt(t[a])];h===s&&(a=c,h=r),e=hn(h)?h.call(e):h}return e}function tm(e,t,r){return e==null?e:Rr(e,t,r)}function nm(e,t,r,a){return a=typeof a=="function"?a:s,e==null?e:Rr(e,t,r,a)}var Wc=Zl(Ze),Uc=Zl(jt);function rm(e,t,r){var a=je(e),c=a||Sn(e)||or(e);if(t=de(t,4),r==null){var h=e&&e.constructor;c?r=a?new h:[]:He(e)?r=hn(h)?nr(ss(e)):{}:r={}}return(c?Lt:Gt)(e,function(f,g,y){return t(r,f,g,y)}),r}function sm(e,t){return e==null?!0:ho(e,t)}function im(e,t,r){return e==null?e:Ol(e,t,xo(r))}function om(e,t,r,a){return a=typeof a=="function"?a:s,e==null?e:Ol(e,t,xo(r),a)}function ar(e){return e==null?[]:Ki(e,Ze(e))}function am(e){return e==null?[]:Ki(e,jt(e))}function lm(e,t,r){return r===s&&(r=t,t=s),r!==s&&(r=Bt(r),r=r===r?r:0),t!==s&&(t=Bt(t),t=t===t?t:0),Pn(Bt(e),t,r)}function cm(e,t,r){return t=dn(t),r===s?(r=t,t=0):r=dn(r),e=Bt(e),xf(e,t,r)}function um(e,t,r){if(r&&typeof r!="boolean"&&ht(e,t,r)&&(t=r=s),r===s&&(typeof t=="boolean"?(r=t,t=s):typeof e=="boolean"&&(r=e,e=s)),e===s&&t===s?(e=0,t=1):(e=dn(e),t===s?(t=e,e=0):t=dn(t)),e>t){var a=e;e=t,t=a}if(r||e%1||t%1){var c=dl();return it(e+c*(t-e+Wh("1e-"+((c+"").length-1))),t)}return lo(e,t)}var hm=sr(function(e,t,r){return t=t.toLowerCase(),e+(r?$c(t):t)});function $c(e){return Oo(De(e).toLowerCase())}function Hc(e){return e=De(e),e&&e.replace(dh,ed).replace(Eh,"")}function dm(e,t,r){e=De(e),t=At(t);var a=e.length;r=r===s?a:Pn(_e(r),0,a);var c=r;return r-=t.length,r>=0&&e.slice(r,c)==t}function fm(e){return e=De(e),e&&Ku.test(e)?e.replace(ba,td):e}function pm(e){return e=De(e),e&&Xu.test(e)?e.replace(Ri,"\\$&"):e}var xm=sr(function(e,t,r){return e+(r?"-":"")+t.toLowerCase()}),gm=sr(function(e,t,r){return e+(r?" ":"")+t.toLowerCase()}),mm=Gl("toLowerCase");function vm(e,t,r){e=De(e),t=_e(t);var a=t?Jn(e):0;if(!t||a>=t)return e;var c=(t-a)/2;return bs(ls(c),r)+e+bs(as(c),r)}function ym(e,t,r){e=De(e),t=_e(t);var a=t?Jn(e):0;return t&&a<t?e+bs(t-a,r):e}function jm(e,t,r){e=De(e),t=_e(t);var a=t?Jn(e):0;return t&&a<t?bs(t-a,r)+e:e}function bm(e,t,r){return r||t==null?t=0:t&&(t=+t),Td(De(e).replace(Ei,""),t||0)}function _m(e,t,r){return(r?ht(e,t,r):t===s)?t=1:t=_e(t),co(De(e),t)}function wm(){var e=arguments,t=De(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Sm=sr(function(e,t,r){return e+(r?"_":"")+t.toLowerCase()});function Cm(e,t,r){return r&&typeof r!="number"&&ht(e,t,r)&&(t=r=s),r=r===s?P:r>>>0,r?(e=De(e),e&&(typeof t=="string"||t!=null&&!Mo(t))&&(t=At(t),!t&&Yn(e))?wn(Wt(e),0,r):e.split(t,r)):[]}var Am=sr(function(e,t,r){return e+(r?" ":"")+Oo(t)});function Tm(e,t,r){return e=De(e),r=r==null?0:Pn(_e(r),0,e.length),t=At(t),e.slice(r,r+t.length)==t}function km(e,t,r){var a=u.templateSettings;r&&ht(e,t,r)&&(t=s),e=De(e),t=Ms({},t,a,ec);var c=Ms({},t.imports,a.imports,ec),h=Ze(c),f=Ki(c,h),g,y,D=0,N=t.interpolate||Kr,$="__p += '",oe=Vi((t.escape||Kr).source+"|"+N.source+"|"+(N===_a?oh:Kr).source+"|"+(t.evaluate||Kr).source+"|$","g"),ce="//# sourceURL="+(Oe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Oh+"]")+`
`;e.replace(oe,function(xe,Ce,ke,kt,dt,It){return ke||(ke=kt),$+=e.slice(D,It).replace(fh,nd),Ce&&(g=!0,$+=`' +
__e(`+Ce+`) +
'`),dt&&(y=!0,$+=`';
`+dt+`;
__p += '`),ke&&($+=`' +
((__t = (`+ke+`)) == null ? '' : __t) +
'`),D=It+xe.length,xe}),$+=`';
`;var pe=Oe.call(t,"variable")&&t.variable;if(!pe)$=`with (obj) {
`+$+`
}
`;else if(sh.test(pe))throw new me(j);$=(y?$.replace(Uu,""):$).replace($u,"$1").replace(Hu,"$1;"),$="function("+(pe||"obj")+`) {
`+(pe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(g?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+$+`return __p
}`;var we=Kc(function(){return Me(h,ce+"return "+$).apply(s,f)});if(we.source=$,Lo(we))throw we;return we}function Im(e){return De(e).toLowerCase()}function Rm(e){return De(e).toUpperCase()}function Em(e,t,r){if(e=De(e),e&&(r||t===s))return tl(e);if(!e||!(t=At(t)))return e;var a=Wt(e),c=Wt(t),h=nl(a,c),f=rl(a,c)+1;return wn(a,h,f).join("")}function Lm(e,t,r){if(e=De(e),e&&(r||t===s))return e.slice(0,il(e)+1);if(!e||!(t=At(t)))return e;var a=Wt(e),c=rl(a,Wt(t))+1;return wn(a,0,c).join("")}function Mm(e,t,r){if(e=De(e),e&&(r||t===s))return e.replace(Ei,"");if(!e||!(t=At(t)))return e;var a=Wt(e),c=nl(a,Wt(t));return wn(a,c).join("")}function Pm(e,t){var r=Z,a=k;if(He(t)){var c="separator"in t?t.separator:c;r="length"in t?_e(t.length):r,a="omission"in t?At(t.omission):a}e=De(e);var h=e.length;if(Yn(e)){var f=Wt(e);h=f.length}if(r>=h)return e;var g=r-Jn(a);if(g<1)return a;var y=f?wn(f,0,g).join(""):e.slice(0,g);if(c===s)return y+a;if(f&&(g+=y.length-g),Mo(c)){if(e.slice(g).search(c)){var D,N=y;for(c.global||(c=Vi(c.source,De(wa.exec(c))+"g")),c.lastIndex=0;D=c.exec(N);)var $=D.index;y=y.slice(0,$===s?g:$)}}else if(e.indexOf(At(c),g)!=g){var oe=y.lastIndexOf(c);oe>-1&&(y=y.slice(0,oe))}return y+a}function Dm(e){return e=De(e),e&&qu.test(e)?e.replace(ja,cd):e}var Om=sr(function(e,t,r){return e+(r?" ":"")+t.toUpperCase()}),Oo=Gl("toUpperCase");function qc(e,t,r){return e=De(e),t=r?s:t,t===s?sd(e)?dd(e):Qh(e):e.match(t)||[]}var Kc=Se(function(e,t){try{return St(e,s,t)}catch(r){return Lo(r)?r:new me(r)}}),Nm=cn(function(e,t){return Lt(t,function(r){r=Qt(r),an(e,r,Ro(e[r],e))}),e});function Bm(e){var t=e==null?0:e.length,r=de();return e=t?$e(e,function(a){if(typeof a[1]!="function")throw new Mt(b);return[r(a[0]),a[1]]}):[],Se(function(a){for(var c=-1;++c<t;){var h=e[c];if(St(h[0],this,a))return St(h[1],this,a)}})}function zm(e){return uf(Dt(e,O))}function No(e){return function(){return e}}function Fm(e,t){return e==null||e!==e?t:e}var Wm=Ql(),Um=Ql(!0);function bt(e){return e}function Bo(e){return Cl(typeof e=="function"?e:Dt(e,O))}function $m(e){return Tl(Dt(e,O))}function Hm(e,t){return kl(e,Dt(t,O))}var qm=Se(function(e,t){return function(r){return kr(r,e,t)}}),Km=Se(function(e,t){return function(r){return kr(e,r,t)}});function zo(e,t,r){var a=Ze(t),c=ps(t,a);r==null&&!(He(t)&&(c.length||!a.length))&&(r=t,t=e,e=this,c=ps(t,Ze(t)));var h=!(He(r)&&"chain"in r)||!!r.chain,f=hn(e);return Lt(c,function(g){var y=t[g];e[g]=y,f&&(e.prototype[g]=function(){var D=this.__chain__;if(h||D){var N=e(this.__wrapped__),$=N.__actions__=vt(this.__actions__);return $.push({func:y,args:arguments,thisArg:e}),N.__chain__=D,N}return y.apply(e,mn([this.value()],arguments))})}),e}function Gm(){return tt._===this&&(tt._=vd),this}function Fo(){}function Vm(e){return e=_e(e),Se(function(t){return Il(t,e)})}var Qm=mo($e),Ym=mo(Ya),Jm=mo(Wi);function Gc(e){return So(e)?Ui(Qt(e)):Tf(e)}function Xm(e){return function(t){return e==null?s:Dn(e,t)}}var Zm=Jl(),ev=Jl(!0);function Wo(){return[]}function Uo(){return!1}function tv(){return{}}function nv(){return""}function rv(){return!0}function sv(e,t){if(e=_e(e),e<1||e>se)return[];var r=P,a=it(e,P);t=de(t),e-=P;for(var c=qi(a,t);++r<e;)t(r);return c}function iv(e){return je(e)?$e(e,Qt):Tt(e)?[e]:vt(fc(De(e)))}function ov(e){var t=++gd;return De(e)+t}var av=js(function(e,t){return e+t},0),lv=vo("ceil"),cv=js(function(e,t){return e/t},1),uv=vo("floor");function hv(e){return e&&e.length?fs(e,bt,no):s}function dv(e,t){return e&&e.length?fs(e,de(t,2),no):s}function fv(e){return Za(e,bt)}function pv(e,t){return Za(e,de(t,2))}function xv(e){return e&&e.length?fs(e,bt,oo):s}function gv(e,t){return e&&e.length?fs(e,de(t,2),oo):s}var mv=js(function(e,t){return e*t},1),vv=vo("round"),yv=js(function(e,t){return e-t},0);function jv(e){return e&&e.length?Hi(e,bt):0}function bv(e,t){return e&&e.length?Hi(e,de(t,2)):0}return u.after=$x,u.ary=Sc,u.assign=Rg,u.assignIn=Bc,u.assignInWith=Ms,u.assignWith=Eg,u.at=Lg,u.before=Cc,u.bind=Ro,u.bindAll=Nm,u.bindKey=Ac,u.castArray=tg,u.chain=bc,u.chunk=up,u.compact=hp,u.concat=dp,u.cond=Bm,u.conforms=zm,u.constant=No,u.countBy=jx,u.create=Mg,u.curry=Tc,u.curryRight=kc,u.debounce=Ic,u.defaults=Pg,u.defaultsDeep=Dg,u.defer=Hx,u.delay=qx,u.difference=fp,u.differenceBy=pp,u.differenceWith=xp,u.drop=gp,u.dropRight=mp,u.dropRightWhile=vp,u.dropWhile=yp,u.fill=jp,u.filter=_x,u.flatMap=Cx,u.flatMapDeep=Ax,u.flatMapDepth=Tx,u.flatten=mc,u.flattenDeep=bp,u.flattenDepth=_p,u.flip=Kx,u.flow=Wm,u.flowRight=Um,u.fromPairs=wp,u.functions=Ug,u.functionsIn=$g,u.groupBy=kx,u.initial=Cp,u.intersection=Ap,u.intersectionBy=Tp,u.intersectionWith=kp,u.invert=qg,u.invertBy=Kg,u.invokeMap=Rx,u.iteratee=Bo,u.keyBy=Ex,u.keys=Ze,u.keysIn=jt,u.map=Ts,u.mapKeys=Vg,u.mapValues=Qg,u.matches=$m,u.matchesProperty=Hm,u.memoize=Is,u.merge=Yg,u.mergeWith=zc,u.method=qm,u.methodOf=Km,u.mixin=zo,u.negate=Rs,u.nthArg=Vm,u.omit=Jg,u.omitBy=Xg,u.once=Gx,u.orderBy=Lx,u.over=Qm,u.overArgs=Vx,u.overEvery=Ym,u.overSome=Jm,u.partial=Eo,u.partialRight=Rc,u.partition=Mx,u.pick=Zg,u.pickBy=Fc,u.property=Gc,u.propertyOf=Xm,u.pull=Lp,u.pullAll=yc,u.pullAllBy=Mp,u.pullAllWith=Pp,u.pullAt=Dp,u.range=Zm,u.rangeRight=ev,u.rearg=Qx,u.reject=Ox,u.remove=Op,u.rest=Yx,u.reverse=ko,u.sampleSize=Bx,u.set=tm,u.setWith=nm,u.shuffle=zx,u.slice=Np,u.sortBy=Ux,u.sortedUniq=Hp,u.sortedUniqBy=qp,u.split=Cm,u.spread=Jx,u.tail=Kp,u.take=Gp,u.takeRight=Vp,u.takeRightWhile=Qp,u.takeWhile=Yp,u.tap=hx,u.throttle=Xx,u.thru=As,u.toArray=Dc,u.toPairs=Wc,u.toPairsIn=Uc,u.toPath=iv,u.toPlainObject=Nc,u.transform=rm,u.unary=Zx,u.union=Jp,u.unionBy=Xp,u.unionWith=Zp,u.uniq=ex,u.uniqBy=tx,u.uniqWith=nx,u.unset=sm,u.unzip=Io,u.unzipWith=jc,u.update=im,u.updateWith=om,u.values=ar,u.valuesIn=am,u.without=rx,u.words=qc,u.wrap=eg,u.xor=sx,u.xorBy=ix,u.xorWith=ox,u.zip=ax,u.zipObject=lx,u.zipObjectDeep=cx,u.zipWith=ux,u.entries=Wc,u.entriesIn=Uc,u.extend=Bc,u.extendWith=Ms,zo(u,u),u.add=av,u.attempt=Kc,u.camelCase=hm,u.capitalize=$c,u.ceil=lv,u.clamp=lm,u.clone=ng,u.cloneDeep=sg,u.cloneDeepWith=ig,u.cloneWith=rg,u.conformsTo=og,u.deburr=Hc,u.defaultTo=Fm,u.divide=cv,u.endsWith=dm,u.eq=$t,u.escape=fm,u.escapeRegExp=pm,u.every=bx,u.find=wx,u.findIndex=xc,u.findKey=Og,u.findLast=Sx,u.findLastIndex=gc,u.findLastKey=Ng,u.floor=uv,u.forEach=_c,u.forEachRight=wc,u.forIn=Bg,u.forInRight=zg,u.forOwn=Fg,u.forOwnRight=Wg,u.get=Po,u.gt=ag,u.gte=lg,u.has=Hg,u.hasIn=Do,u.head=vc,u.identity=bt,u.includes=Ix,u.indexOf=Sp,u.inRange=cm,u.invoke=Gg,u.isArguments=Bn,u.isArray=je,u.isArrayBuffer=cg,u.isArrayLike=yt,u.isArrayLikeObject=Ke,u.isBoolean=ug,u.isBuffer=Sn,u.isDate=hg,u.isElement=dg,u.isEmpty=fg,u.isEqual=pg,u.isEqualWith=xg,u.isError=Lo,u.isFinite=gg,u.isFunction=hn,u.isInteger=Ec,u.isLength=Es,u.isMap=Lc,u.isMatch=mg,u.isMatchWith=vg,u.isNaN=yg,u.isNative=jg,u.isNil=_g,u.isNull=bg,u.isNumber=Mc,u.isObject=He,u.isObjectLike=qe,u.isPlainObject=Pr,u.isRegExp=Mo,u.isSafeInteger=wg,u.isSet=Pc,u.isString=Ls,u.isSymbol=Tt,u.isTypedArray=or,u.isUndefined=Sg,u.isWeakMap=Cg,u.isWeakSet=Ag,u.join=Ip,u.kebabCase=xm,u.last=Nt,u.lastIndexOf=Rp,u.lowerCase=gm,u.lowerFirst=mm,u.lt=Tg,u.lte=kg,u.max=hv,u.maxBy=dv,u.mean=fv,u.meanBy=pv,u.min=xv,u.minBy=gv,u.stubArray=Wo,u.stubFalse=Uo,u.stubObject=tv,u.stubString=nv,u.stubTrue=rv,u.multiply=mv,u.nth=Ep,u.noConflict=Gm,u.noop=Fo,u.now=ks,u.pad=vm,u.padEnd=ym,u.padStart=jm,u.parseInt=bm,u.random=um,u.reduce=Px,u.reduceRight=Dx,u.repeat=_m,u.replace=wm,u.result=em,u.round=vv,u.runInContext=v,u.sample=Nx,u.size=Fx,u.snakeCase=Sm,u.some=Wx,u.sortedIndex=Bp,u.sortedIndexBy=zp,u.sortedIndexOf=Fp,u.sortedLastIndex=Wp,u.sortedLastIndexBy=Up,u.sortedLastIndexOf=$p,u.startCase=Am,u.startsWith=Tm,u.subtract=yv,u.sum=jv,u.sumBy=bv,u.template=km,u.times=sv,u.toFinite=dn,u.toInteger=_e,u.toLength=Oc,u.toLower=Im,u.toNumber=Bt,u.toSafeInteger=Ig,u.toString=De,u.toUpper=Rm,u.trim=Em,u.trimEnd=Lm,u.trimStart=Mm,u.truncate=Pm,u.unescape=Dm,u.uniqueId=ov,u.upperCase=Om,u.upperFirst=Oo,u.each=_c,u.eachRight=wc,u.first=vc,zo(u,function(){var e={};return Gt(u,function(t,r){Oe.call(u.prototype,r)||(e[r]=t)}),e}(),{chain:!1}),u.VERSION=l,Lt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){u[e].placeholder=u}),Lt(["drop","take"],function(e,t){Te.prototype[e]=function(r){r=r===s?1:Xe(_e(r),0);var a=this.__filtered__&&!t?new Te(this):this.clone();return a.__filtered__?a.__takeCount__=it(r,a.__takeCount__):a.__views__.push({size:it(r,P),type:e+(a.__dir__<0?"Right":"")}),a},Te.prototype[e+"Right"]=function(r){return this.reverse()[e](r).reverse()}}),Lt(["filter","map","takeWhile"],function(e,t){var r=t+1,a=r==ge||r==B;Te.prototype[e]=function(c){var h=this.clone();return h.__iteratees__.push({iteratee:de(c,3),type:r}),h.__filtered__=h.__filtered__||a,h}}),Lt(["head","last"],function(e,t){var r="take"+(t?"Right":"");Te.prototype[e]=function(){return this[r](1).value()[0]}}),Lt(["initial","tail"],function(e,t){var r="drop"+(t?"":"Right");Te.prototype[e]=function(){return this.__filtered__?new Te(this):this[r](1)}}),Te.prototype.compact=function(){return this.filter(bt)},Te.prototype.find=function(e){return this.filter(e).head()},Te.prototype.findLast=function(e){return this.reverse().find(e)},Te.prototype.invokeMap=Se(function(e,t){return typeof e=="function"?new Te(this):this.map(function(r){return kr(r,e,t)})}),Te.prototype.reject=function(e){return this.filter(Rs(de(e)))},Te.prototype.slice=function(e,t){e=_e(e);var r=this;return r.__filtered__&&(e>0||t<0)?new Te(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),t!==s&&(t=_e(t),r=t<0?r.dropRight(-t):r.take(t-e)),r)},Te.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Te.prototype.toArray=function(){return this.take(P)},Gt(Te.prototype,function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),a=/^(?:head|last)$/.test(t),c=u[a?"take"+(t=="last"?"Right":""):t],h=a||/^find/.test(t);c&&(u.prototype[t]=function(){var f=this.__wrapped__,g=a?[1]:arguments,y=f instanceof Te,D=g[0],N=y||je(f),$=function(Ce){var ke=c.apply(u,mn([Ce],g));return a&&oe?ke[0]:ke};N&&r&&typeof D=="function"&&D.length!=1&&(y=N=!1);var oe=this.__chain__,ce=!!this.__actions__.length,pe=h&&!oe,we=y&&!ce;if(!h&&N){f=we?f:new Te(this);var xe=e.apply(f,g);return xe.__actions__.push({func:As,args:[$],thisArg:s}),new Pt(xe,oe)}return pe&&we?e.apply(this,g):(xe=this.thru($),pe?a?xe.value()[0]:xe.value():xe)})}),Lt(["pop","push","shift","sort","splice","unshift"],function(e){var t=Xr[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",a=/^(?:pop|shift)$/.test(e);u.prototype[e]=function(){var c=arguments;if(a&&!this.__chain__){var h=this.value();return t.apply(je(h)?h:[],c)}return this[r](function(f){return t.apply(je(f)?f:[],c)})}}),Gt(Te.prototype,function(e,t){var r=u[t];if(r){var a=r.name+"";Oe.call(tr,a)||(tr[a]=[]),tr[a].push({name:t,func:r})}}),tr[ys(s,_).name]=[{name:"wrapper",func:s}],Te.prototype.clone=Pd,Te.prototype.reverse=Dd,Te.prototype.value=Od,u.prototype.at=dx,u.prototype.chain=fx,u.prototype.commit=px,u.prototype.next=xx,u.prototype.plant=mx,u.prototype.reverse=vx,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=yx,u.prototype.first=u.prototype.head,br&&(u.prototype[br]=gx),u},Xn=fd();Rn?((Rn.exports=Xn)._=Xn,Ni._=Xn):tt._=Xn}).call(Dr)})(Zs,Zs.exports);var s1=Zs.exports;const i1=({value:o,onChange:i,onKeyPress:s,placeholder:l="Type a message...",disabled:d=!1,multiline:m=!0,maxRows:b=4,conversationId:j,patientId:C,autoFocus:V=!1})=>{const[I,O]=p.useState([]),[q,X]=p.useState(!1),[Q,U]=p.useState(0),[W,_]=p.useState(""),[Y,H]=p.useState(-1),[M,T]=p.useState(!1),[J,re]=p.useState([]),te=p.useRef(null),G=p.useRef(null),Z=p.useCallback(s1.debounce(async z=>{if(!z.trim()){O([]),T(!1);return}T(!0);try{const se=await fetch(`/api/mentions/conversations/${j}/suggestions?query=${encodeURIComponent(z)}&limit=10`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!se.ok)throw new Error(`Failed to fetch suggestions: ${se.statusText}`);const F=await se.json();O(F.data||[])}catch(se){console.error("Error fetching user suggestions:",se),O([])}finally{T(!1)}},300),[j,C]),k=p.useCallback(z=>{const se=/@\[([^\]]+)\]\(([^)]+)\)/g,F=[];let L;for(;(L=se.exec(z))!==null;)F.push(L[2]);return F},[]),K=z=>{const se=z.target.value,F=z.target.selectionStart||0,L=se.substring(0,F),P=L.lastIndexOf("@");if(P!==-1){const be=L.substring(P+1);!be.includes(" ")&&!be.includes(`
`)?(H(P),_(be),X(!0),U(0),Z(be)):(X(!1),H(-1),_(""))}else X(!1),H(-1),_("");const ie=k(se);re(ie),i(se,ie)},le=z=>{if(Y===-1)return;const se=o.substring(0,Y),F=o.substring(Y+W.length+1),L=`@[${z.displayName}](${z._id})`,P=se+L+F,ie=k(P);re(ie),i(P,ie),X(!1),H(-1),_(""),setTimeout(()=>{var ze,he;(ze=te.current)==null||ze.focus();const be=se.length+L.length;(he=te.current)==null||he.setSelectionRange(be,be)},0)},ge=z=>{if(q&&I.length>0)switch(z.key){case"ArrowDown":z.preventDefault(),U(se=>se<I.length-1?se+1:0);break;case"ArrowUp":z.preventDefault(),U(se=>se>0?se-1:I.length-1);break;case"Enter":I[Q]&&(z.preventDefault(),le(I[Q]));break;case"Escape":z.preventDefault(),X(!1);break}s&&z.key==="Enter"&&!q&&s(z)},ye=z=>{switch(z){case"doctor":return n.jsx(Ur,{});case"pharmacist":return n.jsx(Ys,{});case"patient":return n.jsx(xt,{});default:return n.jsx(xt,{})}},B=z=>{switch(z){case"doctor":return"primary.main";case"pharmacist":return"secondary.main";case"patient":return"info.main";default:return"grey.500"}};return p.useEffect(()=>{const z=se=>{G.current&&!G.current.contains(se.target)&&te.current&&!te.current.contains(se.target)&&X(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[]),n.jsxs(x,{sx:{position:"relative",width:"100%"},children:[n.jsx(_t,{ref:te,fullWidth:!0,multiline:m,maxRows:b,value:o,onChange:K,onKeyDown:ge,placeholder:l,disabled:d,autoFocus:V,variant:"outlined",size:"small",sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}),q&&n.jsx(st,{ref:G,sx:{position:"absolute",top:"100%",left:0,right:0,zIndex:1e3,maxHeight:200,overflow:"auto",mt:1,border:1,borderColor:"divider"},children:M?n.jsxs(x,{sx:{p:2,textAlign:"center"},children:[n.jsx(ur,{size:20}),n.jsx(S,{variant:"caption",sx:{ml:1},children:"Searching users..."})]}):I.length===0?n.jsx(x,{sx:{p:2,textAlign:"center"},children:n.jsxs(S,{variant:"body2",color:"text.secondary",children:['No users found for "',W,'"']})}):n.jsx(dr,{dense:!0,children:I.map((z,se)=>n.jsxs(mr,{button:!0,selected:se===Q,onClick:()=>le(z),sx:{"&.Mui-selected":{bgcolor:"action.selected"}},children:[n.jsx(di,{children:n.jsx(gt,{sx:{bgcolor:B(z.role),width:32,height:32},children:z.avatar?n.jsx("img",{src:z.avatar,alt:z.displayName,style:{width:"100%",height:"100%"}}):ye(z.role)})}),n.jsx(fi,{primary:n.jsx(S,{variant:"body2",fontWeight:"medium",children:z.displayName}),secondary:n.jsx(S,{variant:"caption",color:"text.secondary",children:z.subtitle})})]},z._id))})})]})},ya=({conversationId:o,messages:i,onSendMessage:s,loading:l=!1,error:d=null,threadId:m,parentMessage:b,maxHeight:j="100%"})=>{var se,F;const[C,V]=p.useState(""),[I,O]=p.useState([]),[q,X]=p.useState([]),[Q,U]=p.useState(!1),[W,_]=p.useState(!1),Y=p.useRef(null),H=p.useRef(null),M=p.useRef(null),T=p.useRef(),{isConnected:J}=va();p.useEffect(()=>{Y.current&&(Y.current.scrollTop=Y.current.scrollHeight)},[i]);const re=()=>{!Q&&J&&(U(!0),et.startTyping(o)),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{te()},3e3)},te=()=>{Q&&(U(!1),et.stopTyping(o)),T.current&&clearTimeout(T.current)},G=(L,P)=>{V(L),X(P),L.trim()?re():te()},Z=async()=>{var L;if(!(!C.trim()&&I.length===0||W)){_(!0),te();try{await s(C,I.length>0?I:void 0,m,b==null?void 0:b._id,q.length>0?q:void 0),V(""),O([]),X([]),(L=H.current)==null||L.focus()}catch(P){console.error("Failed to send message:",P)}finally{_(!1)}}},k=L=>{L.key==="Enter"&&!L.shiftKey&&(L.preventDefault(),Z())},K=L=>{const P=Array.from(L.target.files||[]);O(ie=>[...ie,...P]),M.current&&(M.current.value="")},le=L=>{O(P=>P.filter((ie,be)=>be!==L))},ge=L=>{var P;(P=H.current)==null||P.focus()},ye=async L=>{try{const P=await fetch(`/api/communication/messages/${L}/thread`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!P.ok)throw new Error("Failed to create thread");const ie=await P.json();console.log("Thread created:",ie.data.threadId)}catch(P){console.error("Failed to create thread:",P)}},B=L=>{console.log("View thread:",L)},z=m?i.filter(L=>L.threadId===m):i.filter(L=>!L.threadId);return n.jsxs(x,{sx:{height:j,display:"flex",flexDirection:"column",overflow:"hidden"},children:[m&&b&&n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsx(S,{variant:"subtitle2",color:"primary",gutterBottom:!0,children:"Thread"}),n.jsx(x,{sx:{pl:2,borderLeft:2,borderColor:"primary.main"},children:n.jsxs(S,{variant:"body2",color:"text.secondary",children:["Replying to: ",(se=b.content.text)==null?void 0:se.substring(0,100),(((F=b.content.text)==null?void 0:F.length)||0)>100?"...":""]})})]}),d&&n.jsx(xn,{severity:"error",sx:{m:1},children:d}),n.jsx(x,{ref:Y,sx:{flex:1,overflow:"auto",p:1,display:"flex",flexDirection:"column",gap:1},children:l&&z.length===0?n.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:n.jsx(ur,{})}):z.length===0?n.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",textAlign:"center"},children:n.jsx(S,{variant:"body2",color:"text.secondary",children:m?"No replies yet":"No messages yet. Start the conversation!"})}):z.map((L,P)=>{const ie=P>0?z[P-1]:null,be=ie&&new Date(L.createdAt).toDateString()!==new Date(ie.createdAt).toDateString();return n.jsxs(hr.Fragment,{children:[be&&n.jsx(x,{sx:{my:2},children:n.jsx(pn,{children:n.jsx(S,{variant:"caption",color:"text.secondary",children:new Date(L.createdAt).toLocaleDateString()})})}),n.jsx(ia,{message:L,showAvatar:!ie||ie.senderId!==L.senderId,showTimestamp:!0,onReply:()=>ge(),onEdit:(ze,he)=>{console.log("Edit message:",ze,he)},onDelete:ze=>{console.log("Delete message:",ze)},onReaction:(ze,he)=>{console.log("Add reaction:",ze,he)},onCreateThread:ye,onViewThread:B,showThreading:!m,conversationId:o})]},L._id)})}),n.jsxs(x,{sx:{p:2,borderTop:1,borderColor:"divider"},children:[I.length>0&&n.jsx(x,{sx:{mb:1},children:I.map((L,P)=>n.jsxs(st,{variant:"outlined",sx:{p:1,mb:1,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsx(S,{variant:"body2",noWrap:!0,children:L.name}),n.jsx(ve,{size:"small",onClick:()=>le(P),children:""})]},P))}),n.jsxs(x,{sx:{display:"flex",alignItems:"flex-end",gap:1},children:[n.jsx("input",{ref:M,type:"file",multiple:!0,style:{display:"none"},onChange:K}),n.jsx(ve,{size:"small",onClick:()=>{var L;return(L=M.current)==null?void 0:L.click()},disabled:W,children:n.jsx(vu,{})}),n.jsx(i1,{value:C,onChange:G,onKeyPress:k,placeholder:m?"Reply to thread...":"Type a message...",disabled:W||!J,multiline:!0,maxRows:4,conversationId:o,autoFocus:!1}),n.jsx(ve,{size:"small",disabled:W,children:n.jsx(da,{})}),n.jsx(ve,{color:"primary",onClick:Z,disabled:!C.trim()&&I.length===0||W||!J,sx:{bgcolor:"primary.main",color:"primary.contrastText","&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"action.disabledBackground",color:"action.disabled"}},children:W?n.jsx(ur,{size:20,color:"inherit"}):n.jsx(du,{})})]}),!J&&n.jsx(S,{variant:"caption",color:"warning.main",sx:{mt:1,display:"block"},children:"Offline - Messages will be sent when connection is restored"})]})]})},Bu=({conversation:o,onAddParticipant:i,onRemoveParticipant:s,onChangeRole:l,canManageParticipants:d=!0})=>{const[m,b]=p.useState(!1),[j,C]=p.useState(null),[V,I]=p.useState("pharmacist"),[O,q]=p.useState(null),[X,Q]=p.useState(null),[U]=p.useState([{id:"1",firstName:"John",lastName:"Doe",email:"john.doe@example.com",role:"pharmacist"},{id:"2",firstName:"Jane",lastName:"Smith",email:"jane.smith@example.com",role:"doctor"},{id:"3",firstName:"Bob",lastName:"Johnson",email:"bob.johnson@example.com",role:"patient"}]),W=!!O,_=Z=>{switch(Z){case"pharmacist":return n.jsx(Ys,{fontSize:"small"});case"doctor":return n.jsx(Ur,{fontSize:"small"});case"patient":return n.jsx(xt,{fontSize:"small"});case"admin":return n.jsx(Pv,{fontSize:"small"});default:return n.jsx(xt,{fontSize:"small"})}},Y=Z=>{switch(Z){case"pharmacist":return"primary";case"doctor":return"secondary";case"patient":return"default";case"admin":return"error";default:return"default"}},H=Z=>Math.random()>.5,M=()=>{j&&V&&(i==null||i(j.id,V),b(!1),C(null),I("pharmacist"))},T=(Z,k)=>{q(Z.currentTarget),Q(k)},J=()=>{q(null),Q(null)},re=()=>{X&&(s==null||s(X)),J()},te=Z=>{X&&(l==null||l(X,Z)),J()},G=U.filter(Z=>!o.participants.some(k=>k.userId===Z.id));return n.jsxs(x,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs(S,{variant:"h6",children:["Participants (",o.participants.length,")"]}),d&&n.jsx(Ee,{title:"Add participant",children:n.jsx(ve,{size:"small",onClick:()=>b(!0),color:"primary",children:n.jsx(iy,{})})})]}),n.jsxs(x,{sx:{mt:1},children:[n.jsxs(S,{variant:"caption",color:"text.secondary",children:[o.type==="patient_query"&&"Patient Query",o.type==="group"&&"Group Chat",o.type==="direct"&&"Direct Message"]}),o.priority!=="normal"&&n.jsx(Ne,{label:o.priority,size:"small",color:o.priority==="urgent"?"error":"warning",sx:{ml:1,height:20,fontSize:"0.75rem"}})]})]}),n.jsx(x,{sx:{flex:1,overflow:"auto"},children:n.jsx(dr,{dense:!0,children:o.participants.map(Z=>{const k=H(Z.userId);return n.jsxs(mr,{children:[n.jsx(di,{children:n.jsxs(x,{sx:{position:"relative"},children:[n.jsx(gt,{sx:{width:40,height:40},children:"U"}),n.jsx(Ky,{sx:{position:"absolute",bottom:0,right:0,width:12,height:12,color:k?"success.main":"grey.400",bgcolor:"background.paper",borderRadius:"50%",border:2,borderColor:"background.paper"}})]})}),n.jsx(fi,{primary:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(S,{variant:"body2",fontWeight:"medium",children:"User Name"}),n.jsx(Ne,{icon:_(Z.role),label:Z.role,size:"small",color:Y(Z.role),variant:"outlined",sx:{height:20,fontSize:"0.75rem"}})]}),secondary:n.jsxs(x,{children:[n.jsx(S,{variant:"caption",color:"text.secondary",children:"user@example.com"}),n.jsx("br",{}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Joined"," ",new Date(Z.joinedAt).toLocaleDateString()]})]})}),d&&n.jsx(aa,{children:n.jsx(ve,{size:"small",onClick:K=>T(K,Z.userId),children:n.jsx(Kn,{fontSize:"small"})})})]},Z.userId)})})}),n.jsxs(li,{open:m,onClose:()=>b(!1),maxWidth:"sm",fullWidth:!0,children:[n.jsx(ci,{children:"Add Participant"}),n.jsx(ui,{children:n.jsxs(x,{sx:{mt:1},children:[n.jsx(Xo,{options:G,getOptionLabel:Z=>`${Z.firstName} ${Z.lastName} (${Z.email})`,value:j,onChange:(Z,k)=>C(k),renderInput:Z=>n.jsx(_t,{...Z,label:"Select User",placeholder:"Search by name or email",fullWidth:!0}),renderOption:(Z,k)=>n.jsxs(x,{component:"li",...Z,children:[n.jsxs(gt,{sx:{mr:2,width:32,height:32},children:[k.firstName[0],k.lastName[0]]}),n.jsxs(x,{children:[n.jsxs(S,{variant:"body2",children:[k.firstName," ",k.lastName]}),n.jsx(S,{variant:"caption",color:"text.secondary",children:k.email})]})]})}),n.jsxs(_t,{select:!0,label:"Role",value:V,onChange:Z=>I(Z.target.value),fullWidth:!0,sx:{mt:2},children:[n.jsx(ee,{value:"pharmacist",children:"Pharmacist"}),n.jsx(ee,{value:"doctor",children:"Doctor"}),n.jsx(ee,{value:"patient",children:"Patient"})]})]})}),n.jsxs(hi,{children:[n.jsx(We,{onClick:()=>b(!1),children:"Cancel"}),n.jsx(We,{onClick:M,variant:"contained",disabled:!j,children:"Add Participant"})]})]}),n.jsxs(tn,{anchorEl:O,open:W,onClose:J,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[n.jsxs(ee,{onClick:()=>te("pharmacist"),children:[n.jsx(Ys,{fontSize:"small",sx:{mr:1}}),"Make Pharmacist"]}),n.jsxs(ee,{onClick:()=>te("doctor"),children:[n.jsx(Ur,{fontSize:"small",sx:{mr:1}}),"Make Doctor"]}),n.jsxs(ee,{onClick:()=>te("patient"),children:[n.jsx(xt,{fontSize:"small",sx:{mr:1}}),"Make Patient"]}),n.jsx(pn,{}),n.jsxs(ee,{onClick:re,sx:{color:"error.main"},children:[n.jsx(Jy,{fontSize:"small",sx:{mr:1}}),"Remove Participant"]})]})]})},o1=({showDetails:o=!1,size:i="small",variant:s="chip"})=>{const{connectionStatus:l,isConnected:d,connectionInfo:m}=va(),j=(V=>{switch(V){case"connected":return{color:"success",icon:n.jsx(r0,{fontSize:i}),label:"Connected",tooltip:"Real-time messaging is active"};case"connecting":return{color:"warning",icon:n.jsx(Xc,{fontSize:i,className:"animate-spin"}),label:"Connecting",tooltip:"Establishing connection..."};case"reconnecting":return{color:"warning",icon:n.jsx(Xc,{fontSize:i,className:"animate-spin"}),label:"Reconnecting",tooltip:"Attempting to reconnect..."};case"disconnected":return{color:"default",icon:n.jsx(Jc,{fontSize:i}),label:"Disconnected",tooltip:"Real-time messaging is offline"};case"error":return{color:"error",icon:n.jsx(pt,{fontSize:i}),label:"Error",tooltip:"Connection error occurred"};default:return{color:"default",icon:n.jsx(Jc,{fontSize:i}),label:"Unknown",tooltip:"Connection status unknown"}}})(l),C=()=>{et.forceReconnect()};return s==="icon"?n.jsx(Ee,{title:j.tooltip,children:n.jsx(x,{sx:{display:"flex",alignItems:"center",color:j.color==="success"?"success.main":j.color==="warning"?"warning.main":j.color==="error"?"error.main":"text.secondary"},children:j.icon})}):s==="chip"?n.jsx(Ee,{title:j.tooltip,children:n.jsx(Ne,{icon:j.icon,label:j.label,color:j.color,size:i,variant:d?"filled":"outlined"})}):n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,p:1,borderRadius:1,bgcolor:"background.paper",border:1,borderColor:"divider"},children:[n.jsx(x,{sx:{display:"flex",alignItems:"center",color:j.color==="success"?"success.main":j.color==="warning"?"warning.main":j.color==="error"?"error.main":"text.secondary"},children:j.icon}),n.jsxs(x,{sx:{flex:1},children:[n.jsx(x,{sx:{fontWeight:"medium",fontSize:"0.875rem"},children:j.label}),o&&n.jsxs(x,{sx:{fontSize:"0.75rem",color:"text.secondary"},children:[m.socketId&&n.jsxs("div",{children:["Socket ID: ",m.socketId.slice(0,8),"..."]}),m.reconnectAttempts>0&&n.jsxs("div",{children:["Reconnect attempts: ",m.reconnectAttempts]}),m.joinedConversations.length>0&&n.jsxs("div",{children:["Active conversations:"," ",m.joinedConversations.length]})]})]}),!d&&n.jsx(Ee,{title:"Retry connection",children:n.jsx(ve,{size:"small",onClick:C,sx:{ml:1},children:n.jsx(pi,{fontSize:"small"})})})]})},a1=({conversationId:o,participants:i=[],variant:s="compact",maxVisible:l=3})=>{const{typingUsers:d}=e1(o),[m,b]=p.useState(0);if(p.useEffect(()=>{d.length>0&&b(I=>I+1)},[d]),d.length===0)return null;const j=d.map(I=>i.find(O=>O.userId===I)).filter(Boolean).slice(0,l),C=Math.max(0,d.length-l),V=()=>{if(j.length===0)return`${d.length} user${d.length>1?"s":""} typing...`;const I=j.map(O=>O.firstName);if(I.length===1)return`${I[0]} is typing...`;if(I.length===2)return`${I[0]} and ${I[1]} are typing...`;{const O=I.slice(0,2).join(", "),q=I.length-2+C;return`${O} and ${q} other${q>1?"s":""} are typing...`}};return s==="avatars"?n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5,p:1,animation:"fadeInUp 0.3s ease-out","@keyframes fadeInUp":{from:{opacity:0,transform:"translateY(10px)"},to:{opacity:1,transform:"translateY(0)"}}},children:[n.jsxs(x,{sx:{display:"flex",gap:.5},children:[j.map((I,O)=>n.jsxs(gt,{src:I.avatar,sx:{width:24,height:24,fontSize:"0.75rem",animation:`pulse 1.5s ease-in-out infinite ${O*.2}s`,"@keyframes pulse":{"0%, 100%":{opacity:1},"50%":{opacity:.5}}},children:[I.firstName[0],I.lastName[0]]},I.userId)),C>0&&n.jsx(Ne,{label:`+${C}`,size:"small",sx:{height:24,fontSize:"0.75rem",animation:"pulse 1.5s ease-in-out infinite"}})]}),n.jsx(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:n.jsx(Vo,{})})]},m):s==="full"?n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,p:1.5,bgcolor:"action.hover",borderRadius:1,animation:"fadeInUp 0.3s ease-out"},children:[n.jsx(x,{sx:{display:"flex",gap:.5},children:j.slice(0,3).map((I,O)=>n.jsxs(gt,{src:I.avatar,sx:{width:32,height:32,fontSize:"0.875rem",animation:`pulse 1.5s ease-in-out infinite ${O*.2}s`},children:[I.firstName[0],I.lastName[0]]},I.userId))}),n.jsx(x,{sx:{flex:1},children:n.jsx(S,{variant:"body2",color:"text.secondary",children:V()})}),n.jsx(Vo,{})]},m):n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,px:2,py:.5,animation:"fadeInUp 0.3s ease-out"},children:[n.jsx(S,{variant:"caption",color:"text.secondary",children:V()}),n.jsx(Vo,{size:"small"})]},m)},Vo=({size:o="medium"})=>{const i=o==="small"?4:6,s=o==="small"?12:16;return n.jsx(x,{sx:{display:"flex",alignItems:"center",gap:.5,height:s},children:[0,1,2].map(l=>n.jsx(x,{sx:{width:i,height:i,borderRadius:"50%",bgcolor:"text.secondary",animation:`typingDot 1.4s ease-in-out infinite ${l*.2}s`,"@keyframes typingDot":{"0%, 80%, 100%":{transform:"scale(0.8)",opacity:.5},"40%":{transform:"scale(1)",opacity:1}}}},l))})},lu=({conversationId:o,patientId:i,height:s="600px",showParticipants:l=!0,showHeader:d=!0,onConversationAction:m})=>{const{activeConversation:b,messages:j,messageLoading:C,setActiveConversation:V,fetchMessages:I,sendMessage:O,markConversationAsRead:q,loading:X,errors:Q}=Ft(),{isConnected:U}=va(),[W,_]=p.useState(!1),Y=p.useRef(null),H=j[o]||[],M=(b==null?void 0:b._id)===o?b:null,T=()=>{var G;(G=Y.current)==null||G.scrollIntoView({behavior:"smooth"})};p.useEffect(()=>{T()},[H]),p.useEffect(()=>{o&&(I(o),q(o))},[o,I,q]);const J=async(G,Z,k,K,le)=>{if(!G.trim()&&(!Z||Z.length===0))return;const ge={conversationId:o,content:{text:G.trim(),type:"text",attachments:Z},threadId:k,parentMessageId:K,mentions:le};await O(ge)},te=(()=>{if(!M)return null;switch(M.status){case"resolved":return{icon:n.jsx(Kt,{color:"success"}),text:"Resolved",color:"success.main"};case"archived":return{icon:n.jsx($n,{color:"disabled"}),text:"Archived",color:"text.disabled"};default:return null}})();return!M&&!C?n.jsx(st,{sx:{height:s,display:"flex",alignItems:"center",justifyContent:"center",p:3},children:n.jsxs(x,{textAlign:"center",children:[n.jsx(pt,{color:"error",sx:{fontSize:48,mb:2}}),n.jsx(S,{variant:"h6",color:"error",gutterBottom:!0,children:"Conversation not found"}),n.jsx(S,{variant:"body2",color:"text.secondary",children:"The conversation you're looking for doesn't exist or you don't have access to it."})]})}):n.jsxs(st,{sx:{height:s,display:"flex",flexDirection:"column",overflow:"hidden"},children:[d&&M&&n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider",display:"flex",alignItems:"center",gap:2},children:[n.jsxs(x,{sx:{flex:1},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(S,{variant:"h6",noWrap:!0,children:M.title||"Conversation"}),te&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5,color:te.color},children:[te.icon,n.jsx(S,{variant:"caption",children:te.text})]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mt:.5},children:[n.jsxs(S,{variant:"caption",color:"text.secondary",children:[M.participants.length," participant",M.participants.length!==1?"s":""]}),M.priority!=="normal"&&n.jsx(S,{variant:"caption",sx:{px:1,py:.25,borderRadius:1,bgcolor:M.priority==="urgent"?"error.light":"warning.light",color:M.priority==="urgent"?"error.contrastText":"warning.contrastText",textTransform:"uppercase",fontWeight:"bold"},children:M.priority}),n.jsx(o1,{variant:"icon",size:"small"})]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[l&&n.jsx(Ee,{title:"Show participants",children:n.jsx(ve,{size:"small",onClick:()=>_(!W),color:W?"primary":"default",children:n.jsx(xi,{})})}),n.jsx(Ee,{title:"More options",children:n.jsx(ve,{size:"small",children:n.jsx(Kn,{})})})]})]}),!U&&n.jsx(xn,{severity:"warning",sx:{m:1},children:"You're currently offline. Messages will be sent when connection is restored."}),n.jsxs(x,{sx:{display:"flex",flex:1,overflow:"hidden"},children:[n.jsxs(x,{sx:{flex:1,display:"flex",flexDirection:"column"},children:[n.jsx(x,{sx:{flex:1,overflow:"hidden"},children:n.jsx(ya,{conversationId:o,messages:H,onSendMessage:J,loading:C||X.fetchMessages,error:Q.fetchMessages})}),n.jsx(a1,{conversationId:o,participants:M==null?void 0:M.participants.map(G=>({userId:G.userId,firstName:"User",lastName:""})),variant:"compact"}),n.jsx("div",{ref:Y})]}),l&&W&&M&&n.jsxs(n.Fragment,{children:[n.jsx(pn,{orientation:"vertical"}),n.jsx(x,{sx:{width:280,flexShrink:0},children:n.jsx(Bu,{conversation:M,onAddParticipant:(G,Z)=>{console.log("Add participant:",G,Z)},onRemoveParticipant:G=>{console.log("Remove participant:",G)}})})]})]})]})},l1=({conversation:o,selected:i=!1,onClick:s,onAction:l,compact:d=!1})=>{const{messages:m}=Ft(),[b,j]=p.useState(null),V=(m[o._id]||[]).filter(M=>M.status!=="read").length,I=()=>{switch(o.type){case"group":return n.jsx(Yo,{fontSize:"small"});case"patient_query":return n.jsx(yu,{fontSize:"small"});default:return n.jsx(xt,{fontSize:"small"})}},O=()=>{switch(o.status){case"resolved":return"success.main";case"archived":return"text.disabled";default:return"text.primary"}},q=()=>{switch(o.priority){case"urgent":return"error.main";case"high":return"warning.main";case"low":return"info.main";default:return"text.secondary"}},X=()=>{try{return Hn(new Date(o.lastMessageAt),{addSuffix:!0})}catch{return"Unknown"}},Q=()=>{if(o.title)return o.title;switch(o.type){case"patient_query":return"Patient Query";case"group":return`Group Chat (${o.participants.length})`;default:return"Direct Message"}},U=()=>o.participants.map(T=>T.role).filter((T,J,re)=>re.indexOf(T)===J).join(", "),W=M=>{j(null),l==null||l(M,o._id)},_=M=>{M.stopPropagation(),j(M.currentTarget)},H=(()=>{const M=[];return o.status==="active"&&M.push({key:"archive",label:"Archive",icon:n.jsx($n,{fontSize:"small"})},{key:"resolve",label:"Mark as Resolved",icon:n.jsx(Kt,{fontSize:"small"})}),o.status==="archived"&&M.push({key:"unarchive",label:"Unarchive",icon:n.jsx(e0,{fontSize:"small"})}),M.push({key:"delete",label:"Delete",icon:n.jsx(Qs,{fontSize:"small"}),danger:!0}),M})();return n.jsxs(n.Fragment,{children:[n.jsx(Dv,{selected:i,onClick:s,sx:{width:"100%",p:d?1:2,borderRadius:1,mb:.5,"&.Mui-selected":{bgcolor:"primary.light","&:hover":{bgcolor:"primary.light"}}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",width:"100%",gap:2},children:[n.jsxs(x,{sx:{position:"relative"},children:[o.type==="group"?n.jsx(_u,{max:2,sx:{"& .MuiAvatar-root":{width:32,height:32}},children:o.participants.slice(0,2).map((M,T)=>n.jsx(gt,{sx:{bgcolor:"primary.main"},children:M.role.charAt(0).toUpperCase()},M.userId))}):n.jsx(gt,{sx:{bgcolor:"primary.main",width:40,height:40},children:I()}),o.priority==="urgent"&&n.jsx($r,{sx:{position:"absolute",top:-4,right:-4,color:"error.main",fontSize:16}})]}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[n.jsx(S,{variant:d?"body2":"subtitle2",noWrap:!0,sx:{flex:1,fontWeight:V>0?"bold":"normal",color:O()},children:Q()}),o.status==="resolved"&&n.jsx(Kt,{sx:{fontSize:16,color:"success.main"}}),o.status==="archived"&&n.jsx($n,{sx:{fontSize:16,color:"text.disabled"}})]}),!d&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[n.jsx(S,{variant:"caption",color:"text.secondary",noWrap:!0,sx:{flex:1},children:U()}),o.priority!=="normal"&&n.jsx(Ne,{label:o.priority,size:"small",sx:{height:16,fontSize:"0.625rem",bgcolor:q(),color:"white"}})]}),!d&&o.tags&&o.tags.length>0&&n.jsxs(x,{sx:{display:"flex",gap:.5,mb:.5,flexWrap:"wrap"},children:[o.tags.slice(0,2).map(M=>n.jsx(Ne,{label:M,size:"small",variant:"outlined",sx:{height:16,fontSize:"0.625rem"}},M)),o.tags.length>2&&n.jsxs(S,{variant:"caption",color:"text.secondary",children:["+",o.tags.length-2," more"]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Hr,{sx:{fontSize:12,color:"text.secondary"}}),n.jsx(S,{variant:"caption",color:"text.secondary",children:X()})]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[V>0&&n.jsx(qn,{badgeContent:V,color:"primary",max:99,sx:{"& .MuiBadge-badge":{fontSize:"0.625rem",height:16,minWidth:16}}}),n.jsx(Ee,{title:"More options",children:n.jsx(ve,{size:"small",onClick:_,sx:{opacity:i?1:.7},children:n.jsx(Kn,{fontSize:"small"})})})]})]})}),n.jsx(tn,{anchorEl:b,open:!!b,onClose:()=>j(null),onClick:M=>M.stopPropagation(),children:H.map(M=>n.jsx(ee,{onClick:()=>W(M.key),sx:{color:M.danger?"error.main":"inherit"},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[M.icon,M.label]})},M.key))})]})},zu=({open:o,onClose:i,patientId:s,onConversationCreated:l})=>{const{createConversation:d,loading:m,errors:b}=Ft(),{data:j}=ay()||{data:null},C=hr.useMemo(()=>j?Array.isArray(j)?j:j.data&&Array.isArray(j.data)?j.data:j.results&&Array.isArray(j.results)?j.results:j.patients&&Array.isArray(j.patients)?j.patients:[]:[],[j]),[V,I]=p.useState(0),[O,q]=p.useState("direct"),[X,Q]=p.useState(""),[U,W]=p.useState(s||""),[_,Y]=p.useState([]),[H,M]=p.useState("normal"),[T,J]=p.useState([]),[re,te]=p.useState(""),[G,Z]=p.useState(""),k=[{userId:"pharmacist-1",firstName:"Dr. Sarah",lastName:"Johnson",email:"sarah.johnson@pharmacy.com",role:"pharmacist"},{userId:"pharmacist-2",firstName:"Dr. Michael",lastName:"Chen",email:"michael.chen@pharmacy.com",role:"pharmacist"},{userId:"doctor-1",firstName:"Dr. Emily",lastName:"Rodriguez",email:"emily.rodriguez@hospital.com",role:"doctor"},{userId:"doctor-2",firstName:"Dr. James",lastName:"Wilson",email:"james.wilson@clinic.com",role:"doctor"}],K=C.map(w=>({userId:w._id,firstName:w.firstName,lastName:w.lastName,email:w.email||"",role:"patient"})),le=[...k,...K],ge=["Type & Details","Participants","Settings"];p.useEffect(()=>{o&&(I(0),q(s?"patient_query":"direct"),Q(""),W(s||""),Y([]),M("normal"),J([]),te(""),Z(""))},[o,s]);const ye=w=>{_.some(ne=>ne.userId===w.userId)||Y(ne=>[...ne,{userId:w.userId,role:w.role,permissions:z(w.role)}])},B=w=>{Y(R=>R.filter(ne=>ne.userId!==w))},z=w=>{switch(w){case"pharmacist":return["read","write","manage_medications"];case"doctor":return["read","write","manage_diagnosis"];case"patient":return["read","write"];default:return["read"]}},se=w=>{const R=le.find(ne=>ne.userId===w);return R?`${R.firstName} ${R.lastName}`:"Unknown"},F=w=>{const R=le.find(ne=>ne.userId===w);return(R==null?void 0:R.role)||"unknown"},L=w=>{switch(w){case 0:return O!==void 0&&(O!=="patient_query"||U!=="");case 1:return _.length>0;case 2:return!0;default:return!1}},P=()=>{V<ge.length-1&&I(w=>w+1)},ie=()=>{V>0&&I(w=>w-1)},be=async()=>{try{const w={type:O,title:X||void 0,participants:_,patientId:U||void 0,caseId:re||void 0,priority:H,tags:T.length>0?T:void 0},R=await d(w);R&&(l==null||l(R),i())}catch(w){console.error("Failed to create conversation:",w)}},ze=le.filter(w=>{const R=G.toLowerCase(),ne=`${w.firstName} ${w.lastName}`.toLowerCase(),Ae=w.email.toLowerCase();return ne.includes(R)||Ae.includes(R)||w.role.includes(R)}),he=w=>{switch(w){case 0:return n.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[n.jsxs(Jt,{fullWidth:!0,children:[n.jsx(Xt,{children:"Conversation Type"}),n.jsxs(Zt,{value:O,label:"Conversation Type",onChange:R=>q(R.target.value),children:[n.jsx(ee,{value:"direct",children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(xt,{}),n.jsxs(x,{children:[n.jsx(S,{children:"Direct Message"}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"One-on-one conversation"})]})]})}),n.jsx(ee,{value:"group",children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Yo,{}),n.jsxs(x,{children:[n.jsx(S,{children:"Group Chat"}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Multi-participant conversation"})]})]})}),n.jsx(ee,{value:"patient_query",children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(yu,{}),n.jsxs(x,{children:[n.jsx(S,{children:"Patient Query"}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Patient-initiated conversation"})]})]})})]})]}),n.jsx(_t,{fullWidth:!0,label:"Conversation Title (Optional)",value:X,onChange:R=>Q(R.target.value),placeholder:"Enter a descriptive title..."}),O==="patient_query"&&n.jsx(Xo,{options:K,getOptionLabel:R=>`${R.firstName} ${R.lastName}`,value:K.find(R=>R.userId===U)||null,onChange:(R,ne)=>W((ne==null?void 0:ne.userId)||""),renderInput:R=>n.jsx(_t,{...R,label:"Select Patient",required:!0}),renderOption:(R,ne)=>n.jsxs(x,{component:"li",...R,children:[n.jsx(gt,{sx:{mr:2,bgcolor:"primary.main"},children:n.jsx(xt,{})}),n.jsxs(x,{children:[n.jsxs(S,{children:[ne.firstName," ",ne.lastName]}),n.jsx(S,{variant:"caption",color:"text.secondary",children:ne.email})]})]})}),n.jsx(_t,{fullWidth:!0,label:"Case ID (Optional)",value:re,onChange:R=>te(R.target.value),placeholder:"Link to clinical case..."})]});case 1:return n.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[n.jsx(_t,{fullWidth:!0,label:"Search participants",value:G,onChange:R=>Z(R.target.value),placeholder:"Search by name, email, or role..."}),n.jsx(st,{variant:"outlined",sx:{maxHeight:300,overflow:"auto"},children:n.jsx(dr,{children:ze.map(R=>{const ne=_.some(Ae=>Ae.userId===R.userId);return n.jsxs(mr,{children:[n.jsx(di,{children:n.jsx(gt,{sx:{bgcolor:"primary.main"},children:R.role==="doctor"?n.jsx(Zc,{}):R.role==="pharmacist"?n.jsx(Qc,{}):n.jsx(xt,{})})}),n.jsx(fi,{primary:`${R.firstName} ${R.lastName}`,secondary:n.jsxs(x,{children:[n.jsx(S,{variant:"caption",display:"block",children:R.email}),n.jsx(Ne,{label:R.role,size:"small",sx:{mt:.5}})]})}),n.jsx(aa,{children:n.jsx(ve,{edge:"end",onClick:()=>ne?B(R.userId):ye(R),color:ne?"error":"primary",children:ne?n.jsx(ly,{}):n.jsx(fr,{})})})]},R.userId)})})}),_.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(pn,{}),n.jsxs(S,{variant:"subtitle2",children:["Selected Participants (",_.length,")"]}),n.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:_.map(R=>n.jsx(Ne,{label:`${se(R.userId)} (${R.role})`,onDelete:()=>B(R.userId),avatar:n.jsx(gt,{sx:{bgcolor:"primary.main"},children:F(R.userId)==="doctor"?n.jsx(Zc,{}):F(R.userId)==="pharmacist"?n.jsx(Qc,{}):n.jsx(xt,{})})},R.userId))})]})]});case 2:return n.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:3},children:[n.jsxs(Jt,{fullWidth:!0,children:[n.jsx(Xt,{children:"Priority"}),n.jsxs(Zt,{value:H,label:"Priority",onChange:R=>M(R.target.value),children:[n.jsx(ee,{value:"low",children:"Low"}),n.jsx(ee,{value:"normal",children:"Normal"}),n.jsx(ee,{value:"high",children:"High"}),n.jsx(ee,{value:"urgent",children:"Urgent"})]})]}),n.jsx(Xo,{multiple:!0,freeSolo:!0,options:["medication-review","therapy-consultation","follow-up","urgent-care"],value:T,onChange:(R,ne)=>J(ne),renderTags:(R,ne)=>R.map((Ae,at)=>n.jsx(Ne,{variant:"outlined",label:Ae,...ne({index:at})})),renderInput:R=>n.jsx(_t,{...R,label:"Tags (Optional)",placeholder:"Add tags..."})}),n.jsxs(st,{variant:"outlined",sx:{p:2},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Conversation Summary"}),n.jsxs(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[n.jsx("strong",{children:"Type:"})," ",O.replace("_"," ")]}),X&&n.jsxs(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[n.jsx("strong",{children:"Title:"})," ",X]}),n.jsxs(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[n.jsx("strong",{children:"Participants:"})," ",_.length]}),n.jsxs(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[n.jsx("strong",{children:"Priority:"})," ",H]}),T.length>0&&n.jsxs(S,{variant:"body2",color:"text.secondary",children:[n.jsx("strong",{children:"Tags:"})," ",T.join(", ")]})]})]});default:return null}};return n.jsxs(li,{open:o,onClose:i,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:600}},children:[n.jsx(ci,{children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Yo,{}),"New Conversation"]})}),n.jsxs(ui,{children:[n.jsx(Ov,{activeStep:V,sx:{mb:4},children:ge.map(w=>n.jsx(Nv,{children:n.jsx(Bv,{children:w})},w))}),b.createConversation&&n.jsx(xn,{severity:"error",sx:{mb:2},children:b.createConversation}),he(V)]}),n.jsxs(hi,{children:[n.jsx(We,{onClick:i,children:"Cancel"}),V>0&&n.jsx(We,{onClick:ie,children:"Back"}),V<ge.length-1?n.jsx(We,{variant:"contained",onClick:P,disabled:!L(V),children:"Next"}):n.jsx(We,{variant:"contained",onClick:be,disabled:!L(V)||m.createConversation,children:m.createConversation?"Creating...":"Create Conversation"})]})]})},ei=({onConversationSelect:o,selectedConversationId:i,height:s="100%",showNewButton:l=!0,patientId:d,compact:m=!1})=>{const{conversations:b,conversationFilters:j,conversationPagination:C,loading:V,errors:I,fetchConversations:O,setConversationFilters:q,clearConversationFilters:X,archiveConversation:Q,resolveConversation:U,deleteConversation:W}=Ft(),[_,Y]=p.useState(j.search||""),[H,M]=p.useState(null),[T,J]=p.useState(null),[re,te]=p.useState(!1),[G,Z]=p.useState({type:j.type,status:j.status,priority:j.priority}),k=oy(_,300);p.useEffect(()=>{k!==j.search&&q({search:k,page:1})},[k,j.search,q]),p.useEffect(()=>{d&&j.patientId!==d&&q({patientId:d,page:1})},[d,j.patientId,q]),p.useEffect(()=>{O()},[O]);const K=p.useMemo(()=>{let P=[...b];return G.type&&G.type!==j.type&&(P=P.filter(ie=>ie.type===G.type)),G.status&&G.status!==j.status&&(P=P.filter(ie=>ie.status===G.status)),G.priority&&G.priority!==j.priority&&(P=P.filter(ie=>ie.priority===G.priority)),P},[b,G,j]),le=P=>{o==null||o(P)},ge=(P,ie)=>{const be={...G,[P]:ie};Z(be),q({...be,page:1}),M(null)},ye=(P,ie)=>{q({sortBy:P,sortOrder:ie,page:1}),J(null)},B=async(P,ie)=>{try{switch(P){case"archive":await Q(ie);break;case"resolve":await U(ie);break;case"delete":window.confirm("Are you sure you want to delete this conversation?")&&await W(ie);break;default:console.warn("Unknown conversation action:",P)}}catch(be){console.error("Failed to perform conversation action:",be)}},z=()=>{Y(""),Z({}),X(),M(null)},se=()=>{O()},F=Object.values(G).filter(Boolean).length,L=()=>n.jsx(x,{sx:{p:1},children:Array.from({length:5}).map((P,ie)=>n.jsx(x,{sx:{mb:1},children:n.jsx(fu,{variant:"rectangular",height:72,sx:{borderRadius:1}})},ie))});return n.jsxs(st,{sx:{height:s,display:"flex",flexDirection:"column",overflow:"hidden"},children:[!m&&n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[n.jsx(S,{variant:"h6",sx:{flex:1},children:"Conversations"}),n.jsx(Ee,{title:"Refresh",children:n.jsx(ve,{size:"small",onClick:se,children:n.jsx(pi,{})})}),n.jsx(Ee,{title:"Sort",children:n.jsx(ve,{size:"small",onClick:P=>J(P.currentTarget),children:n.jsx(Zy,{})})}),n.jsx(Ee,{title:"Filter",children:n.jsx(qn,{badgeContent:F,color:"primary",children:n.jsx(ve,{size:"small",onClick:P=>M(P.currentTarget),children:n.jsx(mi,{})})})})]}),n.jsx(_t,{fullWidth:!0,size:"small",placeholder:"Search conversations...",value:_,onChange:P=>Y(P.target.value),InputProps:{startAdornment:n.jsx(Vs,{position:"start",children:n.jsx(pr,{})})}}),F>0&&n.jsxs(x,{sx:{display:"flex",gap:1,mt:1,flexWrap:"wrap"},children:[G.type&&n.jsx(Ne,{label:`Type: ${G.type}`,size:"small",onDelete:()=>ge("type",void 0)}),G.status&&n.jsx(Ne,{label:`Status: ${G.status}`,size:"small",onDelete:()=>ge("status",void 0)}),G.priority&&n.jsx(Ne,{label:`Priority: ${G.priority}`,size:"small",onDelete:()=>ge("priority",void 0)}),n.jsx(Ne,{label:"Clear all",size:"small",variant:"outlined",onClick:z})]})]}),I.fetchConversations&&n.jsx(xn,{severity:"error",sx:{m:1},children:I.fetchConversations}),n.jsx(x,{sx:{flex:1,overflow:"auto"},children:V.fetchConversations?L():K.length===0?n.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",p:3,textAlign:"center"},children:[n.jsx(S,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No conversations found"}),n.jsx(S,{variant:"body2",color:"text.secondary",children:_||F>0?"Try adjusting your search or filters":"Start a new conversation to get started"})]}):n.jsx(dr,{sx:{p:0},children:K.map(P=>n.jsx(mr,{sx:{p:0},children:n.jsx(l1,{conversation:P,selected:P._id===i,onClick:()=>le(P),onAction:B,compact:m})},P._id))})}),!m&&C.total>0&&n.jsx(x,{sx:{p:1,borderTop:1,borderColor:"divider",textAlign:"center"},children:n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Showing ",K.length," of"," ",C.total," conversations"]})}),l&&n.jsx(ha,{color:"primary",size:"medium",sx:{position:"absolute",bottom:16,right:16},onClick:()=>te(!0),children:n.jsx(fr,{})}),n.jsxs(tn,{anchorEl:H,open:!!H,onClose:()=>M(null),PaperProps:{sx:{minWidth:200}},children:[n.jsx(ee,{children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Type"}),n.jsxs(Zt,{value:G.type||"",label:"Type",onChange:P=>ge("type",P.target.value||void 0),children:[n.jsx(ee,{value:"",children:"All Types"}),n.jsx(ee,{value:"direct",children:"Direct"}),n.jsx(ee,{value:"group",children:"Group"}),n.jsx(ee,{value:"patient_query",children:"Patient Query"})]})]})}),n.jsx(ee,{children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Status"}),n.jsxs(Zt,{value:G.status||"",label:"Status",onChange:P=>ge("status",P.target.value||void 0),children:[n.jsx(ee,{value:"",children:"All Statuses"}),n.jsx(ee,{value:"active",children:"Active"}),n.jsx(ee,{value:"archived",children:"Archived"}),n.jsx(ee,{value:"resolved",children:"Resolved"})]})]})}),n.jsx(ee,{children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Priority"}),n.jsxs(Zt,{value:G.priority||"",label:"Priority",onChange:P=>ge("priority",P.target.value||void 0),children:[n.jsx(ee,{value:"",children:"All Priorities"}),n.jsx(ee,{value:"low",children:"Low"}),n.jsx(ee,{value:"normal",children:"Normal"}),n.jsx(ee,{value:"high",children:"High"}),n.jsx(ee,{value:"urgent",children:"Urgent"})]})]})}),n.jsx(ee,{onClick:z,children:"Clear All Filters"})]}),n.jsxs(tn,{anchorEl:T,open:!!T,onClose:()=>J(null),children:[n.jsx(ee,{onClick:()=>ye("lastMessageAt","desc"),children:"Latest Activity"}),n.jsx(ee,{onClick:()=>ye("createdAt","desc"),children:"Newest First"}),n.jsx(ee,{onClick:()=>ye("createdAt","asc"),children:"Oldest First"}),n.jsx(ee,{onClick:()=>ye("title","asc"),children:"Title A-Z"}),n.jsx(ee,{onClick:()=>ye("title","desc"),children:"Title Z-A"})]}),n.jsx(zu,{open:re,onClose:()=>te(!1),patientId:d})]})},c1=({notification:o,onClick:i,onDismiss:s,showActions:l=!0,compact:d=!1})=>{const{markNotificationAsRead:m}=Ft(),[b,j]=p.useState(null),[C,V]=p.useState(!1),I=p.useCallback(()=>{const T={sx:{color:o.status==="unread"?"primary.main":"text.secondary",fontSize:d?20:24}};switch(o.type){case"new_message":return n.jsx(Jo,{...T});case"mention":return n.jsx(Hy,{...T});case"therapy_update":return n.jsx(Ur,{...T});case"clinical_alert":return n.jsx(la,{...T});case"conversation_invite":return n.jsx(Vy,{...T});case"file_shared":return n.jsx(vu,{...T});case"intervention_assigned":return n.jsx(Wr,{...T});case"patient_query":return n.jsx(zv,{...T});case"urgent_message":return n.jsx($r,{...T});case"system_notification":return n.jsx(Fr,{...T});default:return n.jsx(Jo,{...T})}},[o.type,o.status,d]),O=p.useCallback(()=>{switch(o.priority){case"urgent":return"error";case"high":return"warning";case"normal":return"info";case"low":return"default";default:return"default"}},[o.priority]),q=p.useCallback(()=>{switch(o.type){case"new_message":return"New Message";case"mention":return"Mention";case"therapy_update":return"Therapy Update";case"clinical_alert":return"Clinical Alert";case"conversation_invite":return"Conversation Invite";case"file_shared":return"File Shared";case"intervention_assigned":return"Intervention Assigned";case"patient_query":return"Patient Query";case"urgent_message":return"Urgent Message";case"system_notification":return"System Notification";default:return"Notification"}},[o.type]),X=p.useCallback(()=>{try{return Hn(new Date(o.createdAt),{addSuffix:!0})}catch{return"Unknown time"}},[o.createdAt]),Q=p.useCallback(()=>{o.status==="unread"&&m(o._id),i?i():o.data.actionUrl&&(window.location.href=o.data.actionUrl)},[o,m,i]),U=p.useCallback(T=>{T.stopPropagation(),o.status==="unread"&&m(o._id)},[o,m]),W=p.useCallback(T=>{T.stopPropagation(),s&&s(),j(null)},[s]),_=p.useCallback(T=>{T.stopPropagation(),j(T.currentTarget)},[]),Y=p.useCallback(()=>{j(null)},[]),H=p.useCallback(T=>{T.stopPropagation(),V(!C)},[C]),M=o.scheduledFor&&new Date(o.scheduledFor)>new Date;return n.jsxs(n.Fragment,{children:[n.jsxs(mr,{button:!0,onClick:Q,sx:{backgroundColor:o.status==="unread"?"action.hover":"transparent",borderLeft:o.status==="unread"?3:0,borderLeftColor:o.status==="unread"?"primary.main":"transparent",py:d?1:1.5,"&:hover":{backgroundColor:"action.selected"}},children:[n.jsx(di,{children:n.jsx(gt,{sx:{bgcolor:o.status==="unread"?"primary.light":"grey.300",width:d?32:40,height:d?32:40},children:I()})}),n.jsx(fi,{primary:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:.5},children:[n.jsx(S,{variant:d?"body2":"subtitle2",sx:{fontWeight:o.status==="unread"?600:400,flex:1},noWrap:!0,children:o.title}),o.priority!=="normal"&&n.jsx(Ne,{label:o.priority,size:"small",color:O(),sx:{height:20,fontSize:"0.7rem"}}),M&&n.jsx(Ee,{title:"Scheduled notification",children:n.jsx(Hr,{sx:{fontSize:16,color:"text.secondary"}})})]}),secondary:n.jsxs(x,{children:[n.jsx(S,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:C?"none":d?1:2,WebkitBoxOrient:"vertical",overflow:"hidden",mb:.5},children:o.content}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Ne,{label:q(),size:"small",variant:"outlined",sx:{height:18,fontSize:"0.65rem"}}),n.jsx(S,{variant:"caption",color:"text.secondary",children:X()})]}),o.content.length>100&&n.jsx(We,{size:"small",onClick:H,startIcon:C?n.jsx(Js,{}):n.jsx(Gs,{}),sx:{minWidth:"auto",p:.5},children:C?"Less":"More"})]})]})}),l&&n.jsx(aa,{children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(Ee,{title:o.status==="unread"?"Mark as read":"Mark as unread",children:n.jsx(ve,{size:"small",onClick:U,children:o.status==="unread"?n.jsx(nu,{}):n.jsx(Kt,{})})}),o.data.actionUrl&&n.jsx(Ee,{title:"Open",children:n.jsx(ve,{size:"small",onClick:Q,children:n.jsx(tu,{})})}),n.jsx(Ee,{title:"More actions",children:n.jsx(ve,{size:"small",onClick:_,children:n.jsx(Kn,{})})})]})})]}),n.jsx(lr,{in:C,timeout:"auto",unmountOnExit:!0,children:n.jsxs(x,{sx:{px:3,pb:2,backgroundColor:"grey.50"},children:[o.data.conversationId&&n.jsxs(S,{variant:"caption",display:"block",gutterBottom:!0,children:["Conversation ID: ",o.data.conversationId]}),o.data.patientId&&n.jsxs(S,{variant:"caption",display:"block",gutterBottom:!0,children:["Patient ID: ",o.data.patientId]}),o.data.senderId&&n.jsxs(S,{variant:"caption",display:"block",gutterBottom:!0,children:["From: ",o.data.senderId]}),o.scheduledFor&&n.jsxs(S,{variant:"caption",display:"block",gutterBottom:!0,children:["Scheduled for:"," ",new Date(o.scheduledFor).toLocaleString()]}),o.readAt&&n.jsxs(S,{variant:"caption",display:"block",gutterBottom:!0,children:["Read at: ",new Date(o.readAt).toLocaleString()]})]})}),n.jsxs(tn,{anchorEl:b,open:!!b,onClose:Y,children:[n.jsx(ee,{onClick:U,children:o.status==="unread"?n.jsxs(n.Fragment,{children:[n.jsx(Kt,{sx:{mr:1}}),"Mark as read"]}):n.jsxs(n.Fragment,{children:[n.jsx(nu,{sx:{mr:1}}),"Mark as unread"]})}),o.data.actionUrl&&n.jsxs(ee,{onClick:Q,children:[n.jsx(tu,{sx:{mr:1}}),"Open"]}),n.jsxs(ee,{onClick:W,children:[n.jsx(oa,{sx:{mr:1}}),"Dismiss"]})]})]})},Fu=({maxHeight:o="600px",showHeader:i=!0,autoRefresh:s=!0,refreshInterval:l=3e4,onNotificationClick:d})=>{const{notifications:m,unreadCount:b,fetchNotifications:j,markNotificationAsRead:C,markAllNotificationsAsRead:V,removeNotification:I,loading:O,errors:q}=Ft(),[X,Q]=p.useState(null),[U,W]=p.useState(null),[_,Y]=p.useState(null),[H,M]=p.useState({}),[T,J]=p.useState(""),[re,te]=p.useState({soundEnabled:!0,desktopNotifications:!0,emailNotifications:!1,groupSimilar:!0}),[G,Z]=p.useState(0),k=p.useCallback(()=>{if(!re.soundEnabled)return;const F=Date.now();if(!(F-G<1e3))try{const L=new Audio("/sounds/notification.mp3");L.volume=.3,L.play().catch(console.warn),Z(F)}catch(L){console.warn("Could not play notification sound:",L)}},[re.soundEnabled,G]);p.useEffect(()=>{if(!s)return;const F=setInterval(()=>{j()},l);return()=>clearInterval(F)},[s,l,j]),p.useEffect(()=>{j()},[j]),p.useEffect(()=>{m.filter(L=>L.status==="unread").length>0&&k()},[m,k]),p.useEffect(()=>{if(!re.desktopNotifications)return;(async()=>{"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission()})()},[re.desktopNotifications]),p.useEffect(()=>{if(!re.desktopNotifications||Notification.permission!=="granted")return;m.filter(L=>L.status==="unread"&&["urgent","high"].includes(L.priority)).forEach(L=>{new Notification(L.title,{body:L.content,icon:"/icons/notification-icon.png",tag:L._id,requireInteraction:L.priority==="urgent"})})},[m,re.desktopNotifications]);const K=p.useMemo(()=>{let F=[...m];if(H.type&&(F=F.filter(L=>L.type===H.type)),H.priority&&(F=F.filter(L=>L.priority===H.priority)),H.status&&(F=F.filter(L=>L.status===H.status)),T.trim()){const L=T.toLowerCase();F=F.filter(P=>P.title.toLowerCase().includes(L)||P.content.toLowerCase().includes(L))}if(re.groupSimilar){const L=new Map;F.forEach(P=>{const ie=`${P.type}_${P.data.conversationId||"general"}`;L.has(ie)||L.set(ie,[]),L.get(ie).push(P)}),F=Array.from(L.values()).map(P=>P.sort((ie,be)=>new Date(be.createdAt).getTime()-new Date(ie.createdAt).getTime())[0])}return F.sort((L,P)=>{const ie={urgent:4,high:3,normal:2,low:1},be=ie[L.priority]||0,ze=ie[P.priority]||0;return be!==ze?ze-be:new Date(P.createdAt).getTime()-new Date(L.createdAt).getTime()})},[m,H,T,re.groupSimilar]),le=p.useCallback(F=>{F.status==="unread"&&C(F._id),d&&d(F)},[C,d]),ge=p.useCallback(()=>{V(),Q(null)},[V]),ye=p.useCallback(()=>{j()},[j]),B=p.useCallback((F,L)=>{M(P=>({...P,[F]:L==="all"?void 0:L})),W(null)},[]),z=p.useCallback((F,L)=>{te(P=>({...P,[F]:L}))},[]),se=p.useCallback(()=>{M({}),J("")},[]);return O.fetchNotifications?n.jsxs(st,{sx:{p:2,maxHeight:o,overflow:"hidden"},children:[i&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",mb:2},children:[n.jsx(Fr,{sx:{mr:1}}),n.jsx(S,{variant:"h6",children:"Notifications"})]}),n.jsx(dr,{children:[...Array(5)].map((F,L)=>n.jsx(mr,{children:n.jsx(fu,{variant:"rectangular",width:"100%",height:60})},L))})]}):n.jsxs(st,{sx:{maxHeight:o,overflow:"hidden",display:"flex",flexDirection:"column"},children:[i&&n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[n.jsx(qn,{badgeContent:b,color:"error",sx:{mr:1},children:n.jsx(Fr,{})}),n.jsx(S,{variant:"h6",children:"Notifications"})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Ee,{title:"Refresh",children:n.jsx(ve,{size:"small",onClick:ye,children:n.jsx(pi,{})})}),n.jsx(Ee,{title:"Filter",children:n.jsx(ve,{size:"small",onClick:F=>W(F.currentTarget),color:Object.keys(H).length>0?"primary":"default",children:n.jsx(mi,{})})}),n.jsx(Ee,{title:"Settings",children:n.jsx(ve,{size:"small",onClick:F=>Y(F.currentTarget),children:n.jsx(Fv,{})})}),b>0&&n.jsx(Ee,{title:"Mark all as read",children:n.jsx(ve,{size:"small",onClick:ge,children:n.jsx(Qy,{})})})]})]}),n.jsx(_t,{fullWidth:!0,size:"small",placeholder:"Search notifications...",value:T,onChange:F=>J(F.target.value),InputProps:{startAdornment:n.jsx(Vs,{position:"start",children:n.jsx(pr,{})}),endAdornment:T&&n.jsx(Vs,{position:"end",children:n.jsx(ve,{size:"small",onClick:()=>J(""),children:n.jsx(cy,{})})})}}),(Object.keys(H).length>0||T)&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mt:1,flexWrap:"wrap"},children:[Object.entries(H).map(([F,L])=>L&&n.jsx(Ne,{label:`${F}: ${L}`,size:"small",onDelete:()=>B(F,"all")},F)),T&&n.jsx(Ne,{label:`Search: ${T}`,size:"small",onDelete:()=>J("")}),n.jsx(We,{size:"small",onClick:se,children:"Clear all"})]})]}),q.fetchNotifications&&n.jsx(xn,{severity:"error",sx:{m:2},children:q.fetchNotifications}),n.jsx(x,{sx:{flex:1,overflow:"auto"},children:K.length===0?n.jsxs(x,{sx:{p:3,textAlign:"center"},children:[n.jsx(Fr,{sx:{fontSize:48,color:"text.secondary",mb:1}}),n.jsx(S,{variant:"body1",color:"text.secondary",children:m.length===0?"No notifications yet":"No notifications match your filters"})]}):n.jsx(dr,{sx:{p:0},children:K.map((F,L)=>n.jsxs(hr.Fragment,{children:[n.jsx(c1,{notification:F,onClick:()=>le(F),onDismiss:()=>I(F._id)}),L<K.length-1&&n.jsx(pn,{})]},F._id))})}),n.jsxs(tn,{anchorEl:U,open:!!U,onClose:()=>W(null),children:[n.jsx(ee,{onClick:()=>B("status","unread"),children:"Unread only"}),n.jsx(ee,{onClick:()=>B("status","read"),children:"Read only"}),n.jsx(pn,{}),n.jsx(ee,{onClick:()=>B("priority","urgent"),children:"Urgent priority"}),n.jsx(ee,{onClick:()=>B("priority","high"),children:"High priority"}),n.jsx(pn,{}),n.jsx(ee,{onClick:()=>B("type","new_message"),children:"Messages only"}),n.jsx(ee,{onClick:()=>B("type","clinical_alert"),children:"Clinical alerts"}),n.jsx(ee,{onClick:()=>B("type","mention"),children:"Mentions only"})]}),n.jsx(tn,{anchorEl:_,open:!!_,onClose:()=>Y(null),PaperProps:{sx:{minWidth:250}},children:n.jsxs(x,{sx:{p:2},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Notification Preferences"}),n.jsx(Ps,{control:n.jsx(Ds,{checked:re.soundEnabled,onChange:F=>z("soundEnabled",F.target.checked)}),label:n.jsxs(x,{sx:{display:"flex",alignItems:"center"},children:[re.soundEnabled?n.jsx(n0,{sx:{mr:1}}):n.jsx(t0,{sx:{mr:1}}),"Sound notifications"]})}),n.jsx(Ps,{control:n.jsx(Ds,{checked:re.desktopNotifications,onChange:F=>z("desktopNotifications",F.target.checked)}),label:"Desktop notifications"}),n.jsx(Ps,{control:n.jsx(Ds,{checked:re.emailNotifications,onChange:F=>z("emailNotifications",F.target.checked)}),label:"Email notifications"}),n.jsx(Ps,{control:n.jsx(Ds,{checked:re.groupSimilar,onChange:F=>z("groupSimilar",F.target.checked)}),label:"Group similar notifications"})]})})]})},Wu=p.forwardRef(({conversationId:o,onSendMessage:i,onTypingStart:s,onTypingStop:l,disabled:d=!1,placeholder:m="Type a message...",replyToMessage:b,onCancelReply:j,threadId:C,parentMessageId:V},I)=>{const[O,q]=p.useState(""),[X,Q]=p.useState([]),[U,W]=p.useState(!1),[_,Y]=p.useState(!1),[H,M]=p.useState(!1),[T,J]=p.useState(null),[re,te]=p.useState([]),[G,Z]=p.useState(!1),k=p.useRef(null),K=p.useRef(null),le=p.useRef(null),ge=p.useRef(null),ye=p.useRef(null);gi(),p.useImperativeHandle(I,()=>({focus:()=>{var w;return(w=k.current)==null?void 0:w.focus()},clear:()=>{q(""),Q([]),te([])},insertText:w=>{var R;q(ne=>ne+w),(R=k.current)==null||R.focus()}})),p.useEffect(()=>(O.trim()?(s==null||s(),ge.current&&clearTimeout(ge.current),ge.current=setTimeout(()=>{l==null||l()},1e3)):l==null||l(),()=>{ge.current&&clearTimeout(ge.current)}),[O,s,l]);const B=w=>{const R=w.target.value;q(R);const ne=R.match(/@\w+/g);te(ne?ne.map(Ae=>Ae.substring(1)):[])},z=async()=>{if(!(!O.trim()&&X.length===0||_||d)){Y(!0);try{await i(O.trim(),X.length>0?X:void 0,C,V,re.length>0?re:void 0),q(""),Q([]),te([]),j==null||j()}catch(w){console.error("Failed to send message:",w)}finally{Y(!1)}}},se=w=>{w.key==="Enter"&&!w.shiftKey&&(w.preventDefault(),z())},F=w=>{Q(R=>[...R,...w]),M(!1)},L=w=>{Q(R=>R.filter((ne,Ae)=>Ae!==w))},P=()=>{le.current&&le.current.click(),M(!1)},ie=()=>{K.current&&K.current.click(),M(!1)},be=async()=>{if(U)ye.current&&ye.current.stop(),W(!1);else try{const w=await navigator.mediaDevices.getUserMedia({audio:!0}),R=new MediaRecorder(w);ye.current=R;const ne=[];R.ondataavailable=Ae=>{ne.push(Ae.data)},R.onstop=()=>{const Ae=new Blob(ne,{type:"audio/wav"}),at=new File([Ae],"voice-message.wav",{type:"audio/wav"});F([at]),w.getTracks().forEach(mt=>mt.stop())},R.start(),W(!0)}catch(w){console.error("Failed to start recording:",w)}},ze=[{icon:n.jsx(Xy,{}),label:"Photo Library",onClick:ie},{icon:n.jsx(qy,{}),label:"Camera",onClick:P},{icon:n.jsx(hu,{}),label:"Document",onClick:ie},{icon:n.jsx(Wv,{}),label:"Location",onClick:()=>{M(!1)}}],he=["","","","","","","","","","","","","","","",""];return n.jsxs(x,{sx:{p:1},children:[n.jsx(lr,{in:!!b,children:b&&n.jsxs(st,{variant:"outlined",sx:{p:1,mb:1,display:"flex",alignItems:"center",gap:1,backgroundColor:"action.hover"},children:[n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsxs(S,{variant:"caption",color:"primary",children:["Replying to ",b.senderName]}),n.jsx(S,{variant:"body2",noWrap:!0,children:b.content.text})]}),n.jsx(ve,{size:"small",onClick:j,children:n.jsx(oa,{})})]})}),n.jsx(lr,{in:X.length>0,children:n.jsx(x,{sx:{mb:1,display:"flex",gap:1,flexWrap:"wrap"},children:X.map((w,R)=>n.jsx(Ne,{label:w.name,onDelete:()=>L(R),size:"small",variant:"outlined",sx:{maxWidth:200}},R))})}),n.jsx(lr,{in:G,children:n.jsx(st,{variant:"outlined",sx:{p:1,mb:1,display:"flex",gap:.5,flexWrap:"wrap",maxHeight:120,overflow:"auto"},children:he.map(w=>n.jsx(We,{size:"small",onClick:()=>{var R;q(ne=>ne+w),Z(!1),(R=k.current)==null||R.focus()},sx:{minWidth:"auto",p:.5,fontSize:"1.2rem"},children:w},w))})}),n.jsxs(x,{sx:{display:"flex",alignItems:"flex-end",gap:1,backgroundColor:"background.paper",borderRadius:2,border:1,borderColor:"divider",p:.5},children:[n.jsx(ve,{size:"small",onClick:w=>{J(w.currentTarget),M(!0)},disabled:d,children:n.jsx(fr,{})}),n.jsx(_t,{ref:k,fullWidth:!0,multiline:!0,maxRows:4,value:O,onChange:B,onKeyPress:se,placeholder:d?"This conversation is closed":m,disabled:d,variant:"standard",InputProps:{disableUnderline:!0,sx:{fontSize:"16px",lineHeight:1.4}},sx:{"& .MuiInputBase-root":{padding:"8px 0"}}}),n.jsx(ve,{size:"small",onClick:()=>Z(!G),disabled:d,color:G?"primary":"default",children:n.jsx(da,{})}),O.trim()||X.length>0?n.jsx(ve,{size:"small",onClick:z,disabled:d||_,color:"primary",sx:{backgroundColor:"primary.main",color:"primary.contrastText","&:hover":{backgroundColor:"primary.dark"},"&.Mui-disabled":{backgroundColor:"action.disabledBackground"}},children:_?n.jsx(ur,{size:20,color:"inherit"}):n.jsx(du,{})}):n.jsx(ve,{size:"small",onClick:be,disabled:d,color:U?"error":"default",sx:{...U&&{backgroundColor:"error.main",color:"error.contrastText",animation:"pulse 1s infinite","@keyframes pulse":{"0%":{opacity:1},"50%":{opacity:.7},"100%":{opacity:1}}}},children:n.jsx(Yy,{})})]}),n.jsx(tn,{anchorEl:T,open:H,onClose:()=>M(!1),anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},children:ze.map(w=>n.jsxs(ee,{onClick:w.onClick,children:[w.icon,n.jsx(S,{sx:{ml:1},children:w.label})]},w.label))}),n.jsx("input",{ref:K,type:"file",multiple:!0,accept:"*/*",style:{display:"none"},onChange:w=>{const R=Array.from(w.target.files||[]);R.length>0&&F(R),w.target.value=""}}),n.jsx("input",{ref:le,type:"file",accept:"image/*,video/*",capture:"environment",style:{display:"none"},onChange:w=>{const R=Array.from(w.target.files||[]);R.length>0&&F(R),w.target.value=""}})]})});Wu.displayName="MobileMessageInput";const u1=({children:o})=>{const i=$y();return n.jsx(qv,{appear:!1,direction:"down",in:!i,children:o})},h1=({conversationId:o,onBack:i,onConversationSelect:s})=>{const{activeConversation:l,conversations:d,messages:m,notifications:b,unreadCount:j,setActiveConversation:C,fetchMessages:V,sendMessage:I,markConversationAsRead:O}=Ft(),{isMobile:q,isSmallMobile:X,screenHeight:Q}=ca(),U=gi();ty();const W=ny(),[_,Y]=p.useState(!o),[H,M]=p.useState(!1),[T,J]=p.useState(!1),[re,te]=p.useState(!1),[G,Z]=p.useState(0),[k,K]=p.useState(!1),le=p.useRef(null),ge=p.useRef(null),ye=o?m[o]||[]:[],B=o?(l==null?void 0:l._id)===o?l:d.find(he=>he._id===o):null;p.useEffect(()=>{if(!U)return;const he=()=>{var Ae;const w=((Ae=window.visualViewport)==null?void 0:Ae.height)||window.innerHeight,ne=window.innerHeight-w;ne>150?Z(ne):Z(0)};return window.visualViewport?(window.visualViewport.addEventListener("resize",he),()=>{var w;return(w=window.visualViewport)==null?void 0:w.removeEventListener("resize",he)}):(window.addEventListener("resize",he),()=>window.removeEventListener("resize",he))},[U]);const{attachGestures:z}=Nu({onSwipeRight:()=>{o&&!_&&Y(!0)},onSwipeLeft:()=>{_&&Y(!1)},onSwipeDown:()=>{var he;_&&((he=le.current)==null||he.scrollTop)}});p.useEffect(()=>{le.current&&z(le.current)},[z]),p.useEffect(()=>{o&&(V(o),O(o),Y(!1))},[o,V,O]);const se=he=>{C(he),s==null||s(he),Y(!1)},F=()=>{o&&(C(null),i==null||i(),Y(!0))},L=async(he,w,R,ne,Ae)=>{if(!o||!he.trim()&&(!w||w.length===0))return;const at={conversationId:o,content:{text:he.trim(),type:"text",attachments:w},threadId:R,parentMessageId:ne,mentions:Ae};await I(at)},P=[{icon:n.jsx(fr,{}),name:"New Conversation",onClick:()=>{te(!1)}},{icon:n.jsx(pr,{}),name:"Search",onClick:()=>{te(!1)}},{icon:n.jsx($n,{}),name:"Archived",onClick:()=>{te(!1)}}],ie=56,ze=Q-ie-60-W.top-W.bottom-G;return n.jsxs(x,{sx:{height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden",paddingTop:`${W.top}px`,paddingBottom:`${W.bottom}px`},children:[n.jsx(u1,{children:n.jsx(Uv,{position:"fixed",sx:{top:W.top,zIndex:he=>he.zIndex.appBar},children:n.jsx($v,{variant:"dense",children:o?n.jsxs(n.Fragment,{children:[n.jsx(ve,{edge:"start",color:"inherit",onClick:F,sx:{mr:1},children:n.jsx(uy,{})}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsx(S,{variant:"h6",noWrap:!0,children:(B==null?void 0:B.title)||"Conversation"}),B&&n.jsxs(S,{variant:"caption",color:"inherit",sx:{opacity:.7},children:[B.participants.length," participant",B.participants.length!==1?"s":"",B.status!=="active"&&`  ${B.status}`]})]}),n.jsx(ve,{color:"inherit",onClick:()=>M(!0),children:n.jsx(xi,{})}),n.jsx(ve,{color:"inherit",children:n.jsx(Kn,{})})]}):n.jsxs(n.Fragment,{children:[n.jsx(S,{variant:"h6",sx:{flex:1},children:"Messages"}),n.jsx(ve,{color:"inherit",onClick:()=>J(!0),children:n.jsx(qn,{badgeContent:j,color:"error",children:n.jsx(Fr,{})})}),n.jsx(ve,{color:"inherit",children:n.jsx(pr,{})})]})})})}),n.jsx(x,{sx:{flex:1,display:"flex",flexDirection:"column",mt:`${ie}px`,overflow:"hidden"},children:o&&B?n.jsxs(n.Fragment,{children:[n.jsx(x,{ref:le,sx:{flex:1,overflow:"hidden",height:`${ze}px`},children:n.jsx(ya,{conversationId:o,messages:ye,onSendMessage:L,mobile:!0,touchOptimized:U,compact:X})}),n.jsx(x,{sx:{borderTop:1,borderColor:"divider",backgroundColor:"background.paper",pb:G>0?`${G}px`:0,transition:"padding-bottom 0.2s ease"},children:n.jsx(Wu,{conversationId:o,onSendMessage:L,onTypingStart:()=>K(!0),onTypingStop:()=>K(!1),disabled:B.status!=="active",ref:ge})})]}):n.jsx(ei,{onConversationSelect:se,selectedConversationId:o,height:"100%",compact:X,showNewButton:!1})}),n.jsx(hy,{anchor:"left",open:_&&!!o,onClose:()=>Y(!1),onOpen:()=>Y(!0),swipeAreaWidth:20,disableSwipeToOpen:!1,sx:{"& .MuiDrawer-paper":{width:"85%",maxWidth:320,paddingTop:`${W.top+ie}px`,paddingBottom:`${W.bottom}px`}},children:n.jsx(ei,{onConversationSelect:se,selectedConversationId:o,height:"100%",compact:!0,showNewButton:!1})}),n.jsx(Yc,{anchor:"right",open:H,onClose:()=>M(!1),sx:{"& .MuiDrawer-paper":{width:"85%",maxWidth:320,paddingTop:`${W.top+ie}px`,paddingBottom:`${W.bottom}px`}},children:B&&n.jsx(Bu,{conversation:B,onAddParticipant:(he,w)=>{console.log("Add participant:",he,w)},onRemoveParticipant:he=>{console.log("Remove participant:",he)},mobile:!0})}),n.jsx(Yc,{anchor:"right",open:T,onClose:()=>J(!1),sx:{"& .MuiDrawer-paper":{width:"90%",maxWidth:400,paddingTop:`${W.top+ie}px`,paddingBottom:`${W.bottom}px`}},children:n.jsx(Fu,{notifications:b,onNotificationClick:he=>{J(!1)},mobile:!0})}),!o&&n.jsx(Ry,{ariaLabel:"Communication actions",sx:{position:"fixed",bottom:16+W.bottom,right:16},icon:n.jsx(wu,{}),open:re,onClose:()=>te(!1),onOpen:()=>te(!0),children:P.map(he=>n.jsx(Oy,{icon:he.icon,tooltipTitle:he.name,onClick:he.onClick},he.name))}),n.jsx(Hv,{open:_||H||T,onClick:()=>{Y(!1),M(!1),J(!1)},sx:{zIndex:he=>he.zIndex.drawer-1}})]})},d1=({initialConversationId:o,patientId:i,height:s="100vh",onConversationChange:l})=>{const d=ai(),{isMobile:m,isTablet:b,isDesktop:j,screenWidth:C}=ca();gi();const{activeConversation:V,setActiveConversation:I,fetchConversations:O}=Ft(),[q,X]=p.useState(o),[Q,U]=p.useState(!m);p.useEffect(()=>{o!==q&&X(o)},[o,q]),p.useEffect(()=>{O()},[O]);const W=Y=>{X(Y._id),I(Y),l==null||l(Y._id),m&&U(!1)},_=()=>{X(void 0),I(null),l==null||l(null),U(!0)};return m?n.jsx(x,{sx:{height:s,overflow:"hidden"},children:n.jsx(h1,{conversationId:q,onBack:_,onConversationSelect:W})}):b?n.jsxs(x,{sx:{height:s,display:"flex",overflow:"hidden"},children:[n.jsx(x,{sx:{width:Q?320:0,flexShrink:0,transition:d.transitions.create("width",{easing:d.transitions.easing.sharp,duration:d.transitions.duration.enteringScreen}),overflow:"hidden",borderRight:Q?1:0,borderColor:"divider"},children:Q&&n.jsx(ei,{onConversationSelect:W,selectedConversationId:q,height:"100%",patientId:i,compact:!0})}),n.jsx(x,{sx:{flex:1,overflow:"hidden"},children:q?n.jsx(lu,{conversationId:q,patientId:i,height:"100%",showParticipants:!0,showHeader:!0,onConversationAction:(Y,H)=>{console.log("Conversation action:",Y,H)}}):n.jsxs(x,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:2,p:3,textAlign:"center"},children:[n.jsx(x,{sx:{fontSize:64,opacity:.3,mb:2},children:""}),n.jsxs(x,{children:[n.jsx(x,{sx:{fontSize:"1.25rem",fontWeight:600,mb:1},children:"Select a conversation"}),n.jsx(x,{sx:{color:"text.secondary"},children:"Choose a conversation from the sidebar to start messaging"})]})]})}),n.jsx(x,{sx:{position:"absolute",top:16,left:Q?304:16,zIndex:d.zIndex.fab,transition:d.transitions.create("left",{easing:d.transitions.easing.sharp,duration:d.transitions.duration.enteringScreen})},children:n.jsx(x,{onClick:()=>U(!Q),sx:{width:40,height:40,borderRadius:"50%",backgroundColor:"primary.main",color:"primary.contrastText",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:2,"&:hover":{backgroundColor:"primary.dark"}},children:Q?"":""})})]}):n.jsxs(x,{sx:{height:s,display:"flex",overflow:"hidden"},children:[n.jsx(x,{sx:{width:360,flexShrink:0,borderRight:1,borderColor:"divider"},children:n.jsx(ei,{onConversationSelect:W,selectedConversationId:q,height:"100%",patientId:i,compact:!1})}),n.jsx(x,{sx:{flex:1,overflow:"hidden"},children:q?n.jsx(lu,{conversationId:q,patientId:i,height:"100%",showParticipants:!0,showHeader:!0,onConversationAction:(Y,H)=>{console.log("Conversation action:",Y,H)}}):n.jsxs(x,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",gap:3,p:4,textAlign:"center"},children:[n.jsx(x,{sx:{fontSize:96,opacity:.2,mb:2},children:""}),n.jsxs(x,{children:[n.jsx(x,{sx:{fontSize:"1.5rem",fontWeight:600,mb:1},children:"Welcome to Communication Hub"}),n.jsx(x,{sx:{color:"text.secondary",maxWidth:400},children:"Select a conversation from the sidebar to start messaging, or create a new conversation to begin collaborating with your healthcare team."})]})]})})]})},f1=mi,cu=ua,p1=pr,x1=pu,uu=Kv,g1=la,m1=pt,v1=xi,Qo=async o=>{const i=o.headers.get("content-type");if(i&&i.includes("application/json"))try{return await o.json()}catch(s){throw console.error("Failed to parse JSON response:",s),new pt("Invalid JSON response from server")}else{const s=await o.text();if(s.trim().startsWith("<!DOCTYPE")||s.trim().startsWith("<html"))throw console.warn("Received HTML response instead of JSON - endpoint may not exist"),new pt(`Server returned HTML instead of JSON: ${o.status} ${o.statusText}`);if(!s.trim())throw console.warn("Received empty response"),new pt(`Server returned empty response: ${o.status} ${o.statusText}`);try{return JSON.parse(s)}catch{throw console.warn("Response is not JSON:",s.substring(0,200)),new pt(`Server returned non-JSON response: ${o.status} ${o.statusText}`)}}},y1=({conversationId:o,patientId:i,height:s="600px",showFilters:l=!0,showExport:d=!0})=>{const[m,b]=p.useState([]),[j,C]=p.useState(!1),[V,I]=p.useState(null),[O,q]=p.useState(0),[X,Q]=p.useState(25),[U,W]=p.useState(0),[_,Y]=p.useState({conversationId:o,patientId:i}),[H,M]=p.useState(!1),[T,J]=p.useState(null),[re,te]=p.useState(!1),G=p.useCallback(async()=>{var B;C(!0),I(null);try{const z=new URLSearchParams({limit:X.toString(),offset:(O*X).toString()});Object.entries(_).forEach(([P,ie])=>{ie!=null&&ie!==""&&(ie instanceof Date?z.append(P,ie.toISOString()):z.append(P,ie.toString()))});const se=o?`/api/communication/audit/conversation/${o}?${z}`:`/api/communication/audit?${z}`,F=await fetch(se,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!F.ok){if(F.status===404){b([]),W(0);return}if(F.status===401||F.status===403)throw new pt("Authentication required. Please log in again.");try{const P=await Qo(F);throw new pt(P.message||"Failed to fetch audit logs")}catch{throw new pt(`Failed to fetch audit logs: ${F.status} ${F.statusText}`)}}const L=await Qo(F);b(L.data),W(((B=L.pagination)==null?void 0:B.total)||L.count||0)}catch(z){I(z.message||"Failed to fetch audit logs")}finally{C(!1)}},[o,_,O,X]);p.useEffect(()=>{G()},[G]);const Z=(B,z)=>{Y(se=>({...se,[B]:z})),q(0)},k=()=>{Y({conversationId:o,patientId:i}),q(0)},K=async B=>{te(!0);try{const z=new URLSearchParams({format:B});Object.entries(_).forEach(([ie,be])=>{be!=null&&be!==""&&(be instanceof Date?z.append(ie,be.toISOString()):z.append(ie,be.toString()))});const se=await fetch(`/api/communication/audit/export?${z}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!se.ok){if(se.status===404)throw new pt("Export functionality is not available");if(se.status===401||se.status===403)throw new pt("Authentication required. Please log in again.");try{const ie=await Qo(se);throw new pt(ie.message||"Failed to export audit logs")}catch{throw new pt(`Failed to export audit logs: ${se.status} ${se.statusText}`)}}const F=await se.blob(),L=window.URL.createObjectURL(F),P=document.createElement("a");P.href=L,P.download=`audit_logs_${B}_${B==="csv"?new Date().toISOString().split("T")[0]:Date.now()}.${B}`,document.body.appendChild(P),P.click(),window.URL.revokeObjectURL(L),document.body.removeChild(P)}catch(z){I(z.message||"Failed to export audit logs")}finally{te(!1)}},le=B=>{const z={low:{color:"success",icon:n.jsx(v1,{fontSize:"small"})},medium:{color:"warning",icon:n.jsx(g1,{fontSize:"small"})},high:{color:"error",icon:n.jsx(m1,{fontSize:"small"})},critical:{color:"error",icon:n.jsx(uu,{fontSize:"small"})}},{color:se,icon:F}=z[B]||z.low;return n.jsx(Ne,{size:"small",color:se,icon:F,label:B.toUpperCase(),variant:"outlined"})},ge=B=>B.split("_").map(z=>z.charAt(0).toUpperCase()+z.slice(1)).join(" "),ye=B=>{const z=[];return B.details.conversationId&&z.push(`Conv: ${B.details.conversationId.slice(-8)}`),B.details.messageId&&z.push(`Msg: ${B.details.messageId.slice(-8)}`),B.details.patientId&&z.push(`Patient: ${B.details.patientId.slice(-8)}`),B.details.fileName&&z.push(`File: ${B.details.fileName}`),B.duration&&z.push(`${B.duration}ms`),z.join(", ")};return n.jsx(ju,{dateAdapter:bu,children:n.jsxs(x,{sx:{height:s,display:"flex",flexDirection:"column"},children:[n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[n.jsxs(S,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(uu,{}),"Audit Log Viewer",o&&n.jsx(Ne,{size:"small",label:`Conversation: ${o.slice(-8)}`})]}),n.jsxs(x,{sx:{display:"flex",gap:1},children:[l&&n.jsx(We,{startIcon:n.jsx(f1,{}),onClick:()=>M(!H),variant:H?"contained":"outlined",size:"small",children:"Filters"}),d&&n.jsxs(n.Fragment,{children:[n.jsx(We,{startIcon:n.jsx(cu,{}),onClick:()=>K("csv"),disabled:re,size:"small",variant:"outlined",children:"Export CSV"}),n.jsx(We,{startIcon:n.jsx(cu,{}),onClick:()=>K("json"),disabled:re,size:"small",variant:"outlined",children:"Export JSON"})]})]})]}),n.jsx(lr,{in:H,children:n.jsx(zn,{variant:"outlined",sx:{mb:2},children:n.jsx(Fn,{children:n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsx(_t,{fullWidth:!0,size:"small",label:"Search",placeholder:"Search actions, users...",value:_.searchQuery||"",onChange:B=>Z("searchQuery",B.target.value),InputProps:{startAdornment:n.jsx(p1,{sx:{mr:1,color:"text.secondary"}})}})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Action"}),n.jsxs(Zt,{value:_.action||"",onChange:B=>Z("action",B.target.value),label:"Action",children:[n.jsx(ee,{value:"",children:"All Actions"}),n.jsx(ee,{value:"message_sent",children:"Message Sent"}),n.jsx(ee,{value:"message_read",children:"Message Read"}),n.jsx(ee,{value:"conversation_created",children:"Conversation Created"}),n.jsx(ee,{value:"participant_added",children:"Participant Added"}),n.jsx(ee,{value:"file_uploaded",children:"File Uploaded"}),n.jsx(ee,{value:"conversation_exported",children:"Conversation Exported"})]})]})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Risk Level"}),n.jsxs(Zt,{value:_.riskLevel||"",onChange:B=>Z("riskLevel",B.target.value),label:"Risk Level",children:[n.jsx(ee,{value:"",children:"All Levels"}),n.jsx(ee,{value:"low",children:"Low"}),n.jsx(ee,{value:"medium",children:"Medium"}),n.jsx(ee,{value:"high",children:"High"}),n.jsx(ee,{value:"critical",children:"Critical"})]})]})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Success"}),n.jsxs(Zt,{value:_.success!==void 0?_.success.toString():"",onChange:B=>Z("success",B.target.value===""?void 0:B.target.value==="true"),label:"Success",children:[n.jsx(ee,{value:"",children:"All"}),n.jsx(ee,{value:"true",children:"Success"}),n.jsx(ee,{value:"false",children:"Failed"})]})]})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsx(Xs,{label:"Start Date",value:_.startDate,onChange:B=>Z("startDate",B),slotProps:{textField:{size:"small",fullWidth:!0}}})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsx(Xs,{label:"End Date",value:_.endDate,onChange:B=>Z("endDate",B),slotProps:{textField:{size:"small",fullWidth:!0}}})}),n.jsx("div",{style:{flex:"1 1 calc(25% - 16px)",minWidth:"250px"},children:n.jsx(We,{fullWidth:!0,variant:"outlined",onClick:k,size:"small",children:"Clear Filters"})})]})})})})]}),V&&n.jsx(xn,{severity:"error",sx:{m:2},onClose:()=>I(null),children:V}),j&&n.jsx(x,{sx:{display:"flex",justifyContent:"center",p:4},children:n.jsx(ur,{})}),!j&&n.jsx(py,{component:st,sx:{flex:1,overflow:"auto"},children:n.jsxs(xy,{stickyHeader:!0,size:"small",children:[n.jsx(gy,{children:n.jsxs($o,{children:[n.jsx(ft,{children:"Timestamp"}),n.jsx(ft,{children:"Action"}),n.jsx(ft,{children:"User"}),n.jsx(ft,{children:"Risk Level"}),n.jsx(ft,{children:"Status"}),n.jsx(ft,{children:"Details"}),n.jsx(ft,{children:"Actions"})]})}),n.jsxs(my,{children:[m.map(B=>n.jsxs($o,{hover:!0,children:[n.jsx(ft,{children:n.jsx(S,{variant:"body2",children:cr(eu(B.timestamp),"MMM dd, yyyy HH:mm:ss")})}),n.jsxs(ft,{children:[n.jsx(S,{variant:"body2",fontWeight:"medium",children:ge(B.action)}),n.jsx(S,{variant:"caption",color:"text.secondary",children:B.targetType})]}),n.jsxs(ft,{children:[n.jsxs(S,{variant:"body2",children:[B.userId.firstName," ",B.userId.lastName]}),n.jsx(S,{variant:"caption",color:"text.secondary",children:B.userId.role})]}),n.jsx(ft,{children:le(B.riskLevel)}),n.jsx(ft,{children:n.jsx(Ne,{size:"small",color:B.success?"success":"error",label:B.success?"Success":"Failed",variant:"outlined"})}),n.jsxs(ft,{children:[n.jsx(S,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:ye(B)}),B.errorMessage&&n.jsx(S,{variant:"caption",color:"error",children:B.errorMessage})]}),n.jsx(ft,{children:n.jsx(Ee,{title:"View Details",children:n.jsx(ve,{size:"small",onClick:()=>J(B),children:n.jsx(x1,{})})})})]},B._id)),m.length===0&&!j&&n.jsx($o,{children:n.jsx(ft,{colSpan:7,align:"center",sx:{py:4},children:n.jsx(S,{color:"text.secondary",children:"No audit logs found"})})})]})]})}),!j&&m.length>0&&n.jsx(vy,{component:"div",count:U,page:O,onPageChange:(B,z)=>q(z),rowsPerPage:X,onRowsPerPageChange:B=>{Q(parseInt(B.target.value,10)),q(0)},rowsPerPageOptions:[10,25,50,100]}),n.jsxs(li,{open:!!T,onClose:()=>J(null),maxWidth:"md",fullWidth:!0,children:[n.jsxs(ci,{children:["Audit Log Details",T&&le(T.riskLevel)]}),n.jsx(ui,{children:T&&n.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"16px"},children:[n.jsxs("div",{style:{flex:"1 1 calc(50% - 16px)",minWidth:"250px"},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Basic Information"}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Action:"})," ",ge(T.action)]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Timestamp:"})," ",cr(eu(T.timestamp),"PPpp")]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"User:"})," ",T.userId.firstName," ",T.userId.lastName," (",T.userId.email,")"]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Role:"})," ",T.userId.role]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Target Type:"})," ",T.targetType]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Target ID:"})," ",T.targetId]})]}),n.jsxs("div",{style:{flex:"1 1 calc(50% - 16px)",minWidth:"250px"},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Security & Compliance"}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Risk Level:"})," ",T.riskLevel]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Compliance Category:"})," ",T.complianceCategory]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Success:"})," ",T.success?"Yes":"No"]}),n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"IP Address:"})," ",T.ipAddress]}),T.duration&&n.jsxs(S,{variant:"body2",children:[n.jsx("strong",{children:"Duration:"})," ",T.duration,"ms"]})]}),n.jsxs("div",{style:{flex:"1 1 100%",minWidth:"250px"},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Details"}),n.jsx(st,{variant:"outlined",sx:{p:2,bgcolor:"grey.50"},children:n.jsx("pre",{style:{margin:0,fontSize:"0.875rem",whiteSpace:"pre-wrap"},children:JSON.stringify(T.details,null,2)})})]}),T.errorMessage&&n.jsxs("div",{style:{flex:"1 1 100%",minWidth:"250px"},children:[n.jsx(S,{variant:"subtitle2",gutterBottom:!0,color:"error",children:"Error Message"}),n.jsx(xn,{severity:"error",children:T.errorMessage})]})]})}),n.jsx(hi,{children:n.jsx(We,{onClick:()=>J(null),children:"Close"})})]})]})})},j1=({query:o,selected:i=!1,onSelect:s,onClick:l,onAction:d,compact:m=!1,showPatientInfo:b=!0})=>{var Z;const[j,C]=p.useState(null),V=()=>{switch(o.priority){case"urgent":return{color:"error.main",bgcolor:"error.light",icon:n.jsx($r,{}),label:"Urgent"};case"high":return{color:"warning.main",bgcolor:"warning.light",icon:n.jsx(la,{}),label:"High"};case"low":return{color:"info.main",bgcolor:"info.light",icon:n.jsx(xi,{}),label:"Low"};default:return{color:"text.secondary",bgcolor:"grey.100",icon:n.jsx(Vv,{}),label:"Normal"}}},I=()=>{switch(o.status){case"resolved":return{color:"success.main",bgcolor:"success.light",icon:n.jsx(Kt,{}),label:"Resolved"};case"archived":return{color:"text.disabled",bgcolor:"grey.200",icon:n.jsx($n,{}),label:"Archived"};default:return{color:"primary.main",bgcolor:"primary.light",icon:n.jsx(Hr,{}),label:"Active"}}},O=k=>{try{const K=new Date(k);return Hn(K,{addSuffix:!0})}catch{return"Unknown time"}},q=()=>{var k,K;return o.title?o.title:(K=(k=o.metadata)==null?void 0:k.clinicalContext)!=null&&K.diagnosis?`Query about ${o.metadata.clinicalContext.diagnosis}`:"Patient Query"},X=()=>`Involving: ${o.participants.filter(K=>K.role!=="patient").map(K=>K.role).join(", ")}`,Q=()=>o.participants.filter(k=>k.role!=="patient"),U=()=>{if(o.status==="resolved")return 100;if(o.status==="archived")return 0;const k=new Date(o.createdAt),le=(new Date().getTime()-k.getTime())/(1e3*60*60);return Math.min(Math.round(le/24*100),90)},W=k=>{C(null),d==null||d(k,o._id)},_=k=>{k.stopPropagation(),C(k.currentTarget)},Y=()=>{l&&l()},H=k=>{k.stopPropagation(),s==null||s(k.target.checked)},M=()=>{const k=[{key:"view",label:"View Details",icon:n.jsx(pu,{})},{key:"reply",label:"Reply",icon:n.jsx(xr,{})},{key:"edit",label:"Edit Query",icon:n.jsx(mu,{})}];return o.status==="active"&&k.push({key:"assign",label:"Assign",icon:n.jsx(Wr,{})},{key:"escalate",label:"Escalate",icon:n.jsx($r,{})},{key:"resolve",label:"Mark as Resolved",icon:n.jsx(Kt,{})},{key:"archive",label:"Archive",icon:n.jsx($n,{})}),o.status==="archived"&&k.push({key:"unarchive",label:"Unarchive",icon:n.jsx($n,{})}),k.push({key:"forward",label:"Forward",icon:n.jsx(Gy,{})},{key:"delete",label:"Delete",icon:n.jsx(Qs,{}),danger:!0}),k},T=V(),J=I(),re=Q(),te=U(),G=M();return n.jsxs(n.Fragment,{children:[n.jsxs(zn,{component:l?"button":"div",sx:{cursor:l?"pointer":"default",transition:"all 0.2s ease-in-out","&:hover":{boxShadow:l?4:1,transform:l?"translateY(-2px)":"none"},border:i?2:1,borderColor:i?"primary.main":"divider",position:"relative",textAlign:"left",width:"100%",...l&&{"&:focus":{outline:"2px solid",outlineColor:"primary.main",outlineOffset:"2px"}}},onClick:Y,role:l?"button":void 0,tabIndex:l?0:void 0,"aria-label":l?q():void 0,children:[n.jsx(x,{sx:{position:"absolute",top:0,left:0,width:4,height:"100%",bgcolor:T.color}}),n.jsx(Fn,{sx:{pb:m?2:1},children:n.jsxs(x,{sx:{display:"flex",alignItems:"flex-start",gap:2,mb:2},children:[s&&n.jsx(Gv,{checked:i,onChange:H,size:"small",sx:{mt:-.5}}),n.jsxs(x,{sx:{flex:1,minWidth:0},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[n.jsx(S,{variant:m?"body1":"h6",component:"h3",noWrap:!0,sx:{flex:1,fontWeight:600},children:q()}),n.jsx(Ne,{icon:J.icon,label:J.label,size:"small",sx:{bgcolor:J.bgcolor,color:J.color,"& .MuiChip-icon":{color:J.color}}}),n.jsx(Ne,{icon:T.icon,label:T.label,size:"small",sx:{bgcolor:T.bgcolor,color:T.color,"& .MuiChip-icon":{color:T.color}}})]}),!m&&n.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:2},children:X()}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[b&&o.patientId&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(xt,{sx:{fontSize:16,color:"text.secondary"}}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Patient ID: ",o.patientId.slice(-6)]})]}),o.caseId&&n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(Wr,{sx:{fontSize:16,color:"text.secondary"}}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Case: ",o.caseId]})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(dy,{sx:{fontSize:16,color:"text.secondary"}}),n.jsx(S,{variant:"caption",color:"text.secondary",children:O(o.createdAt)})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:.5},children:[n.jsx(Jo,{sx:{fontSize:16,color:"text.secondary"}}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:["Last: ",O(o.lastMessageAt)]})]})]}),o.tags&&o.tags.length>0&&n.jsxs(x,{sx:{display:"flex",gap:.5,mb:2,flexWrap:"wrap"},children:[o.tags.slice(0,m?2:4).map(k=>n.jsx(Ne,{label:k,size:"small",variant:"outlined",sx:{height:20,fontSize:"0.625rem"}},k)),o.tags.length>(m?2:4)&&n.jsxs(S,{variant:"caption",color:"text.secondary",children:["+",o.tags.length-(m?2:4)," more"]})]}),((Z=o.metadata)==null?void 0:Z.clinicalContext)&&!m&&n.jsxs(x,{sx:{mb:2},children:[o.metadata.clinicalContext.diagnosis&&n.jsxs(S,{variant:"caption",color:"text.secondary",display:"block",children:["Diagnosis: ",o.metadata.clinicalContext.diagnosis]}),o.metadata.clinicalContext.medications&&o.metadata.clinicalContext.medications.length>0&&n.jsxs(S,{variant:"caption",color:"text.secondary",display:"block",children:["Medications:"," ",o.metadata.clinicalContext.medications.length," ","items"]})]}),o.status==="active"&&!m&&n.jsxs(x,{sx:{mb:2},children:[n.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",mb:.5},children:[n.jsx(S,{variant:"caption",color:"text.secondary",children:"Query Progress"}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:[te,"%"]})]}),n.jsx(xu,{variant:"determinate",value:te,sx:{height:4,borderRadius:2}})]}),n.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(S,{variant:"caption",color:"text.secondary",children:"Assigned to:"}),n.jsx(_u,{max:3,sx:{"& .MuiAvatar-root":{width:24,height:24,fontSize:"0.75rem"}},children:re.map((k,K)=>n.jsx(Ee,{title:k.role,children:n.jsx(gt,{sx:{bgcolor:"primary.main"},children:k.role.charAt(0).toUpperCase()})},k.userId))})]}),n.jsx(ve,{size:"small",onClick:_,sx:{ml:1},"aria-label":"More options",children:n.jsx(Kn,{})})]})]})]})}),!m&&n.jsxs(n.Fragment,{children:[n.jsx(pn,{}),n.jsxs(yy,{sx:{px:2,py:1},children:[n.jsx(We,{size:"small",startIcon:n.jsx(xr,{}),onClick:k=>{k.stopPropagation(),W("reply")},children:"Reply"}),o.status==="active"&&n.jsxs(n.Fragment,{children:[n.jsx(We,{size:"small",startIcon:n.jsx(Wr,{}),onClick:k=>{k.stopPropagation(),W("assign")},children:"Assign"}),n.jsx(We,{size:"small",startIcon:n.jsx(Kt,{}),onClick:k=>{k.stopPropagation(),W("resolve")},children:"Resolve"})]}),n.jsx(x,{sx:{flex:1}}),n.jsxs(S,{variant:"caption",color:"text.secondary",children:["ID: ",o._id.slice(-6)]})]})]})]}),n.jsx(tn,{anchorEl:j,open:!!j,onClose:()=>C(null),onClick:k=>k.stopPropagation(),children:G.map(k=>n.jsx(ee,{onClick:()=>W(k.key),sx:{color:k.danger?"error.main":"inherit"},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[k.icon,k.label]})},k.key))})]})},b1=({patientId:o,height:i="600px",showAnalytics:s=!0,onQuerySelect:l,onCreateQuery:d})=>{const{conversations:m,conversationFilters:b,loading:j,errors:C,fetchConversations:V,setConversationFilters:I,clearConversationFilters:O,resolveConversation:q,archiveConversation:X,updateConversation:Q}=Ft(),[U,W]=p.useState(0),[_,Y]=p.useState(""),[H,M]=p.useState("all"),[T,J]=p.useState("all"),[re,te]=p.useState("all"),[G,Z]=p.useState({start:null,end:null}),[k,K]=p.useState(!1),[le,ge]=p.useState([]),ye=p.useMemo(()=>m.filter(w=>{var R;if(w.type!=="patient_query"||o&&w.patientId!==o)return!1;if(_){const ne=_.toLowerCase(),Ae=(R=w.title)==null?void 0:R.toLowerCase().includes(ne),at=w.participants.some(lt=>lt.role.toLowerCase().includes(ne)),mt=w.tags.some(lt=>lt.toLowerCase().includes(ne));if(!Ae&&!at&&!mt)return!1}if(H!=="all"&&w.status!==H||T!=="all"&&w.priority!==T)return!1;if(G.start||G.end){const ne=new Date(w.createdAt);if(G.start&&ne<sy(G.start)||G.end&&ne>Qv(G.end))return!1}return!0}),[m,o,_,H,T,G]),B=p.useMemo(()=>({all:ye,open:ye.filter(w=>w.status==="active"),pending:ye.filter(w=>w.status==="active"&&w.priority==="high"),resolved:ye.filter(w=>w.status==="resolved"),archived:ye.filter(w=>w.status==="archived")}),[ye]),z=p.useMemo(()=>{const w=ye.length,R=B.open.length,ne=B.resolved.length,Ae=ye.filter(lt=>lt.priority==="urgent").length,at=ne>0?Math.round(Math.random()*24+2):0,mt=Array.from({length:7},(lt,rn)=>{const Ye=jy(new Date,6-rn),wt=ye.filter(kn=>{const ct=new Date(kn.createdAt);return cr(ct,"yyyy-MM-dd")===cr(Ye,"yyyy-MM-dd")});return{period:cr(Ye,"MMM dd"),count:wt.length}});return{totalQueries:w,openQueries:R,resolvedQueries:ne,averageResponseTime:at,urgentQueries:Ae,queryTrends:mt}},[ye,B]),se=[{label:"All Queries",value:"all",count:B.all.length},{label:"Open",value:"open",count:B.open.length},{label:"Pending",value:"pending",count:B.pending.length},{label:"Resolved",value:"resolved",count:B.resolved.length},{label:"Archived",value:"archived",count:B.archived.length}],F=B[se[U].value];p.useEffect(()=>{const w={type:"patient_query",...o&&{patientId:o},sortBy:"lastMessageAt",sortOrder:"desc"};V(w)},[o,V]);const L=(w,R)=>{W(R)},P=async(w,R)=>{try{switch(w){case"resolve":await q(R);break;case"archive":await X(R);break;case"assign":console.log("Assign query:",R);break;case"escalate":await Q(R,{priority:"urgent"});break;default:console.log("Unknown action:",w)}}catch(ne){console.error("Query action failed:",ne)}},ie=async w=>{try{const R=le.map(ne=>{switch(w){case"resolve":return q(ne);case"archive":return X(ne);default:return Promise.resolve()}});await Promise.all(R),ge([])}catch(R){console.error("Bulk action failed:",R)}},be=()=>{const w={type:"patient_query",...o&&{patientId:o},sortBy:"lastMessageAt",sortOrder:"desc"};V(w)},ze=()=>{console.log("Export queries:",F)},he=()=>{Y(""),M("all"),J("all"),te("all"),Z({start:null,end:null}),O()};return n.jsx(ju,{dateAdapter:bu,children:n.jsxs(x,{sx:{height:i,display:"flex",flexDirection:"column"},children:[n.jsxs(x,{sx:{p:2,borderBottom:1,borderColor:"divider"},children:[n.jsxs(x,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:[n.jsx(S,{variant:"h5",component:"h1",children:"Patient Query Dashboard"}),n.jsxs(x,{sx:{display:"flex",gap:1},children:[n.jsx(Ee,{title:"Refresh",children:n.jsx(ve,{onClick:be,disabled:j.fetchConversations,children:n.jsx(pi,{})})}),n.jsx(Ee,{title:"Export",children:n.jsx(ve,{onClick:ze,children:n.jsx(ua,{})})}),n.jsx(We,{variant:"contained",startIcon:n.jsx(fr,{}),onClick:()=>{d?d():K(!0)},children:"New Query"})]})]}),s&&n.jsxs(rt,{container:!0,spacing:2,sx:{mb:2},children:[n.jsx(rt,{item:!0,xs:12,sm:6,md:2.4,children:n.jsx(zn,{children:n.jsx(Fn,{sx:{p:2,"&:last-child":{pb:2}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Wr,{color:"primary"}),n.jsxs(x,{children:[n.jsx(S,{variant:"h6",children:z.totalQueries}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Total Queries"})]})]})})})}),n.jsx(rt,{item:!0,xs:12,sm:6,md:2.4,children:n.jsx(zn,{children:n.jsx(Fn,{sx:{p:2,"&:last-child":{pb:2}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Hr,{color:"warning"}),n.jsxs(x,{children:[n.jsx(S,{variant:"h6",children:z.openQueries}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Open Queries"})]})]})})})}),n.jsx(rt,{item:!0,xs:12,sm:6,md:2.4,children:n.jsx(zn,{children:n.jsx(Fn,{sx:{p:2,"&:last-child":{pb:2}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Kt,{color:"success"}),n.jsxs(x,{children:[n.jsx(S,{variant:"h6",children:z.resolvedQueries}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Resolved"})]})]})})})}),n.jsx(rt,{item:!0,xs:12,sm:6,md:2.4,children:n.jsx(zn,{children:n.jsx(Fn,{sx:{p:2,"&:last-child":{pb:2}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx($r,{color:"error"}),n.jsxs(x,{children:[n.jsx(S,{variant:"h6",children:z.urgentQueries}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Urgent"})]})]})})})}),n.jsx(rt,{item:!0,xs:12,sm:6,md:2.4,children:n.jsx(zn,{children:n.jsx(Fn,{sx:{p:2,"&:last-child":{pb:2}},children:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(Yv,{color:"info"}),n.jsxs(x,{children:[n.jsxs(S,{variant:"h6",children:[z.averageResponseTime,"h"]}),n.jsx(S,{variant:"caption",color:"text.secondary",children:"Avg Response"})]})]})})})})]}),n.jsxs(rt,{container:!0,spacing:2,alignItems:"center",children:[n.jsx(rt,{item:!0,xs:12,md:3,children:n.jsx(_t,{fullWidth:!0,size:"small",placeholder:"Search queries...",value:_,onChange:w=>Y(w.target.value),InputProps:{startAdornment:n.jsx(Vs,{position:"start",children:n.jsx(pr,{})})}})}),n.jsx(rt,{item:!0,xs:6,md:2,children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Status"}),n.jsxs(Zt,{value:H,label:"Status",onChange:w=>M(w.target.value),children:[n.jsx(ee,{value:"all",children:"All Status"}),n.jsx(ee,{value:"active",children:"Active"}),n.jsx(ee,{value:"resolved",children:"Resolved"}),n.jsx(ee,{value:"archived",children:"Archived"})]})]})}),n.jsx(rt,{item:!0,xs:6,md:2,children:n.jsxs(Jt,{fullWidth:!0,size:"small",children:[n.jsx(Xt,{children:"Priority"}),n.jsxs(Zt,{value:T,label:"Priority",onChange:w=>J(w.target.value),children:[n.jsx(ee,{value:"all",children:"All Priority"}),n.jsx(ee,{value:"low",children:"Low"}),n.jsx(ee,{value:"normal",children:"Normal"}),n.jsx(ee,{value:"high",children:"High"}),n.jsx(ee,{value:"urgent",children:"Urgent"})]})]})}),n.jsx(rt,{item:!0,xs:6,md:2,children:n.jsx(Xs,{label:"Start Date",value:G.start,onChange:w=>Z(R=>({...R,start:w})),slotProps:{textField:{size:"small",fullWidth:!0}}})}),n.jsx(rt,{item:!0,xs:6,md:2,children:n.jsx(Xs,{label:"End Date",value:G.end,onChange:w=>Z(R=>({...R,end:w})),slotProps:{textField:{size:"small",fullWidth:!0}}})}),n.jsx(rt,{item:!0,xs:12,md:1,children:n.jsx(We,{variant:"outlined",startIcon:n.jsx(mi,{}),onClick:he,size:"small",children:"Clear"})})]})]}),j.fetchConversations&&n.jsx(xu,{}),C.fetchConversations&&n.jsx(xn,{severity:"error",sx:{m:2},children:C.fetchConversations}),n.jsx(x,{sx:{borderBottom:1,borderColor:"divider"},children:n.jsx(gu,{value:U,onChange:L,children:se.map((w,R)=>n.jsx(Br,{label:n.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[w.label,n.jsx(qn,{badgeContent:w.count,color:"primary"})]})},w.value))})}),le.length>0&&n.jsxs(x,{sx:{p:2,bgcolor:"action.selected",display:"flex",alignItems:"center",gap:2},children:[n.jsxs(S,{variant:"body2",children:[le.length," queries selected"]}),n.jsx(We,{size:"small",variant:"outlined",onClick:()=>ie("resolve"),children:"Resolve Selected"}),n.jsx(We,{size:"small",variant:"outlined",onClick:()=>ie("archive"),children:"Archive Selected"}),n.jsx(We,{size:"small",variant:"text",onClick:()=>ge([]),children:"Clear Selection"})]}),n.jsx(x,{sx:{flex:1,overflow:"auto",p:2},children:F.length===0?n.jsxs(x,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",textAlign:"center"},children:[n.jsx(Jv,{sx:{fontSize:64,color:"text.secondary",mb:2}}),n.jsx(S,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No queries found"}),n.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:2},children:U===0?"No patient queries match your current filters.":`No ${se[U].label.toLowerCase()} queries found.`}),U===0&&n.jsx(We,{variant:"contained",startIcon:n.jsx(fr,{}),onClick:()=>K(!0),children:"Create First Query"})]}):n.jsx(rt,{container:!0,spacing:2,children:F.map(w=>n.jsx(rt,{item:!0,xs:12,children:n.jsx(j1,{query:w,selected:le.includes(w._id),onSelect:R=>{ge(R?ne=>[...ne,w._id]:ne=>ne.filter(Ae=>Ae!==w._id))},onClick:()=>l==null?void 0:l(w),onAction:P})},w._id))})}),n.jsx(zu,{open:k,onClose:()=>K(!1),defaultType:"patient_query",patientId:o})]})})};class ti{constructor(i){this.navigate=i}toConversation(i,s){const l=new URLSearchParams;l.set("conversation",i),s&&l.set("message",s),this.navigate(`/pharmacy/communication?${l.toString()}`)}toNewConversation(i,s){const l=new URLSearchParams;l.set("action","new"),i&&l.set("patient",i),s&&l.set("type",s),this.navigate(`/pharmacy/communication?${l.toString()}`)}toReplyMessage(i,s){const l=new URLSearchParams;l.set("conversation",i),l.set("message",s),l.set("action","reply"),this.navigate(`/pharmacy/communication?${l.toString()}`)}toNotifications(i){const s=new URLSearchParams;s.set("tab","notifications"),i&&s.set("notification",i),this.navigate(`/pharmacy/communication?${s.toString()}`)}toAuditLogs(i,s){const l=new URLSearchParams;l.set("tab","audit"),i&&l.set("conversation",i),s&&(l.set("start",s.start.toISOString()),l.set("end",s.end.toISOString())),this.navigate(`/pharmacy/communication?${l.toString()}`)}toPatientQueries(i,s){const l=new URLSearchParams;l.set("tab","queries"),i&&l.set("status",i),s&&l.set("priority",s),this.navigate(`/pharmacy/communication?${l.toString()}`)}toSettings(i){const s=new URLSearchParams;s.set("tab","settings"),i&&s.set("section",i),this.navigate(`/pharmacy/communication?${s.toString()}`)}static parseUrlParams(i){return{conversationId:i.get("conversation")||void 0,messageId:i.get("message")||void 0,patientId:i.get("patient")||void 0,action:i.get("action")||void 0,tab:i.get("tab")||void 0}}static generateShareableLink(i,s){const l=window.location.origin,d=new URLSearchParams;return d.set("conversation",i),s&&d.set("message",s),`${l}/pharmacy/communication?${d.toString()}`}static generateNotificationLink(i){const s=window.location.origin,l=new URLSearchParams;return i.conversationId&&l.set("conversation",i.conversationId),i.messageId&&l.set("message",i.messageId),i.patientId&&l.set("patient",i.patientId),i.action&&l.set("action",i.action),`${s}/pharmacy/communication?${l.toString()}`}static async validateAccess(i,s){return!(i.conversationId&&!s.includes("communication_access")||i.tab==="audit"&&!s.includes("audit_access")||i.tab==="settings"&&!s.includes("communication_settings"))}static handleExternalLink(i,s){try{const l=new URL(i);if(l.pathname==="/pharmacy/communication"){const d=ti.parseUrlParams(l.searchParams),m=new ti(s);if(d.conversationId)return m.toConversation(d.conversationId,d.messageId),!0;if(d.action==="new")return m.toNewConversation(d.patientId),!0;if(d.tab){switch(d.tab){case"notifications":m.toNotifications();break;case"audit":m.toAuditLogs();break;case"settings":m.toSettings();break;default:s("/pharmacy/communication")}return!0}return s("/pharmacy/communication"),!0}return!1}catch(l){return console.error("Error handling external link:",l),!1}}}const Ws=({children:o,value:i,index:s})=>n.jsx("div",{role:"tabpanel",hidden:i!==s,id:`communication-tabpanel-${s}`,"aria-labelledby":`communication-tab-${s}`,children:i===s&&n.jsx(x,{sx:{py:3},children:o})}),dj=()=>{const o=ai(),i=Xv(),[s,l]=p.useState(0);p.useEffect(()=>{const m=new URLSearchParams(i.search),b=ti.parseUrlParams(m);if(b.tab)switch(b.tab){case"messages":l(0);break;case"notifications":l(1);break;case"queries":l(2);break;case"audit":l(3);break;default:l(0)}},[i.search]);const d=(m,b)=>{l(b);const j=new URLSearchParams(i.search),C=["messages","notifications","queries","audit"];b===0?j.delete("tab"):j.set("tab",C[b]);const V=`${i.pathname}${j.toString()?`?${j.toString()}`:""}`;window.history.replaceState(null,"",V)};return n.jsxs(Zv,{maxWidth:"xl",sx:{py:3},children:[n.jsxs(x,{sx:{mb:4},children:[n.jsx(S,{variant:"h4",component:"h1",sx:{fontWeight:"bold",background:`linear-gradient(135deg, ${o.palette.primary.main}, ${o.palette.secondary.main})`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",mb:1},children:"Communication Hub"}),n.jsx(S,{variant:"body1",color:"text.secondary",children:"Secure messaging and collaboration platform for healthcare teams"})]}),n.jsxs(st,{sx:{bgcolor:"background.paper",borderRadius:2,overflow:"hidden",boxShadow:o.shadows[4]},children:[n.jsx(x,{sx:{borderBottom:1,borderColor:"divider",bgcolor:ey(o.palette.primary.main,.02)},children:n.jsxs(gu,{value:s,onChange:d,"aria-label":"communication hub tabs",sx:{"& .MuiTab-root":{textTransform:"none",fontWeight:600,fontSize:"0.95rem",minHeight:64},"& .Mui-selected":{color:o.palette.primary.main}},children:[n.jsx(Br,{label:"Messages"}),n.jsx(Br,{label:"Notifications"}),n.jsx(Br,{label:"Patient Queries"}),n.jsx(Br,{label:"Audit Logs"})]})}),n.jsx(Ws,{value:s,index:0,children:n.jsx(d1,{})}),n.jsx(Ws,{value:s,index:1,children:n.jsx(Fu,{})}),n.jsx(Ws,{value:s,index:2,children:n.jsx(b1,{})}),n.jsx(Ws,{value:s,index:3,children:n.jsx(y1,{})})]})]})};export{dj as default};
