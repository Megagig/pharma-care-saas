import{z as Ce,c9 as Pe,r as a,j as e,C as N,b as W,D as y,B as n,bj as ne,bk as B,T as i,aP as we,aQ as Re,aR as Te,aS as De,h as j,G as r,a4 as h,aa as K,l as g,I as Ne,a6 as Z,a7 as ee,a8 as se,f as p,bC as M,bo as A,bp as C,aU as P,bq as w,L as R,n as T,p as D,W as We,_ as Be,Y as ke,aX as ze,O as te}from"./index-louytu0d.js";import{u as Oe,b as $e}from"./usePatients--qdYAPd6.js";import{b as Le}from"./api-Ce5h1_pV.js";import{A as Ee}from"./Autocomplete-DW-SeE61.js";import{R as Fe}from"./Remove-BUFeT4ko.js";import{A as ie}from"./Add-DinP5QbX.js";import{L as Me}from"./LocalHospital-BMwh71ta.js";const _e=()=>{var Y,J;const{user:d}=Ce(),{hasFeature:k}=Pe(),[x,b]=a.useState(0),[v,f]=a.useState(!1),[l,ae]=a.useState(null),[_,z]=a.useState(null),[re,I]=a.useState(!1),[le,oe]=a.useState(!1),[m,ce]=a.useState(""),[de,ue]=a.useState(null),{data:O,isLoading:$}=Oe({limit:100}),{data:L,isLoading:E}=$e(m),he=((Y=O==null?void 0:O.data)==null?void 0:Y.results)||[],xe=((J=L==null?void 0:L.data)==null?void 0:J.results)||[],q=m.length>=2?xe:he,[G,pe]=a.useState(""),[u,F]=a.useState([{type:"subjective",description:""}]),[me,qe]=a.useState([]),[je,Ge]=a.useState([]),[o,S]=a.useState({}),[U,ge]=a.useState(""),[H,ye]=a.useState("mild"),[Q,be]=a.useState("acute");if(!((d==null?void 0:d.role)==="super_admin"||k("clinical_decision_support")))return e.jsx(N,{children:e.jsx(W,{children:e.jsx(y,{severity:"warning",children:"Clinical Decision Support feature is not available in your current plan. Please upgrade to access AI-powered diagnostic assistance."})})});const V=s=>{F([...u,{type:s,description:""}])},ve=s=>{F(u.filter((t,c)=>c!==s))},fe=(s,t)=>{const c=[...u];c[s].description=t,F(c)},X=async()=>{if(!le){I(!0);return}f(!0),z(null);try{const s=await Le.post("/diagnostics/ai",{patientId:G,symptoms:{subjective:u.filter(t=>t.type==="subjective").map(t=>t.description).filter(Boolean),objective:u.filter(t=>t.type==="objective").map(t=>t.description).filter(Boolean),duration:U,severity:H,onset:Q},labResults:me.filter(t=>t.testName&&t.value),currentMedications:je.filter(t=>t.name&&t.dosage),vitalSigns:o,patientConsent:{provided:!0,method:"electronic"}});ae(s.data.data),b(1)}catch(s){z(s instanceof Error?s.message:"An error occurred")}finally{f(!1)}},Ie=()=>e.jsxs(r,{container:!0,spacing:3,children:[e.jsxs(r,{item:!0,xs:12,children:[e.jsx(Ee,{fullWidth:!0,options:q,getOptionLabel:s=>`${s.displayName||`${s.firstName} ${s.lastName}`} - ${s.mrn}${s.age?` (${s.age} years)`:""}`,value:de,onChange:(s,t)=>{ue(t),pe(t?t._id:"")},inputValue:m,onInputChange:(s,t)=>{ce(t)},loading:$||E,filterOptions:s=>s,renderInput:s=>e.jsx(h,{...s,label:"Search and Select Patient",placeholder:"Type patient name, MRN, or phone number...",required:!0,InputProps:{...s.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[$||E?e.jsx(K,{color:"inherit",size:20}):null,s.InputProps.endAdornment]})}}),renderOption:(s,t)=>e.jsx(n,{component:"li",...s,children:e.jsxs(n,{children:[e.jsx(i,{variant:"body1",children:t.displayName||`${t.firstName} ${t.lastName}`}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["MRN: ",t.mrn," ",t.age&&`• Age: ${t.age}`," ",t.phone&&`• ${t.phone}`]})]})}),noOptionsText:m.length<2?"Type at least 2 characters to search patients":"No patients found"}),q.length===0&&!$&&!E&&m.length<2&&e.jsx(i,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:"No patients found. Please add patients to the system first."})]}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Symptoms"}),u.map((s,t)=>e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(g,{label:s.type==="subjective"?"Subjective":"Objective",color:s.type==="subjective"?"primary":"secondary",size:"small"}),e.jsx(h,{fullWidth:!0,placeholder:`Enter ${s.type} symptom`,value:s.description,onChange:c=>fe(t,c.target.value)}),e.jsx(Ne,{onClick:()=>ve(t),size:"small",children:e.jsx(Fe,{})})]},t)),e.jsxs(n,{sx:{display:"flex",gap:1,mt:1},children:[e.jsx(j,{startIcon:e.jsx(ie,{}),onClick:()=>V("subjective"),size:"small",children:"Add Subjective"}),e.jsx(j,{startIcon:e.jsx(ie,{}),onClick:()=>V("objective"),size:"small",children:"Add Objective"})]})]}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsx(h,{fullWidth:!0,label:"Duration",value:U,onChange:s=>ge(s.target.value),placeholder:"e.g., 3 days, 2 weeks"})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ee,{children:"Severity"}),e.jsxs(se,{value:H,onChange:s=>ye(s.target.value),children:[e.jsx(p,{value:"mild",children:"Mild"}),e.jsx(p,{value:"moderate",children:"Moderate"}),e.jsx(p,{value:"severe",children:"Severe"})]})]})}),e.jsx(r,{item:!0,xs:12,md:4,children:e.jsxs(Z,{fullWidth:!0,children:[e.jsx(ee,{children:"Onset"}),e.jsxs(se,{value:Q,onChange:s=>be(s.target.value),children:[e.jsx(p,{value:"acute",children:"Acute"}),e.jsx(p,{value:"chronic",children:"Chronic"}),e.jsx(p,{value:"subacute",children:"Subacute"})]})]})}),e.jsxs(r,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Vital Signs"}),e.jsxs(r,{container:!0,spacing:2,children:[e.jsx(r,{item:!0,xs:6,md:3,children:e.jsx(h,{fullWidth:!0,label:"Blood Pressure",value:o.bloodPressure||"",onChange:s=>S({...o,bloodPressure:s.target.value}),placeholder:"120/80"})}),e.jsx(r,{item:!0,xs:6,md:3,children:e.jsx(h,{fullWidth:!0,label:"Heart Rate",type:"number",value:o.heartRate||"",onChange:s=>S({...o,heartRate:Number(s.target.value)}),placeholder:"BPM"})}),e.jsx(r,{item:!0,xs:6,md:3,children:e.jsx(h,{fullWidth:!0,label:"Temperature",type:"number",value:o.temperature||"",onChange:s=>S({...o,temperature:Number(s.target.value)}),placeholder:"°C"})}),e.jsx(r,{item:!0,xs:6,md:3,children:e.jsx(h,{fullWidth:!0,label:"O2 Saturation",type:"number",value:o.oxygenSaturation||"",onChange:s=>S({...o,oxygenSaturation:Number(s.target.value)}),placeholder:"%"})})]})]}),e.jsx(r,{item:!0,xs:12,children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",mt:2},children:e.jsx(j,{variant:"contained",size:"large",startIcon:v?e.jsx(K,{size:20}):e.jsx(M,{}),onClick:X,disabled:v||!G||u.filter(s=>s.description).length===0,children:v?"Generating Analysis...":"Generate AI Analysis"})})})]}),Se=()=>l?e.jsxs(n,{children:[e.jsxs(y,{severity:"info",sx:{mb:3},children:["Analysis completed in ",l.processingTime,"ms with confidence score: ",l.analysis.confidenceScore,"%"]}),e.jsxs(A,{defaultExpanded:!0,children:[e.jsx(C,{expandIcon:e.jsx(P,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Me,{}),e.jsx(i,{variant:"h6",children:"Differential Diagnoses"})]})}),e.jsx(w,{children:e.jsx(R,{children:l.analysis.differentialDiagnoses.map((s,t)=>e.jsx(T,{children:e.jsx(D,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"subtitle1",children:s.condition}),e.jsx(g,{label:`${s.probability}%`,color:s.probability>70?"error":s.probability>40?"warning":"success",size:"small"}),e.jsx(g,{label:s.severity,color:s.severity==="high"?"error":s.severity==="medium"?"warning":"info",size:"small"})]}),secondary:s.reasoning})},t))})})]}),l.analysis.redFlags.length>0&&e.jsxs(A,{children:[e.jsx(C,{expandIcon:e.jsx(P,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(We,{color:"error"}),e.jsx(i,{variant:"h6",children:"Red Flags"})]})}),e.jsx(w,{children:e.jsx(R,{children:l.analysis.redFlags.map((s,t)=>e.jsx(T,{children:e.jsx(D,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"subtitle1",children:s.flag}),e.jsx(g,{label:s.severity,color:s.severity==="critical"?"error":s.severity==="high"?"warning":"info",size:"small"})]}),secondary:s.action})},t))})})]}),e.jsxs(A,{children:[e.jsx(C,{expandIcon:e.jsx(P,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Be,{}),e.jsx(i,{variant:"h6",children:"Recommended Tests"})]})}),e.jsx(w,{children:e.jsx(R,{children:l.analysis.recommendedTests.map((s,t)=>e.jsx(T,{children:e.jsx(D,{primary:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(i,{variant:"subtitle1",children:s.testName}),e.jsx(g,{label:s.priority,color:s.priority==="urgent"?"error":s.priority==="routine"?"warning":"info",size:"small"})]}),secondary:s.reasoning})},t))})})]}),e.jsxs(A,{children:[e.jsx(C,{expandIcon:e.jsx(P,{}),children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ke,{}),e.jsx(i,{variant:"h6",children:"Therapeutic Options"})]})}),e.jsx(w,{children:e.jsx(R,{children:l.analysis.therapeuticOptions.map((s,t)=>e.jsx(T,{children:e.jsx(D,{primary:`${s.medication} - ${s.dosage}, ${s.frequency}`,secondary:e.jsxs(n,{children:[e.jsx(i,{variant:"body2",children:s.reasoning}),s.safetyNotes.length>0&&e.jsxs(n,{sx:{mt:1},children:[e.jsx(i,{variant:"caption",color:"error",children:"Safety Notes:"}),s.safetyNotes.map((c,Ae)=>e.jsxs(i,{variant:"caption",display:"block",color:"error",children:["• ",c]},Ae))]})]})})},t))})})]}),e.jsx(y,{severity:"warning",sx:{mt:2},children:l.analysis.disclaimer})]}):null;return e.jsxs(n,{children:[_&&e.jsx(y,{severity:"error",sx:{mb:2},onClose:()=>z(null),children:_}),e.jsxs(ne,{value:x,onChange:(s,t)=>b(t),sx:{mb:3},children:[e.jsx(B,{label:"Input Data"}),e.jsx(B,{label:"AI Analysis",disabled:!l})]}),x===0&&e.jsx(N,{children:e.jsxs(W,{children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:"Clinical Data Input"}),Ie()]})}),x===1&&e.jsx(N,{children:e.jsxs(W,{children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:"AI Diagnostic Analysis"}),Se()]})}),e.jsxs(we,{open:re,onClose:()=>I(!1),children:[e.jsx(Re,{children:"Patient Consent Required"}),e.jsx(Te,{children:e.jsx(i,{children:"AI diagnostic analysis requires patient consent for data processing. Please ensure the patient has provided informed consent before proceeding."})}),e.jsxs(De,{children:[e.jsx(j,{onClick:()=>I(!1),children:"Cancel"}),e.jsx(j,{onClick:()=>{oe(!0),I(!1),X()},variant:"contained",children:"Patient Consents - Proceed"})]})]})]})},es=()=>{const[d,k]=a.useState(0),x={title:"Clinical Decision Support",purpose:"AI-powered diagnostic assistance and clinical recommendations for evidence-based patient care.",workflow:{description:"Intelligent clinical decision support system that provides AI-powered diagnostic analysis and evidence-based recommendations to enhance patient safety.",steps:["Input patient symptoms and clinical data","Review AI-generated diagnostic analysis","Evaluate differential diagnoses and recommendations","Accept, modify, or override AI suggestions","Document clinical rationale and decisions"]},keyFeatures:["AI-powered diagnostic analysis","Differential diagnosis ranking","Drug interaction checking","Red flag identification","Therapeutic recommendations","Evidence-based suggestions","Patient consent management","Clinical decision documentation"],status:"active",estimatedRelease:"Available Now"},b=(v,f)=>{k(f)};return e.jsxs(ze,{maxWidth:"xl",sx:{py:4},children:[e.jsx(n,{sx:{p:3,borderRadius:"12px",background:"linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%)",color:"white",mb:4,position:"relative",overflow:"hidden"},children:e.jsxs(n,{sx:{position:"relative",zIndex:1,display:"flex",alignItems:"center",gap:2},children:[e.jsx(n,{sx:{width:60,height:60,borderRadius:"50%",bgcolor:"rgba(255,255,255,0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(M,{sx:{fontSize:32}})}),e.jsxs(n,{children:[e.jsx(i,{variant:"h4",component:"h1",sx:{fontWeight:600},children:x.title}),e.jsx(i,{variant:"body1",sx:{opacity:.9,mt:.5},children:x.purpose})]})]})}),e.jsx(n,{sx:{borderBottom:1,borderColor:"divider",mb:3},children:e.jsxs(ne,{value:d,onChange:b,children:[e.jsx(B,{icon:e.jsx(M,{}),label:"AI Diagnostic Tool",iconPosition:"start"}),e.jsx(B,{icon:e.jsx(te,{}),label:"How to Use",iconPosition:"start"})]})}),d===0&&e.jsx(_e,{}),d===1&&e.jsx(N,{children:e.jsxs(W,{children:[e.jsxs(i,{variant:"h5",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(te,{color:"primary"}),"How to Use Clinical Decision Support"]}),e.jsxs(n,{sx:{mt:3},children:[e.jsx(i,{variant:"h6",gutterBottom:!0,color:"primary",children:"Step-by-Step Usage Guide"}),e.jsxs(n,{component:"ol",sx:{pl:2,"& > li":{mb:2}},children:[e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Select Patient"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Choose the patient from the dropdown menu. This ensures the AI analysis is contextualized with the patient's medical history."})]}),e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Input Symptoms"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:'Add both subjective symptoms (patient-reported) and objective findings (clinical observations). Use the "Add Subjective" and "Add Objective" buttons to categorize symptoms appropriately.'})]}),e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Clinical Details"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:'Specify the duration (e.g., "3 days", "2 weeks"), severity (mild/moderate/severe), and onset type (acute/chronic/subacute) of symptoms.'})]}),e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Vital Signs"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Enter current vital signs including blood pressure, heart rate, temperature, and oxygen saturation. This data helps the AI assess severity and urgency."})]}),e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Generate Analysis"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:'Click "Generate AI Analysis" to receive comprehensive diagnostic insights. The system will prompt for patient consent before proceeding.'})]}),e.jsxs("li",{children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,children:"Review Results"}),e.jsx(i,{variant:"body2",color:"text.secondary",children:"Examine the AI-generated differential diagnoses, red flags, recommended tests, and therapeutic options. Use these as clinical decision support - not replacement for professional judgment."})]})]}),e.jsxs(y,{severity:"info",sx:{mt:3},children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"Important Notes:"}),e.jsxs(i,{variant:"body2",children:["• This tool provides clinical decision support and should not replace professional medical judgment",e.jsx("br",{}),"• Always verify AI recommendations with current clinical guidelines",e.jsx("br",{}),"• Patient consent is required before generating AI analysis",e.jsx("br",{}),"• Red flags require immediate attention and possible escalation"]})]}),e.jsxs(n,{sx:{mt:3,p:2,bgcolor:"primary.50",borderRadius:2},children:[e.jsx(i,{variant:"subtitle1",fontWeight:600,color:"primary",gutterBottom:!0,children:"Best Practices"}),e.jsxs(i,{variant:"body2",children:["• Be thorough in symptom documentation for better AI accuracy",e.jsx("br",{}),"• Include all relevant vital signs and clinical observations",e.jsx("br",{}),"• Review drug interactions in therapeutic recommendations",e.jsx("br",{}),"• Document your clinical reasoning alongside AI suggestions",e.jsx("br",{}),"• Use confidence scores to guide decision-making"]})]})]})]})})]})};export{es as default};
