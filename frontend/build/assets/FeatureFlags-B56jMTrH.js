import{u as ye,aW as be,a3 as Ce,r as c,j as e,aX as N,D as $,T as d,B as n,aZ as fe,a_ as H,a$ as Q,h as j,C as V,cp as q,b as we,G as s,a4 as g,a6 as u,a7 as h,a8 as x,f as l,bB as Ae,I as P,$ as Te,S as Fe,ah as E,l as p,d as G,aP as L,aQ as z,aR as B,aS as O}from"./index-louytu0d.js";import{A as F}from"./Add-DinP5QbX.js";import{E as X}from"./Edit-B2er_J4R.js";import{D as Y}from"./Delete-CTgRaLP1.js";import{F as Se}from"./FilterList-BXxQXbYc.js";import{S as ke}from"./Search-BDaMMIPP.js";import{T as Re,a as We,b as Ie,c as J,d as _e}from"./TableRow-D2snGkma.js";import{T as o}from"./TableCell-ZA4nZKqC.js";import{S as M}from"./Switch-Cd_KxpXf.js";import{T as De}from"./TablePagination-F3GtdUGZ.js";import"./LastPage-fqBHFQFA.js";const y=[{value:"core",label:"Core Features",color:"primary"},{value:"analytics",label:"Analytics & Reporting",color:"secondary"},{value:"collaboration",label:"Collaboration & Teams",color:"success"},{value:"integration",label:"Integrations",color:"info"},{value:"compliance",label:"Compliance & Regulations",color:"warning"},{value:"administration",label:"Administration",color:"error"}],ee=["free_trial","basic","pro","pharmily","network","enterprise"],ae=["pharmacist","pharmacy_team","pharmacy_outlet","intern_pharmacist","super_admin"],$e=()=>{const re=ye(),S=be(re.breakpoints.down("md")),{isSuperAdmin:te}=Ce(),[se,k]=c.useState([]),[le,R]=c.useState(!0),[b,ie]=c.useState(""),[W,ne]=c.useState("all"),[C,oe]=c.useState("all"),[I,U]=c.useState(0),[f,ce]=c.useState(10),[de,w]=c.useState(!1),[ue,A]=c.useState(!1),[he,T]=c.useState(!1),[m,Z]=c.useState(null),[r,i]=c.useState({name:"",key:"",description:"",isActive:!0,allowedTiers:[],allowedRoles:[],category:"core",priority:"medium",tags:[]});c.useEffect(()=>{xe()},[]);const xe=async()=>{try{R(!0),setTimeout(()=>{k([{_id:"1",name:"Advanced Analytics",key:"advanced_analytics",description:"Access to advanced business intelligence dashboards and reports",isActive:!0,allowedTiers:["pro","pharmily","network","enterprise"],allowedRoles:["pharmacist","pharmacy_team","pharmacy_outlet"],metadata:{category:"analytics",priority:"high",tags:["analytics","reports","dashboard"]},customRules:{maxUsers:10,requiredLicense:!0},createdAt:"2024-01-15T10:00:00Z",updatedAt:"2024-01-20T14:30:00Z"},{_id:"2",name:"Team Management",key:"team_management",description:"Ability to invite and manage team members across the organization",isActive:!0,allowedTiers:["pro","pharmily","network","enterprise"],allowedRoles:["pharmacy_team","pharmacy_outlet"],metadata:{category:"collaboration",priority:"medium",tags:["team","collaboration","users"]},customRules:{maxUsers:50},createdAt:"2024-01-10T09:00:00Z",updatedAt:"2024-01-18T16:45:00Z"},{_id:"3",name:"API Access",key:"api_access",description:"Access to REST API endpoints for external integrations",isActive:!1,allowedTiers:["network","enterprise"],allowedRoles:["pharmacy_outlet","super_admin"],metadata:{category:"integration",priority:"low",tags:["api","integration","external"]},customRules:{requiredLicense:!0},createdAt:"2024-01-05T11:30:00Z",updatedAt:"2024-01-22T08:15:00Z"}]),R(!1)},1e3)}catch(a){console.error("Error fetching feature flags:",a),R(!1)}},me=async a=>{try{k(t=>t.map(v=>v._id===a._id?{...v,isActive:!v.isActive}:v))}catch(t){console.error("Error toggling flag:",t)}},_=()=>{i({name:"",key:"",description:"",isActive:!0,allowedTiers:[],allowedRoles:[],category:"core",priority:"medium",tags:[]}),w(!0)},je=a=>{Z(a),i({name:a.name,key:a.key,description:a.description,isActive:a.isActive,allowedTiers:a.allowedTiers,allowedRoles:a.allowedRoles,category:a.metadata.category,priority:a.metadata.priority,tags:a.metadata.tags}),A(!0)},pe=a=>{Z(a),T(!0)},D=se.filter(a=>{const t=a.name.toLowerCase().includes(b.toLowerCase())||a.key.toLowerCase().includes(b.toLowerCase())||a.description.toLowerCase().includes(b.toLowerCase()),v=W==="all"||a.metadata.category===W,ve=C==="all"||C==="active"&&a.isActive||C==="inactive"&&!a.isActive;return t&&v&&ve}),K=a=>y.find(t=>t.value===a)||y[0],ge=a=>{switch(a){case"critical":return"error";case"high":return"warning";case"medium":return"info";case"low":return"success";default:return"default"}};return te?e.jsxs(N,{maxWidth:"xl",sx:{mt:2,mb:4},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsxs(fe,{"aria-label":"breadcrumb",sx:{mb:2},children:[e.jsx(H,{component:Q,to:"/dashboard",color:"inherit",children:"Dashboard"}),e.jsx(H,{component:Q,to:"/admin",color:"inherit",children:"Admin"}),e.jsx(d,{color:"textPrimary",children:"Feature Flags"})]}),e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:2},children:[e.jsxs(n,{children:[e.jsx(d,{variant:"h3",component:"h1",gutterBottom:!0,children:"Feature Flags Management"}),e.jsx(d,{variant:"body1",color:"textSecondary",children:"Control feature access across different subscription tiers and user roles"})]}),!S&&e.jsx(j,{variant:"contained",startIcon:e.jsx(F,{}),onClick:_,size:"large",children:"Create Feature Flag"})]})]}),e.jsxs(V,{sx:{mb:4},children:[e.jsx(q,{title:"Filters & Search",avatar:e.jsx(Se,{})}),e.jsx(we,{children:e.jsxs(s,{container:!0,spacing:3,children:[e.jsx(s,{item:!0,xs:12,md:4,children:e.jsx(g,{fullWidth:!0,placeholder:"Search features...",value:b,onChange:a=>ie(a.target.value),InputProps:{startAdornment:e.jsx(ke,{sx:{mr:1,color:"text.secondary"}})}})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Category"}),e.jsxs(x,{value:W,label:"Category",onChange:a=>ne(a.target.value),children:[e.jsx(l,{value:"all",children:"All Categories"}),y.map(a=>e.jsx(l,{value:a.value,children:a.label},a.value))]})]})}),e.jsx(s,{item:!0,xs:12,md:4,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Status"}),e.jsxs(x,{value:C,label:"Status",onChange:a=>oe(a.target.value),children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"active",children:"Active"}),e.jsx(l,{value:"inactive",children:"Inactive"})]})]})})]})})]}),e.jsxs(V,{children:[e.jsx(q,{title:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{}),e.jsxs(d,{variant:"h6",children:["Feature Flags (",D.length,")"]})]}),action:S&&e.jsx(P,{onClick:_,children:e.jsx(F,{})})}),e.jsx(Te,{}),le?e.jsx(n,{sx:{p:3},children:Array.from(new Array(5)).map((a,t)=>e.jsx(Fe,{variant:"rectangular",height:60,sx:{mb:1}},t))}):e.jsxs(Re,{children:[e.jsxs(We,{children:[e.jsx(Ie,{children:e.jsxs(J,{children:[e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Name"}),e.jsx(o,{children:"Key"}),e.jsx(o,{children:"Category"}),e.jsx(o,{children:"Priority"}),e.jsx(o,{children:"Tiers"}),e.jsx(o,{align:"center",children:"Actions"})]})}),e.jsx(_e,{children:D.slice(I*f,I*f+f).map(a=>e.jsxs(J,{hover:!0,children:[e.jsx(o,{children:e.jsx(E,{control:e.jsx(M,{checked:a.isActive,onChange:()=>me(a),color:"primary"}),label:""})}),e.jsx(o,{children:e.jsxs(n,{children:[e.jsx(d,{variant:"subtitle2",gutterBottom:!0,children:a.name}),e.jsx(d,{variant:"caption",color:"textSecondary",children:a.description})]})}),e.jsx(o,{children:e.jsx(d,{variant:"body2",sx:{fontFamily:"monospace",backgroundColor:"background.paper",padding:"2px 6px",borderRadius:1,border:"1px solid",borderColor:"divider"},children:a.key})}),e.jsx(o,{children:e.jsx(p,{label:K(a.metadata.category).label,size:"sm",color:K(a.metadata.category).color,variant:"outlined"})}),e.jsx(o,{children:e.jsx(p,{label:a.metadata.priority.toUpperCase(),size:"sm",color:ge(a.metadata.priority),variant:"filled"})}),e.jsx(o,{children:e.jsxs(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.allowedTiers.slice(0,2).map(t=>e.jsx(p,{label:t,size:"sm",variant:"outlined"},t)),a.allowedTiers.length>2&&e.jsx(p,{label:`+${a.allowedTiers.length-2}`,size:"sm",variant:"outlined",color:"default"})]})}),e.jsx(o,{align:"center",children:e.jsxs(n,{sx:{display:"flex",gap:.5},children:[e.jsx(G,{title:"Edit",children:e.jsx(P,{size:"sm",onClick:()=>je(a),children:e.jsx(X,{})})}),e.jsx(G,{title:"Delete",children:e.jsx(P,{size:"sm",color:"error",onClick:()=>pe(a),children:e.jsx(Y,{})})})]})})]},a._id))})]}),e.jsx(De,{component:"div",count:D.length,page:I,onPageChange:(a,t)=>U(t),rowsPerPage:f,onRowsPerPageChange:a=>{ce(parseInt(a.target.value,10)),U(0)}})]})]}),S&&e.jsx(n,{sx:{position:"fixed",bottom:24,right:24,zIndex:1e3},children:e.jsx(j,{variant:"contained",onClick:_,sx:{minWidth:56,height:56,borderRadius:"50%"},children:e.jsx(F,{})})}),e.jsxs(L,{open:de,onClose:()=>w(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(F,{}),"Create New Feature Flag"]})}),e.jsx(B,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Feature Name",value:r.name,onChange:a=>i({...r,name:a.target.value})})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Feature Key",value:r.key,onChange:a=>i({...r,key:a.target.value}),helperText:"Unique identifier for the feature"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:r.description,onChange:a=>i({...r,description:a.target.value})})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Category"}),e.jsx(x,{value:r.category,label:"Category",onChange:a=>i({...r,category:a.target.value}),children:y.map(a=>e.jsx(l,{value:a.value,children:a.label},a.value))})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Priority"}),e.jsxs(x,{value:r.priority,label:"Priority",onChange:a=>i({...r,priority:a.target.value}),children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"critical",children:"Critical"})]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Allowed Tiers"}),e.jsx(x,{multiple:!0,value:r.allowedTiers,label:"Allowed Tiers",onChange:a=>i({...r,allowedTiers:a.target.value}),renderValue:a=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.map(t=>e.jsx(p,{label:t,size:"sm"},t))}),children:ee.map(a=>e.jsx(l,{value:a,children:a},a))})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Allowed Roles"}),e.jsx(x,{multiple:!0,value:r.allowedRoles,label:"Allowed Roles",onChange:a=>i({...r,allowedRoles:a.target.value}),renderValue:a=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.map(t=>e.jsx(p,{label:t,size:"sm"},t))}),children:ae.map(a=>e.jsx(l,{value:a,children:a},a))})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(E,{control:e.jsx(M,{checked:r.isActive,onChange:a=>i({...r,isActive:a.target.checked})}),label:"Active by default"})})]})}),e.jsxs(O,{children:[e.jsx(j,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(j,{variant:"contained",onClick:()=>{w(!1)},children:"Create Feature Flag"})]})]}),e.jsxs(L,{open:ue,onClose:()=>A(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(z,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(X,{}),"Edit Feature Flag"]})}),e.jsx(B,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Feature Name",value:r.name,onChange:a=>i({...r,name:a.target.value})})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsx(g,{fullWidth:!0,label:"Feature Key",value:r.key,onChange:a=>i({...r,key:a.target.value}),disabled:!0,helperText:"Key cannot be changed after creation"})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,multiline:!0,rows:3,label:"Description",value:r.description,onChange:a=>i({...r,description:a.target.value})})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Category"}),e.jsx(x,{value:r.category,label:"Category",onChange:a=>i({...r,category:a.target.value}),children:y.map(a=>e.jsx(l,{value:a.value,children:a.label},a.value))})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Priority"}),e.jsxs(x,{value:r.priority,label:"Priority",onChange:a=>i({...r,priority:a.target.value}),children:[e.jsx(l,{value:"low",children:"Low"}),e.jsx(l,{value:"medium",children:"Medium"}),e.jsx(l,{value:"high",children:"High"}),e.jsx(l,{value:"critical",children:"Critical"})]})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Allowed Tiers"}),e.jsx(x,{multiple:!0,value:r.allowedTiers,label:"Allowed Tiers",onChange:a=>i({...r,allowedTiers:a.target.value}),renderValue:a=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.map(t=>e.jsx(p,{label:t,size:"sm"},t))}),children:ee.map(a=>e.jsx(l,{value:a,children:a},a))})]})}),e.jsx(s,{item:!0,xs:12,sm:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(h,{children:"Allowed Roles"}),e.jsx(x,{multiple:!0,value:r.allowedRoles,label:"Allowed Roles",onChange:a=>i({...r,allowedRoles:a.target.value}),renderValue:a=>e.jsx(n,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:a.map(t=>e.jsx(p,{label:t,size:"sm"},t))}),children:ae.map(a=>e.jsx(l,{value:a,children:a},a))})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(E,{control:e.jsx(M,{checked:r.isActive,onChange:a=>i({...r,isActive:a.target.checked})}),label:"Feature is active"})})]})}),e.jsxs(O,{children:[e.jsx(j,{onClick:()=>A(!1),children:"Cancel"}),e.jsx(j,{variant:"contained",onClick:()=>{A(!1)},children:"Update Feature Flag"})]})]}),e.jsxs(L,{open:he,onClose:()=>T(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(z,{children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,color:"error.main"},children:[e.jsx(Y,{}),"Delete Feature Flag"]})}),e.jsxs(B,{children:[e.jsx($,{severity:"warning",sx:{mb:2},children:"This action cannot be undone. This will permanently delete the feature flag and may affect users who depend on it."}),e.jsxs(d,{variant:"body1",children:["Are you sure you want to delete the feature flag"," ",e.jsxs("strong",{children:['"$',m==null?void 0:m.name,'"']}),"?"]}),e.jsxs(d,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Key: ",m==null?void 0:m.key]})]}),e.jsxs(O,{children:[e.jsx(j,{onClick:()=>T(!1),children:"Cancel"}),e.jsx(j,{variant:"contained",color:"error",onClick:()=>{m&&k(a=>a.filter(t=>t._id!==m._id)),T(!1)},children:"Delete Forever"})]})]})]}):e.jsx(N,{maxWidth:"lg",sx:{mt:4,mb:8},children:e.jsxs($,{severity:"error",sx:{mt:4},children:[e.jsx(d,{variant:"h6",gutterBottom:!0,children:"Access Denied"}),e.jsx(d,{children:"You need super admin permissions to access feature flag management."})]})})};export{$e as default};
