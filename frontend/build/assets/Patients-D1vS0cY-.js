import{g as xe,a2 as he,a3 as me,r as j,j as e,B as r,D as L,T as n,h as u,l as p,C as V,b as ge,a4 as C,a5 as je,a6 as K,a7 as U,a8 as H,f as x,S as ue,a9 as pe,A as fe,W as ye,d as z,I as N,V as Y,M as ve,aa as be}from"./index-louytu0d.js";import{S as Pe}from"./Search-BDaMMIPP.js";import{F as Ae}from"./FilterList-BXxQXbYc.js";import{M as Ce}from"./MoreVert-nhhWlZ7h.js";import{E as q}from"./Edit-B2er_J4R.js";import{D as Se}from"./Delete-CTgRaLP1.js";import{L as S}from"./LocalHospital-BMwh71ta.js";import{I as Q}from"./PersonAdd-uFn5Wt3l.js";import{u as we,a as ke}from"./usePatients--qdYAPd6.js";import{A as Ie}from"./Autocomplete-DW-SeE61.js";import{T as Te,a as ze,b as Ne,c as w,d as De}from"./TableRow-D2snGkma.js";import{T as t}from"./TableCell-ZA4nZKqC.js";import{T as We}from"./TablePagination-F3GtdUGZ.js";import"./LastPage-fqBHFQFA.js";const Me=["Abia","Adamawa","Akwa Ibom","Anambra","Bauchi","Bayelsa","Benue","Borno","Cross River","Delta","Ebonyi","Edo","Ekiti","Enugu","FCT","Gombe","Imo","Jigawa","Kaduna","Kano","Katsina","Kebbi","Kogi","Kwara","Lagos","Nasarawa","Niger","Ogun","Ondo","Osun","Oyo","Plateau","Rivers","Sokoto","Taraba","Yobe","Zamfara"],Be=["A+","A-","B+","B-","AB+","AB-","O+","O-"],$e=["AA","AS","SS","AC","SC","CC"],Je=()=>{var R,O;const h=xe(),[D]=he(),l=D.get("for")==="medications",c=D.get("for")==="diagnostics",{permissions:J}=me(),[i,f]=j.useState({page:1,limit:10}),[W,Z]=j.useState(""),[y,X]=j.useState(!1),[m,M]=j.useState(null),[B,$]=j.useState(null),{data:d,isLoading:E,isError:F,error:k}=we(i),I=ke(),T=((R=d==null?void 0:d.data)==null?void 0:R.results)||[],v=((O=d==null?void 0:d.meta)==null?void 0:O.total)||0,ee=(i.page||1)-1;console.log("Patients page data:",{patientsResponse:d,patients:T.length,totalPatients:v,searchParams:i,isLoading:E,isError:F,error:k});const ae=a=>{Z(a),f(s=>({...s,q:a||void 0,page:1}))},g=a=>{f(s=>({...s,...a,page:1}))},se=(a,s)=>{f(o=>({...o,page:s+1}))},te=a=>{const s=parseInt(a.target.value,10);f(o=>({...o,limit:s,page:1}))},ne=(a,s)=>{$(a.currentTarget),M(s)},b=()=>{$(null),M(null)},re=async()=>{if(m)try{await I.mutateAsync(m),b()}catch(a){console.error("Failed to delete patient:",a)}},P=a=>{h(l?`/patients/${a}/medications`:c?`/pharmacy/diagnostics/case/new?selectedPatient=${a}`:`/patients/${a}`),b()},G=a=>{h(`/patients/${a}/edit`),b()},ie=a=>{if(!a)return null;const s=new Date,o=new Date(a);let A=s.getFullYear()-o.getFullYear();const _=s.getMonth()-o.getMonth();return(_<0||_===0&&s.getDate()<o.getDate())&&A--,A},oe=(a,s)=>`${a[0]||""}${s[0]||""}`.toUpperCase(),le=a=>{if(!a)return"N/A";if(a.startsWith("+234")){const s=a.slice(4);return`+234 ${s.slice(0,3)} ${s.slice(3,6)} ${s.slice(6)}`}return a},ce=a=>a.displayName||`${a.firstName} ${a.lastName}`,de=a=>{if(a.age!==void 0)return`${a.age} years`;if(a.calculatedAge!==void 0)return`${a.calculatedAge} years`;const s=ie(a.dob);return s?`${s} years`:"Unknown"};return F?e.jsxs(r,{sx:{p:3},children:[e.jsxs(L,{severity:"error",sx:{mb:3},children:[e.jsx(n,{variant:"h6",children:"Failed to load patients"}),e.jsx(n,{variant:"body2",children:k instanceof Error?k.message:"An unexpected error occurred while loading patient data."})]}),e.jsx(u,{variant:"outlined",onClick:()=>window.location.reload(),sx:{mt:2},children:"Retry"})]}):e.jsxs(r,{sx:{p:3},children:[(l||c)&&e.jsxs(L,{severity:"info",sx:{mb:3,display:"flex",alignItems:"center"},icon:e.jsx(S,{fontSize:"inherit"}),children:[e.jsx(r,{sx:{fontWeight:"medium"},children:"Patient Selection Mode"}),e.jsx(n,{variant:"body2",children:l?'Select a patient from the list below to manage their medications. Click the "Select" button in the Actions column to proceed.':'Select a patient from the list below to create a diagnostic case. Click the "Select" button in the Actions column to proceed.'})]}),e.jsxs(r,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:4,flexWrap:"wrap",gap:2},children:[e.jsxs(r,{sx:{flex:1,minWidth:300},children:[e.jsxs(n,{variant:"h4",component:"h1",sx:{fontWeight:600,mb:1,display:"flex",alignItems:"center",gap:1},children:[e.jsx(S,{color:"primary"}),l?"Select a Patient for Medications":c?"Select a Patient for Diagnostic Case":"Patient Management"]}),e.jsxs(n,{component:"div",variant:"body1",color:"text.secondary",children:[l?"Click on any patient to manage their medications":c?"Click on any patient to create a diagnostic case":"Comprehensive patient care and medical records management",v>0&&e.jsx(p,{label:`${v} total patients`,size:"small",color:"primary",variant:"outlined",sx:{ml:2}})]})]}),e.jsxs(r,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(u,{variant:"outlined",startIcon:e.jsx(Ae,{}),onClick:()=>X(!y),sx:{borderRadius:2},children:y?"Hide Filters":"Advanced Filters"}),e.jsx(u,{variant:"contained",startIcon:e.jsx(Q,{}),sx:{borderRadius:2,py:1.5,px:3},onClick:()=>h("/patients/new"),children:"Add New Patient"})]})]}),e.jsx(V,{sx:{mb:3},children:e.jsxs(ge,{children:[e.jsx(r,{sx:{display:"flex",gap:2,mb:y?3:0},children:e.jsx(C,{placeholder:"Search patients by name, MRN, phone, or email...",variant:"outlined",value:W,onChange:a=>ae(a.target.value),InputProps:{startAdornment:e.jsx(je,{position:"start",children:e.jsx(Pe,{color:"action"})})},sx:{flexGrow:1,minWidth:300}})}),y&&e.jsxs(r,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2,pt:2,borderTop:1,borderColor:"divider"},children:[e.jsx(Ie,{options:Me,value:i.state||null,onChange:(a,s)=>g({state:s||void 0}),renderInput:a=>e.jsx(C,{...a,label:"State",size:"small"})}),e.jsxs(K,{size:"small",children:[e.jsx(U,{children:"Blood Group"}),e.jsxs(H,{value:i.bloodGroup||"",label:"Blood Group",onChange:a=>g({bloodGroup:a.target.value||void 0}),children:[e.jsx(x,{value:"",children:"All Blood Groups"}),Be.map(a=>e.jsx(x,{value:a,children:a},a))]})]}),e.jsxs(K,{size:"small",children:[e.jsx(U,{children:"Genotype"}),e.jsxs(H,{value:i.genotype||"",label:"Genotype",onChange:a=>g({genotype:a.target.value||void 0}),children:[e.jsx(x,{value:"",children:"All Genotypes"}),$e.map(a=>e.jsx(x,{value:a,children:a},a))]})]}),e.jsx(C,{label:"MRN",size:"small",value:i.mrn||"",onChange:a=>g({mrn:a.target.value||void 0}),placeholder:"PHM-LAG-001"}),e.jsx(C,{label:"Phone Number",size:"small",value:i.phone||"",onChange:a=>g({phone:a.target.value||void 0}),placeholder:"+234812345678"})]})]})}),e.jsxs(V,{children:[e.jsx(Te,{children:e.jsxs(ze,{children:[e.jsx(Ne,{children:e.jsxs(w,{children:[e.jsx(t,{sx:{fontWeight:600},children:"Patient"}),e.jsx(t,{sx:{fontWeight:600},children:"MRN"}),e.jsx(t,{sx:{fontWeight:600},children:"Age/Gender"}),e.jsx(t,{sx:{fontWeight:600},children:"Contact"}),e.jsx(t,{sx:{fontWeight:600},children:"Location"}),e.jsx(t,{sx:{fontWeight:600},children:"Medical Info"}),e.jsx(t,{sx:{fontWeight:600},children:"MTR Status"}),e.jsx(t,{sx:{fontWeight:600},children:"Vitals"}),e.jsx(t,{sx:{fontWeight:600,textAlign:"center"},children:"Actions"})]})}),e.jsx(De,{children:E?Array.from({length:i.limit||10}).map((a,s)=>e.jsx(w,{children:Array.from({length:9}).map((o,A)=>e.jsx(t,{children:e.jsx(ue,{variant:"text",height:40})},A))},s)):T.length===0?e.jsx(w,{children:e.jsx(t,{colSpan:9,sx:{textAlign:"center",py:6},children:e.jsxs(pe,{spacing:2,alignItems:"center",children:[e.jsx(S,{sx:{fontSize:48,color:"text.secondary"}}),e.jsx(n,{variant:"h6",color:"text.secondary",children:"No patients found"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:W||Object.keys(i).length>2?"Try adjusting your search or filter criteria":"Add your first patient to get started with patient management"}),e.jsx(u,{variant:"contained",startIcon:e.jsx(Q,{}),sx:{mt:2},onClick:()=>h("/patients/new"),children:"Add First Patient"})]})})}):T.map(a=>e.jsxs(w,{hover:!0,sx:{"&:hover":{bgcolor:l||c?"primary.lighter":"action.hover",transition:"background-color 0.2s ease"},cursor:l||c?"pointer":"default",bgcolor:l||c?"rgba(25, 118, 210, 0.04)":"inherit"},onClick:l||c?()=>P(a._id):void 0,children:[e.jsx(t,{children:e.jsxs(r,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(fe,{sx:{bgcolor:"primary.main",width:40,height:40},children:oe(a.firstName,a.lastName)}),e.jsxs(r,{children:[e.jsx(n,{variant:"body2",sx:{fontWeight:500},children:ce(a)}),e.jsx(n,{variant:"caption",color:"text.secondary",children:a.otherNames&&`(${a.otherNames})`})]})]})}),e.jsx(t,{children:e.jsx(n,{variant:"body2",sx:{fontWeight:500,fontFamily:"monospace"},children:a.mrn})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",children:de(a)}),e.jsx(n,{variant:"caption",color:"text.secondary",children:a.gender?a.gender.charAt(0).toUpperCase()+a.gender.slice(1):"Unknown"})]}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",children:le(a.phone)}),e.jsx(n,{variant:"caption",color:"text.secondary",children:a.email||"No email"})]}),e.jsxs(t,{children:[e.jsx(n,{variant:"body2",children:a.state||"Unknown"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:a.lga||"Unknown LGA"})]}),e.jsx(t,{children:e.jsxs(r,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[a.bloodGroup&&e.jsx(p,{label:a.bloodGroup,size:"small",color:"primary",variant:"outlined",sx:{fontSize:"0.75rem"}}),a.genotype&&e.jsx(p,{label:a.genotype,size:"small",color:a.genotype.includes("S")?"warning":"success",variant:"outlined",sx:{fontSize:"0.75rem"}}),a.hasActiveDTP&&e.jsx(p,{label:"DTP",size:"small",color:"error",icon:e.jsx(ye,{sx:{fontSize:14}}),sx:{fontSize:"0.75rem"}})]})}),e.jsx(t,{children:e.jsx(p,{label:"MTR Available",size:"small",variant:"outlined",color:"default"})}),e.jsx(t,{children:a.latestVitals?e.jsxs(r,{children:[e.jsxs(n,{variant:"caption",color:"text.secondary",children:["BP: ",a.latestVitals.bpSys,"/",a.latestVitals.bpDia," mmHg"]}),a.weightKg&&e.jsxs(n,{variant:"caption",color:"text.secondary",display:"block",children:["Weight: ",a.weightKg,"kg"]})]}):e.jsx(n,{variant:"caption",color:"text.secondary",children:"No vitals recorded"})}),e.jsx(t,{sx:{textAlign:"center"},children:e.jsxs(r,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[l||c?e.jsx(u,{size:"small",variant:"contained",color:"primary",onClick:s=>{s.stopPropagation(),P(a._id)},startIcon:e.jsx(S,{}),children:"Select"}):e.jsx(z,{title:"View Details",children:e.jsx(N,{size:"small",color:"primary",onClick:()=>P(a._id),children:e.jsx(Y,{fontSize:"small"})})}),e.jsx(z,{title:"Edit Patient",children:e.jsx(N,{size:"small",color:"primary",onClick:()=>G(a._id),children:e.jsx(q,{fontSize:"small"})})}),e.jsx(z,{title:"More Actions",children:e.jsx(N,{size:"small",onClick:s=>ne(s,a._id),color:"primary",children:e.jsx(Ce,{fontSize:"small"})})})]})})]},a._id))})]})}),e.jsx(We,{component:"div",count:v,page:ee,onPageChange:se,rowsPerPage:i.limit||10,onRowsPerPageChange:te,rowsPerPageOptions:[5,10,25,50,100],sx:{borderTop:1,borderColor:"divider"},labelDisplayedRows:({from:a,to:s,count:o})=>`${a}–${s} of ${o!==-1?o:`more than ${s}`}`})]}),e.jsxs(ve,{anchorEl:B,open:!!B,onClose:b,PaperProps:{sx:{minWidth:180}},children:[e.jsxs(x,{onClick:()=>m&&P(m),children:[e.jsx(Y,{sx:{mr:1,fontSize:18}}),"View Patient Profile"]}),e.jsxs(x,{onClick:()=>m&&G(m),children:[e.jsx(q,{sx:{mr:1,fontSize:18}}),"Edit Patient Info"]}),J.canDelete&&e.jsxs(x,{onClick:re,sx:{color:"error.main"},disabled:I.isPending,children:[I.isPending?e.jsx(be,{size:18,sx:{mr:1}}):e.jsx(Se,{sx:{mr:1,fontSize:18}}),"Delete Patient"]})]})]})};export{Je as default};
