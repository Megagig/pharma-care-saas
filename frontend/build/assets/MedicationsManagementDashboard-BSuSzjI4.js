import{c as S,j as e,u as L,B as t,T as n,aO as k,bi as b,d as B,h as o,M as q,f as M,D as h,G as c,C as j,b as m,aa as l,a$ as p,w as W,b4 as V,Q as E,P as D}from"./index-louytu0d.js";import{R as K,c as $,b as N,X as G,Y as O,T as Y,L as H,d as Q}from"./LineChart-C8w0z8yz.js";import{m as C}from"./medicationManagementService-CyHUiaEu.js";import"./reselect-BYKfjCpY.js";import"./api-Ce5h1_pV.js";const X=S(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"})),U=({data:a})=>{const i=L(),y=({active:d,payload:x,label:g})=>d&&x&&x.length?e.jsxs(t,{sx:{backgroundColor:i.palette.background.paper,p:1.5,boxShadow:i.shadows[2],borderRadius:1,border:`1px solid ${i.palette.divider}`},children:[e.jsx(n,{variant:"subtitle2",children:g}),e.jsxs(n,{variant:"body2",sx:{color:i.palette.primary.main,fontWeight:"medium",display:"flex",alignItems:"center",gap:1},children:["Adherence: ",x[0].value,"%"]})]}):null;return!a||a.length===0?e.jsxs(t,{sx:{height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",border:"1px dashed",borderColor:"divider",borderRadius:1,p:2},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Data Available"}),e.jsx(n,{variant:"body2",color:"text.secondary",align:"center",children:"There is no adherence data available for the selected time period."})]}):e.jsx(K,{width:"100%",height:"100%",children:e.jsxs($,{data:a,margin:{top:10,right:30,left:20,bottom:30},children:[e.jsx(N,{strokeDasharray:"3 3",stroke:i.palette.divider}),e.jsx(G,{dataKey:"name",tick:{fill:i.palette.text.secondary},tickMargin:10,angle:-15}),e.jsx(O,{domain:[0,100],tickFormatter:d=>`${d}%`,tick:{fill:i.palette.text.secondary}}),e.jsx(Y,{content:e.jsx(y,{})}),e.jsx(H,{wrapperStyle:{paddingTop:"10px"}}),e.jsx(Q,{type:"monotone",dataKey:"adherence",name:"Medication Adherence",stroke:i.palette.primary.main,strokeWidth:2,dot:{r:4,strokeWidth:1,fill:i.palette.background.paper},activeDot:{r:6,stroke:i.palette.primary.main,strokeWidth:2}})]})})},ne=()=>{const[a,i]=k.useState("month"),[y,d]=k.useState(null),x=!!y,g=s=>{d(s.currentTarget)},f=()=>{d(null)},z=()=>{alert("Exporting medications data as CSV..."),f()},I=()=>{alert("Exporting medications data as PDF..."),f()},{data:r,isLoading:u,error:T}=b({queryKey:["medicationDashboardStats"],queryFn:async()=>{try{return await C.getDashboardStats()}catch(s){return console.error("Error fetching dashboard stats:",s),{activeMedications:0,averageAdherence:0,interactionAlerts:0}}}}),{data:v,isLoading:P,error:A}=b({queryKey:["recentPatientsWithMedications"],queryFn:async()=>{try{return await C.getRecentPatientsWithMedications()}catch(s){return console.error("Error fetching recent patients:",s),[]}}}),{data:R,isLoading:F,error:w}=b({queryKey:["medicationAdherenceTrends",a],queryFn:async()=>{try{return await C.getAdherenceTrends(a)}catch(s){return console.error("Error fetching adherence trends:",s),[]}}});return e.jsxs(t,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(n,{variant:"h5",component:"h1",children:"Medication Management Dashboard"}),e.jsxs(t,{children:[e.jsx(B,{title:"Export Data",children:e.jsx(o,{variant:"outlined",startIcon:e.jsx(X,{}),onClick:g,size:"small",children:"Export"})}),e.jsxs(q,{anchorEl:y,open:x,onClose:f,children:[e.jsx(M,{onClick:z,children:"Export as CSV"}),e.jsx(M,{onClick:I,children:"Export as PDF"})]})]})]}),(T||A||w)&&e.jsx(h,{severity:"error",sx:{mb:3},children:"There was an error loading the dashboard data. Please try refreshing the page."}),e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{size:{xs:12,md:4},children:e.jsx(j,{children:e.jsxs(m,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Active Medications"}),u?e.jsx(t,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(l,{size:40})}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h3",children:(r==null?void 0:r.activeMedications)||0}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Across all patients"})]})]})})}),e.jsx(c,{size:{xs:12,md:4},children:e.jsx(j,{children:e.jsxs(m,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Average Adherence"}),u?e.jsx(t,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(l,{size:40})}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"h3",children:[(r==null?void 0:r.averageAdherence)||0,"%"]}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Based on refill patterns"})]})]})})}),e.jsx(c,{size:{xs:12,md:4},children:e.jsx(j,{children:e.jsxs(m,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Interaction Alerts"}),u?e.jsx(t,{sx:{display:"flex",justifyContent:"center",my:2},children:e.jsx(l,{size:40})}):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"h3",children:(r==null?void 0:r.interactionAlerts)||0}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Requiring attention"})]})]})})}),e.jsx(c,{size:{xs:12,md:12},children:e.jsx(j,{sx:{mb:3},children:e.jsxs(m,{children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h6",children:"Recent Interaction Alerts"}),e.jsx(o,{component:p,to:"/medication-interactions",size:"small",children:"View All"})]}),u?e.jsx(t,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(l,{})}):(r==null?void 0:r.interactionAlerts)===0?e.jsx(h,{severity:"success",icon:e.jsx(W,{}),children:"No medication interaction alerts detected"}):e.jsxs(h,{severity:"warning",sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx(V,{children:"Attention Required"}),r==null?void 0:r.interactionAlerts," potential medication"," ",(r==null?void 0:r.interactionAlerts)===1?"interaction":"interactions"," ","detected"]}),e.jsx(o,{variant:"contained",color:"warning",component:p,to:"/medication-interactions",size:"small",children:"Review Now"})]})]})})}),e.jsx(c,{size:{xs:12,md:8},children:e.jsxs(E,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h6",children:"Medication Adherence Trends"}),e.jsxs(t,{children:[e.jsx(o,{size:"small",variant:a==="week"?"contained":"outlined",sx:{mr:1},onClick:()=>i("week"),children:"Week"}),e.jsx(o,{size:"small",variant:a==="month"?"contained":"outlined",sx:{mr:1},onClick:()=>i("month"),children:"Month"}),e.jsx(o,{size:"small",variant:a==="year"?"contained":"outlined",onClick:()=>i("year"),children:"Year"})]})]}),e.jsx(t,{sx:{height:300},children:F?e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:e.jsx(l,{})}):w?e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",border:"1px dashed",borderColor:"divider",borderRadius:1},children:e.jsx(n,{color:"error",children:"Failed to load chart data"})}):e.jsx(U,{data:R||[]})})]})}),e.jsx(c,{size:{xs:12,md:4},children:e.jsxs(E,{sx:{p:3},children:[e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(n,{variant:"h6",children:"Recent Patients"}),e.jsx(o,{component:p,to:"/patients",size:"small",children:"View All"})]}),P?e.jsx(t,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(l,{})}):A?e.jsx(h,{severity:"error",children:"Failed to load recent patients"}):v&&v.length>0?v.map(s=>e.jsx(j,{sx:{mb:2},children:e.jsx(m,{sx:{py:2,"&:last-child":{pb:2}},children:e.jsxs(t,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(t,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:"primary.light",display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:e.jsx(D,{sx:{color:"primary.main"}})}),e.jsxs(t,{children:[e.jsx(n,{variant:"body1",fontWeight:"bold",children:s.name}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:[s.medicationCount," medications â€¢"," ",s.lastUpdate]})]})]}),e.jsx(o,{component:p,to:`/patients/${s.id}/medications`,size:"small",variant:"outlined",children:"View"})]})})},s.id)):e.jsx(h,{severity:"info",children:"No recent patients with medications"}),e.jsx(t,{sx:{textAlign:"center",mt:2},children:e.jsx(o,{variant:"contained",component:p,to:"/patients?for=medications",children:"Select Patient"})})]})})]})]})};export{ne as default};
