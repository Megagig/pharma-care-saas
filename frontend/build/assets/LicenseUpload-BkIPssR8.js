import{ae as O,r as n,z as Q,bE as H,c5 as b,j as e,b1 as _,C as D,b as L,D as x,B as l,T as i,bx as $,by as g,bz as y,a4 as K,h as m,Q as I,I as N,x as X,V as Z,l as ee,aP as te,aQ as se,aR as ae,aS as ie,b5 as ne,W as re,w as le}from"./index-louytu0d.js";import{U as oe}from"./CloudUpload-CGSNiQ02.js";import{D as T}from"./Delete-CTgRaLP1.js";import{S as v}from"./StepContent-DsFsbqZA.js";const ce=O("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),je=()=>{var B;const[t,P]=n.useState(null),[W,z]=n.useState(!0),[F,U]=n.useState(!1),[o,j]=n.useState(""),[d,w]=n.useState(null),[R,c]=n.useState(0),[G,C]=n.useState(!1),[E,V]=n.useState(!1),[p,S]=n.useState(null),{user:u}=Q(),r=H(a=>a.addNotification),f=n.useCallback(async()=>{try{const a=await b.get("/api/license/status",{withCredentials:!0});if(a.status===200){const s=a.data;P(s.data),s.data.licenseNumber&&j(s.data.licenseNumber),s.data.status==="pending"?c(2):s.data.status==="approved"?c(3):s.data.hasDocument&&c(1)}}catch{r({type:"error",title:"Error",message:"Failed to load license status",duration:5e3})}finally{z(!1)}},[r,j,P,c]),k=n.useCallback(async()=>{V(!0);try{const a=await b.post("/api/license/validate-number",{licenseNumber:o},{withCredentials:!0});if(a.status===200){const s=a.data;S(s.data.isAvailable),s.data.isAvailable||r({type:"warning",title:"License Already Registered",message:s.data.message,duration:5e3})}}catch{S(!1)}finally{V(!1)}},[o,r]);n.useEffect(()=>{f()},[f]),n.useEffect(()=>{o.length>=6?k():S(null)},[o,k]);const Y=a=>{var h;const s=(h=a.target.files)==null?void 0:h[0];if(s){if(!["image/jpeg","image/jpg","image/png","image/webp","application/pdf"].includes(s.type)){r({type:"error",title:"Invalid File Type",message:"Please upload a JPEG, PNG, WebP, or PDF file",duration:5e3});return}if(s.size>5242880){r({type:"error",title:"File Too Large",message:"File size must be less than 5MB",duration:5e3});return}w(s)}},M=async()=>{var a;if(!d||!o||p===!1){r({type:"error",title:"Validation Error",message:"Please provide a valid license number and select a file",duration:5e3});return}U(!0);try{const s=new FormData;s.append("licenseDocument",d),s.append("licenseNumber",o);const h=await b.post("/api/license/upload",s,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}});if(h.status===200)r({type:"success",title:"Upload Successful",message:"Your license has been submitted for review",duration:5e3}),c(2),f(),w(null);else throw new Error(((a=h.data)==null?void 0:a.message)||"Upload failed")}catch(s){r({type:"error",title:"Upload Failed",message:s.message||"Failed to upload license document",duration:5e3})}finally{U(!1)}},q=async()=>{try{(await b.delete("/api/license/document",{withCredentials:!0})).status===200&&(r({type:"success",title:"Document Deleted",message:"License document has been removed",duration:5e3}),f(),c(0),j(""))}catch{r({type:"error",title:"Delete Failed",message:"Failed to delete license document",duration:5e3})}},J=a=>{switch(a){case"approved":return"success";case"pending":return"warning";case"rejected":return"error";default:return"default"}},A=a=>{switch(a){case"approved":return e.jsx(le,{});case"pending":return e.jsx(re,{});case"rejected":return e.jsx(ne,{});default:return}};return W?e.jsx(_,{message:"Loading license information..."}):t!=null&&t.requiresLicense?e.jsxs(l,{children:[e.jsx(i,{variant:"h5",gutterBottom:!0,children:"License Verification"}),e.jsxs(i,{variant:"body2",color:"text.secondary",paragraph:!0,children:["As a ",(B=u==null?void 0:u.role)==null?void 0:B.replace("_"," "),", you need to verify your pharmacist license to access all features."]}),e.jsx(D,{sx:{mb:3},children:e.jsx(L,{children:e.jsxs($,{activeStep:R,orientation:"vertical",children:[e.jsxs(g,{children:[e.jsx(y,{children:"Enter License Number"}),e.jsxs(v,{children:[e.jsx(l,{sx:{mb:2},children:e.jsx(K,{fullWidth:!0,label:"Pharmacist License Number",value:o,onChange:a=>j(a.target.value.toUpperCase()),placeholder:"e.g., PCN123456",disabled:(t==null?void 0:t.status)==="approved",error:p===!1,helperText:E?"Validating...":p===!1?"This license number is already registered":p===!0?"License number is available":"Enter your pharmacist license number"})}),e.jsx(m,{variant:"contained",onClick:()=>c(1),disabled:!o||p===!1||E,children:"Continue"})]})]}),e.jsxs(g,{children:[e.jsx(y,{children:"Upload License Document"}),e.jsxs(v,{children:[e.jsxs(l,{sx:{mb:2},children:[e.jsx(x,{severity:"info",sx:{mb:2},children:"Upload a clear photo or PDF of your pharmacist license. Accepted formats: JPEG, PNG, WebP, PDF (max 5MB)"}),d?e.jsx(I,{sx:{p:2,mb:2},children:e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{children:[e.jsx(i,{variant:"body2",children:d.name}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:[(d.size/1024/1024).toFixed(2)," MB"]})]}),e.jsx(N,{onClick:()=>w(null),children:e.jsx(T,{})})]})}):e.jsxs(m,{component:"label",variant:"outlined",startIcon:e.jsx(oe,{}),fullWidth:!0,sx:{mb:2},children:["Select License Document",e.jsx(ce,{type:"file",accept:"image/*,.pdf",onChange:Y})]}),F&&e.jsxs(l,{sx:{mb:2},children:[e.jsx(i,{variant:"body2",gutterBottom:!0,children:"Uploading..."}),e.jsx(X,{})]})]}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(m,{onClick:()=>c(0),children:"Back"}),e.jsx(m,{variant:"contained",onClick:M,disabled:!d||F,children:"Upload Document"})]})]})]}),e.jsxs(g,{children:[e.jsx(y,{children:"Under Review"}),e.jsxs(v,{children:[e.jsx(x,{severity:"warning",sx:{mb:2},children:"Your license is currently being reviewed by our team. This usually takes 1-2 business days."}),(t==null?void 0:t.hasDocument)&&e.jsx(I,{sx:{p:2,mb:2},children:e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(l,{children:[e.jsxs(i,{variant:"body2",children:["License Number: ",t.licenseNumber]}),e.jsxs(i,{variant:"caption",color:"text.secondary",children:["Uploaded:"," ",t.documentInfo&&new Date(t.documentInfo.uploadedAt).toLocaleDateString()]})]}),e.jsxs(l,{display:"flex",gap:1,children:[e.jsx(N,{onClick:()=>C(!0),title:"View Document",children:e.jsx(Z,{})}),e.jsx(N,{onClick:q,title:"Delete Document",disabled:t.status==="approved",children:e.jsx(T,{})})]})]})}),(t==null?void 0:t.status)==="rejected"&&e.jsxs(x,{severity:"error",sx:{mb:2},children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"License Rejected"}),e.jsxs(i,{variant:"body2",children:["Reason: ",t.rejectionReason]})]})]})]}),e.jsxs(g,{children:[e.jsx(y,{children:"Verification Complete"}),e.jsx(v,{children:e.jsxs(x,{severity:"success",children:[e.jsx(i,{variant:"subtitle2",gutterBottom:!0,children:"License Verified Successfully!"}),e.jsx(i,{variant:"body2",children:"Your pharmacist license has been approved. You now have access to all features."})]})})]})]})})}),t&&e.jsx(D,{children:e.jsxs(L,{children:[e.jsxs(l,{display:"flex",alignItems:"center",justifyContent:"between",mb:2,children:[e.jsx(i,{variant:"h6",children:"Current Status"}),e.jsx(ee,{...A(t.status)&&{icon:A(t.status)},label:t.status.toUpperCase(),color:J(t.status)})]}),t.licenseNumber&&e.jsxs(i,{variant:"body2",color:"text.secondary",children:["License Number: ",t.licenseNumber]}),t.verifiedAt&&e.jsxs(i,{variant:"body2",color:"text.secondary",children:["Verified:"," ",new Date(t.verifiedAt).toLocaleDateString()]})]})}),e.jsxs(te,{open:G,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:"License Document"}),e.jsx(ae,{children:e.jsx("iframe",{src:`/api/license/document/${u==null?void 0:u.id}`,width:"100%",height:"400px",style:{border:"none"}})}),e.jsx(ie,{children:e.jsx(m,{onClick:()=>C(!1),children:"Close"})})]})]}):e.jsx(D,{children:e.jsx(L,{children:e.jsx(x,{severity:"info",children:"License verification is not required for your current role."})})})};export{je as default};
