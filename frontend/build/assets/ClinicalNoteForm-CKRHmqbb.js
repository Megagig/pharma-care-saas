import{az as dt,aA as ut,af as mt,r as i,bc as pt,j as e,ap as xt,aC as ht,c as lt,bd as xe,B as d,T as p,x as jt,D as he,G as m,C as J,b as Z,l as Se,d as X,I as U,V as Ke,ab as Ee,h as V,aR as Ae,aS as Me,be as gt,aT as Re,aU as Ne,aV as ft,Y as bt,b3 as vt,a3 as yt,g as Ct,bf as wt,bg as St,bh as Ie,ai as ke,W as It,aX as De,aW as Fe,bi as A,a5 as Xe,a7 as Je,a8 as Ze,a9 as et,f as tt,bj as kt,bk as pe}from"./index-B_pWc9hu.js";import{C as Dt,u as Ft,a as zt,b as Pt}from"./useClinicalNotesErrorHandling-DC3LTeok.js";import{u as Et,b as At}from"./usePatients-TJUphVTL.js";import{c as Mt,d as Rt,e as Nt,N as Tt,a as Ut}from"./clinicalNote-Dz3Qh_Vc.js";import{U as st}from"./CloudUpload-D6U8tbUo.js";import{C as nt}from"./CardActions-DtPJ3__D.js";import{D as it}from"./Download-DRMVM3Bm.js";import{D as rt}from"./Delete-BIyg2wQJ.js";import{I as Ot}from"./Image-B2lXq2kK.js";import{L as Lt}from"./LocalizationProvider-CB6kfikn.js";import{A as Vt}from"./AdapterDateFns-RQ5vW8pD.js";import{A as Bt}from"./ArrowBack-bh5q612l.js";import{S as ze}from"./Switch-DtQ0auD3.js";import{S as at}from"./Save-DxF8g1QD.js";import{C as Wt}from"./Cancel-DzpQiNXV.js";import{E as Pe}from"./ExpandLess-CfW7CJI2.js";import{A as _t}from"./Autocomplete-HcpzFt3K.js";import{D as Ht}from"./DateTimePicker-DzpmGcCV.js";function $t(l){return ut("MuiCardMedia",l)}dt("MuiCardMedia",["root","media","img"]);const qt=l=>{const{classes:h,isMediaComponent:f,isImageComponent:u}=l;return ht({root:["root",f&&"media",u&&"img"]},$t,h)},Yt=mt("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(l,h)=>{const{ownerState:f}=l,{isMediaComponent:u,isImageComponent:r}=f;return[h.root,u&&h.media,r&&h.img]}})({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",variants:[{props:{isMediaComponent:!0},style:{width:"100%"}},{props:{isImageComponent:!0},style:{objectFit:"cover"}}]}),Gt=["video","audio","picture","iframe","img"],Qt=["picture","img"],ot=i.forwardRef(function(h,f){const u=pt({props:h,name:"MuiCardMedia"}),{children:r,className:z,component:I="div",image:x,src:k,style:j,...$}=u,C=Gt.includes(I),q=!C&&x?{backgroundImage:`url("${x}")`,...j}:j,M={...u,component:I,isMediaComponent:C,isImageComponent:Qt.includes(I)},Y=qt(M);return e.jsx(Yt,{className:xt(Y.root,z),as:I,role:!C&&x?"img":void 0,ref:f,style:q,ownerState:M,src:C?x||k:void 0,...$,children:r})}),Kt=lt(e.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"})),Xt=lt(e.jsx("path",{d:"M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5zm4-3H19v1h1.5V11H19v2h-1.5V7h3zM9 9.5h1v-1H9zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm10 5.5h1v-3h-1z"})),Jt=({onFilesUploaded:l,onAttachmentDeleted:h,existingAttachments:f=[],noteId:u,maxFiles:r=5,acceptedTypes:z=["image/*","application/pdf",".doc",".docx",".txt",".csv"],maxFileSize:I=10*1024*1024,disabled:x=!1,showPreview:k=!0})=>{const[j,$]=i.useState([]),[C,q]=i.useState(!1),[M,Y]=i.useState(0),[B,R]=i.useState(null),[c,se]=i.useState(null),[ne,W]=i.useState(!1),[je,O]=i.useState(!1),[D,ie]=i.useState(null),[re,ae]=i.useState(!1),[oe,le]=i.useState(""),w=i.useRef(null),G=t=>{if(t===0)return"0 Bytes";const a=1024,v=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,y)).toFixed(2))+" "+v[y]},b=t=>t.startsWith("image/")?e.jsx(Ot,{}):t==="application/pdf"?e.jsx(Xt,{}):t.includes("word")||t.includes("document")?e.jsx(bt,{}):e.jsx(Kt,{}),Q=t=>t.startsWith("image/"),ee=t=>t==="application/pdf",ge=t=>Q(t)||ee(t)||t==="text/plain",L=t=>{le(t),ae(!0)},F=t=>{if(t.size>I)return`File size exceeds ${G(I)}`;const a=t.type,v=t.name.toLowerCase();return z.some(g=>{if(g.startsWith("."))return v.endsWith(g);if(g.includes("*")){const S=g.split("/")[0];return a.startsWith(S)}return a===g})?null:`File type not supported. Accepted types: ${z.join(", ")}`},N=i.useCallback(async t=>{if(R(null),j.length+f.length+t.length>r){R(`Maximum ${r} files allowed`);return}const v=[],y=[];if(Array.from(t).forEach(g=>{const S=F(g);S?y.push(`${g.name}: ${S}`):v.push(g)}),y.length>0){R(y.join(", "));return}if(v.length!==0){q(!0),Y(0);try{if(u){const S=(await xe.uploadAttachment(u,v)).attachments.map(T=>({id:T._id,name:T.originalName,size:T.size,type:T.mimeType,url:T.url,uploadStatus:"completed"})),P=[...j,...S];$(P),l(P),L(`Successfully uploaded ${v.length} file(s)`)}else{const g=v.map((P,T)=>({id:`local-${Date.now()}-${T}`,name:P.name,size:P.size,type:P.type,url:URL.createObjectURL(P),file:P,uploadStatus:"pending"})),S=[...j,...g];$(S),l(S),L(`Added ${v.length} file(s) for upload`)}}catch(g){R(g.message||"Failed to upload files. Please try again.")}finally{q(!1),Y(0)}}},[j,f,r,I,z,l,u]),ce=t=>{const a=j.filter(v=>v.id!==t);$(a),l(a)},de=async t=>{if(u)try{await xe.deleteAttachment(u,t),h==null||h(t),L("Attachment deleted successfully")}catch(a){R(a.message||"Failed to delete attachment")}},te=async t=>{if(u)try{const a=await xe.downloadAttachment(u,t._id),v=window.URL.createObjectURL(a),y=document.createElement("a");y.href=v,y.download=t.originalName,document.body.appendChild(y),y.click(),document.body.removeChild(y),window.URL.revokeObjectURL(v),L("Download started")}catch(a){R(a.message||"Failed to download attachment")}},_=t=>{se(t),W(!0)},ue=(t,a=!1)=>{ie(t),O(!0)},fe=async()=>{if(D)try{f.some(a=>a._id===D)?await de(D):ce(D)}catch(t){R(t.message||"Failed to delete file")}finally{O(!1),ie(null)}},be=i.useCallback(t=>{if(t.preventDefault(),x||C)return;const a=t.dataTransfer.files;a.length>0&&N(a)},[x,C,N]),ve=i.useCallback(t=>{t.preventDefault()},[]),H=j.length+f.length;return e.jsxs(d,{children:[e.jsxs(d,{onDrop:be,onDragOver:ve,sx:{border:"2px dashed",borderColor:x?"grey.300":"primary.main",borderRadius:2,p:3,textAlign:"center",backgroundColor:x?"grey.50":"background.paper",cursor:x?"not-allowed":"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:x?"grey.50":"action.hover"}},children:[e.jsx("input",{ref:w,type:"file",multiple:!0,accept:z.join(","),onChange:t=>t.target.files&&N(t.target.files),style:{display:"none"},id:"file-upload-input",disabled:x||C}),e.jsxs("label",{htmlFor:"file-upload-input",style:{cursor:x?"not-allowed":"pointer"},children:[e.jsx(st,{sx:{fontSize:48,color:x?"grey.400":"primary.main",mb:1}}),e.jsx(p,{variant:"h6",gutterBottom:!0,children:C?"Uploading...":"Drop files here or click to browse"}),e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Maximum ",r," files, up to ",G(I)," each"]}),e.jsxs(p,{variant:"body2",color:"text.secondary",children:["Supported: ",z.join(", ")]})]}),C&&e.jsxs(d,{sx:{mt:2},children:[e.jsx(jt,{variant:"determinate",value:M}),e.jsxs(p,{variant:"body2",sx:{mt:1},children:[Math.round(M),"% uploaded"]})]})]}),B&&e.jsx(he,{severity:"error",sx:{mt:2},onClose:()=>R(null),children:B}),f.length>0&&e.jsxs(d,{sx:{mt:2},children:[e.jsxs(p,{variant:"subtitle2",gutterBottom:!0,children:["Existing Attachments (",f.length,")"]}),e.jsx(m,{container:!0,spacing:2,children:f.map(t=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(J,{variant:"outlined",children:[Q(t.mimeType)&&k&&e.jsx(ot,{component:"img",height:"120",image:t.url,alt:t.originalName,sx:{objectFit:"cover",cursor:"pointer"},onClick:()=>_(t)}),e.jsxs(Z,{sx:{pb:1},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,mb:1,children:[b(t.mimeType),e.jsx(p,{variant:"body2",noWrap:!0,title:t.originalName,children:t.originalName})]}),e.jsx(p,{variant:"caption",color:"text.secondary",children:G(t.size)}),e.jsx(Se,{label:t.mimeType,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}})]}),e.jsxs(nt,{sx:{pt:0,justifyContent:"space-between"},children:[e.jsxs(d,{children:[ge(t.mimeType)&&e.jsx(X,{title:"Preview",children:e.jsx(U,{size:"small",onClick:()=>_(t),children:e.jsx(Ke,{})})}),e.jsx(X,{title:"Download",children:e.jsx(U,{size:"small",onClick:()=>te(t),children:e.jsx(it,{})})})]}),e.jsx(X,{title:"Delete",children:e.jsx(U,{size:"small",color:"error",onClick:()=>ue(t._id,!0),disabled:x,children:e.jsx(rt,{})})})]})]})},t._id))})]}),j.length>0&&e.jsxs(d,{sx:{mt:2},children:[e.jsxs(p,{variant:"subtitle2",gutterBottom:!0,children:["New Files (",j.length,")"]}),e.jsx(m,{container:!0,spacing:2,children:j.map(t=>e.jsx(m,{item:!0,xs:12,sm:6,md:4,children:e.jsxs(J,{variant:"outlined",children:[Q(t.type)&&k&&t.url&&e.jsx(ot,{component:"img",height:"120",image:t.url,alt:t.name,sx:{objectFit:"cover",cursor:"pointer"},onClick:()=>_(t)}),e.jsxs(Z,{sx:{pb:1},children:[e.jsxs(d,{display:"flex",alignItems:"center",gap:1,mb:1,children:[b(t.type),e.jsx(p,{variant:"body2",noWrap:!0,title:t.name,children:t.name})]}),e.jsx(p,{variant:"caption",color:"text.secondary",children:G(t.size)}),e.jsx(Se,{label:t.type,size:"small",variant:"outlined",sx:{ml:1,height:20,fontSize:"0.7rem"}}),t.uploadStatus&&e.jsxs(d,{display:"flex",alignItems:"center",gap:1,mt:1,children:[t.uploadStatus==="uploading"&&e.jsx(Ee,{size:16}),e.jsx(Se,{label:t.uploadStatus,size:"small",color:t.uploadStatus==="completed"?"success":t.uploadStatus==="error"?"error":"default",sx:{height:20,fontSize:"0.7rem"}})]})]}),e.jsxs(nt,{sx:{pt:0,justifyContent:"space-between"},children:[e.jsx(d,{children:ge(t.type)&&t.url&&e.jsx(X,{title:"Preview",children:e.jsx(U,{size:"small",onClick:()=>_(t),children:e.jsx(Ke,{})})})}),e.jsx(X,{title:"Remove",children:e.jsx(U,{size:"small",color:"error",onClick:()=>ue(t.id),disabled:x||C,children:e.jsx(rt,{})})})]})]})},t.id))})]}),!C&&H<r&&e.jsx(V,{component:"label",variant:"outlined",startIcon:e.jsx(st,{}),disabled:x,sx:{mt:2},onClick:()=>{var t;return(t=w.current)==null?void 0:t.click()},children:"Add More Files"}),e.jsxs(Ae,{open:ne,onClose:()=>W(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Me,{children:e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(p,{variant:"h6",children:"originalName"in(c||{})?c.originalName:c==null?void 0:c.name}),e.jsx(U,{onClick:()=>W(!1),children:e.jsx(gt,{})})]})}),e.jsx(Re,{children:c&&e.jsx(d,{textAlign:"center",children:Q("mimeType"in c?c.mimeType:c.type)?e.jsx("img",{src:("url"in c,c.url),alt:"originalName"in c?c.originalName:c.name,style:{maxWidth:"100%",maxHeight:"70vh"}}):ee("mimeType"in c?c.mimeType:c.type)?e.jsx("iframe",{src:("url"in c,c.url),width:"100%",height:"500px",title:"PDF Preview"}):e.jsx(p,{variant:"body1",color:"text.secondary",children:"Preview not available for this file type"})})}),e.jsxs(Ne,{children:["_id"in(c||{})&&e.jsx(V,{startIcon:e.jsx(it,{}),onClick:()=>te(c),children:"Download"}),e.jsx(V,{onClick:()=>W(!1),children:"Close"})]})]}),e.jsxs(Ae,{open:je,onClose:()=>O(!1),children:[e.jsx(Me,{children:"Confirm Delete"}),e.jsx(Re,{children:e.jsx(p,{children:"Are you sure you want to delete this file? This action cannot be undone."})}),e.jsxs(Ne,{children:[e.jsx(V,{onClick:()=>O(!1),children:"Cancel"}),e.jsx(V,{onClick:fe,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsx(ft,{open:re,autoHideDuration:3e3,onClose:()=>ae(!1),message:oe})]})},Zt=l=>{var u,r,z,I;const h={};return l.patient||(h.patient={message:"Patient is required"}),(!l.title||l.title.trim().length<3)&&(h.title={message:"Title is required and must be at least 3 characters"}),l.type||(h.type={message:"Note type is required"}),l.content&&(((u=l.content.subjective)==null?void 0:u.trim())||((r=l.content.objective)==null?void 0:r.trim())||((z=l.content.assessment)==null?void 0:z.trim())||((I=l.content.plan)==null?void 0:I.trim()))||(h.content={message:"At least one content section is required"}),l.followUpRequired&&!l.followUpDate&&(h.followUpDate={message:"Follow-up date is required when follow-up is marked as required"}),h},es=({noteId:l,patientId:h,onSave:f,onCancel:u,readonly:r=!1})=>{var Oe,Le,Ve,Be,We,_e,He,$e,qe,Ye,Ge;const{id:z}=vt(),[I]=yt(),x=Ct(),k=l||z,j=h||I.get("patientId")||void 0,$=!!k,[C,q]=i.useState(""),[M,Y]=i.useState(""),[B,R]=i.useState(!0),[c,se]=i.useState(null),[ne,W]=i.useState(!1),[je,O]=i.useState(!1);Ft(),zt(),Pt();const[D,ie]=i.useState([{id:"basic",title:"Basic Information",expanded:!0},{id:"soap",title:"SOAP Note Content",expanded:!0},{id:"vitals",title:"Vital Signs",expanded:!1},{id:"labs",title:"Lab Results",expanded:!1},{id:"attachments",title:"Attachments",expanded:!1},{id:"additional",title:"Additional Information",expanded:!1}]),[re,ae]=i.useState([]),[oe,le]=i.useState(null),{data:w,isLoading:G}=Mt(k||""),{control:b,handleSubmit:Q,watch:ee,setValue:ge,getValues:L,formState:{errors:F,isDirty:N},reset:ce,setError:de,clearErrors:te}=wt({defaultValues:St.createEmptyNoteData(j),mode:"onChange"}),[_,ue]=i.useState(!1),fe=ee(),be=ee("followUpRequired"),ve=i.useMemo(()=>({}),[]),{data:H,isLoading:t}=Et(ve),{data:a,isLoading:v}=At(M),y=M?v:t,g=Rt(),S=Nt(),P=i.useRef({}),T=i.useCallback(()=>{const s=L(),n=Zt(s),o=Object.keys(n).length>0;ue(!o);const E=Object.keys(P.current),Qe=Object.keys(n);(E.length!==Qe.length||E.some(K=>!n[K])||Qe.some(K=>{const me=P.current[K],we=n[K];return!me||me.message!==(we==null?void 0:we.message)}))&&(P.current={...n},te(),Object.entries(n).forEach(([K,me])=>{de(K,me)}))},[L,de,te]);i.useEffect(()=>{const s=setTimeout(()=>{T()},100);return()=>clearTimeout(s)},[fe,T]),i.useEffect(()=>{const s=setTimeout(()=>{Y(C)},300);return()=>clearTimeout(s)},[C]),Ie({control:b,name:"laborResults"}),Ie({control:b,name:"recommendations"}),Ie({control:b,name:"tags"}),i.useEffect(()=>{if(w!=null&&w.note){const s=w.note;ce({patient:s.patient._id,title:s.title,type:s.type,content:s.content,medications:s.medications||[],vitalSigns:s.vitalSigns,laborResults:s.laborResults||[],recommendations:s.recommendations||[],followUpRequired:s.followUpRequired,followUpDate:s.followUpDate?new Date(s.followUpDate).toISOString():void 0,priority:s.priority,isConfidential:s.isConfidential,tags:s.tags||[]})}},[w,ce]);const Te=i.useCallback(async()=>{if(!(!B||!N||!_||r))try{const s=L();k&&await S.mutateAsync({id:k,data:s}),se(new Date),W(!1)}catch(s){console.error("Auto-save failed:",s)}},[B,N,_,r,k,L,S]);i.useEffect(()=>{if(!B||r||!N)return;const s=setTimeout(()=>{Te()},3e4);return()=>clearTimeout(s)},[N,Te,B,r]),i.useEffect(()=>{W(N)},[N]);const ct=async s=>{try{console.log("Form submission data:",s),console.log("Patient ID:",s.patient),console.log("Available patients:",Ce);let n;if(k)n=await S.mutateAsync({id:k,data:s});else if(n=await g.mutateAsync(s),n.note&&re.length>0){const o=re.filter(E=>E.file&&E.uploadStatus==="pending").map(E=>E.file);if(o.length>0)try{await xe.uploadAttachment(n.note._id,o)}catch(E){console.error("Failed to upload attachments:",E),le("Some attachments failed to upload. You can try uploading them again.")}}se(new Date),W(!1),f?f(n.note):x(j?`/patients/${j}`:"/notes")}catch(n){console.error("Failed to save note:",n)}},Ue=()=>{ne&&!r?O(!0):u?u():x(j?`/patients/${j}`:"/notes")},ye=s=>{ie(n=>n.map(o=>o.id===s?{...o,expanded:!o.expanded}:o))},Ce=i.useMemo(()=>{var n,o;return M&&((n=a==null?void 0:a.data)!=null&&n.results)?a.data.results:((o=H==null?void 0:H.data)==null?void 0:o.results)||[]},[M,(Oe=a==null?void 0:a.data)==null?void 0:Oe.results,(Le=H==null?void 0:H.data)==null?void 0:Le.results]);return G?e.jsx(d,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:e.jsx(Ee,{})}):e.jsx(Lt,{dateAdapter:Vt,children:e.jsxs(d,{component:"form",onSubmit:Q(ct),children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsxs(d,{children:[e.jsx(p,{variant:"h5",component:"h1",children:$?"Edit Clinical Note":"Create Clinical Note"}),j&&e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mt:.5},children:"Creating note for patient context"})]}),e.jsxs(d,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(U,{onClick:Ue,sx:{bgcolor:"action.hover"},children:e.jsx(Bt,{})}),!r&&e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ke,{control:e.jsx(ze,{checked:B,onChange:s=>R(s.target.checked),size:"small"}),label:"Auto-save"}),c&&e.jsx(X,{title:`Last saved: ${c.toLocaleTimeString()}`,children:e.jsx(at,{color:"success",fontSize:"small"})})]}),e.jsx(V,{variant:"outlined",onClick:Ue,startIcon:e.jsx(Wt,{}),children:"Cancel"}),!r&&e.jsx(V,{type:"submit",variant:"contained",startIcon:e.jsx(at,{}),disabled:!_||g.isPending||S.isPending,children:g.isPending||S.isPending?"Saving...":"Save"})]})]}),ne&&!r&&e.jsx(he,{severity:"warning",sx:{mb:2},children:e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(It,{fontSize:"small"}),"You have unsaved changes. They will be lost if you navigate away."]})}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(J,{children:e.jsxs(Z,{children:[e.jsxs(d,{display:"flex",justifyContent:"between",alignItems:"center",mb:2,children:[e.jsx(p,{variant:"h6",children:(Ve=D.find(s=>s.id==="basic"))==null?void 0:Ve.title}),e.jsx(U,{onClick:()=>ye("basic"),size:"small",children:(Be=D.find(s=>s.id==="basic"))!=null&&Be.expanded?e.jsx(Pe,{}):e.jsx(De,{})})]}),e.jsx(Fe,{in:(We=D.find(s=>s.id==="basic"))==null?void 0:We.expanded,children:e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(A,{name:"patient",control:b,render:({field:s})=>e.jsx(_t,{...s,options:Ce,getOptionLabel:n=>typeof n=="string"?n:`${n.firstName} ${n.lastName} (${n.mrn})`,value:Ce.find(n=>n._id===s.value)||null,onChange:(n,o)=>{s.onChange((o==null?void 0:o._id)||""),o&&q("")},onInputChange:(n,o,E)=>{E==="input"&&q(o)},loading:y,disabled:r,renderInput:n=>{var o;return e.jsx(Xe,{...n,label:"Patient *",error:!!F.patient,helperText:(o=F.patient)==null?void 0:o.message,InputProps:{...n.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[y?e.jsx(Ee,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})}})}})})}),e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(A,{name:"title",control:b,render:({field:s})=>{var n;return e.jsx(Xe,{...s,label:"Note Title *",fullWidth:!0,error:!!F.title,helperText:(n=F.title)==null?void 0:n.message,disabled:r})}})}),e.jsx(m,{item:!0,xs:12,md:4,children:e.jsx(A,{name:"type",control:b,render:({field:s})=>e.jsxs(Je,{fullWidth:!0,error:!!F.type,children:[e.jsx(Ze,{children:"Note Type *"}),e.jsx(et,{...s,label:"Note Type *",disabled:r,children:Tt.map(n=>e.jsx(tt,{value:n.value,children:n.label},n.value))}),F.type&&e.jsx(kt,{children:F.type.message})]})})}),e.jsx(m,{item:!0,xs:12,md:4,children:e.jsx(A,{name:"priority",control:b,render:({field:s})=>e.jsxs(Je,{fullWidth:!0,children:[e.jsx(Ze,{children:"Priority"}),e.jsx(et,{...s,label:"Priority",disabled:r,children:Ut.map(n=>e.jsx(tt,{value:n.value,children:e.jsxs(d,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(d,{width:12,height:12,borderRadius:"50%",bgcolor:n.color}),n.label]})},n.value))})]})})}),e.jsx(m,{item:!0,xs:12,md:4,children:e.jsx(A,{name:"isConfidential",control:b,render:({field:s})=>e.jsx(ke,{control:e.jsx(ze,{...s,checked:s.value,disabled:r}),label:"Confidential Note"})})})]})})]})})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(J,{children:e.jsxs(Z,{children:[e.jsxs(d,{display:"flex",justifyContent:"between",alignItems:"center",mb:2,children:[e.jsx(p,{variant:"h6",children:"SOAP Note Content"}),e.jsx(U,{onClick:()=>ye("soap"),size:"small",children:(_e=D.find(s=>s.id==="soap"))!=null&&_e.expanded?e.jsx(Pe,{}):e.jsx(De,{})})]}),e.jsxs(Fe,{in:(He=D.find(s=>s.id==="soap"))==null?void 0:He.expanded,children:[F.content&&e.jsx(he,{severity:"error",sx:{mb:2},children:F.content.message}),e.jsxs(m,{container:!0,spacing:3,children:[e.jsxs(m,{item:!0,xs:12,md:6,children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Subjective"}),e.jsx(A,{name:"content.subjective",control:b,render:({field:s})=>e.jsx(pe,{...s,minRows:4,maxRows:8,placeholder:"Patient's subjective complaints, symptoms, and history...",style:{width:"100%",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"inherit",fontSize:"14px",resize:"vertical"},disabled:r})})]}),e.jsxs(m,{item:!0,xs:12,md:6,children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Objective"}),e.jsx(A,{name:"content.objective",control:b,render:({field:s})=>e.jsx(pe,{...s,minRows:4,maxRows:8,placeholder:"Observable findings, vital signs, physical examination...",style:{width:"100%",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"inherit",fontSize:"14px",resize:"vertical"},disabled:r})})]}),e.jsxs(m,{item:!0,xs:12,md:6,children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Assessment"}),e.jsx(A,{name:"content.assessment",control:b,render:({field:s})=>e.jsx(pe,{...s,minRows:4,maxRows:8,placeholder:"Clinical assessment, diagnosis, and professional judgment...",style:{width:"100%",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"inherit",fontSize:"14px",resize:"vertical"},disabled:r})})]}),e.jsxs(m,{item:!0,xs:12,md:6,children:[e.jsx(p,{variant:"subtitle1",gutterBottom:!0,children:"Plan"}),e.jsx(A,{name:"content.plan",control:b,render:({field:s})=>e.jsx(pe,{...s,minRows:4,maxRows:8,placeholder:"Treatment plan, interventions, and follow-up instructions...",style:{width:"100%",padding:"12px",border:"1px solid #ccc",borderRadius:"4px",fontFamily:"inherit",fontSize:"14px",resize:"vertical"},disabled:r})})]})]})]})]})})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(J,{children:e.jsx(Z,{children:e.jsxs(m,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(A,{name:"followUpRequired",control:b,render:({field:s})=>e.jsx(ke,{control:e.jsx(ze,{...s,checked:s.value,disabled:r}),label:"Follow-up Required"})})}),be&&e.jsx(m,{item:!0,xs:12,md:6,children:e.jsx(A,{name:"followUpDate",control:b,render:({field:s})=>{var n;return e.jsx(Ht,{label:"Follow-up Date",value:s.value?new Date(s.value):null,onChange:o=>s.onChange(o==null?void 0:o.toISOString()),disabled:r,slotProps:{textField:{fullWidth:!0,error:!!F.followUpDate,helperText:(n=F.followUpDate)==null?void 0:n.message}}})}})})]})})})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(J,{children:e.jsxs(Z,{children:[e.jsxs(d,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsx(p,{variant:"h6",children:($e=D.find(s=>s.id==="attachments"))==null?void 0:$e.title}),e.jsx(U,{onClick:()=>ye("attachments"),size:"small",children:(qe=D.find(s=>s.id==="attachments"))!=null&&qe.expanded?e.jsx(Pe,{}):e.jsx(De,{})})]}),e.jsxs(Fe,{in:(Ye=D.find(s=>s.id==="attachments"))==null?void 0:Ye.expanded,children:[oe&&e.jsx(he,{severity:"error",sx:{mb:2},children:oe}),e.jsx(Jt,{onFilesUploaded:s=>{ae(s),le(null)},onAttachmentDeleted:s=>{var n;(n=w==null?void 0:w.note)!=null&&n.attachments&&w.note.attachments.filter(o=>o._id!==s)},existingAttachments:((Ge=w==null?void 0:w.note)==null?void 0:Ge.attachments)||[],noteId:k,maxFiles:5,maxFileSize:10*1024*1024,disabled:r,showPreview:!0})]})]})})})]}),e.jsxs(Ae,{open:je,onClose:()=>O(!1),children:[e.jsx(Me,{children:"Unsaved Changes"}),e.jsx(Re,{children:e.jsx(p,{children:"You have unsaved changes. Are you sure you want to leave without saving?"})}),e.jsxs(Ne,{children:[e.jsx(V,{onClick:()=>O(!1),children:"Continue Editing"}),e.jsx(V,{onClick:()=>{O(!1),u==null||u()},color:"error",children:"Discard Changes"})]})]})]})})},vs=l=>e.jsx(Dt,{context:"clinical-note-form",children:e.jsx(es,{...l})});export{vs as C};
