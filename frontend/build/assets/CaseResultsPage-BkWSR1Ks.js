import{j as s,C as g,b as p,B as a,T as e,x as U,l as d,bs as h,bt as j,aX as m,bu as y,L as b,aQ as v,n as I,p as C,a0 as A,G,D as u,g as q,b3 as H,r as o,a_ as D,ab as O,h as F,I as N,b0 as Q,b1 as X,R as _}from"./index-B_pWc9hu.js";import{A as J}from"./ArrowBack-bh5q612l.js";import{E as K}from"./ErrorBoundary-HGDGyMUI.js";import{D as V}from"./diagnosticFeatureGuard-BcVaU7eX.js";import{a as $}from"./aiDiagnosticService-BSsJF3Px.js";import"./BugReport-CefgtFkV.js";import"./Upgrade-DcNEIpam.js";import"./apiClient-BShn_SjK.js";const M=({analysis:i,loading:c=!1})=>{if(c)return s.jsx(g,{children:s.jsxs(p,{children:[s.jsx(a,{sx:{display:"flex",alignItems:"center",mb:2},children:s.jsx(e,{variant:"h6",sx:{flexGrow:1},children:"AI Analysis in Progress"})}),s.jsx(U,{sx:{mb:2}}),s.jsx(e,{variant:"body2",color:"text.secondary",children:"Our AI is analyzing the case data. This typically takes 30-60 seconds..."})]})});const t=n=>n>=.8?"success":n>=.6?"warning":"error",x=n=>{switch(n){case"high":return"error";case"medium":return"warning";case"low":return"info";default:return"default"}};return s.jsxs(a,{sx:{space:2},children:[s.jsx(g,{sx:{mb:2},children:s.jsxs(p,{children:[s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[s.jsx(e,{variant:"h5",sx:{fontWeight:600},children:"AI Diagnostic Analysis"}),s.jsx(d,{label:`${Math.round(i.confidence*100)}% Confidence`,color:t(i.confidence),variant:"filled"})]}),s.jsxs(e,{variant:"body2",color:"text.secondary",children:["Analysis completed in ",i.processingTime,"ms • Generated on"," ",new Date(i.createdAt).toLocaleString()]})]})}),s.jsx(g,{sx:{mb:2},children:s.jsxs(p,{children:[s.jsxs(e,{variant:"h6",sx:{mb:2,display:"flex",alignItems:"center"},children:["Primary Diagnosis",s.jsx(d,{label:`${Math.round(i.analysis.primaryDiagnosis.confidence*100)}%`,color:t(i.analysis.primaryDiagnosis.confidence),size:"small",sx:{ml:2}})]}),s.jsx(e,{variant:"h5",color:"primary",sx:{mb:1,fontWeight:500},children:i.analysis.primaryDiagnosis.condition}),s.jsx(e,{variant:"body2",color:"text.secondary",children:i.analysis.primaryDiagnosis.reasoning})]})}),i.analysis.differentialDiagnoses.length>0&&s.jsxs(h,{sx:{mb:2},children:[s.jsx(j,{expandIcon:s.jsx(m,{}),children:s.jsxs(e,{variant:"h6",children:["Differential Diagnoses (",i.analysis.differentialDiagnoses.length,")"]})}),s.jsx(y,{children:s.jsx(b,{children:i.analysis.differentialDiagnoses.map((n,r)=>s.jsxs(v.Fragment,{children:[s.jsx(I,{sx:{px:0},children:s.jsx(C,{primary:s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(e,{variant:"subtitle1",sx:{fontWeight:500},children:n.condition}),s.jsx(d,{label:`${Math.round(n.confidence*100)}%`,color:t(n.confidence),size:"small"})]}),secondary:n.reasoning})}),r<i.analysis.differentialDiagnoses.length-1&&s.jsx(A,{})]},r))})})]}),i.analysis.recommendedTests.length>0&&s.jsxs(h,{sx:{mb:2},children:[s.jsx(j,{expandIcon:s.jsx(m,{}),children:s.jsxs(e,{variant:"h6",children:["Recommended Tests (",i.analysis.recommendedTests.length,")"]})}),s.jsx(y,{children:s.jsx(b,{children:i.analysis.recommendedTests.map((n,r)=>s.jsxs(v.Fragment,{children:[s.jsx(I,{sx:{px:0},children:s.jsx(C,{primary:s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(e,{variant:"subtitle1",sx:{fontWeight:500},children:n.test}),s.jsx(d,{label:n.priority,color:x(n.priority),size:"small"})]}),secondary:n.reasoning})}),r<i.analysis.recommendedTests.length-1&&s.jsx(A,{})]},r))})})]}),i.analysis.treatmentSuggestions.length>0&&s.jsxs(h,{sx:{mb:2},children:[s.jsx(j,{expandIcon:s.jsx(m,{}),children:s.jsxs(e,{variant:"h6",children:["Treatment Suggestions (",i.analysis.treatmentSuggestions.length,")"]})}),s.jsx(y,{children:s.jsx(b,{children:i.analysis.treatmentSuggestions.map((n,r)=>s.jsxs(v.Fragment,{children:[s.jsx(I,{sx:{px:0},children:s.jsx(C,{primary:s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[s.jsx(e,{variant:"subtitle1",sx:{fontWeight:500},children:n.treatment}),s.jsxs(a,{sx:{display:"flex",gap:1},children:[s.jsx(d,{label:n.type,variant:"outlined",size:"small"}),s.jsx(d,{label:n.priority,color:x(n.priority),size:"small"})]})]}),secondary:n.reasoning})}),r<i.analysis.treatmentSuggestions.length-1&&s.jsx(A,{})]},r))})})]}),i.analysis.riskFactors.length>0&&s.jsxs(h,{sx:{mb:2},children:[s.jsx(j,{expandIcon:s.jsx(m,{}),children:s.jsxs(e,{variant:"h6",children:["Risk Factors (",i.analysis.riskFactors.length,")"]})}),s.jsx(y,{children:s.jsx(G,{container:!0,spacing:2,children:i.analysis.riskFactors.map((n,r)=>s.jsx(G,{item:!0,xs:12,md:6,children:s.jsx(g,{variant:"outlined",children:s.jsxs(p,{sx:{p:2},children:[s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[s.jsx(e,{variant:"subtitle2",sx:{fontWeight:600},children:n.factor}),s.jsx(d,{label:n.severity,color:x(n.severity),size:"small"})]}),s.jsx(e,{variant:"body2",color:"text.secondary",children:n.description})]})})},r))})})]}),i.analysis.followUpRecommendations.length>0&&s.jsxs(h,{sx:{mb:2},children:[s.jsx(j,{expandIcon:s.jsx(m,{}),children:s.jsxs(e,{variant:"h6",children:["Follow-up Recommendations (",i.analysis.followUpRecommendations.length,")"]})}),s.jsx(y,{children:s.jsx(b,{children:i.analysis.followUpRecommendations.map((n,r)=>s.jsxs(v.Fragment,{children:[s.jsx(I,{sx:{px:0},children:s.jsx(C,{primary:s.jsxs(a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(e,{variant:"subtitle1",sx:{fontWeight:500},children:n.action}),s.jsx(d,{label:n.timeframe,variant:"outlined",size:"small"})]}),secondary:n.reasoning})}),r<i.analysis.followUpRecommendations.length-1&&s.jsx(A,{})]},r))})})]}),s.jsx(u,{severity:"warning",sx:{mt:2},children:s.jsxs(e,{variant:"body2",children:[s.jsx("strong",{children:"Important:"})," This AI analysis is for informational purposes only and should not replace professional medical judgment. Always consult with qualified healthcare professionals for diagnosis and treatment decisions."]})})]})},Y=()=>{const i=q(),{caseId:c}=H(),[t,x]=o.useState(null),[n,r]=o.useState(null),[L,w]=o.useState(!0),[P,W]=o.useState(!1),[z,f]=o.useState(null),R=o.useRef(!1),B=o.useCallback(async()=>{if(c)try{W(!0);const l=await $.pollAnalysis(c);r(l),x(T=>T&&{...T,status:"completed",aiAnalysis:l})}catch(l){console.error("Failed to get analysis:",l),f("Analysis is taking longer than expected. Please refresh to check status.")}finally{W(!1)}},[c]),k=o.useCallback(async()=>{if(!c){f("Case ID is required"),w(!1);return}if(!R.current)try{R.current=!0,w(!0),f(null);const l=await $.getCase(c);x(l),l.status==="completed"&&l.aiAnalysis?r(l.aiAnalysis):l.status==="analyzing"&&B()}catch(l){console.error("Failed to load case:",l),f("Failed to load diagnostic case. Please try again.")}finally{w(!1),R.current=!1}},[c,B]),E=()=>{k()},S=()=>{i("/pharmacy/diagnostics")};return o.useEffect(()=>{k()},[k]),L?s.jsx(D,{maxWidth:"lg",sx:{py:4},children:s.jsx(a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:s.jsxs(a,{sx:{textAlign:"center"},children:[s.jsx(O,{sx:{mb:2}}),s.jsx(e,{variant:"body1",color:"text.secondary",children:"Loading diagnostic case..."})]})})}):z?s.jsx(D,{maxWidth:"lg",sx:{py:4},children:s.jsx(u,{severity:"error",action:s.jsx(F,{color:"inherit",size:"small",onClick:E,children:"Retry"}),children:z})}):t?s.jsx(K,{children:s.jsxs(D,{maxWidth:"lg",sx:{py:4},children:[s.jsx(a,{sx:{mb:4},children:s.jsxs(a,{sx:{display:"flex",alignItems:"center",mb:2},children:[s.jsx(N,{onClick:S,sx:{mr:1},children:s.jsx(J,{})}),s.jsxs(a,{sx:{flexGrow:1},children:[s.jsxs(Q,{sx:{mb:1},children:[s.jsx(X,{component:"button",variant:"body2",onClick:S,sx:{textDecoration:"none"},children:"Diagnostics"}),s.jsx(e,{variant:"body2",color:"text.primary",children:"Case Results"})]}),s.jsx(e,{variant:"h4",sx:{fontWeight:600},children:"Diagnostic Case Results"}),s.jsxs(e,{variant:"body1",color:"text.secondary",children:["Case ID: ",t.id," • Status: ",t.status]})]}),s.jsx(N,{onClick:E,disabled:L||P,children:s.jsx(_,{})})]})}),s.jsx(g,{sx:{mb:3},children:s.jsxs(p,{children:[s.jsx(e,{variant:"h6",sx:{mb:2},children:"Case Information"}),s.jsxs(a,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:2},children:[s.jsxs(a,{children:[s.jsx(e,{variant:"caption",color:"text.secondary",children:"Patient"}),s.jsx(e,{variant:"body2",children:typeof t.patientId=="object"&&t.patientId&&"firstName"in t.patientId?`${t.patientId.firstName||""} ${t.patientId.lastName||""}`.trim():t.patientId})]}),s.jsxs(a,{children:[s.jsx(e,{variant:"caption",color:"text.secondary",children:"Created"}),s.jsx(e,{variant:"body2",children:new Date(t.createdAt).toLocaleString()})]}),s.jsxs(a,{children:[s.jsx(e,{variant:"caption",color:"text.secondary",children:"Last Updated"}),s.jsx(e,{variant:"body2",children:new Date(t.updatedAt).toLocaleString()})]}),s.jsxs(a,{children:[s.jsx(e,{variant:"caption",color:"text.secondary",children:"Primary Symptoms"}),s.jsx(e,{variant:"body2",children:t.caseData.symptoms.subjective.join(", ")||"None specified"})]})]})]})}),t.status==="analyzing"||P?s.jsx(M,{analysis:{},loading:!0}):t.status==="completed"&&n?s.jsx(M,{analysis:n}):t.status==="failed"?s.jsxs(u,{severity:"error",sx:{mb:2},children:[s.jsx(e,{variant:"h6",sx:{mb:1},children:"Analysis Failed"}),s.jsx(e,{variant:"body2",children:"The AI analysis could not be completed. This may be due to insufficient data or a system error. Please try submitting the case again or contact support if the issue persists."})]}):s.jsxs(u,{severity:"info",sx:{mb:2},children:[s.jsx(e,{variant:"h6",sx:{mb:1},children:"Analysis Pending"}),s.jsx(e,{variant:"body2",children:"The AI analysis has not been completed yet. Please check back later or refresh the page."})]}),s.jsxs(a,{sx:{mt:4,display:"flex",gap:2,justifyContent:"center"},children:[s.jsx(F,{variant:"outlined",onClick:S,children:"Back to Diagnostics"}),s.jsx(F,{variant:"contained",onClick:()=>i("/pharmacy/diagnostics/case/new"),children:"New Case"})]})]})}):s.jsx(D,{maxWidth:"lg",sx:{py:4},children:s.jsx(u,{severity:"warning",children:"Diagnostic case not found."})})},ls=()=>s.jsx(V,{children:s.jsx(Y,{})});export{ls as default};
