import{c as A,j as e,g as F,r as o,c9 as m,b4 as z,a_ as _,B as n,T as s,D as C,C as w,b as S,l as y,x as M,h as l,Q as E,X as Y,a0 as $,L as G,n as I,ar as k,bP as O,p as P,O as X,aR as H,aS as J,aT as Q,aU as q}from"./index-B_pWc9hu.js";import{U as K}from"./Upgrade-DcNEIpam.js";const V=A(e.jsx("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"})),ae=()=>{const g=F(),[W,x]=o.useState(!0),[N,R]=o.useState([]),[r,D]=o.useState(null),[d,j]=o.useState("monthly"),[T,u]=o.useState(!1),[c,U]=o.useState(null),[f,h]=o.useState(""),b=o.useCallback(async()=>{var a;try{x(!0);const i=await m.get("/api/subscriptions/status",{withCredentials:!0});i.data.success&&D(i.data.data);const t=await m.get(`/api/subscriptions/plans?billingInterval=${d}`,{withCredentials:!0});t.data.success&&R(t.data.data)}catch(i){if(console.error("Error fetching subscription data:",i),((a=i.response)==null?void 0:a.status)===401){window.location.href="/login";return}h("Failed to load subscription information")}finally{x(!1)}},[d]);o.useEffect(()=>{b()},[b]);const p=async a=>{var i;if(a.isContactSales){if(a.whatsappNumber){const t=encodeURIComponent(`Hi! I'm interested in the ${a.name} plan. Can you provide more information about pricing and features?`);window.open(`https://wa.me/${a.whatsappNumber.replace("+","")}?text=${t}`,"_blank")}return}try{x(!0);const t=await m.post("/api/subscriptions/checkout",{planId:a._id,billingInterval:d,callbackUrl:`${window.location.origin}/subscription/success`},{withCredentials:!0});t.data.success&&((i=t.data.data)!=null&&i.authorization_url)?window.location.href=t.data.data.authorization_url:h(t.data.message||"Failed to initialize payment")}catch(t){console.error("Error creating checkout session:",t),h("Failed to start upgrade process")}finally{x(!1)}},v=a=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(a),B=a=>{switch(a){case"trial":return"info";case"active":return"success";case"expired":case"no_subscription":return"error";case"no_workspace":return"warning";default:return"default"}},L=a=>a.hasWorkspace?a.hasSubscription?a.isTrialActive?`Trial (${a.daysRemaining} days left)`:a.status.charAt(0).toUpperCase()+a.status.slice(1):"No Subscription":"No Workplace";return W?e.jsx(z,{}):e.jsxs(_,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(n,{sx:{mb:4},children:[e.jsx(s,{variant:"h4",component:"h1",gutterBottom:!0,children:"Subscription Management"}),e.jsx(s,{variant:"body1",color:"text.secondary",children:"Manage your subscription and upgrade your plan to unlock more features"})]}),f&&e.jsx(C,{severity:"error",sx:{mb:3},children:f}),r&&e.jsx(w,{sx:{mb:4},children:e.jsx(S,{children:e.jsxs(n,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:3,alignItems:"center"},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Current Status"}),e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[e.jsx(y,{label:L(r),color:B(r.status),variant:"filled"}),r.tier&&e.jsx(y,{label:r.tier.charAt(0).toUpperCase()+r.tier.slice(1),variant:"outlined"})]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:r.message})]}),r.isTrialActive&&e.jsxs(n,{sx:{flex:1},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Trial Progress"}),e.jsx(n,{sx:{mb:1},children:e.jsx(M,{variant:"determinate",value:(14-(r.daysRemaining||0))/14*100,sx:{height:8,borderRadius:4}})}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[r.daysRemaining," days remaining in your free trial"]})]})]})})}),r&&!r.hasWorkspace&&e.jsxs(C,{severity:"info",sx:{mb:4},children:[e.jsx(s,{variant:"body1",gutterBottom:!0,children:"You need to create or join a workplace to access subscription features."}),e.jsxs(n,{sx:{mt:2},children:[e.jsx(l,{variant:"contained",onClick:()=>g("/dashboard"),sx:{mr:2},children:"Create Workplace"}),e.jsx(l,{variant:"outlined",onClick:()=>g("/dashboard"),children:"Join Workplace"})]})]}),(r==null?void 0:r.hasWorkspace)&&e.jsx(n,{sx:{mb:4,display:"flex",justifyContent:"center"},children:e.jsxs(E,{sx:{p:1,display:"flex",borderRadius:2},children:[e.jsx(l,{variant:d==="monthly"?"contained":"text",onClick:()=>j("monthly"),sx:{borderRadius:1},children:"Monthly"}),e.jsxs(l,{variant:d==="yearly"?"contained":"text",onClick:()=>j("yearly"),sx:{borderRadius:1},children:["Yearly",e.jsx(y,{label:"Save 17%",size:"sm",color:"success",sx:{ml:1}})]})]})}),(r==null?void 0:r.hasWorkspace)&&e.jsx(n,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:3},children:N.map(a=>e.jsxs(w,{sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",border:a.popularPlan?2:1,borderColor:a.popularPlan?"primary.main":"divider","&:hover":{boxShadow:i=>i.shadows[8],transform:"translateY(-4px)"},transition:"all 0.3s ease-in-out"},children:[a.popularPlan&&e.jsxs(n,{sx:{position:"absolute",top:-12,left:"50%",transform:"translateX(-50%)",bgcolor:"primary.main",color:"white",px:2,py:.5,borderRadius:1,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Y,{fontSize:"small"}),e.jsx(s,{variant:"caption",fontWeight:"bold",children:"Most Popular"})]}),e.jsxs(S,{sx:{flexGrow:1,p:3},children:[e.jsx(s,{variant:"h5",component:"h2",gutterBottom:!0,children:a.name}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:a.description}),e.jsx(n,{sx:{mb:3},children:a.isContactSales?e.jsx(s,{variant:"h4",component:"div",children:"Custom"}):e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"h4",component:"div",children:v(a.priceNGN)}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["per"," ",a.billingInterval==="yearly"?"year":"month"]})]})}),e.jsx($,{sx:{mb:2}}),e.jsxs(G,{dense:!0,children:[a.displayFeatures.slice(0,6).map((i,t)=>e.jsxs(I,{sx:{px:0},children:[e.jsx(k,{sx:{minWidth:32},children:e.jsx(O,{color:"success",fontSize:"small"})}),e.jsx(P,{primary:e.jsx(s,{variant:"body2",children:i})})]},t)),a.displayFeatures.length>6&&e.jsxs(I,{sx:{px:0},children:[e.jsx(k,{sx:{minWidth:32},children:e.jsx(X,{color:"info",fontSize:"small"})}),e.jsx(P,{primary:e.jsxs(s,{variant:"body2",sx:{fontStyle:"italic"},children:["+",a.displayFeatures.length-6," more features"]})})]})]})]}),e.jsx(n,{sx:{p:3,pt:0},children:a.isContactSales?e.jsx(l,{fullWidth:!0,variant:"outlined",startIcon:e.jsx(V,{}),onClick:()=>p(a),sx:{py:1.5},children:"Contact Sales"}):e.jsx(l,{fullWidth:!0,variant:a.popularPlan?"contained":"outlined",startIcon:e.jsx(K,{}),onClick:()=>p(a),sx:{py:1.5},children:(r==null?void 0:r.tier)===a.tier?"Current Plan":"Upgrade"})})]},a._id))}),e.jsxs(H,{open:T,onClose:()=>u(!1),children:[e.jsx(J,{children:"Confirm Plan Upgrade"}),e.jsx(Q,{children:c&&e.jsxs(n,{children:[e.jsxs(s,{variant:"body1",gutterBottom:!0,children:["You are about to upgrade to the"," ",e.jsx("strong",{children:c.name})," plan."]}),e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:["You will be charged ",v(c.priceNGN)," ",c.billingInterval==="yearly"?"annually":"monthly","."]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Your new features will be available immediately after payment confirmation."})]})}),e.jsxs(q,{children:[e.jsx(l,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(l,{variant:"contained",onClick:()=>{c&&(p(c),U(null)),u(!1)},children:"Proceed to Payment"})]})]})]})};export{ae as default};
