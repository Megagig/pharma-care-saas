import{c as me,j as e,c5 as be,bE as _,r as p,d7 as ve,d8 as Se,aX as Q,B as o,x as X,T as s,D as T,Q as G,ah as we,a9 as g,l as O,C as S,U as N,b as w,$ as xe,L as pe,n as ye,aq as je,w as Z,p as ge,h as P,a1 as K,d9 as Ce,v as ae,y as ee,b1 as re,a6 as Pe,a7 as Ie,a8 as De,f as $,d as Me,I as te,H as ie,G as V,aa as se,aP as oe,aQ as ce,aR as le,aS as Ae,ca as ke,q as Te,J as Le,P as Re,W as Fe,Z as Ee,a3 as Ne,da as Be,bj as Ue,bk as W,b3 as ze}from"./index-louytu0d.js";import{S as de}from"./Support-CQSyIz9e.js";import{S as $e}from"./Switch-Cd_KxpXf.js";import{D as Oe}from"./Download-vzkMIyVG.js";import{F as _e}from"./FilterList-BXxQXbYc.js";import{C as We}from"./Clear-De3B6C8y.js";import{L as qe}from"./LocalizationProvider-Dw4E6yUa.js";import{A as Ge}from"./AdapterDateFns-BacIp4vz.js";import{T as Ve,a as Je,b as Ye,c as ue,d as He}from"./TableRow-D2snGkma.js";import{T as D}from"./TableCell-ZA4nZKqC.js";import{P as Qe}from"./Pagination-D8bBW3PB.js";import{D as Xe}from"./Delete-CTgRaLP1.js";import{A as ne}from"./Add-DinP5QbX.js";import{T as Ze}from"./TrendingDown-CH8OKfR7.js";import{A as Ke}from"./Api-Jt2EzGd_.js";import"./addMonths-BF41cc2b.js";import"./format-CuO4PcXN.js";import"./LastPage-fqBHFQFA.js";const he=me(e.jsx("path",{d:"m19.83 7.5-2.27-2.27c.07-.42.18-.81.32-1.15.08-.18.12-.37.12-.58 0-.83-.67-1.5-1.5-1.5-1.64 0-3.09.79-4 2h-5C4.46 4 2 6.46 2 9.5S4.5 21 4.5 21H10v-2h2v2h5.5l1.68-5.59 2.82-.94V7.5zM13 9H8V7h5zm3 2c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"})),fe=me(e.jsx("path",{d:"m22 9.24-7.19-.62L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27 18.18 21l-1.63-7.03zM12 15.4l-3.76 2.27 1-4.28-3.32-2.88 4.38-.38L12 6.1l1.71 4.04 4.38.38-3.32 2.88 1 4.28z"})),et="http://localhost:5000/api";class tt{async makeRequest(n,i={}){var u,y,c;try{return(await be(`${et}${n}`,{method:i.method||"GET",data:i.body?JSON.parse(i.body):void 0,headers:{"Content-Type":"application/json",...i.headers||{}},withCredentials:!0})).data}catch(h){throw new Error(((y=(u=h.response)==null?void 0:u.data)==null?void 0:y.message)||h.message||`Request failed with status: ${((c=h.response)==null?void 0:c.status)||"unknown"}`)}}async getPayments(n=1,i=10,u,y,c){const h=new URLSearchParams({page:n.toString(),limit:i.toString()});return u&&h.append("status",u),y&&h.append("dateFrom",y),c&&h.append("dateTo",c),(await this.makeRequest(`/payments?${h.toString()}`)).data}async getPayment(n){return(await this.makeRequest(`/payments/${n}`)).data.payment}async generateInvoice(n){return(await this.makeRequest(`/payments/${n}/invoice`)).data.invoice}async getPaymentMethods(){return(await this.makeRequest("/payments/methods/list")).data.paymentMethods}async createSetupIntent(){return(await this.makeRequest("/payments/methods/setup-intent",{method:"POST"})).data}async addPaymentMethod(n,i=!1){return await this.makeRequest("/payments/methods/add",{method:"POST",body:JSON.stringify({paymentMethodId:n,setAsDefault:i})})}async removePaymentMethod(n){return await this.makeRequest(`/payments/methods/${n}`,{method:"DELETE"})}async setDefaultPaymentMethod(n){return await this.makeRequest("/payments/methods/default",{method:"PUT",body:JSON.stringify({paymentMethodId:n})})}async getSubscription(){return(await this.makeRequest("/subscription-management/current")).data}async getSubscriptionPlans(){return(await this.makeRequest("/subscription-management/plans")).data}async getSubscriptionAnalytics(){return(await this.makeRequest("/subscription-management/analytics")).data}async createCheckoutSession(n,i="monthly"){return(await this.makeRequest("/subscription-management/checkout",{method:"POST",body:JSON.stringify({planId:n,billingInterval:i})})).data}async upgradeSubscription(n,i="monthly"){return(await this.makeRequest("/subscription-management/upgrade",{method:"POST",body:JSON.stringify({planId:n,billingInterval:i})})).data}async downgradeSubscription(n){return(await this.makeRequest("/subscription-management/downgrade",{method:"POST",body:JSON.stringify({planId:n})})).data}async cancelSubscription(n){return(await this.makeRequest("/subscription-management/cancel",{method:"POST",body:JSON.stringify({reason:n})})).data}async handleSuccessfulPayment(n){return(await this.makeRequest("/subscription-management/success",{method:"POST",body:JSON.stringify({sessionId:n})})).data}async createPayment(n){return(await this.makeRequest("/payments",{method:"POST",body:JSON.stringify(n)})).data}async updateSubscription(n){throw new Error("Use upgradeSubscription or downgradeSubscription instead")}async renewSubscription(){throw new Error("Subscription renewal is handled automatically")}async getPlans(){return this.getSubscriptionPlans()}async createPaymentIntent(n,i="ngn"){throw new Error("Use createCheckoutSession for new payments")}async confirmPayment(n){throw new Error("Payment confirmation is handled by Stripe checkout")}async updatePaymentMethod(n){return this.setDefaultPaymentMethod(n)}}const B=new tt,st=()=>{var F;const m=_(t=>t.addNotification),[n,i]=p.useState("monthly"),[u,y]=p.useState(null),{data:c,isLoading:h}=ve(),{data:f=[],isLoading:b}=Se(n),I=t=>{const a=[];return t.features.patientLimit?t.features.patientLimit===-1?a.push("Unlimited patients"):a.push(`Up to ${t.features.patientLimit} patients`):a.push("Unlimited patients"),t.features.reminderSmsMonthlyLimit&&(t.features.reminderSmsMonthlyLimit===-1?a.push("Unlimited SMS reminders"):a.push(`${t.features.reminderSmsMonthlyLimit} SMS reminders/month`)),t.features.reportsExport&&a.push("Export reports"),t.features.careNoteExport&&a.push("Export care notes"),t.features.adrModule&&a.push("ADR monitoring"),t.features.multiUserSupport&&a.push("Multi-user support"),t.features.teamSize&&(t.features.teamSize===-1?a.push("Unlimited team members"):a.push(`Up to ${t.features.teamSize} team members`)),t.features.apiAccess&&a.push("API access"),t.features.customIntegrations&&a.push("Custom integrations"),t.features.prioritySupport&&a.push("Priority support"),t.features.adrReporting&&a.push("ADR Reporting"),t.features.drugInteractionChecker&&a.push("Drug Interaction Checker"),t.features.doseCalculator&&a.push("Dose Calculator"),t.features.multiLocationDashboard&&a.push("Multi-location Dashboard"),t.features.sharedPatientRecords&&a.push("Shared Patient Records"),t.features.groupAnalytics&&a.push("Group Analytics"),t.features.cdss&&a.push("Clinical Decision Support System"),a},j=["free_trial","basic","pro","pharmily","network","enterprise"],A=f.sort((t,a)=>j.indexOf(t.tier)-j.indexOf(a.tier)),l=t=>{var a,r;return((r=(a=c==null?void 0:c.subscription)==null?void 0:a.planId)==null?void 0:r._id)===t},v=()=>{var t,a;if(((t=c==null?void 0:c.subscription)==null?void 0:t.status)==="trial"&&((a=c==null?void 0:c.subscription)!=null&&a.endDate)){const r=new Date(c.subscription.endDate),d=new Date,C=r.getTime()-d.getTime(),z=Math.ceil(C/(1e3*60*60*24));return Math.max(0,z)}return 0},x=async t=>{var a;if(t.isContactSales&&t.whatsappNumber){const r=encodeURIComponent(`Hello! I'm interested in the ${t.name} plan for my pharmacy. Could you please provide more details about pricing and features?`),d=`https://wa.me/${t.whatsappNumber.replace(/[^0-9]/g,"")}?text=${r}`;window.open(d,"_blank");return}if(l(t._id)){m({type:"info",title:"Already Subscribed",message:"You are already subscribed to this plan",duration:3e3});return}y(t._id);try{const r=await Ce.createCheckoutSession(t._id,n);if(r.success&&((a=r.data)!=null&&a.authorization_url))window.location.href=r.data.authorization_url;else throw new Error(r.message||"Failed to create checkout session")}catch(r){const d=r instanceof Error?r.message:"Failed to initiate subscription";m({type:"error",title:"Subscription Error",message:d,duration:5e3})}finally{y(null)}},k=(t,a)=>{const r=new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN",minimumFractionDigits:0}).format(t);if(a==="yearly"){const d=Math.round(t/12);return`${r}/year (₦${d.toLocaleString()}/mo)`}return`${r}/month`},L=t=>{switch(t){case"free_trial":return e.jsx(N,{color:"action"});case"basic":return e.jsx(K,{color:"primary"});case"pro":return e.jsx(ee,{color:"secondary"});case"pharmily":return e.jsx(ae,{color:"info"});case"network":return e.jsx(de,{color:"warning"});case"enterprise":return e.jsx(ae,{color:"success"});default:return e.jsx(N,{color:"action"})}},U=t=>{const a=t*12*.75,r=t*12,C=(r-a)/r*100;return Math.round(C)};if(h||b)return e.jsxs(Q,{maxWidth:"lg",sx:{py:4},children:[e.jsx(o,{sx:{display:"flex",alignItems:"center",mb:4},children:e.jsx(X,{sx:{width:"100%"}})}),e.jsx(s,{variant:"h6",align:"center",children:"Loading subscription plans..."})]});const R=v();return e.jsxs(Q,{maxWidth:"lg",sx:{py:4},children:[e.jsxs(o,{sx:{mb:6,textAlign:"center"},children:[e.jsx(s,{variant:"h3",component:"h1",gutterBottom:!0,fontWeight:"bold",children:"Subscription Plans"}),e.jsx(s,{variant:"h6",color:"text.secondary",sx:{mb:4},children:"Choose the perfect plan for your pharmacy needs"}),(c==null?void 0:c.subscription)&&e.jsx(T,{severity:c.subscription.status==="trial"?"info":"success",sx:{mb:4,maxWidth:600,mx:"auto"},children:e.jsx(s,{variant:"body1",children:c.subscription.status==="trial"?e.jsxs(e.Fragment,{children:["You are currently on a ",e.jsx("strong",{children:"Free Trial"}),R>0?e.jsxs(e.Fragment,{children:[" ","with ",e.jsxs("strong",{children:[R," days remaining"]})]}):e.jsxs(e.Fragment,{children:[" ","that has ",e.jsx("strong",{children:"expired"})]})]}):e.jsxs(e.Fragment,{children:["Current Plan:"," ",e.jsx("strong",{children:((F=c.subscription.planId)==null?void 0:F.name)||"Unknown"})]})})}),e.jsx(G,{elevation:1,sx:{display:"inline-flex",p:1,mb:4},children:e.jsx(we,{control:e.jsx($e,{checked:n==="yearly",onChange:t=>i(t.target.checked?"yearly":"monthly"),color:"primary"}),label:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(s,{variant:"body2",children:n==="monthly"?"Monthly":"Yearly"}),n==="yearly"&&e.jsx(O,{label:"Save 25%",size:"small",color:"success",variant:"outlined"})]})})})]}),e.jsx(o,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",sm:"repeat(2, 1fr)",md:"repeat(3, 1fr)"},gap:3,mb:6,justifyItems:"center"},children:A.map(t=>e.jsx(o,{children:e.jsxs(S,{elevation:t.popularPlan?8:2,sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",border:t.popularPlan?2:1,borderColor:t.popularPlan?"primary.main":"divider",transform:t.popularPlan?"scale(1.05)":"none",transition:"all 0.3s ease-in-out","&:hover":{transform:t.popularPlan?"scale(1.07)":"scale(1.02)",boxShadow:a=>a.shadows[8]}},children:[t.popularPlan&&e.jsx(o,{sx:{position:"absolute",top:-10,left:"50%",transform:"translateX(-50%)",zIndex:1},children:e.jsx(O,{label:"Most Popular",color:"primary",icon:e.jsx(N,{}),sx:{fontWeight:"bold"}})}),e.jsxs(w,{sx:{flexGrow:1,pt:t.popularPlan?4:2},children:[e.jsxs(o,{sx:{textAlign:"center",mb:3},children:[e.jsx(o,{sx:{mb:2},children:L(t.tier)}),e.jsx(s,{variant:"h5",component:"h2",fontWeight:"bold",gutterBottom:!0,children:t.name}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:2},children:t.description}),t.tier==="free_trial"?e.jsxs(o,{children:[e.jsx(s,{variant:"h3",fontWeight:"bold",color:"primary.main",children:"Free"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"14-day trial"})]}):t.isContactSales?e.jsxs(o,{children:[e.jsx(s,{variant:"h5",fontWeight:"bold",color:"primary.main",children:"Contact Sales"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Custom pricing"})]}):e.jsxs(o,{children:[e.jsx(s,{variant:"h3",fontWeight:"bold",color:"primary.main",children:k(t.priceNGN,n).split("/")[0]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["/",n==="monthly"?"month":"year"]}),n==="yearly"&&e.jsxs(s,{variant:"caption",color:"success.main",fontWeight:"bold",children:["Save ₦",U(t.priceNGN).toLocaleString(),"/month"]})]})]}),e.jsx(xe,{sx:{mb:2}}),e.jsx(pe,{dense:!0,sx:{mb:3},children:I(t).slice(0,6).map((a,r)=>e.jsxs(ye,{disablePadding:!0,children:[e.jsx(je,{sx:{minWidth:32},children:e.jsx(Z,{color:"success",fontSize:"small"})}),e.jsx(ge,{primary:a,primaryTypographyProps:{variant:"body2",fontSize:"0.875rem"}})]},r))}),e.jsx(P,{variant:t.popularPlan?"contained":"outlined",color:t.popularPlan?"primary":"inherit",fullWidth:!0,size:"large",disabled:u===t._id||l(t._id),onClick:()=>x(t),sx:{mt:"auto",fontWeight:"bold",py:1.5},children:u===t._id?"Processing...":l(t._id)?"Current Plan":t.isContactSales?"Contact Sales":"Subscribe Now"})]})]})},t._id))}),e.jsxs(o,{sx:{textAlign:"center",mt:6},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"All plans include"}),e.jsxs(o,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mt:2,justifyContent:"center",alignItems:"center"},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(K,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"body2",children:"Secure & Compliant"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(de,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"body2",children:"24/7 Support"})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx(Z,{color:"primary",sx:{mr:1}}),e.jsx(s,{variant:"body2",children:"No Setup Fees"})]})]})]})]})},nt=()=>{const[m,n]=p.useState([]),[i,u]=p.useState(!0),[y,c]=p.useState(!1),[h,f]=p.useState(1),[b,I]=p.useState(0),[j,A]=p.useState({status:"",dateFrom:null,dateTo:null}),[l,v]=p.useState({totalAmount:0,totalPayments:0,successfulPayments:0,failedPayments:0}),x=_(r=>r.addNotification),k=p.useCallback(async()=>{var r,d;u(!0);try{const C=(r=j.dateFrom)==null?void 0:r.toISOString().split("T")[0],z=(d=j.dateTo)==null?void 0:d.toISOString().split("T")[0],E=await B.getPayments(h,10,j.status||void 0,C,z);n(E.payments),I(E.pagination.totalPages),v(E.summary)}catch(C){console.error("Error loading payments:",C),x({type:"error",title:"Error",message:"Failed to load billing history",duration:5e3})}finally{u(!1)}},[h,j,x]);p.useEffect(()=>{k()},[k]);const L=(r,d)=>{A(C=>({...C,[r]:d})),f(1)},U=()=>{A({status:"",dateFrom:null,dateTo:null}),f(1)},R=r=>{switch(r){case"completed":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"info";default:return"default"}},F=r=>{switch(r){case"completed":return"Completed";case"pending":return"Pending";case"failed":return"Failed";case"refunded":return"Refunded";default:return r}},t=(r,d="NGN")=>new Intl.NumberFormat("en-NG",{style:"currency",currency:d}).format(r),a=async r=>{c(!0);try{const d=await B.generateInvoice(r),C=`
INVOICE: ${d.invoiceNumber}
Date: ${new Date(d.date).toLocaleDateString()}
Customer: ${d.customer.name}
Email: ${d.customer.email}

Items:
${d.items.map(Y=>`- ${Y.description}: ${t(Y.amount)} x ${Y.quantity}`).join(`
`)}

Total: ${t(d.amount,d.currency)}
Status: ${d.status}
Payment Method: ${d.paymentMethod}
      `,z=new Blob([C],{type:"text/plain"}),E=URL.createObjectURL(z),J=document.createElement("a");J.href=E,J.download=`invoice-${d.invoiceNumber}.txt`,J.click(),URL.revokeObjectURL(E),x({type:"success",title:"Download Complete",message:"Invoice downloaded successfully",duration:3e3})}catch(d){console.error("Error downloading invoice:",d),x({type:"error",title:"Download Failed",message:"Failed to download invoice",duration:5e3})}finally{c(!1)}};return i&&h===1?e.jsx(re,{message:"Loading billing history..."}):e.jsx(qe,{dateAdapter:Ge,children:e.jsxs(o,{children:[e.jsx(s,{variant:"h5",gutterBottom:!0,children:"Billing History"}),e.jsxs(o,{display:"flex",flexWrap:"wrap",gap:3,sx:{mb:4},children:[e.jsx(o,{flex:"1 1 200px",children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Total Spent"}),e.jsx(s,{variant:"h4",component:"div",children:t(l.totalAmount)})]})})}),e.jsx(o,{flex:"1 1 200px",children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Total Payments"}),e.jsx(s,{variant:"h4",component:"div",children:l.totalPayments})]})})}),e.jsx(o,{flex:"1 1 200px",children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Successful"}),e.jsx(s,{variant:"h4",component:"div",color:"success.main",children:l.successfulPayments})]})})}),e.jsx(o,{flex:"1 1 200px",children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{color:"text.secondary",gutterBottom:!0,variant:"body2",children:"Failed"}),e.jsx(s,{variant:"h4",component:"div",color:"error.main",children:l.failedPayments})]})})})]}),e.jsx(S,{sx:{mb:3},children:e.jsx(w,{children:e.jsxs(o,{display:"flex",flexWrap:"wrap",gap:2,alignItems:"center",children:[e.jsxs(Pe,{size:"small",sx:{minWidth:120},children:[e.jsx(Ie,{children:"Status"}),e.jsxs(De,{value:j.status,label:"Status",onChange:r=>L("status",r.target.value),children:[e.jsx($,{value:"",children:"All"}),e.jsx($,{value:"completed",children:"Completed"}),e.jsx($,{value:"pending",children:"Pending"}),e.jsx($,{value:"failed",children:"Failed"}),e.jsx($,{value:"refunded",children:"Refunded"})]})]}),e.jsxs(o,{display:"flex",gap:2,alignItems:"center",children:[e.jsx(P,{variant:"outlined",startIcon:e.jsx(_e,{}),onClick:()=>{},children:"Filter"}),e.jsx(P,{variant:"text",startIcon:e.jsx(We,{}),onClick:U,children:"Clear"})]})]})})}),e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(Ve,{children:e.jsxs(Je,{children:[e.jsx(Ye,{children:e.jsxs(ue,{children:[e.jsx(D,{children:"Date"}),e.jsx(D,{children:"Amount"}),e.jsx(D,{children:"Plan"}),e.jsx(D,{children:"Status"}),e.jsx(D,{children:"Payment Method"}),e.jsx(D,{align:"right",children:"Actions"})]})}),e.jsx(He,{children:m.map(r=>{var d,C;return e.jsxs(ue,{hover:!0,children:[e.jsx(D,{children:new Date(r.createdAt).toLocaleDateString()}),e.jsx(D,{children:e.jsx(s,{fontWeight:"medium",children:t(r.amount,r.currency.toUpperCase())})}),e.jsx(D,{children:((C=(d=r.subscription)==null?void 0:d.planId)==null?void 0:C.name)||"N/A"}),e.jsx(D,{children:e.jsx(O,{label:F(r.status),color:R(r.status),size:"small"})}),e.jsx(D,{children:e.jsx(s,{variant:"body2",sx:{textTransform:"capitalize"},children:r.paymentMethod.replace("_"," ")})}),e.jsx(D,{align:"right",children:e.jsx(Me,{title:"Download Invoice",children:e.jsx(te,{size:"small",onClick:()=>a(r._id),disabled:y,children:e.jsx(Oe,{})})})})]},r._id)})})]})}),e.jsx(o,{display:"flex",justifyContent:"center",sx:{mt:3},children:e.jsx(Qe,{count:b,page:h,onChange:(r,d)=>f(d),color:"primary"})})]})})]})})},rt=({onSuccess:m,onCancel:n})=>{const[i,u]=p.useState(!1),[y,c]=p.useState(null),[h,f]=p.useState(!1),b=_(j=>j.addNotification),I=async j=>{j.preventDefault(),c("Stripe integration is not yet implemented. Please install @stripe/stripe-js and @stripe/react-stripe-js packages."),console.log("Variables ready for Stripe integration:",{onSuccess:m,setLoading:u,addNotification:b})};return e.jsxs(o,{component:"form",onSubmit:I,children:[e.jsxs(o,{sx:{mb:3},children:[e.jsx(s,{variant:"subtitle2",gutterBottom:!0,children:"Card Information"}),e.jsx(o,{sx:{p:2,border:"1px solid",borderColor:"divider",borderRadius:1,textAlign:"center",color:"text.secondary","&:focus-within":{borderColor:"primary.main"}},children:e.jsx(s,{variant:"body2",children:"Stripe Card Element will be rendered here when Stripe packages are installed"})})]}),y&&e.jsx(T,{severity:"error",sx:{mb:2},children:y}),e.jsx(o,{sx:{mb:3},children:e.jsx(P,{variant:h?"contained":"outlined",size:"small",onClick:()=>f(!h),startIcon:h?e.jsx(N,{}):e.jsx(fe,{}),children:"Set as default payment method"})}),e.jsxs(g,{direction:"row",spacing:2,justifyContent:"flex-end",children:[e.jsx(P,{onClick:n,disabled:i,children:"Cancel"}),e.jsx(P,{type:"submit",variant:"contained",disabled:i,startIcon:i?e.jsx(se,{size:16}):e.jsx(ne,{}),children:i?"Adding...":"Add Payment Method"})]})]})},at=()=>{const[m,n]=p.useState([]),[i,u]=p.useState(!0),[y,c]=p.useState(!1),[h,f]=p.useState(!1),[b,I]=p.useState(null),[j,A]=p.useState(null),l=_(t=>t.addNotification),v=p.useCallback(async()=>{u(!0);try{const t=await B.getPaymentMethods();n(t)}catch(t){console.error("Error loading payment methods:",t),l({type:"error",title:"Error",message:"Failed to load payment methods",duration:5e3})}finally{u(!1)}},[l]);p.useEffect(()=>{v()},[v]);const x=async t=>{A(t);try{await B.setDefaultPaymentMethod(t),await v(),l({type:"success",title:"Default Updated",message:"Default payment method updated successfully",duration:3e3})}catch(a){console.error("Error setting default payment method:",a),l({type:"error",title:"Error",message:"Failed to update default payment method",duration:5e3})}finally{A(null)}},k=()=>{if(!b)return;const t=m.find(a=>a.id===b);if(t!=null&&t.isDefault){l({type:"warning",title:"Cannot Delete",message:"Cannot delete the default payment method. Please set another method as default first.",duration:5e3}),f(!1),I(null);return}L()},L=async()=>{if(b){A(b);try{await B.removePaymentMethod(b),await v(),l({type:"success",title:"Payment Method Removed",message:"Payment method removed successfully",duration:3e3})}catch(t){console.error("Error removing payment method:",t),l({type:"error",title:"Error",message:"Failed to remove payment method",duration:5e3})}finally{A(null),f(!1),I(null)}}},U=()=>e.jsx(ie,{}),R=(t,a)=>`${t.toString().padStart(2,"0")}/${a.toString().slice(-2)}`,F=()=>{c(!1),v()};return i?e.jsx(re,{message:"Loading payment methods..."}):e.jsxs(o,{children:[e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:3},children:[e.jsx(s,{variant:"h5",children:"Payment Methods"}),e.jsx(P,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:()=>c(!0),children:"Add Payment Method"})]}),e.jsx(T,{severity:"info",icon:e.jsx(K,{}),sx:{mb:3},children:"Your payment information is securely stored and encrypted. We never store your full card details on our servers."}),m.length===0?e.jsx(S,{children:e.jsxs(w,{sx:{textAlign:"center",py:6},children:[e.jsx(ie,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"No Payment Methods"}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Add a payment method to manage your subscription and billing."}),e.jsx(P,{variant:"contained",startIcon:e.jsx(ne,{}),onClick:()=>c(!0),children:"Add Your First Payment Method"})]})}):e.jsx(V,{container:!0,spacing:3,children:m.map(t=>e.jsx(V,{size:{xs:12,md:6},children:e.jsx(S,{variant:"outlined",children:e.jsx(w,{children:e.jsxs(g,{direction:"row",spacing:2,alignItems:"flex-start",children:[e.jsx(o,{sx:{color:"text.secondary"},children:U()}),e.jsxs(o,{sx:{flexGrow:1},children:[e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",sx:{mb:1},children:[e.jsx(s,{variant:"subtitle1",sx:{textTransform:"capitalize"},children:t.brand}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["•••• ",t.last4]}),t.isDefault&&e.jsx(O,{label:"Default",size:"small",color:"primary",icon:e.jsx(N,{})})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["Expires"," ",R(t.expiryMonth,t.expiryYear)]}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Added ",new Date(t.createdAt).toLocaleDateString()]})]}),e.jsxs(g,{direction:"row",spacing:1,children:[!t.isDefault&&e.jsx(te,{size:"small",onClick:()=>x(t.id),disabled:j===t.id,title:"Set as default",children:j===t.id?e.jsx(se,{size:16}):e.jsx(fe,{})}),e.jsx(te,{size:"small",color:"error",onClick:()=>{I(t.id),f(!0)},disabled:j===t.id,title:"Remove payment method",children:j===t.id?e.jsx(se,{size:16}):e.jsx(Xe,{})})]})]})})})},t.id))}),e.jsxs(oe,{open:y,onClose:()=>c(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ce,{children:"Add Payment Method"}),e.jsx(le,{children:e.jsx(rt,{onSuccess:F,onCancel:()=>c(!1)})})]}),e.jsxs(oe,{open:h,onClose:()=>f(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(ce,{children:"Remove Payment Method"}),e.jsxs(le,{children:[e.jsx(s,{variant:"body1",gutterBottom:!0,children:"Are you sure you want to remove this payment method?"}),e.jsx(T,{severity:"warning",sx:{mt:2},children:"This action cannot be undone. Make sure you have another payment method set up for your subscription."})]}),e.jsxs(Ae,{children:[e.jsx(P,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(P,{onClick:k,color:"error",variant:"contained",children:"Remove Payment Method"})]})]})]})},M=({children:m,...n})=>{const i={item:!0,...n};return e.jsx(V,{...i,children:m})},H=({children:m,...n})=>{const i={container:!0,...n};return e.jsx(V,{...i,children:m})},it=()=>{const[m,n]=p.useState(null),[i,u]=p.useState(!0),y=_(x=>x.addNotification),c=p.useCallback(async()=>{u(!0);try{const x=await B.getSubscriptionAnalytics();n(x)}catch(x){console.error("Error loading analytics:",x),y({type:"error",title:"Error",message:"Failed to load subscription analytics",duration:5e3})}finally{u(!1)}},[y]);p.useEffect(()=>{c()},[c]);const h=x=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(x),f=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),b=(x,k)=>k===-1?0:Math.min(x/k*100,100),I=x=>x>=90?"error":x>=75?"warning":"success",j=x=>x<=7?"error":x<=30?"warning":"success";if(i)return e.jsx(re,{message:"Loading analytics..."});if(!m)return e.jsx(T,{severity:"info",children:"No analytics data available. Please ensure you have an active subscription."});const{subscription:A,usageMetrics:l,costOptimization:v}=m;return e.jsxs(o,{children:[e.jsxs(g,{direction:"row",spacing:2,alignItems:"center",sx:{mb:4},children:[e.jsx(ke,{}),e.jsx(s,{variant:"h5",children:"Subscription Analytics"})]}),e.jsxs(H,{spacing:3,children:[e.jsx(M,{xs:12,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Current Billing Period"}),e.jsxs(H,{spacing:3,children:[e.jsx(M,{xs:12,md:4,children:e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Period"}),e.jsxs(s,{variant:"body1",children:[f(l.currentPeriodStart)," -"," ",f(l.currentPeriodEnd)]})]})}),e.jsx(M,{xs:12,md:4,children:e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Days Remaining"}),e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(s,{variant:"h6",children:l.daysRemaining}),e.jsx(O,{label:l.daysRemaining<=7?"Ending Soon":"Active",color:j(l.daysRemaining),size:"small",icon:e.jsx(Te,{})})]})]})}),e.jsx(M,{xs:12,md:4,children:e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Plan"}),e.jsx(s,{variant:"h6",sx:{textTransform:"capitalize"},children:A.tier.replace("_"," ")})]})})]})]})})}),e.jsx(M,{xs:12,md:8,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Usage Metrics"}),e.jsxs(H,{spacing:3,children:[e.jsx(M,{xs:12,children:e.jsxs(o,{sx:{mb:2},children:[e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Le,{color:"primary"}),e.jsx(s,{variant:"body2",children:"Storage Usage"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[l.storageUsed," GB used"]})]}),e.jsx(X,{variant:"determinate",value:b(l.storageUsed,10),color:I(b(l.storageUsed,10)),sx:{height:8,borderRadius:4}})]})}),e.jsx(M,{xs:12,children:e.jsxs(o,{sx:{mb:2},children:[e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{mb:1},children:[e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ke,{color:"primary"}),e.jsx(s,{variant:"body2",children:"API Calls This Month"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[l.apiCalls.toLocaleString()," calls"]})]}),e.jsx(X,{variant:"determinate",value:b(l.apiCalls,1e4),color:I(b(l.apiCalls,1e4)),sx:{height:8,borderRadius:4}})]})}),e.jsx(M,{xs:12,children:e.jsx(o,{children:e.jsxs(g,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Re,{color:"primary"}),e.jsx(s,{variant:"body2",children:"Team Members"})]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:[l.teamMembers," members"]})]})})})]})]})})}),e.jsx(M,{xs:12,md:4,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Cost Overview"}),e.jsxs(g,{spacing:2,children:[e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Current Monthly Cost"}),e.jsx(s,{variant:"h5",color:"primary.main",children:h(v.currentMonthlySpend)})]}),e.jsx(xe,{}),e.jsxs(o,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",children:"Projected Annual Cost"}),e.jsx(s,{variant:"h6",children:h(v.projectedAnnualSpend)})]}),v.savings.yearlyVsMonthly>0&&e.jsx(T,{severity:"info",icon:e.jsx(he,{}),children:e.jsxs(s,{variant:"body2",children:["Save"," ",h(v.savings.yearlyVsMonthly)," ","with annual billing"]})})]})]})})}),e.jsx(M,{xs:12,md:6,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Active Features"}),e.jsx(pe,{dense:!0,children:l.features.map((x,k)=>e.jsxs(ye,{children:[e.jsx(je,{children:e.jsx(Z,{color:"success"})}),e.jsx(ge,{primary:x.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase())})]},k))})]})})}),e.jsx(M,{xs:12,md:6,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Optimization Suggestions"}),e.jsxs(g,{spacing:2,children:[l.daysRemaining<=7&&e.jsx(T,{severity:"warning",icon:e.jsx(Fe,{}),children:e.jsxs(s,{variant:"body2",children:["Your subscription renews in ",l.daysRemaining," ","days. Consider switching to annual billing to save money."]})}),b(l.storageUsed,10)>80&&e.jsx(T,{severity:"info",children:e.jsxs(s,{variant:"body2",children:["You're using"," ",Math.round(b(l.storageUsed,10)),"% of your storage. Consider upgrading your plan if you need more space."]})}),v.savings.yearlyVsMonthly>0&&e.jsx(G,{sx:{p:2,bgcolor:"success.light",color:"success.contrastText"},children:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(ee,{}),e.jsxs(o,{children:[e.jsx(s,{variant:"subtitle2",children:"Annual Billing Savings"}),e.jsxs(s,{variant:"body2",children:["Switch to annual billing and save"," ",h(v.savings.yearlyVsMonthly)," ","per year!"]})]})]})}),l.storageUsed<2&&l.apiCalls<1e3&&e.jsx(G,{sx:{p:2,bgcolor:"info.light",color:"info.contrastText"},children:e.jsxs(g,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(Ze,{}),e.jsxs(o,{children:[e.jsx(s,{variant:"subtitle2",children:"Consider Downgrading"}),e.jsx(s,{variant:"body2",children:"Based on your usage, you might be able to save money with a lower-tier plan."})]})]})})]})]})})}),e.jsx(M,{xs:12,children:e.jsx(S,{children:e.jsxs(w,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Quick Actions"}),e.jsxs(g,{direction:"row",spacing:2,flexWrap:"wrap",useFlexGap:!0,children:[e.jsx(P,{variant:"outlined",startIcon:e.jsx(Ee,{}),onClick:()=>window.location.href="/dashboard/subscription/billing-history",children:"View Billing History"}),e.jsx(P,{variant:"outlined",startIcon:e.jsx(ee,{}),onClick:()=>window.location.href="/dashboard/subscription/plans",children:"Upgrade Plan"}),e.jsx(P,{variant:"outlined",startIcon:e.jsx(he,{}),onClick:()=>window.location.href="/dashboard/subscription/payment-methods",children:"Manage Payment Methods"}),v.savings.yearlyVsMonthly>0&&e.jsx(P,{variant:"contained",startIcon:e.jsx(N,{}),color:"success",children:"Switch to Annual Billing"})]})]})})})]})]})},ot=({feature:m,requiredRole:n,requiresLicense:i=!1,children:u,fallback:y=null})=>{const{role:c}=Ne(),{isFeatureEnabled:h}=Be();return h(m)?n&&!(Array.isArray(n)?n:[n]).includes(c)?e.jsx(e.Fragment,{children:y}):e.jsx(e.Fragment,{children:u}):e.jsx(e.Fragment,{children:y})},q=m=>{const{children:n,value:i,index:u,...y}=m;return e.jsx("div",{role:"tabpanel",hidden:i!==u,id:`subscription-tabpanel-${u}`,"aria-labelledby":`subscription-tab-${u}`,...y,children:i===u&&e.jsx(o,{sx:{p:3},children:n})})},It=()=>{const[m,n]=p.useState(0),i=(u,y)=>{n(y)};return e.jsx(Q,{maxWidth:"xl",children:e.jsxs(o,{sx:{p:3},children:[e.jsx(s,{variant:"h4",component:"h1",gutterBottom:!0,children:"Subscription Management"}),e.jsx(G,{sx:{width:"100%",mb:4},children:e.jsxs(Ue,{value:m,onChange:i,indicatorColor:"primary",textColor:"primary",variant:"fullWidth","aria-label":"subscription tabs",children:[e.jsx(W,{label:"Plans"}),e.jsx(W,{label:"Billing History"}),e.jsx(W,{label:"Payment Methods"}),e.jsx(W,{label:"Analytics"})]})}),e.jsxs(ze,{children:[e.jsx(q,{value:m,index:0,children:e.jsx(st,{})}),e.jsx(q,{value:m,index:1,children:e.jsx(nt,{})}),e.jsx(q,{value:m,index:2,children:e.jsx(at,{})}),e.jsx(q,{value:m,index:3,children:e.jsx(ot,{feature:"advanced_analytics",children:e.jsx(it,{})})})]})]})})};export{It as default};
