<!DOCTYPE html>
<html>
  <head>
    <title>Subscription Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <h1>Subscription Test Page</h1>
    <button onclick="testSubscription()">Test Basic Plan Subscription</button>
    <div id="result"></div>

    <script>
      // Configure axios to use cookies
      axios.defaults.withCredentials = true;

      async function testSubscription() {
        try {
          console.log('Testing subscription...');

          // First, let's get the available plans
          const plansResponse = await axios.get(
            'http://localhost:5000/api/subscription-management/plans?billingInterval=monthly'
          );
          console.log('Available plans:', plansResponse.data);

          if (
            plansResponse.data.success &&
            plansResponse.data.data.length > 0
          ) {
            const basicPlan = plansResponse.data.data.find(
              (plan) => plan.tier === 'basic'
            );

            if (basicPlan) {
              console.log('Found basic plan:', basicPlan);

              // Now try to create a checkout session
              const checkoutResponse = await axios.post(
                'http://localhost:5000/api/subscription-management/checkout',
                {
                  planId: basicPlan._id,
                  billingInterval: 'monthly',
                }
              );

              console.log('Checkout response:', checkoutResponse.data);
              document.getElementById('result').innerHTML =
                '<pre>' +
                JSON.stringify(checkoutResponse.data, null, 2) +
                '</pre>';

              if (
                checkoutResponse.data.success &&
                checkoutResponse.data.data &&
                checkoutResponse.data.data.checkoutUrl
              ) {
                const checkoutUrl = checkoutResponse.data.data.checkoutUrl;
                console.log('Redirecting to:', checkoutUrl);
                setTimeout(() => {
                  window.location.href = checkoutUrl;
                }, 2000);
              }
            } else {
              console.log('Basic plan not found');
              document.getElementById('result').innerHTML =
                'Basic plan not found';
            }
          }
        } catch (error) {
          console.error('Error:', error);
          document.getElementById('result').innerHTML =
            '<pre style="color: red;">' +
            JSON.stringify(error.response?.data || error.message, null, 2) +
            '</pre>';
        }
      }
    </script>
  </body>
</html>
